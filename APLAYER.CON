//************************************************************************************************************************
//************************************************************************************************************************
//************************************************************************************************************************
//******************************************Here Comes the Huge APLAYER code O.O******************************************
//************************************************************************************************************************
//************************************************************************************************************************
//************************************************************************************************************************

actor APLAYER MAXPLAYERHEALTH PSTAND 0 0
/*
ifvare player[THISACTOR].player_par 2
{
 ifvarvarn CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
 ifvarvarn CURRENTENERGYPOINTS MAXENERGYPOINTS setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTS
}
*/
setvar MISCARRAYID 229 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANK-POINTS-LOWEST
ifvarvarl RANKPOINTS MISCARRAYID_AMOUNTTEMP setvarvar RANKPOINTS MISCARRAYID_AMOUNTTEMP
setvar MISCARRAYID 230 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANK-POINTS-HIGHEST
ifvarvarg RANKPOINTS MISCARRAYID_AMOUNTTEMP setvarvar RANKPOINTS MISCARRAYID_AMOUNTTEMP

ifvare player[THISACTOR].pals_time 0
{
 setplayer[THISACTOR].pals 0 0 //Red
 setplayer[THISACTOR].pals 1 0 //Green
 setplayer[THISACTOR].pals 2 0 //Blue
}


ifvarg INVULNREFLECTRATE 2000 setvar INVULNREFLECTRATE 2000
ifvarg INVULNHEALTHDRAIN 2001 setvar INVULNHEALTHDRAIN 2001
ifvare CURRENTARMORPOINTS 0 state removecorrosion_armorgone // makes sure corrosion ailment is removed if it destroys your current armor.

ifvarn mainmenusubmenu 7 
{
 ifvare WORLDTILEVIEWMODE 2 { setvar WORLDTILEVIEWMODE 1 savegamevar WORLDTILEVIEWMODE }
}
else
{
 ifvare WORLDTILEVIEWMODE 2 { ifvare mainmenupage 10 ifvarg mainmenuselection 5 { setvar WORLDTILEVIEWMODE 1 savegamevar WORLDTILEVIEWMODE } }
}

ifvare mainmenu 1 ifvarg mainmenutransitiontimer 6
{
 setvar MISCARRAYID 88 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-ang
 addvar MISCARRAYID_AMOUNTTEMP 37
 setvar MISCARRAYID 88 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-ang

 getplayer[THISACTOR].ang temp
 getplayer[THISACTOR].oang tempb
 getincangle angvar temp tempb
 divvar angvar 3
 setvar MISCARRAYID 86 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-x
 subvarvar MISCARRAYID_AMOUNTTEMP angvar
 setplayer[THISACTOR].ang player[THISACTOR].oang
 ifvarl MISCARRAYID_AMOUNTTEMP 0 setvar MISCARRAYID_AMOUNTTEMP 0
 ifvarg MISCARRAYID_AMOUNTTEMP 320 setvar MISCARRAYID_AMOUNTTEMP 320
 setvar MISCARRAYID 86 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-x

 getplayer[THISACTOR].horiz temp
 getplayer[THISACTOR].ohoriz tempb
 subvarvar temp tempb
 getuserdef[THISACTOR].mouseflip tempc
 setvar MISCARRAYID 87 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-y
 ifvare tempc 0 addvarvar MISCARRAYID_AMOUNTTEMP temp else subvarvar MISCARRAYID_AMOUNTTEMP temp
 ifvarl MISCARRAYID_AMOUNTTEMP 0 setvar MISCARRAYID_AMOUNTTEMP 0
 ifvarg MISCARRAYID_AMOUNTTEMP 200 setvar MISCARRAYID_AMOUNTTEMP 200
 setvar MISCARRAYID 87 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-y
}

ifvarg TIMERRAWFORMAT -1 ifvarl TIMERRAWFORMAT 3
{
 ifvare CHARACTERSELECTED? 1 { ifvare CURRENTENERGYPOINTS 0 { setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTS } } // addlogvar CURRENTENERGYPOINTS
 else
 {
  setvar CHARACTERARRAY 1
  getactorvar[CHARACTERARRAY].CHARACTEREP TEMPVAR
  getactorvar[CHARACTERARRAY].CHARACTERMAXEP TEMPVAR2
  ifvare TEMPVAR 0 setvarvar TEMPVAR TEMPVAR2
  setactorvar[CHARACTERARRAY].CHARACTEREP TEMPVAR
  // addlogvar TEMPVAR
 }
}

 // Determine Inventory Maximums
 ifvare EQUIPCHEAT? 0
 {
  ifvare SKILLLEVEL 0 setvar INVENTORYSLOTMAX 4
  ifvare SKILLLEVEL 1 setvar INVENTORYSLOTMAX 3
  ifvare SKILLLEVEL 2 setvar INVENTORYSLOTMAX 3
  ifvare SKILLLEVEL 3 setvar INVENTORYSLOTMAX 3
  ifvare SKILLLEVEL 4 setvar INVENTORYSLOTMAX 2
  ifvare SKILLLEVEL 5 setvar INVENTORYSLOTMAX 2
  ifvare SKILLLEVEL 6 setvar INVENTORYSLOTMAX 2
  ifvare SKILLLEVEL 7 setvar INVENTORYSLOTMAX 1
  ifvare SKILLLEVEL 8 setvar INVENTORYSLOTMAX 1
  ifvare SKILLLEVEL 9 setvar INVENTORYSLOTMAX 1
 }
 else
 {
  ifvare EQUIPCHEAT? 2 setvar INVENTORYSLOTMAX 8
  else setvar INVENTORYSLOTMAX 4
 } 
 state checkmysticsatchels ifvarg ITEMARRAYID_AMOUNTTEMP 0 addvarvar INVENTORYSLOTMAX ITEMARRAYID_AMOUNTTEMP
 ifvarl INVENTORYSLOTMAX 1 setvar INVENTORYSLOTMAX 1
 ifvarg INVENTORYSLOTMAX 8 setvar INVENTORYSLOTMAX 8


ifvare autosavetoggle 1 ifvarvare TIMERRAWFORMAT NEXTAUTOSAVEINTERVAL
{
 setvarvar LASTAUTOSAVEINTERVAL TIMERRAWFORMAT
 state reset_autosavetimes
 state autosave_slot10
}

ifvare shop_id -1 setvar shopamount 1
ifvarn atm_id -1 ifvarand atm_type 4
{
 addvar SOUNDPITCH -256
 setplayer[THISACTOR].sound_pitch SOUNDPITCH
 soundonce ATM_HUM 
 subvar SOUNDPITCH -256
 setplayer[THISACTOR].sound_pitch SOUNDPITCH
}

setvar MISCARRAYID 65 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // CHEAT-PHASE
ifvare MISCARRAYID_AMOUNTTEMP 1
{
 setplayer[THISACTOR].got_access 127
 setvar ACCESSCARDS? 127
 setvar MISCARRAYID 65 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CHEAT-PHASE
}

ifvare mainmenu 0 addvar RANKPAYMENTTIMER 1
ifvarvarl RANKPAYMENTTIMER RANKPAYMENTINTERVAL nullop
else
{
 setvarvar varname RANKPOINTS
 ifvarl varname -262143999 { setvar TEMPVAR 35 state rank_payment_stuff } // [O] Rank
 ifvarg varname -262144000 ifvarl varname -65536000 { setvar TEMPVAR 100 state rank_payment_stuff } // [N] Rank 
 ifvarg varname -65536001 ifvarl varname -16384000 { setvar TEMPVAR 250 state rank_payment_stuff } // [M] Rank
 ifvarg varname -16384001 ifvarl varname -4096000 { setvar TEMPVAR 375 state rank_payment_stuff } // [L] Rank
 ifvarg varname -4096001 ifvarl varname -1024000 { setvar TEMPVAR 500 state rank_payment_stuff } // [K] Rank
 ifvarg varname -1024001 ifvarl varname -256000 { setvar TEMPVAR 750 state rank_payment_stuff } // [J] Rank
 ifvarg varname -256001 ifvarl varname -64000 { setvar TEMPVAR 1000 state rank_payment_stuff } // [I] Rank
 ifvarg varname -64001 ifvarl varname -16000 { setvar TEMPVAR 1500 state rank_payment_stuff } // [H] Rank
 ifvarg varname -16001 ifvarl varname -4000 { setvar TEMPVAR 2000 state rank_payment_stuff } // [G] Rank
 ifvarg varname -4001 ifvarl varname 0 { setvar TEMPVAR 2250 state rank_payment_stuff } // [F] Rank
 ifvare varname 0 { setvar TEMPVAR 2500 state rank_payment_stuff } // [-] Rank
 ifvarg varname 0 ifvarl varname 4001 { setvar TEMPVAR 3750 state rank_payment_stuff } // [E] Rank
 ifvarg varname 4000 ifvarl varname 16001 { setvar TEMPVAR 5000 state rank_payment_stuff } // [D] Rank
 ifvarg varname 16000 ifvarl varname 64001 { setvar TEMPVAR 8000 state rank_payment_stuff } // [C] Rank
 ifvarg varname 64000 ifvarl varname 256001 { setvar TEMPVAR 12000 state rank_payment_stuff } // [B] Rank
 ifvarg varname 256000 ifvarl varname 1024001 { setvar TEMPVAR 26000 state rank_payment_stuff } // [A] Rank
 ifvarg varname 1024000 ifvarl varname 4096001 { setvar TEMPVAR 55000 state rank_payment_stuff } // [S] Rank
 ifvarg varname 4096000 ifvarl varname 16384001 { setvar TEMPVAR 120000 state rank_payment_stuff } // [SS] Rank
 ifvarg varname 16384000 ifvarl varname 65536000 { setvar TEMPVAR 280000 state rank_payment_stuff } // [Z] Rank
 ifvarg varname 65535999 ifvarl varname 262144000 { setvar TEMPVAR 640000 state rank_payment_stuff } // [ZZ] Rank
 ifvarg varname 262143999 { setvar TEMPVAR 2150000 state rank_payment_stuff } // [NR] Rank
 setvar RANKPAYMENTTIMER 0
}

state randomseedgen-2

// .textscale = Default ranges from 100 to 400 and increments in a value of 50, 100 150 200 etc.
setuserdef[THISACTOR].textscale 125

ifvare player[THISACTOR].player_par 1
{
 ifvarn rainstart 0 { setvarvar raining rainstart setvar rainstart -1 }
 ifvarn freezestart 0 { setvarvar freezingbase freezestart setvar freezestart -1 }
}

ifvarvarl player[THISACTOR].posz player[THISACTOR].truecz setplayer[THISACTOR].posz player[THISACTOR].truecz
//setactorvar[THISACTOR].ACTORMAXHP actorvar[THISACTOR].ACTORHP

        ifvarg MAXPISTOL 24576 setvar MAXPISTOL 24576
        ifvarg MAXSHOTGUN 24576 setvar MAXSHOTGUN 24576
        ifvarg MAXCHAINGUN 24576 setvar MAXCHAINGUN 24576
        ifvarg MAXRPG 24576 setvar MAXRPG 24576
        ifvarg MAXPIPEBOMB 24576 setvar MAXPIPEBOMB 24576
        ifvarg MAXSHRINKER 24576 setvar MAXSHRINKER 24576
        ifvarg MAXEXPANDER 24576 setvar MAXEXPANDER 24576
        ifvarg MAXDEVASTATOR 24576 setvar MAXDEVASTATOR 24576
        ifvarg MAXTRIPBOMB 24576 setvar MAXTRIPBOMB 24576
        ifvarg MAXFREEZER 24576 setvar MAXFREEZER 24576

state checkoverflowmods

state checkforexistingshikons
ifvare mainmenu 0
{
 ifvarn raining 0 state raincode

 ifvarl winterclothes 0 setvar winterclothes 0
 ifvarg winterclothes 100 setvar winterclothes 100
 ifvarl freezetimer 0 setvar freezetimer 0 
 setvarvar freezing freezingbase
 getactor[THISACTOR].sectnum TEMPVAR2 getactorvar[TEMPVAR2].freezingmod TEMPVAR3
 addvarvar freezing TEMPVAR3
 ifvarl freezing 0 setvar freezing 0
 ifvarn freezing 0 state freezecode_player
 else 
 {
  ifvarg freezetimer 0 { randvar tempb 2 ifrnd 128 mulvar tempb -1 addvar tempb 4 subvarvar freezetimer tempb }
 }
}

// Healing Sector
ifvare mainmenu 0 ifvarg CURRENTHITPOINTS 0
{
 getactor[THISACTOR].sectnum temph

 ifvarg actorvar[temph].healsectortype 0
 {
  addvar healsectordelaycur 1
  ifvarvarl healsectordelaycur actorvar[temph].healsectordelaymax nullop
  else
  {
   ifvarand actorvar[temph].healsectortype 1 // HP Healing
   {
    getactorvar[temph].healsectormaxheal TEMPVAR4
    ifvarg TEMPVAR4 0
    {
     mulvarvar TEMPVAR4 MAXHITPOINTS
     divvar TEMPVAR4 1000
    }
    else mulvar TEMPVAR4 -1
    
    ifvarvarl CURRENTHITPOINTS TEMPVAR4
    {
     getactorvar[temph].healsectoramount TEMPVAR5
     ifvarg TEMPVAR5 0
     {
      mulvarvar TEMPVAR5 MAXHITPOINTS
      divvar TEMPVAR5 1000
     }
     else mulvar TEMPVAR5 -1

     addvarvar CURRENTHITPOINTS TEMPVAR5
     ifvarvarg CURRENTHITPOINTS TEMPVAR4 setvarvar CURRENTHITPOINTS TEMPVAR4
     state checkbuddhamode
     ifvarn player[THISACTOR].over_shoulder_on 0
     {
      ifvarg TEMPVAR5 0
      {
       setvarvar SHOWDAMAGE TEMPVAR5
       setvar SHOWDAMAGETYPE 3
       setvarvar SHOWDAMAGEACTORID THISACTOR
       state showdamage
      }
     }
     sound MYSTERIOUS_HEALING // REGEN_HEALTH5
     setvar PLAYERHPDAMAGED? -1
    }
   }

   ifvarand actorvar[temph].healsectortype 2 // AP Healing
   {
    getactorvar[temph].healsectormaxheal TEMPVAR4
    ifvarg TEMPVAR4 0
    {
     mulvarvar TEMPVAR4 MAXARMORPOINTS
     divvar TEMPVAR4 1000
    }
    else mulvar TEMPVAR4 -1
    
    ifvarvarl CURRENTARMORPOINTS TEMPVAR4
    {
     getactorvar[temph].healsectoramount TEMPVAR5
     ifvarg TEMPVAR5 0
     {
      mulvarvar TEMPVAR5 MAXARMORPOINTS
      divvar TEMPVAR5 1000
     }
     else mulvar TEMPVAR5 -1

     getactorvar[temph].healsectorarmorab TEMPVAR3
     ifvarvarl ARMORPERCENT TEMPVAR3 setvarvar ARMORPERCENT TEMPVAR3

     addvarvar CURRENTARMORPOINTS TEMPVAR5
     ifvarvarg CURRENTARMORPOINTS TEMPVAR4 setvarvar CURRENTARMORPOINTS TEMPVAR4
     ifvarn player[THISACTOR].over_shoulder_on 0
     {
      ifvarg TEMPVAR5 0
      {
       setvarvar SHOWDAMAGE TEMPVAR5
       setvar SHOWDAMAGETYPE 4
       setvarvar SHOWDAMAGEACTORID THISACTOR
       state showdamage
      }
     }
     sound MYSTERIOUS_ARMOR // REGEN_ARMOR5
     setvar PLAYERAPDAMAGED? -1
    }
   }

   ifvarand actorvar[temph].healsectortype 4 // EP Healing
   {
    getactorvar[temph].healsectormaxheal TEMPVAR4
    ifvarg TEMPVAR4 0
    {
     mulvarvar TEMPVAR4 MAXENERGYPOINTS
     divvar TEMPVAR4 1000
    }
    else mulvar TEMPVAR4 -1
    
    ifvarvarl CURRENTENERGYPOINTS TEMPVAR4
    {
     getactorvar[temph].healsectoramount TEMPVAR5
     ifvarg TEMPVAR5 0
     {
      mulvarvar TEMPVAR5 MAXENERGYPOINTS
      divvar TEMPVAR5 1000
     }
     else mulvar TEMPVAR5 -1

     addvarvar CURRENTENERGYPOINTS TEMPVAR5
     ifvarvarg CURRENTENERGYPOINTS TEMPVAR4 setvarvar CURRENTENERGYPOINTS TEMPVAR4
     sound MYSTERIOUS_ENERGY
    }
   }

   setvar healsectordelaycur 0
  }
 }
 else
 {
  setvar healsectordelaycur 0
 }
}

// EP Drain code involving transformations or special items that drain the character's EP slowly [i.e. Loki Mask transformation, Mercury VR Visor, etc]
ifvare mainmenu 0
{
 ifvare CHARACTERSELECTED? 3 // Bubsy
 {
  setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 1 // If Bubsy's in "Loki Mask" form, drain EP
  {
   addvar TRANSFORMTIMER 1
   ifvarvarg TRANSFORMTIMER TRANSFORMTIMERMAX
   {
    ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 1
    setvar TRANSFORMTIMER 0
   }

   ifvarl CURRENTENERGYPOINTS 1
   {
    globalsound TELEPORTER
    redefinequote 334 ^10BUBSY HAS RUN OUT OF EP!
    setvarvar fta fta_normal setvar ftq 334
    setvar MISCARRAYID 103 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // BUBSY-FORM?
   }
  }
 }
 else
 ifvare CHARACTERSELECTED? 4 // Ami
 {
  ifvare player[THISACTOR].heat_on 1
  {
   addvar VRVISORMSG1 1
   setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
   ifvare MISCARRAYID_AMOUNTTEMP 1 // If Ami is using her VR Visor, drain EP
   {
    ifvarg VRVISORMSG1 155 { ifvarand CHEATBITFIELD? 128 nullop else { subvar CURRENTENERGYPOINTS 1 } setvar VRVISORMSG1 0 }
   }
   else
   {
    ifvarg VRVISORMSG1 64 { ifvarand CHEATBITFIELD? 128 nullop else { subvar CURRENTENERGYPOINTS 1 } setvar VRVISORMSG1 0 }
   }
   ifvarl CURRENTENERGYPOINTS 1
   {
    setplayer[THISACTOR].heat_on 0
    setvar MISCARRAYID 100 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // VISOR-OFF-SOUND
    ifvare MISCARRAYID_AMOUNTTEMP 0 
    {
     stopsound NITEVISION_ONOFF
     sound VRVISOR_OFF
     redefinequote 334 ^10AMI HAS RUN OUT OF EP!
     setvar MISCARRAYID 100 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // VISOR-OFF-SOUND
     setvar MISCARRAYID 99 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // VISOR-ON-SOUND
    }
   }
  }
  setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 2 // If Ami's in her "Balanced" form, drain EP
  {
   addvar TRANSFORMTIMER 1
   ifvarvarg TRANSFORMTIMER TRANSFORMTIMERMAX
   {
    ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 1
    setvar TRANSFORMTIMER 0
   }

   ifvarl CURRENTENERGYPOINTS 1
   {
    globalsound TELEPORTER
    redefinequote 334 ^10AMI HAS RUN OUT OF EP!
    setvarvar fta fta_normal setvar ftq 334
    
    ifrnd 128 { setvar MISCARRAYID 104 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 } else { setvar MISCARRAYID 104 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 } // AMI-FORM?
   }
  }
 }
 else
 ifvare CHARACTERSELECTED? 13 // Minako
 {
  setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 2 // If Minako's in her "Balanced" form, drain EP
  {
   addvar TRANSFORMTIMER 1
   ifvarvarg TRANSFORMTIMER TRANSFORMTIMERMAX
   {
    ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 1
    setvar TRANSFORMTIMER 0
   }

   ifvarvarl CURRENTENERGYPOINTS 1
   {
    globalsound TELEPORTER
    redefinequote 334 ^10MINAKO HAS RUN OUT OF EP!
    setvarvar fta fta_normal setvar ftq 334
    ifrnd 128 { setvar MISCARRAYID 113 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 } else { setvar MISCARRAYID 113 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 } // MINAKO-FORM? 
   }
  }
 }
}

 getactor[THISACTOR].sectnum tempf
 ifvare actorvar[tempf].SPACESECTOR? 1 // If In Space Sector
 {
  ifvare mainmenu 0
  {

   ifvarand CHEATBITFIELD? 32 nullop else
   {
    ifvarl INVULNTIME 1
    {
     ifvare VEHICLEID -1
     {
      setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
      ifvarl MISCARRAYID_AMOUNTTEMP 1
      {
       ifvare CHARACTERSELECTED? 14 nullop // Mystery Lady is able to breath in spaaaaaaace! :P
       else
       {
        // HP Damage
        ifvare CHARACTERSELECTED? 10 { setvarvar tempd MAXHITPOINTS mulvar tempd 1 divvar tempd 300 }
        else { setvarvar tempd MAXHITPOINTS mulvar tempd 3 divvar tempd 100 }

        ifvarand CHEATBITFIELD? 16
        {
         ifvarg tempd 0 { divvar tempd 1000 ifvarl tempd 1 setvar tempd 1 state cheatersound }
        }

        ifvarg CURRENTHITPOINTS 0
        {
         subvarvar CURRENTHITPOINTS tempd
         state checkbuddhamode
         ifvarg tempd 0 setvar PLAYERHPDAMAGED? 1
         ifvarl tempd 0 setvar PLAYERHPDAMAGED? -1
         ifvarn player[THISACTOR].over_shoulder_on 0
         {
          ifvarg tempd 0
          {
           setvarvar SHOWDAMAGE tempd
           setvar SHOWDAMAGETYPE 0
           setvarvar SHOWDAMAGEACTORID PLAYERID
           state showdamage
          }
         }

         ifvarg tempd 0
         {
          setvarvar PAINSOUNDFACTOR tempd
          state checkpainfactor

          setvar ATTACKINGACTORPICNUM BIGORBIT1
          getactor[THISACTOR].pal TEMP
          setvarvar ATTACKINGACTORPAL TEMP
          setvar ACTORCRITICAL? 0
          setvarvar PLAYERDAMAGETEMP tempd
          setactor[THISACTOR].htpicnum -1
          setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
          setvar ACTORCRITICAL? 0
          setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
          ifvarg actorvar[tempf].SPACESECTOR? 0 setvar HEALTHDAMAGETIMER 0

          state characterpainsounds
          setvarvar DAMAGEHUEFACTOR tempd
          state playerdamagehues-electrictype
         }
        }

       }
      }
     }
    }
    else
    {
     state invulnflash
    }
   }

  }
 }

 getplayer[THISACTOR].ang tempe
 ifvarl tempe 0 addvar tempe 2048
 ifvarg tempe 2047 subvar tempe 2048
 setplayer[THISACTOR].ang tempe

 ifvarg PLAYERPUSHINGTIMER 0 subvar PLAYERPUSHINGTIMER 1
 ifvarl PLAYERPUSHINGTIMER 0 addvar PLAYERPUSHINGTIMER 1

 state calcbank_interests
 state getskillusecosts

 // Lifting Strength
 setvarvar PLAYERLIFTSTRENGTHTEMP PLAYERLIFTSTRENGTH

 setvarvar TEMPVAR5 PLAYERLEVEL
 mulvar TEMPVAR5 3
 divvar TEMPVAR5 2
 addvarvar PLAYERLIFTSTRENGTHTEMP TEMPVAR5

 setvarvar TEMPVAR5 PLAYERLEVEL
 subvar TEMPVAR5 1
 divvar TEMPVAR5 3
 addvar TEMPVAR5 100
 mulvarvar PLAYERLIFTSTRENGTHTEMP TEMPVAR5
 divvar PLAYERLIFTSTRENGTHTEMP 100

 ifvare CHARACTERSELECTED? 3
 { 
  setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERLIFTSTRENGTHTEMP 3 divvar PLAYERLIFTSTRENGTHTEMP 2 }

  setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
  ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERLIFTSTRENGTHTEMP 3 divvar PLAYERLIFTSTRENGTHTEMP 5 } // Cuts Bubsy's lifting strength by 40%
 }
 ifvare CHARACTERSELECTED? 4
 {
  setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar PLAYERLIFTSTRENGTHTEMP 2
 }
 ifvare CHARACTERSELECTED? 10 
 {
  setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar PLAYERLIFTSTRENGTHTEMP 5 divvar PLAYERLIFTSTRENGTHTEMP 8 }
 }
 ifvare CHARACTERSELECTED? 13
 {
  setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar PLAYERLIFTSTRENGTHTEMP 2
 }


 // Check for Power Wrist [equippable item]
 setvar DAMAGEMODIFIER 100
 ifvare PLAYEREQUIPSLOTITEM1 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM2 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM3 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM4 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM5 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM6 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM7 18 addvar DAMAGEMODIFIER 25
 ifvare PLAYEREQUIPSLOTITEM8 18 addvar DAMAGEMODIFIER 25
 mulvarvar PLAYERLIFTSTRENGTHTEMP DAMAGEMODIFIER
 divvar PLAYERLIFTSTRENGTHTEMP 100

 // Check for Jewel of Four Souls
 setvar DAMAGEMODIFIER 0
 ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 5
 ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
 mulvarvar PLAYERLIFTSTRENGTHTEMP DAMAGEMODIFIER

 setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
 ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar PLAYERLIFTSTRENGTHTEMP 3 divvar PLAYERLIFTSTRENGTHTEMP 5 }
 ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar PLAYERLIFTSTRENGTHTEMP 4 divvar PLAYERLIFTSTRENGTHTEMP 5 }

 ifp ponsteroids { mulvar PLAYERLIFTSTRENGTHTEMP 9 divvar PLAYERLIFTSTRENGTHTEMP 2 }



  // Controls which barrel of the Devastator is "shooting" in Old Skool Mode
  getplayer[THISACTOR].weapon_pos TEMPVAR3 // [negatives are "going down" [last_weapon], positives are "coming up" [curr_weapon]]
  ifvarg TEMPVAR3 -11 ifvarl TEMPVAR3 0 getplayer[THISACTOR].last_weapon TEMPVAR
  else ifvarg TEMPVAR3 -1 ifvarl TEMPVAR3 11 getplayer[THISACTOR].curr_weapon TEMPVAR

  ifvare TEMPVAR 7
  {
   getplayer[THISACTOR].kickback_pic TEMPVAR2
   ifvare TEMPVAR2 0
   {
    ifvare DEVASTATORBARRELDISPLAY2 0 setvar DEVASTATORBARRELDISPLAY 0
    ifvare DEVASTATORBARRELDISPLAY2 1 setvar DEVASTATORBARRELDISPLAY 1
   }

   ifvare DEVASTATORBARRELDISPLAY 0 { ifvare TEMPVAR2 1 setvar DEVASTATORBARRELDISPLAY2 1 }
   ifvare DEVASTATORBARRELDISPLAY 1 { ifvare TEMPVAR2 1 setvar DEVASTATORBARRELDISPLAY2 0 }
  }
//

// Check for Happy/Style/Charm Shoe items
setvar EQUIP_ISMOVING? 0
ifvare mainmenu 0
{
 ifvarn shop_id -1 nullop // lol no increasing timers while using the keys to shop, that's just derptastically cheap and lolz
 else ifvarn atm_id -1 nullop // same for ATMs, although it's harder to really think to press movement keys while in the ATM <.<
 else
 {  
  ifvare sector[PLAYERSECTOR].lotag 2 // Underwater
  {
   ifvarand bits 1 addvar EQUIP_ISMOVING? 1
   ifvarand bits 2 addvar EQUIP_ISMOVING? 1
  }
  else
  {
   ifp pjetpack
   {
    ifvarand bits 1 addvar EQUIP_ISMOVING? 1
    ifvarand bits 2 addvar EQUIP_ISMOVING? 1
   }
  }
  ifvarand extbits 1 addvar EQUIP_ISMOVING? 1
  ifvarand extbits 2 addvar EQUIP_ISMOVING? 1
  ifvarand extbits 3 addvar EQUIP_ISMOVING? 1
  ifvarand extbits 4 addvar EQUIP_ISMOVING? 1
 }
}
ifvarg EQUIP_ISMOVING? 0
{
 addvar EQUIP_MOVETIMER 1
 ifvarand PLAYERSTATUS? 2 setvar TEMPVAR5 19
 else ifvarand PLAYERSTATUS? 4 setvar TEMPVAR5 31
 else setvar TEMPVAR5 25
 ifvarvarg EQUIP_MOVETIMER TEMPVAR5
 {
  setvar EQUIP_MOVETIMER 0  

  ifvare PLAYEREQUIPSLOTITEM1 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM1 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM1 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM2 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM2 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM2 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM3 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM3 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM3 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM4 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM4 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM4 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM5 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM5 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM5 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM6 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM6 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM6 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM7 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM7 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM7 17 state player_havecharmshoes // Charm Shoes = Cents[money]

  ifvare PLAYEREQUIPSLOTITEM8 15 state player_havehappyshoes // Happy Shoes = EXP
  ifvare PLAYEREQUIPSLOTITEM8 16 state player_havestyleshoes // Style Shoes = RANK
  ifvare PLAYEREQUIPSLOTITEM8 17 state player_havecharmshoes // Charm Shoes = Cents[money]


 }
}
//

ifvarn BIOMETRIC_TIMER 0
{
  ifvare CHARACTERSELECTED? 8
  {
   ifvare HAVEENERGYSHIELD? 1
   {
    // Checks # of Yin-Yang Orbs
    setvar DAMAGEMODIFIER 1000

    ifvarg INVENTORYSLOTMAX 0 ifvare PLAYEREQUIPSLOTITEM1 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 1 ifvare PLAYEREQUIPSLOTITEM2 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 2 ifvare PLAYEREQUIPSLOTITEM3 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 3 ifvare PLAYEREQUIPSLOTITEM4 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 4 ifvare PLAYEREQUIPSLOTITEM5 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 5 ifvare PLAYEREQUIPSLOTITEM6 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 6 ifvare PLAYEREQUIPSLOTITEM7 27 subvar DAMAGEMODIFIER 200
    ifvarg INVENTORYSLOTMAX 7 ifvare PLAYEREQUIPSLOTITEM8 27 subvar DAMAGEMODIFIER 200

    ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
    setvar TEMPVAR5 25
    mulvarvar TEMPVAR5 DAMAGEMODIFIER
    divvar TEMPVAR5 1000
    ifvarl TEMPVAR5 1 setvar TEMPVAR5 1

    ifvarvarl CURRENTENERGYPOINTS TEMPVAR5 nullop
    else
    {
     ifvarg CURRENTCELLS 4
     {
      subvar CURRENTCELLS 5
      subvarvar CURRENTENERGYPOINTS TEMPVAR5
      stopsound LISA_MELEE1
      stopsound LISA_MELEE2
      stopsound LISA_MELEE3
      ifrnd 85 sound LISA_MELEE1
      else ifrnd 128 sound LISA_MELEE2
      else sound LISA_MELEE3
      sound BIOMETRIC_FIRE
      eshoot BIOMETRICBLAST1
      setvarvar TEMPVAR5 CURRENTBIOSHIELDPOWER
      divvarvar TEMPVAR5 MAXHITPOINTS
      ifvarl TEMPVAR5 16 { setactor[RETURN].pal 0 }
      else ifvarg TEMPVAR5 15 ifvarl TEMPVAR5 64 { setactor[RETURN].pal 17 }
      else ifvarg TEMPVAR5 63 ifvarl TEMPVAR5 256 { setactor[RETURN].pal 23 }
      else ifvarg TEMPVAR5 255 ifvarl TEMPVAR5 1024 { setactor[RETURN].pal 21 }
      else ifvarg TEMPVAR5 1023 { setactor[RETURN].pal 20 } 

      getactor[THISACTOR].x ROTATEXORIGIN
      getactor[THISACTOR].y ROTATEYORIGIN
      getplayer[THISACTOR].ang TEMP
      setvarvar ROTATEXPOINT ROTATEXORIGIN
      addvar ROTATEXPOINT 384 // 384 // NOTE: APPEARANTLY ROTATEXPOINT IS THE KEY HERE FOR PROPER FRONT ALIGNMENT
      setvarvar ROTATEYPOINT ROTATEYORIGIN
      subvar ROTATEYPOINT 0
      rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT TEMP ROTATEXRETURN ROTATEYRETURN
      setactor[RETURN].x ROTATEXRETURN
      setactor[RETURN].y ROTATEYRETURN
     }
    }
   }
  } 
  setvar BIOMETRIC_TIMER 0
}

ifvarg ACCESSINCS 0 setplayer[THISACTOR].knuckle_incs ACCESSINCS

setvar TEMPVAR 0
addvarvar TEMPVAR fpress
addvarvar TEMPVAR bpress
ifvarg TEMPVAR 0 { ifvarl TEMPVAR 4 { ifp ponground addvar CUSTOMBOBCOUNTER 1 else setvar CUSTOMBOBCOUNTER 0 } else setvar CUSTOMBOBCOUNTER 0 } else setvar CUSTOMBOBCOUNTER 0

ifvarg ftq 69 ifvarl ftq 73 { ifvarvare fta fta_normal state character_keycard_sounds }

ifvare mainmenu 0
{
 ifvarg mainmenutransitiontimer 0 subvar mainmenutransitiontimer 1
}
else
{
 ifvarl mainmenutransitiontimer 8 addvar mainmenutransitiontimer 1
}

ifvare shop_id -1
{
 ifvarg shoptransitiontimer 0 subvar shoptransitiontimer 1
}
else
{
 ifvarl shoptransitiontimer 8 addvar shoptransitiontimer 1
}

ifvare gameover? 0
{
 ifvarg gameovertransitiontimer 0 ifvarl gameovertransitiontimer 14 setvar gameovertransitiontimer 0
 ifvarl gameovertransitiontimer 14 randvar gameoverscreen 24
 ifvarg gameovertransitiontimer 0 subvar gameovertransitiontimer 1
}
else
{
 ifvarl gameovertransitiontimer 28 addvar gameovertransitiontimer 1
}

ifvarl mainmenutransitiontimer 0 setvar mainmenutransitiontimer 0
ifvarl shoptransitiontimer 0 setvar shoptransitiontimer 0
ifvarl gameovertransitiontimer 0 setvar gameovertransitiontimer 0

state checkspeeddisplays

ifvare mainmenu 0
{
 ifvarand POWERUPCHEATFLAGS? 1 setvar QUADTIME 130
 ifvarand POWERUPCHEATFLAGS? 2 setvar INVULNTIME 130
 ifvarand POWERUPCHEATFLAGS? 4 setvar REGENTIME 130
 ifvarand POWERUPCHEATFLAGS? 8 setvar APREGENTIME 130
 ifvarand POWERUPCHEATFLAGS? 16 setvar VAMPIRETIME 130
 
 ifvarand CHEATBITFIELD? 1
 {
  getplayer[THISACTOR].max_ammo_amount 0 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 0 TEMP

  getplayer[THISACTOR].max_ammo_amount 1 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 1 TEMP

  getplayer[THISACTOR].max_ammo_amount 2 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 2 TEMP

  getplayer[THISACTOR].max_ammo_amount 3 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 3 TEMP

  getplayer[THISACTOR].max_ammo_amount 4 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 4 TEMP

  getplayer[THISACTOR].max_ammo_amount 5 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 5 TEMP

  getplayer[THISACTOR].max_ammo_amount 6 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 6 TEMP

  getplayer[THISACTOR].max_ammo_amount 7 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 7 TEMP

  getplayer[THISACTOR].max_ammo_amount 8 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 8 TEMP

  getplayer[THISACTOR].max_ammo_amount 9 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 9 TEMP

  getplayer[THISACTOR].max_ammo_amount 11 TEMP
  ifvarg TEMP 1 subvar TEMP 1
  setplayer[THISACTOR].ammo_amount 11 TEMP
 }

}

ifvarand bits 4 setvar SHOPCHEATBIT1 4 else setvar SHOPCHEATBIT1 0
ifvarand bits 4194304 setvar SHOPCHEATBIT2 4194304 else setvar SHOPCHEATBIT2 0
setvar SHOPCHEATBITTOTAL 0
addvarvar SHOPCHEATBITTOTAL SHOPCHEATBIT1
addvarvar SHOPCHEATBITTOTAL SHOPCHEATBIT2

getactor[THISACTOR].mdflags TEMP
orvar TEMP 16
setactor[THISACTOR].mdflags TEMP 

// Set's Up Overhead Sprite Animation Frames
ifvare player[THISACTOR].on_ground 1
{
 // getplayer[THISACTOR].posxv posxv
 // getplayer[THISACTOR].posyv posyv
 ifvarg player[THISACTOR].posxv 65536 state enforceoverheadsprites
 else
 {
  ifvarl player[THISACTOR].posxv -65536 state enforceoverheadsprites
  else
  {
   ifvarg player[THISACTOR].posyv 65536 state enforceoverheadsprites
   else
   {
    ifvarl player[THISACTOR].posyv -65536 state enforceoverheadsprites
    else setvar OVERHEADSPRITE 0
   }
  }
 }
}
else
{
 setvar OVERHEADSPRITE 0
}

ifvarn VEHICLEID -1
{
 setplayer[THISACTOR].hurt_delay 12 // Constantly sets to 12 to prevent Forcefields and Cacti from damaging a Vehicle
 setplayer[THISACTOR].footprintcount 0
 ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
 {
  ifvare CHARACTERSELECTED? 6 setvar bits 268435456
  ifvare CHARACTERSELECTED? 9 setvar bits 268435456
 }
}

setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
ifvare MISCARRAYID_AMOUNTTEMP 1 state checkfloors-freeze

setvar MISCARRAYID 75 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ARMOR-APPEARANCE?
ifvare CHARACTERSELECTED? 1 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
ifvare CHARACTERSELECTED? 2 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
ifvare CHARACTERSELECTED? 3 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
ifvare CHARACTERSELECTED? 4 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 5 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
ifvare CHARACTERSELECTED? 6 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 2 }
ifvare CHARACTERSELECTED? 7 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
ifvare CHARACTERSELECTED? 8 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 9 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 3 }
ifvare CHARACTERSELECTED? 10 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 11 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 12 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 13 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 14 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
ifvare CHARACTERSELECTED? 15 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }

setvarvar DEFENSEMODE? player[THISACTOR].holster_weapon

state checkplayergrowthrates
state checkplayerinventoryitems
state removeexcessinventoryslots
state checkplayersupportlevels

state support-maxhp
state support-airtime
state support-mantling
state support-speed
state support-randomstat
state support-maxap

state holdingcode
state mercurycomputerautomapcheck

ifvarn CHARACTERSELECTED? 1 { setvar CHARACTERARRAY 1 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 2 { setvar CHARACTERARRAY 2 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 3 { setvar CHARACTERARRAY 3 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 4 { setvar CHARACTERARRAY 4 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 5 { setvar CHARACTERARRAY 5 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 6 { setvar CHARACTERARRAY 6 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 7 { setvar CHARACTERARRAY 7 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 8 { setvar CHARACTERARRAY 8 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 9 { setvar CHARACTERARRAY 9 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 10 { setvar CHARACTERARRAY 10 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 11 { setvar CHARACTERARRAY 11 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 12 { setvar CHARACTERARRAY 12 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 13 { setvar CHARACTERARRAY 13 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 14 { setvar CHARACTERARRAY 14 state checknonusecharcAP }
ifvarn CHARACTERSELECTED? 15 { setvar CHARACTERARRAY 15 state checknonusecharcAP }

ifaction PFROZEN nullop
else
{
 ifvarn VEHICLEID -1
 {
  ifvare VEHICLETYPE 0 setactor[THISACTOR].pal 0
  ifvare VEHICLETYPE 1 setactor[THISACTOR].pal 17
  ifvare VEHICLETYPE 2 setactor[THISACTOR].pal 19
 }
 else
 {
  ifvare CHARACTERSELECTED? 1 setactor[THISACTOR].pal 0
  ifvare CHARACTERSELECTED? 2 setactor[THISACTOR].pal 15
  ifvare CHARACTERSELECTED? 3 setactor[THISACTOR].pal 21
  ifvare CHARACTERSELECTED? 4 setactor[THISACTOR].pal 16
  ifvare CHARACTERSELECTED? 5 setactor[THISACTOR].pal 15
  ifvare CHARACTERSELECTED? 6 setactor[THISACTOR].pal 24
  ifvare CHARACTERSELECTED? 7 setactor[THISACTOR].pal 23
  ifvare CHARACTERSELECTED? 8 setactor[THISACTOR].pal 14
  ifvare CHARACTERSELECTED? 9 setactor[THISACTOR].pal 24
  ifvare CHARACTERSELECTED? 10 setactor[THISACTOR].pal 20
  ifvare CHARACTERSELECTED? 11 setactor[THISACTOR].pal 21
  ifvare CHARACTERSELECTED? 12 setactor[THISACTOR].pal 15
  ifvare CHARACTERSELECTED? 13 setactor[THISACTOR].pal 23
  ifvare CHARACTERSELECTED? 14 setactor[THISACTOR].pal 0
  ifvare CHARACTERSELECTED? 15 setactor[THISACTOR].pal 18
 }
}

// Checks a Character's PK Shield Hits, and makes sure they stay intact even if a character dies.
setvar CHARACTERARRAY 1 state checkpkshieldamounts
setvar CHARACTERARRAY 2 state checkpkshieldamounts
setvar CHARACTERARRAY 3 state checkpkshieldamounts
setvar CHARACTERARRAY 4 state checkpkshieldamounts
setvar CHARACTERARRAY 5 state checkpkshieldamounts
setvar CHARACTERARRAY 6 state checkpkshieldamounts
setvar CHARACTERARRAY 7 state checkpkshieldamounts
setvar CHARACTERARRAY 8 state checkpkshieldamounts
setvar CHARACTERARRAY 9 state checkpkshieldamounts
setvar CHARACTERARRAY 10 state checkpkshieldamounts
setvar CHARACTERARRAY 11 state checkpkshieldamounts
setvar CHARACTERARRAY 12 state checkpkshieldamounts
setvar CHARACTERARRAY 13 state checkpkshieldamounts
setvar CHARACTERARRAY 14 state checkpkshieldamounts
setvar CHARACTERARRAY 15 state checkpkshieldamounts

//********************
//* MAIN MENU CHECKS *
//********************

ifvare mainmenu 0 // Main Menu is NOT open
{
 // Bio-Shield Checks/Regen
 ifvare BIOSHIELDRECHARGABLE? 2 // The Bio-Shield will Auto-Recharge itself until it hits full cells and damage-strength
 {
  ifvare LISA? 1
  {
   ifvare HAVEENERGYSHIELD? 1
   {
     setvarvar TEMP2 MAXCELLS
     addvar TEMP2 1
     ifvarvarl CURRENTCELLS TEMP2
     {
      ifvare CHARACTERSELECTED? 8
      {
       ifvare ENERGYSHIELDMODE 1
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 66
        else addvar BIOSHIELDRECHARGETIMER 3
       }
       else
       ifvare ENERGYSHIELDMODE 0
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 264
        else addvar BIOSHIELDRECHARGETIMER 24
       }
      }
      else
      {
       ifvare ENERGYSHIELDMODE 1
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 22
        else addvar BIOSHIELDRECHARGETIMER 1
       }
       else
       ifvare ENERGYSHIELDMODE 0
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 88
        else addvar BIOSHIELDRECHARGETIMER 8
       }
      }
      ifvare ESHIELDADVANCEMENT 0 setvar TEMPVAR5 255 else setvar TEMPVAR5 191
      ifvarvarg BIOSHIELDRECHARGETIMER TEMPVAR5
      {
       ifvare CURRENTCELLS 0 { setvar BIOSHIELDRECHARGETIMER 0 } else { ifvare ESHIELDADVANCEMENT 0 subvar BIOSHIELDRECHARGETIMER 256 else subvar BIOSHIELDRECHARGETIMER 192 }
       setvarvar TEMP3 ESHIELDDMGFACTOR
       divvar TEMP3 16
       ifvare ESHIELDADVANCEMENT 1 { mulvar TEMP3 9 divvar TEMP3 8 }
       ifvarl TEMP3 1 setvar TEMP3 1
       ifvarvarl CURRENTCELLS MAXCELLS nullop else { ifvarvarl DAMAGEINCELL ESHIELDDMGFACTOR nullop else setvar TEMP3 0 }

       ifvarn player[THISACTOR].over_shoulder_on 0 ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1
       {
        ifvarg TEMP3 0
        {
         setvarvar SHOWDAMAGE TEMP3
         setvar SHOWDAMAGETYPE 5
         setvarvar SHOWDAMAGEACTORID PLAYERID
         state showdamage
        }
       }

       ifvarvare CURRENTCELLS MAXCELLS ifvarvare DAMAGEINCELL ESHIELDDMGFACTOR nullop
       else
       {
        addvarvar DAMAGEINCELL TEMP3
        ifvarvare CURRENTCELLS MAXCELLS ifvarvare DAMAGEINCELL ESHIELDDMGFACTOR { soundonce ESHIELD_CHARGEDMAX }
        ifvarvare CURRENTCELLS MAXCELLS ifvarvarg DAMAGEINCELL ESHIELDDMGFACTOR { setvarvar DAMAGEINCELL ESHIELDDMGFACTOR soundonce ESHIELD_CHARGEDMAX }
       }
      }
     }
     else setvar BIOSHIELDRECHARGETIMER 0
   }
  }
 }
 else
 ifvare BIOSHIELDRECHARGABLE? 1 // Only recharges the 'Free Cell' inside the shield to full power and nothing more.
 {
  ifvare LISA? 1
  {
   ifvare HAVEENERGYSHIELD? 1
   {
    ifvare CURRENTCELLS 0
    {
     ifvarvarl DAMAGEINCELL ESHIELDDMGFACTOR
     {
      ifvare CHARACTERSELECTED? 8
      {
       ifvare ENERGYSHIELDMODE 1
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 132
        else addvar BIOSHIELDRECHARGETIMER 3
       }
       else
       ifvare ENERGYSHIELDMODE 0
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 264
        else addvar BIOSHIELDRECHARGETIMER 24
       }
      }
      else
      {
       ifvare ENERGYSHIELDMODE 1
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 44
        else addvar BIOSHIELDRECHARGETIMER 1
       }
       else
       ifvare ENERGYSHIELDMODE 0
       {
        ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 88
        else addvar BIOSHIELDRECHARGETIMER 8
       }
      }
      ifvare ESHIELDADVANCEMENT 0 setvar TEMPVAR5 255 else setvar TEMPVAR5 191
      ifvarvarg BIOSHIELDRECHARGETIMER TEMPVAR5
      {
       ifvare CURRENTCELLS 0 { setvar BIOSHIELDRECHARGETIMER 0 } else { ifvare ESHIELDADVANCEMENT 0 subvar BIOSHIELDRECHARGETIMER 256 else subvar BIOSHIELDRECHARGETIMER 192 }
       setvarvar TEMP3 ESHIELDDMGFACTOR
       divvar TEMP3 16
       ifvare ESHIELDADVANCEMENT 1 { mulvar TEMP3 9 divvar TEMP3 8 }
       ifvarl TEMP3 1 setvar TEMP3 1
       ifvarvarl DAMAGEINCELL ESHIELDDMGFACTOR nullop else setvar TEMP3 0

       ifvarn player[THISACTOR].over_shoulder_on 0 ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1
       {
        ifvarg TEMP3 0
        {
         setvarvar SHOWDAMAGE TEMP3
         setvar SHOWDAMAGETYPE 5
         setvarvar SHOWDAMAGEACTORID PLAYERID
         state showdamage
        }
       }

       ifvarvare DAMAGEINCELL ESHIELDDMGFACTOR nullop
       else
       {
        addvarvar DAMAGEINCELL TEMP3
        ifvarvarg DAMAGEINCELL ESHIELDDMGFACTOR setvarvar DAMAGEINCELL ESHIELDDMGFACTOR
       }
      }
     }
    }
    else setvar BIOSHIELDRECHARGETIMER 0
   }
  }
 }

 // Mantling
 ifvare EDGEGRAPPLING 1
 {
  setvar GLIDING? 0
  ifvare player[THISACTOR].ftq 245
  {
   ifvarg player[THISACTOR].fta 0 setplayer[THISACTOR].fta 0
  }
 }
 else
 {
  ifvarg ONAWALL? 0
  {
   setvar GLIDING? 0
   ifvare player[THISACTOR].ftq 245
   {
    ifvarg player[THISACTOR].fta 0 setplayer[THISACTOR].fta 0
   }
  }
 }

 // Over the Shoulder Mode
 ifvarg backview 0
 {
  subvar backview 1
  ifvare EDGEGRAPPLING 1 nullop
  else
  {
   ifvarg ONAWALL? 0 nullop
   else
   {
    ifvarg backview 8 setvar backview 8
   }
  }
 }
 ifvarl backview 8
 {
  ifvare player[THISACTOR].ftq 835
  {
   ifvarg player[THISACTOR].fta 0 setplayer[THISACTOR].fta 0
  }
 }

 // Money Radar
 setvar MISCARRAYID 68 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // GOT-MONEY-RADAR?
 ifvare MISCARRAYID_AMOUNTTEMP 1 { state moneyfinder state gemfinder }

 // Helix Testing
 ifvarl ROTATEZINTERVAL 17
 {
  ifvarg CURRENTHITPOINTS 0 // ifp palive
  {
   addvar ROTATEPOINTTESTTIMER 1
   ifvarg ROTATEPOINTTESTTIMER 0
   {
    state rotatepointtest
    state rotatepointtest2
    subvar ROTATEPOINTTESTTIMER 1
   }
  }
 }

 // Knockback Checks
 ifvarg knockback 0
 {
   subvar knockback 1
   cos xvel knockbackang
   sin yvel knockbackang
   mulvarvar xvel knockbackstr mulvarvar yvel knockbackstr
   setplayer[THISACTOR].poszv -1024 // -1536
   setplayer[THISACTOR].posxv xvel
   setplayer[THISACTOR].posyv yvel
   setplayer[THISACTOR].jumping_toggle 1
   setvar multijumpflag 0
 }
 ifvare knockback 0 setvar knockbackstr 1

 // Status Checks
 ifvarand PLAYERSTATUS? 2
 {
  setvar TEMPVAR5 0
  ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
  ifvarg TEMPVAR5 0
  {
   setvarvar TEMPVAR4 TIMERRAWFORMAT
   modvar TEMPVAR4 5
   ifvare TEMPVAR4 4 subvar PLAYERHASTETIMER 1
  }
  else
  {
   subvar PLAYERHASTETIMER 1
  }

  ifvarl PLAYERHASTETIMER 1
  {
   setvar PLAYERHASTETIMER 0
   state removehaste
  }
 }
 ifvarand PLAYERSTATUS? 4
 {
  setvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
  subvarvar PLAYERSLOWTIMER TEMPVAR5

  ifvarl PLAYERSLOWTIMER 1
  {
   setvar PLAYERSLOWTIMER 0
   state removeslow
  }
 }
 ifvarand PLAYERSTATUS? 8
 {
  setvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
  subvarvar PLAYERPOISONTIMER TEMPVAR5

  ifvarl PLAYERPOISONTIMER 1
  {
   setvar PLAYERPOISONTIMER 0
   state removepoison
  }
 }
 ifvarand PLAYERSTATUS? 16
 {
  setvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
  subvarvar PLAYERDIMNESSTIMER TEMPVAR5

  ifvarl PLAYERDIMNESSTIMER 1
  {
   setvar PLAYERDIMNESSTIMER 0
   state removedimness
  }
 }
 ifvarand PLAYERSTATUS? 128
 {
  setvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
  subvarvar PLAYERCONFUSIONTIMER TEMPVAR5

  ifvarl PLAYERCONFUSIONTIMER 1
  {
   setvar PLAYERCONFUSIONTIMER 0
   state removeconfusion
  }
 }
 ifvarand PLAYERSTATUS? 512
 {
  setvar TEMPVAR5 0
  ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
  ifvarg TEMPVAR5 0
  {
   setvarvar TEMPVAR4 TIMERRAWFORMAT
   modvar TEMPVAR4 5
   ifvare TEMPVAR4 4 subvar PLAYERSHELLTIMER 1
  }
  else
  {
   subvar PLAYERSHELLTIMER 1
  }

  ifvarl PLAYERSHELLTIMER 1
  {
   setvar PLAYERSHELLTIMER 0
   state removedamageshell
  }
 }
 ifvarand PLAYERSTATUS? 1024 nullop
 else
 {
  ifvarg PLAYERPSISHIELDTIMER 0 addvar PLAYERSTATUS? 1024
 }
 ifvarand PLAYERSTATUS? 4096
 {
  setvar TEMPVAR5 0
  ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
  ifvarg TEMPVAR5 0
  {
   setvarvar TEMPVAR4 TIMERRAWFORMAT
   modvar TEMPVAR4 5
   ifvare TEMPVAR4 4 subvar PLAYERBOOSTERTIMER 1
  }
  else
  {
   subvar PLAYERBOOSTERTIMER 1
  }

  ifvarl PLAYERBOOSTERTIMER 1
  {
   setvar PLAYERBOOSTERTIMER 0
   state removebooster
  }
 }
 ifvarand PLAYERSTATUS? 8192
 {
  setvar TEMPVAR5 0
  ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
  ifvarg TEMPVAR5 0
  {
   setvarvar TEMPVAR4 TIMERRAWFORMAT
   modvar TEMPVAR4 5
   ifvare TEMPVAR4 4 subvar PLAYERBLOODLUSTTIMER 1
  }
  else
  {
   subvar PLAYERBLOODLUSTTIMER 1
  }

  ifvarl PLAYERBLOODLUSTTIMER 1
  {
   setvar PLAYERBLOODLUSTTIMER 0
   state removebloodlusting
  }
 }
 ifvarand PLAYERSTATUS? 16384
 {
  setvar TEMPVAR5 1
  ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
  ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
  subvarvar PLAYERCORROSIONTIMER TEMPVAR5

  ifvarl PLAYERCORROSIONTIMER 1
  {
   setvar PLAYERCORROSIONTIMER 0
   state removecorrosion
  }
 }

 // Portable Medikit Toggle Mode
 ifvare automedikittoggle 1
 {
  ifvare oldskoolmode 0
  {
   setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
   ifvarl MISCARRAYID_AMOUNTTEMP 10
   {
    ifvarg CURRENTHITPOINTS 0
    {
     ifvarvarl CURRENTHITPOINTS MAXHITPOINTS state usemedikit
    }
   }
  }
 }
}

ifvarn player[THISACTOR].curr_weapon 4
{
 ifvare player[THISACTOR].ftq 1334 setplayer[THISACTOR].fta 0
}

ifvarg DEATHMISSILEACTIVATED 0
{
 addvar DEATHMISSILETIMERLAPSE 1
 ifvarg DEATHMISSILETIMERLAPSE 1
 {
  setvar DEATHMISSILEACTIVATED 0
  setvar DEATHMISSILETIMERLAPSE 0
 }
}

ifvare SKILLLEVEL 4 setuserdef[THISACTOR].respawn_monsters 0
setuserdef[THISACTOR].levelstats 0
setuserdef[THISACTOR].althud 0
setuserdef[THISACTOR].lockout 0

//***********************************************
//*Check for Twilight Cloaks or Vampire Artifact*
//***********************************************
setvar VAMPIREDMGFACTOR 0
randvar VAMPIREDMGRANDOM 0
setvar VAMPIREMAXDMGFACTOR 0
ifvare PUBLICBETA? 0 // Commerical Versions
{
 ifvarg VAMPIRETIME 0
 {
  setvar VAMPIREDMGFACTOR 250
  randvar VAMPIREDMGRANDOM 50
  ifrnd 128 addvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM else subvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 200
 }
 else
 {
  setvar VAMPIREDMGFACTOR 0
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 100
 }

 ifvarg VAMPIRETIME 0
 {
  setvar VAMPIREMAXDMGFACTOR 1250
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 200
 }
 else
 {
  setvar VAMPIREMAXDMGFACTOR 1000
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 100
 }
 ifvarg VAMPIREMAXDMGFACTOR 4000 setvar VAMPIREMAXDMGFACTOR 4000
}
else // Public Beta
{
 ifvarg VAMPIRETIME 0
 {
  setvar VAMPIREDMGFACTOR 500
  randvar VAMPIREDMGRANDOM 100
  ifrnd 128 addvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM else subvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 200
 }
 else
 {
  setvar VAMPIREDMGFACTOR 0
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 100
 }

 ifvarg VAMPIRETIME 0
 {
  setvar VAMPIREMAXDMGFACTOR 1500
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 200
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 200
 }
 else
 {
  setvar VAMPIREMAXDMGFACTOR 1000
  ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 100
  ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 100
 }
 ifvarg VAMPIREMAXDMGFACTOR 4000 setvar VAMPIREMAXDMGFACTOR 4000
}

state refreshhealthvalues

ifvarg SPRITEDAMAGETYPE? 0 setvar SPRITEDAMAGETYPE? 0

ifvare oldskoolmode 0
{
 redefinequote 12 ^19USED VITAMIN X
 redefinequote 90 ^20VITAMIN X

 setvar WEAPON1_SHOOTS 6136
 setvar WEAPON1_TOTALTIME 6
 setvar WEAPON2_RELOAD 10 // 10
 setvar WEAPON2_FIREDELAY 3 // 3
 setvar WEAPON2_TOTALTIME 21 // 21
 setvar WEAPON2_SHOOTS 6140

 ifvare CHAINGUNMODE 0
 {
  setvar WEAPON3_SHOOTS CHAINGUN // SHOTSPARK1
  setvar WEAPON3_SHOTSPERBURST 3
  setvar WEAPON3_FIRESOUND CAPT_ATTACK
  setvar WEAPON3_FLAGS 73748 // 4+16+8192+65536
 }
 else
 ifvare CHAINGUNMODE 1
 {
  setvar WEAPON3_SHOOTS 2605
  setvar WEAPON3_SHOTSPERBURST 2
  setvar WEAPON3_FIRESOUND 6
  setvar WEAPON3_FLAGS 73748 // 4+16+8192+65536
 }
/*
 else
 ifvare CHAINGUNMODE 2
 {
  setvar WEAPON3_SHOOTS FIRELASER
  setvar WEAPON3_SHOTSPERBURST 1
  setvar WEAPON3_FIRESOUND PRED_ATTACK
  setvar WEAPON3_FLAGS 73748 // 4+16+8192+65536
 }
*/

 /*
 ifvare CHARACTERSELECTED? 8
 {
  setvar WEAPON3_SHOOTS 6071
  setvar WEAPON3_FIRESOUND 575
 }
 else
 {
  setvar WEAPON3_SHOOTS 2605
  setvar WEAPON3_FIRESOUND 6
 }
*/
 ifvare DEATHMISSILESUSABLE? 1
 {  
  ifvare DEATHMISSILEMODE 0
  {
   setvar WEAPON4_SHOOTS GATEMISSILE_MAIN // Deathgate
   setvar WEAPON4_SHOTSPERBURST 1
   setvar WEAPON4_FIRESOUND 0
  }
  else
  ifvare DEATHMISSILEMODE 1
  {
   setvar WEAPON4_SHOOTS STROKEMISSILE_MAIN // Deathstroke
   setvar WEAPON4_SHOTSPERBURST 1
   setvar WEAPON4_FIRESOUND 0
  }
 }
 else
 {
  setvar WEAPON4_SHOOTS 6140
  setvar WEAPON4_SHOTSPERBURST 56
  setvar WEAPON4_FIRESOUND 109
 }
 setvar WEAPON11_SHOTSPERBURST 7
}
else
{
 setvar WEAPON1_SHOOTS 2595
 setvar WEAPON1_TOTALTIME 5
 setvar WEAPON2_RELOAD 13
 setvar WEAPON2_FIREDELAY 4
 setvar WEAPON2_TOTALTIME 31
 setvar WEAPON2_SHOOTS 2613
 setvar WEAPON3_SHOOTS 2536
 setvar WEAPON4_SHOOTS 2605
 setvar WEAPON4_SHOTSPERBURST 1
 setvar WEAPON4_FIRESOUND 0
 setvar WEAPON11_SHOTSPERBURST 1
}

ifvare oldskoolmode 0 state globaltimer

//getplayer[THISACTOR].wackedbyactor temp

ifvarg CURRENTHITPOINTS 0
{
 ifvarn player[THISACTOR].wackedbyactor -1 setplayer[THISACTOR].wackedbyactor -1
 ifvarn player[THISACTOR].dead_flag 0 setplayer[THISACTOR].dead_flag 0
}

ifp pjetpack
{
   ifvarn sector[PLAYERSECTOR].lotag 2
   {
    ifvarand bits 1
    {
      ifvare mainmenu 0 addvar JETPACKSMOKEVAR 1
      ifvarg JETPACKSMOKEVAR 7
      {
       state jetpacksmoke
       setvar JETPACKSMOKEVAR 0
      }
    }
 
    ifvarand bits 2
    {
      ifvare mainmenu 0 addvar JETPACKSMOKEVAR 1
       ifvarg JETPACKSMOKEVAR 7
      {
       state jetpacksmoke
       setvar JETPACKSMOKEVAR 0
      }
    }
 
    ifvarand bits 3 nullop
    else
    {
      ifvare mainmenu 0 addvar JETPACKSMOKEVAR 1
      ifvarg JETPACKSMOKEVAR 15
      {
       state jetpacksmoke
       setvar JETPACKSMOKEVAR 0
      }
    }
   }

   // Jetpack Rise Heights
   //getplayer[THISACTOR].posz TEMPVAR2
   //getplayer[THISACTOR].oposz TEMPVAR3
   
   ifvarand bits 1
   {
     ifvarvarl player[THISACTOR].posz player[THISACTOR].oposz
     {
      setvarvar TEMPVAR4 player[THISACTOR].oposz
      subvarvar TEMPVAR4 player[THISACTOR].posz
      ifvare CHARACTERSELECTED? 1 mulvar TEMPVAR4 0
      ifvare CHARACTERSELECTED? 2 mulvar TEMPVAR4 534
      ifvare CHARACTERSELECTED? 3
      {
       setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
       ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar TEMPVAR4 541 else mulvar TEMPVAR4 635
      }
      ifvare CHARACTERSELECTED? 4 mulvar TEMPVAR4 821
      ifvare CHARACTERSELECTED? 5 mulvar TEMPVAR4 198
      ifvare CHARACTERSELECTED? 6
      {
       setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
       ifvare MISCARRAYID_AMOUNTTEMP 0 mulvar TEMPVAR4 -783 else mulvar TEMPVAR4 -627 
      }
      ifvare CHARACTERSELECTED? 7 mulvar TEMPVAR4 211
      ifvare CHARACTERSELECTED? 8 mulvar TEMPVAR4 723
      ifvare CHARACTERSELECTED? 9 mulvar TEMPVAR4 -811
      ifvare CHARACTERSELECTED? 10 mulvar TEMPVAR4 623
      ifvare CHARACTERSELECTED? 11 mulvar TEMPVAR4 851
      ifvare CHARACTERSELECTED? 12 mulvar TEMPVAR4 647
      ifvare CHARACTERSELECTED? 13 mulvar TEMPVAR4 778
      ifvare CHARACTERSELECTED? 14 mulvar TEMPVAR4 556
      ifvare CHARACTERSELECTED? 15 mulvar TEMPVAR4 806
      divvar TEMPVAR4 1000
      ifvare CHARACTERSELECTED? 1 { ifvarg TEMPVAR4 0 setvar TEMPVAR4 0 }
      ifvare CHARACTERSELECTED? 2 { ifvarg TEMPVAR4 1094 setvar TEMPVAR4 1094 }
      ifvare CHARACTERSELECTED? 3
      {
       setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
       ifvare MISCARRAYID_AMOUNTTEMP 1 { ifvarg TEMPVAR4 1102 setvar TEMPVAR4 1102 }
         else { ifvarg TEMPVAR4 1301 setvar TEMPVAR4 1301 }
      }
      ifvare CHARACTERSELECTED? 4 { ifvarg TEMPVAR4 1682 setvar TEMPVAR4 1682 }
      ifvare CHARACTERSELECTED? 5 { ifvarg TEMPVAR4 405 setvar TEMPVAR4 405 }
      ifvare CHARACTERSELECTED? 6 
      { 
       setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
       ifvare MISCARRAYID_AMOUNTTEMP 0 { ifvarg TEMPVAR4 -1603 setvar TEMPVAR4 -1603 } else { ifvarg TEMPVAR4 -1283 setvar TEMPVAR4 -1283 } 
      }
      ifvare CHARACTERSELECTED? 7 { ifvarg TEMPVAR4 432 setvar TEMPVAR4 432 }
      ifvare CHARACTERSELECTED? 8 { ifvarg TEMPVAR4 1481 setvar TEMPVAR4 1481 }
      ifvare CHARACTERSELECTED? 9 { ifvarg TEMPVAR4 -1661 setvar TEMPVAR4 -1661 }
      ifvare CHARACTERSELECTED? 10 { ifvarg TEMPVAR4 1276 setvar TEMPVAR4 1276 }
      ifvare CHARACTERSELECTED? 11 { ifvarg TEMPVAR4 1743 setvar TEMPVAR4 1743 }
      ifvare CHARACTERSELECTED? 12 { ifvarg TEMPVAR4 1325 setvar TEMPVAR4 1325 }
      ifvare CHARACTERSELECTED? 13 { ifvarg TEMPVAR4 1593 setvar TEMPVAR4 1593 }
      ifvare CHARACTERSELECTED? 14 { ifvarg TEMPVAR4 1138 setvar TEMPVAR4 1138 }
      ifvare CHARACTERSELECTED? 15 { ifvarg TEMPVAR4 1652 setvar TEMPVAR4 1652 }
      setvarvar TEMPVAR5 player[THISACTOR].posz
      subvarvar TEMPVAR5 TEMPVAR4
      setplayer[THISACTOR].posz TEMPVAR5
     }
    }
    ifvarand bits 2
    {
     ifvarvarg player[THISACTOR].posz player[THISACTOR].oposz
     {
      setvarvar TEMPVAR4 player[THISACTOR].oposz
      subvarvar TEMPVAR4 player[THISACTOR].posz
      ifvare CHARACTERSELECTED? 1 mulvar TEMPVAR4 0
      ifvare CHARACTERSELECTED? 2 mulvar TEMPVAR4 348
      ifvare CHARACTERSELECTED? 3
      {
       setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
       ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar TEMPVAR4 355 else mulvar TEMPVAR4 388
      }
      ifvare CHARACTERSELECTED? 4 mulvar TEMPVAR4 451
      ifvare CHARACTERSELECTED? 5 mulvar TEMPVAR4 165
      ifvare CHARACTERSELECTED? 6
      {
       setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
       ifvare MISCARRAYID_AMOUNTTEMP 0 mulvar TEMPVAR4 -3607 else mulvar TEMPVAR4 -2525 
      }
      ifvare CHARACTERSELECTED? 7 mulvar TEMPVAR4 174
      ifvare CHARACTERSELECTED? 8 mulvar TEMPVAR4 420
      ifvare CHARACTERSELECTED? 9 mulvar TEMPVAR4 -4295
      ifvare CHARACTERSELECTED? 10 mulvar TEMPVAR4 384
      ifvare CHARACTERSELECTED? 11 mulvar TEMPVAR4 460
      ifvare CHARACTERSELECTED? 12 mulvar TEMPVAR4 393
      ifvare CHARACTERSELECTED? 13 mulvar TEMPVAR4 438
      ifvare CHARACTERSELECTED? 14 mulvar TEMPVAR4 357
      ifvare CHARACTERSELECTED? 15 mulvar TEMPVAR4 446
      divvar TEMPVAR4 1000
      setvarvar TEMPVAR5 player[THISACTOR].posz
      addvarvar TEMPVAR5 TEMPVAR4
      setplayer[THISACTOR].posz TEMPVAR5
     }
   }

   ifvarn ONAWALL? 0 setvar ONAWALL? 0
}



ifvarg fpress 0 subvar fpress 1
ifvarg bpress 0 subvar bpress 1
ifvarl ONAWALL? 0 { setvar WALLTYPE 0 addvar ONAWALL? 1 }

ifvarg ONAWALL? 0 state wallclimbcode
ifvare ONAWALL? 0 { setvar WALLTYPE 0 setvar WALLCLIMBSNDTIMER 0 }

ifvarg ONAWALL? 0 
{  
 getactor[THISACTOR].xvel temp
 divvar temp 128
 setactor[THISACTOR].xvel temp
 getactor[THISACTOR].yvel temp
 divvar temp 128
 setactor[THISACTOR].yvel temp
 setvar fallingresistance 0
 setvar fallcounter2 0
 setvar totalfallcounter 0
 setvar falldamageratio 0
 setvar FALLSOUND? 0
 getplayer[THISACTOR].weapon_pos temp
 ifvarl temp 9
 {
  addvar temp 3
  setplayer[THISACTOR].weapon_pos temp
 }
}

ifvarg dodge 0
{
 cos xvel dodgeang
 sin yvel dodgeang 
 mulvar xvel 352
 mulvar yvel 352
 setplayer[THISACTOR].poszv -1536
 setplayer[THISACTOR].posxv xvel
 setplayer[THISACTOR].posyv yvel
 subvar dodge 1
}

ifp ponground ifvare INTHEAIR? 1 setvar INTHEAIR? 0

ifvarn sector[PLAYERSECTOR].lotag 2
{
 ifvare oldskoolmode 0 // Mantling shouldn't be usable in the Prolouge :P
 {
  ifvarg MANTLINGTIMER 0
  {
   ifvare ONAWALL? 0 
   {
    ifp pjetpack setvar EDGEGRAPPLING 0
    else
    {
     ifvare SPRITEID-HOLDING -1
     {
      ifvare automantletoggle 0
      {
       ifvarand bits 1 state edgegrabbing
       else setvar EDGEGRAPPLING 0
      }
      else state edgegrabbing
     }
     else setvar EDGEGRAPPLING 0
    }
   }
   else setvar EDGEGRAPPLING 0
  }
  else setvar EDGEGRAPPLING 0
 }
 else setvar EDGEGRAPPLING 0
}

ifvarg EDGEGRAPPLING 0
{
 setvar GLIDING? 0
 setvar fallingresistance 0
 setvar fallcounter2 0
 setvar totalfallcounter 0
 setvar falldamageratio 0
 setvar FALLSOUND? 0
 getplayer[THISACTOR].weapon_pos temp
 ifvarl temp 9
 {
  addvar temp 3
  setplayer[THISACTOR].weapon_pos temp
 }
}
else
{
 ifvarn SPRITEID-HOLDING -1
 {
  ifvarvare SPRITEID-HOLDING SPRITEID-TELEKENESIS_P
  {
   ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
   else
   ifvarg MANTLINGTIMER -1
   ifvarvarl MANTLINGTIMER MANTLINGTIMERMAX
   {
    setvarvar TEMPVAR MANTLINGTIMERMAX
    divvar TEMPVAR 130
    ifvarl TEMPVAR 1 setvar TEMPVAR 1
    ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvarvar MANTLINGTIMER TEMPVAR }
   }
   else
   {
    setvarvar MANTLINGTIMER MANTLINGTIMERMAX
    setvar MANTLINGTIMEREXTRA 1000
   } 
  }
 }
 else
 ifvare SPRITEID-HOLDING -1
 {
  ifvarn PLAYERPUSHINGTIMER 0 nullop
  else
  {
   ifvarl MANTLINGTIMER 0
   {
    setvar MANTLINGTIMER 0
   }
   else
   ifvarg MANTLINGTIMER -1
   ifvarvarl MANTLINGTIMER MANTLINGTIMERMAX
   {
    setvarvar TEMPVAR MANTLINGTIMERMAX
    divvar TEMPVAR 130
    ifvarl TEMPVAR 1 setvar TEMPVAR 1
    ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvarvar MANTLINGTIMER TEMPVAR }
   }
   else
   {
    setvarvar MANTLINGTIMER MANTLINGTIMERMAX
    setvar MANTLINGTIMEREXTRA 1000
   } 
  }
 }
}

ifvarl INVULNTIME 1 setvar DEFLECTDAMAGESTATE 0
ifvarn CHARACTERSELECTED? 12 setvar REFRACTORSTATE 0

state difficulty
ifvare SKILLSET? 0 
{
 state initializer
 setvar SKILLSET? 1 
}

state rankstarplayer
state getplayerid
state canceldeadactions

ifvarl CURRENTHITPOINTS 1
{
 ifvarn FROZEN? 1 setactor[PLAYERID].extra 0
} 
else 
{
 setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
 ifvarg MISCARRAYID_AMOUNTTEMP 0 setactor[PLAYERID].extra 16384

 ifsquished setvar CURRENTHITPOINTS 0
 getactor[PLAYERID].extra TEMPVAR
 ifvarl TEMPVAR 1 setvar CURRENTHITPOINTS 0
}

// Deals with Protozoid [GREENSLIME] damage
ifvarn player[THISACTOR].somethingonplayer -1
{
 ifvare INVULNTIME 0
 {
  ifvarn VEHICLEID -1
  {
   setplayer[THISACTOR].quick_kick 1
   setplayer[THISACTOR].fta 0
  }
  else
  {
   addvar GREENSLIMETIMER 1
   ifvarg GREENSLIMETIMER 4
   {
    setvarvar TEMP MAXHITPOINTS
    ifvare CHARACTERSELECTED? 14
    {
     ifvare PUBLICBETA? 0
     {
      randvar temp 1
      addvar temp 1
     }
     else
     {
      randvar temp 5
      addvar temp 5
     }
    }
    else
    {
     randvar temp 5
     addvar temp 5
    }
    mulvarvar TEMP temp
    divvar TEMP 1000

    ifvare CHARACTERSELECTED? 14
    {
     ifvare PUBLICBETA? 0
     {
      randvar tempe 1
      addvar tempe 2
     }
     else
     {
      randvar tempe 3
      addvar tempe 5
     }
    }
    else
    {
     randvar tempe 3
     addvar tempe 5
    }
    addvarvar tempe TEMP

    setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
    ifvare MISCARRAYID_AMOUNTTEMP 0 ifvare mainmenu 0
    {
     //*********************
     //*Check Malakian Gems*
     //*********************
     setvarvar TEMP7 tempe
     state malakiangemcheck 
     setvarvar tempe TEMP7

     ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarl TEMPVAR 1 setvar TEMPVAR 1 state cheatersound }

     setvarvar TEMPDAMAGEVAR tempe
     state lisashield_misc
     setvarvar tempe TEMPDAMAGEVAR

     setvarvar tempb CURRENTHITPOINTS
     subvarvar tempb tempe
     ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
     else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
     ifvarl tempb 0 setvar tempb 0
     ifvarvarg tempb MAXHITPOINTSATOMIC setvarvar tempb MAXHITPOINTSATOMIC
     setactor[PLAYERID].htpicnum -1
     setvarvar CURRENTHITPOINTS tempb
     state checkbuddhamode

     ifvarn player[THISACTOR].over_shoulder_on 0
     {
      ifvarg CELLDAMAGETEMP 0
      {
       setvarvar SHOWDAMAGE CELLDAMAGETEMP
       setvar SHOWDAMAGETYPE 2
       setvarvar SHOWDAMAGEACTORID THISACTOR
       state showdamage
      }
     }
     ifvarg FULLSHIELDDAMAGE 0
     {
      setvarvar ATTACKINGACTORPICNUM 2375
      setvar ATTACKINGACTORPAL 0
      setvar ACTORCRITICAL? 0
      setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
      ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
     }
     
     ifvarn player[THISACTOR].over_shoulder_on 0
     {
      ifvarg tempe 0
      {
       setvarvar SHOWDAMAGE tempe
       setvar SHOWDAMAGETYPE 0
       setvarvar SHOWDAMAGEACTORID THISACTOR
       state showdamage
      }
     }
     ifvarg tempe 0
     {
      setvarvar PAINSOUNDFACTOR tempe
      state checkpainfactor

      ifrnd 72 state characterpainsounds
      setvarvar DAMAGEHUEFACTOR tempe
      state playerdamagehues-acidtype

      setvarvar ATTACKINGACTORPICNUM 2375
      setvar ATTACKINGACTORPAL 0
      setvar ACTORCRITICAL? 0
      setvarvar PLAYERDAMAGETEMP tempe
      setactor[THISACTOR].htpicnum -1
      setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
      setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
      ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
     }
    }
    setactor[THISACTOR].extra 16384
    setvar GREENSLIMETIMER 0
   }
  }
 }
 else
 {
  setplayer[THISACTOR].quick_kick 1
  setplayer[THISACTOR].fta 0
  sound INVULNITEM3
 }

 ifvarand CHEATBITFIELD? 32
 {
  setplayer[THISACTOR].quick_kick 1
  setplayer[THISACTOR].fta 0
 }

 ifvarl CURRENTHITPOINTS 1
 {
  setplayer[THISACTOR].quick_kick 1
  setplayer[THISACTOR].fta 0
 }
}
else
{
 setvar GREENSLIMETIMER 0
}

ifvarg com_pause 0 subvar com_pause 1 // For Keypad Entry Delays

// Keeps Stats from being set to 0 for the current character-in-play through some random act of buggy fate :P
ifvarl MAXHITPOINTS 1 setvar MAXHITPOINTS 1
ifvarl MAXARMORPOINTS 1 setvar MAXARMORPOINTS 1
ifvarl MAXENERGYPOINTS 1 setvar MAXENERGYPOINTS 1
ifvarl PLAYERATTACK 1 setvar PLAYERATTACK 1
ifvarl PLAYERDEFENSE 1 setvar PLAYERDEFENSE 1

ifvarg MAXHITPOINTS 0 
{ 
 setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
 setvarvar MISCARRAYID_AMOUNTTEMP CURRENTHITPOINTS
 mulvar MISCARRAYID_AMOUNTTEMP 1000
 divvarvar MISCARRAYID_AMOUNTTEMP MAXHITPOINTS 
 setvar MISCARRAYID 94 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
}
ifvarg MAXARMORPOINTS 0 
{
 setvar MISCARRAYID 95 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AP-FACTOR
 setvarvar MISCARRAYID_AMOUNTTEMP CURRENTARMORPOINTS
 mulvar MISCARRAYID_AMOUNTTEMP 1000
 divvarvar MISCARRAYID_AMOUNTTEMP MAXARMORPOINTS 
 setvar MISCARRAYID 95 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AP-FACTOR
}
ifvarg MAXENERGYPOINTS 0 
{
 setvar MISCARRAYID 96 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // EP-FACTOR
 setvarvar MISCARRAYID_AMOUNTTEMP CURRENTENERGYPOINTS
 mulvar MISCARRAYID_AMOUNTTEMP 1000
 divvarvar MISCARRAYID_AMOUNTTEMP MAXENERGYPOINTS 
 setvar MISCARRAYID 96 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // EP-FACTOR
}
ifvarg MAXHITPOINTS 0 
{ 
 setvar MISCARRAYID 97 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FA-FACTOR
 setvarvar MISCARRAYID_AMOUNTTEMP FIRSTAIDCURRENT
 mulvar MISCARRAYID_AMOUNTTEMP 1000
 divvarvar MISCARRAYID_AMOUNTTEMP MAXHITPOINTS 
 setvar MISCARRAYID 97 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FA-FACTOR
}
ifvarg MAXBIOSHIELDPOWER 0 
{
 setvar MISCARRAYID 98 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ES-FACTOR
 setvarvar MISCARRAYID_AMOUNTTEMP CURRENTBIOSHIELDPOWER
 mulvar MISCARRAYID_AMOUNTTEMP 1000
 divvarvar MISCARRAYID_AMOUNTTEMP MAXBIOSHIELDPOWER
 setvar MISCARRAYID 98 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ES-FACTOR
}
ifvarg PLAYERMAXAIRJUMPS 0
{
 setvarvar AIRJUMPRATIO PLAYERMAXAIRJUMPS
 subvarvar AIRJUMPRATIO multijumpflag
 mulvar AIRJUMPRATIO 1000
 divvarvar AIRJUMPRATIO PLAYERMAXAIRJUMPS
}

setplayer[THISACTOR].airleft 16384 // For Overriding the original oxygen system for the customized one.

getplayer[THISACTOR].got_access ACCESSCARDS?

ifvarvarg PLAYERATTACK STATLIMIT setvarvar PLAYERATTACK STATLIMIT
ifvarvarg PLAYERDEFENSE STATLIMIT setvarvar PLAYERDEFENSE STATLIMIT

// Knuckle Cracking Stuff
ifvare CHARACTERSELECTED? 1 nullop
else ifvare CHARACTERSELECTED? 8 nullop
else ifvare CHARACTERSELECTED? 9 nullop
else ifvare CHARACTERSELECTED? 15 nullop
else setplayer[THISACTOR].knuckle_incs 0

ifvare mainmenu 1 setplayer[THISACTOR].knuckle_incs 0
ifvarn shop_id -1 setplayer[THISACTOR].knuckle_incs 0
ifvarn atm_id -1 setplayer[THISACTOR].knuckle_incs 0

ifvare FULLPOWER 1
{ 
 state fullpower
 setvar FULLPOWER 0
}
state neardeath
ifvare INSTANTDEATH 1 
{ 
 state checkcontinues setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount
 ifvarn VEHICLEID -1 setactorvar[VEHICLEID].ACTORHP 0
 state killallcharacters
}
ifvarg CURRENTHITPOINTS 0 { setvar gameover? 0 ifvarand PLAYERSTATUS? 1 subvar PLAYERSTATUS? 1 }

state getcharactergender

setvar MISCARRAYID 28 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // THROWBACK-DELAY
ifvarg MISCARRAYID_AMOUNTTEMP 0 
{ 
 divvar posxv 2 
 setplayer[THISACTOR].posxv posxv
 divvar posyv 2 
 setplayer[THISACTOR].posyv posyv

 subvar MISCARRAYID_AMOUNTTEMP 1
 setvar MISCARRAYID 28 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // THROWBACK-DELAY
}

setvar MISCARRAYID 27 // ADD-DELAY
getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
ifvarg MISCARRAYID_AMOUNTTEMP 0 subvar MISCARRAYID_AMOUNTTEMP 1
setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP

setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
ifvarg MISCARRAYID_AMOUNTTEMP 0 // Prevents potentially-fatal knockback when a death-switch occurs
{
  getplayer[THISACTOR].player_par TEMPVAR4
  modvar TEMPVAR4 6
  getactor[THISACTOR].cstat TEMPVAR3
  ifvarand TEMPVAR3 2 subvar TEMPVAR3 2
  ifvarand TEMPVAR3 512 subvar TEMPVAR3 512
  ifvarand TEMPVAR3 32768 subvar TEMPVAR3 32768
  ifvare TEMPVAR4 0 addvar TEMPVAR3 2
  ifvare TEMPVAR4 1 addvar TEMPVAR3 2
  ifvare TEMPVAR4 2 addvar TEMPVAR3 514
  ifvare TEMPVAR4 3 addvar TEMPVAR3 514
  ifvare TEMPVAR4 4 addvar TEMPVAR3 33282
  ifvare TEMPVAR4 5 addvar TEMPVAR3 33282
  setactor[THISACTOR].cstat TEMPVAR3

  setvar MISCARRAYID 26 // DEATHSWITCH-DELAY
  getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
  subvar MISCARRAYID_AMOUNTTEMP 1
  //addlogvar MISCARRAYID_AMOUNTTEMP
  setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP

  setplayer[THISACTOR].falling_counter 0
}
else
{
  getactor[THISACTOR].cstat TEMPVAR3
  ifvarand TEMPVAR3 2 subvar TEMPVAR3 2
  ifvarand TEMPVAR3 512 subvar TEMPVAR3 512
  ifvarand TEMPVAR3 32768 subvar TEMPVAR3 32768
  setactor[THISACTOR].cstat TEMPVAR3
}

setvar MISCARRAYID 25 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SWITCHOVER-DELAY
ifvarg MISCARRAYID_AMOUNTTEMP 0 subvar MISCARRAYID_AMOUNTTEMP 1
setvar MISCARRAYID 25 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SWITCHOVER-DELAY
ifvare MISCARRAYID_AMOUNTTEMP 0 
{
 // Prevents Player from Exceeding 200% HP
 ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
 // Prevents Player from Exceeding 200% AP
 ifvarvarg CURRENTARMORPOINTS MAXARMORPOINTSATOMIC setvarvar CURRENTARMORPOINTS MAXARMORPOINTSATOMIC 
 // Prevents Player from Exceeding 200% EP
 ifvarvarg CURRENTENERGYPOINTS MAXENERGYPOINTSATOMIC setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTSATOMIC 
 // Prevents Player from Exceeding 200% FA
 ifvarvarg FIRSTAIDCURRENT MAXHITPOINTSATOMIC setvarvar FIRSTAIDCURRENT MAXHITPOINTSATOMIC 

 ifvare mainmenu 0
 {
  ifvare player[THISACTOR].steroids_amount 400 setvar STEROIDSTICS 7
  else
  {
   ifvarg STEROIDSTIME 0
   {
    subvar STEROIDSTIME 1
    subvar STEROIDSTICS 1
    ifvarl STEROIDSTICS 1
    {
     sound DUKE_HARTBEAT
     addvar STEROIDSTICS 7
    }
    setplayer[THISACTOR].steroids_amount 399
   }
   else
   {
    setvar STEROIDSTICS 7
    setplayer[THISACTOR].steroids_amount 0
   }
  }
 }
 else
 { 
  stopsound DUKE_HARTBEAT 
  stopsound DUKE_HARTBEAT 
  stopsound DUKE_HARTBEAT 
  state stoppainsounds
  setplayer[THISACTOR].boot_amount BOOTSTIME 
  setplayer[THISACTOR].holoduke_amount HOLOFORMTIME 
  setplayer[THISACTOR].heat_amount NIGHTVISIONTIME 
  setplayer[THISACTOR].jetpack_amount JETPACKTIME 
 }
}

 setplayer[THISACTOR].hard_landing 0

 ifvare oldskoolmode 0 
 { 
  setplayer[THISACTOR].inven_icon 0 
  setplayer[THISACTOR].invdisptime 0 
 }

 setplayer[THISACTOR].last_pissed_time 600
 
 setvarvar TEMPVAR3 FIRSTAIDCURRENT
 mulvar TEMPVAR3 100
 ifvarn MAXHITPOINTS 0 divvarvar TEMPVAR3 MAXHITPOINTS
 setplayer[THISACTOR].firstaid_amount TEMPVAR3


//*******************************************************************
state iscurrentcharalive
state checkcharacters // EXTREMELY IMPORTANT: DO NOT DELETE THIS!!!!
state checkpartysize
ifvare CURRENTHITPOINTS 0 // ifp pdead 
{ 
 ifwasweapon FREEZEBLAST
 {
  ifvarn FROZEN? 1
  {
   state freezeup
   state frosty 
   spritepal 1
   move 0
   action PFROZEN
   break
  }
 }

 ifvare FROZEN? 1 nullop // If the character is frozen by the freeze-thrower, they are not fully 'dead' and can still thaw back to life
 else // All other attacks will kill/try-to-kill the character
 { 
  ifvarn PLAYERSTATUS? 1
  ifvarg PARTYALIVE 0 // More than one character alive on character death
  { 
   ifvare CURRENTHITPOINTS 0 setvarvar DEATHCHARACTERVAR CHARACTERSELECTED? else setvar DEATHCHARACTERVAR 0

   ifvare CHARACTERSELECTED? 3 // Character is Bubsy
   {
    getactor[PLAYERID].htpicnum TEMPVAR
    ifvare gameover? 0 { ifvare TEMPVAR -1 setvar SURVIVALCHECK 10001 else randvar SURVIVALCHECK 10000 } else { setvar SURVIVALCHECK 10001 break }   
    ifvarvarl SURVIVALCHECK SURVIVALVALUE
    {
     ifvare CURRENTHITPOINTS 0
     {
      setactor[PLAYERID].extra 16384
      setvar CURRENTHITPOINTS 1
      state canceldeadactions
      stopsound DUKE_GRUNT
      redefinequote 321 ^23SURVIVED A MORTAL BLOW!!   
      setvar DEATHCHARACTERVAR 0
      setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
      setvarvar fta fta_normal setvar ftq 321
      break 
     }
    }
    else
    {
     setactor[PLAYERID].htpicnum -1
     setvar TEMPVAR -1
    }

    state checkbubsylives
    ifvarg ITEMARRAYID_AMOUNTTEMP 0 // If Bubsy has 'extra lives' left, revive him automatically to 100% HP and Airtime and don't switch him over, but decrement his 'lives' counter by 1
    { 
     state death-checkbubsylives2
     state canceldeadactions
    }
    else
    {
     setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
     ifvarl MISCARRAYID_AMOUNTTEMP 26 
     { 
      ifmove PSHRINKING
      {
       sizeat 42 36
       setvar SHRUNK? 0
      }
      state switchtolivingcharacter 
      state canceldeadactions
     } 
    }
   }
   else
   {
    setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
    ifvarl MISCARRAYID_AMOUNTTEMP 26 
    { 
     ifmove PSHRINKING
     {
      sizeat 42 36
      setvar SHRUNK? 0
     }
     state switchtolivingcharacter 
     state canceldeadactions
    } 
   }
  } 
  else // Last character dies X_x;
  {
   ifvare CURRENTHITPOINTS 0 setvarvar DEATHCHARACTERVAR CHARACTERSELECTED? else setvar DEATHCHARACTERVAR 0

   ifvare CHARACTERSELECTED? 3 // Last Character is Bubsy
   {
    getactor[PLAYERID].htpicnum TEMPVAR     
    ifvare gameover? 0 { ifvare TEMPVAR -1 setvar SURVIVALCHECK 10001 else randvar SURVIVALCHECK 10000 } else { setvar SURVIVALCHECK 10001 }
    ifvarvarl SURVIVALCHECK SURVIVALVALUE
    {
     ifvare CURRENTHITPOINTS 0
     {
      setactor[PLAYERID].extra 16384
      setvar CURRENTHITPOINTS 1
      state canceldeadactions
      stopsound DUKE_GRUNT
      redefinequote 321 ^23SURVIVED A MORTAL BLOW!!   
      setvar DEATHCHARACTERVAR 0
      setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
      setvarvar fta fta_normal setvar ftq 321
      break 
     }
    }
    else
    {
     setactor[PLAYERID].htpicnum -1
     setvar TEMPVAR -1
    }

    state checkbubsylives
    ifvarg ITEMARRAYID_AMOUNTTEMP 0 // If Bubsy has 'extra lives' left, revive him automatically to 100% HP and Airtime and don't switch him over, but decrement his 'lives' counter by 1
    { 
     state death-checkbubsylives2
     state canceldeadactions
    } 
    else
    {
     ifmove PSHRINKING
     {
      sizeat 42 36
      setvar SHRUNK? 0
     }
     state checkforcontinues
     state canceldeadactions
    }
   }
   else // Character is not Bubsy
   {
    ifmove PSHRINKING
    {
     sizeat 42 36
     setvar SHRUNK? 0
    }
    state checkforcontinues 
    state canceldeadactions
   }
  }

 } 
}

ifaction PFROZEN move 0
ifvarg CURRENTHITPOINTS 0 
{
 setvar MISCARRAYID 79 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // AUTO-SWITCH-ATTEMPTS
 setactor[THISACTOR].cstat 257 
}
ifvarn CHARACTERSELECTED? 3
{
 state checkbubsylives
 ifvarg ITEMARRAYID_AMOUNTTEMP 0 state death-checkbubsylives
}

/*
// For the future when there's actual graphics of the characters :P
ifaction PFROZEN spritepal 1
else
{
 ifvare CHARACTERSELECTED? 6 spritepal 24
 else ifvare CHARACTERSELECTED? 9 spritepal 24
 else ifvare CHARACTERSELECTED? 10 
 {
  setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 0 spritepal 20 else spritepal 0 
 }
 else spritepal 0
}
*/

 setvar CHARACTERARRAY 14
 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { setvar MISCARRAYID 30 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 } else { ifvare mainmenu 0 { setvar MISCARRAYID 30 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP addvar MISCARRAYID_AMOUNTTEMP 1 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP } } // MYSTERY1-DEADTIMER

 setvar MISCARRAYID 30 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MYSTERY1-DEADTIMER
 ifvarg MISCARRAYID_AMOUNTTEMP 7799 // 15599
 {
  palfrom 32 64 64 64
  setvar CHARACTERARRAY 14
  getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMPVAR
  setactorvar[CHARACTERARRAY].CHARACTERHP TEMPVAR
  globalsound RESURRECTED_ALLY 
  redefinequote 335 ^20??????? CAME BACK TO LIFE ON HER OWN!
  setvarvar fta fta_normal setvar ftq 335
  setvar MISCARRAYID 30 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MYSTERY1-DEADTIMER
 }
//*******************************************************************

ifvare SKILLSET? 1
{
 ifvarg PARTYSIZE 0 state calculateaveragelevel else state killallcharacters
}

 ifvarg CURRENTARMORPOINTS 0
 {
  ifvarl ARMORPERCENT 100 setvar ARMORPERCENT 100
 }
 else
 {
  ifvarg ARMORPERCENT 0 setvar ARMORPERCENT 0
 }

ifvarl CHARACTERSPEEDTRUE 46500 setvarvar CHARACTERSPEEDTRUE 46500 // Prevents people from having 'Negative' speed


ifinwater
{
 setvar WATER? 2
}
else 
setvar WATER? 0

getplayer[THISACTOR].posz TEMPVAR2
getsector[THISACTOR].floorz TEMPVAR3
getsector[THISACTOR].floorz TEMPVAR4
addvar TEMPVAR4 -8960 //-17920
ifvarvarg TEMPVAR2 TEMPVAR4 ifvarvarl TEMPVAR2 TEMPVAR3 ifvare sector[PLAYERSECTOR].lotag 1
{
 setvar WATER? 1
}

getplayer[THISACTOR].boot_amount BOOTSTIME
ifvarg SCUBATIME 0 setplayer[THISACTOR].scuba_amount 96 else setplayer[THISACTOR].scuba_amount 0
getplayer[THISACTOR].holoduke_amount HOLOFORMTIME
getplayer[THISACTOR].heat_amount NIGHTVISIONTIME
getplayer[THISACTOR].jetpack_amount JETPACKTIME

ifvare mainmenu 1
{
 setplayer[THISACTOR].movement_lock 127 // 31
 setplayer[THISACTOR].ang PLAYERANGLE
 setplayer[THISACTOR].horiz PLAYERHORIZ
}
else
{
 ifvarn shop_id -1
 {
  setplayer[THISACTOR].movement_lock 127 // 31
  setplayer[THISACTOR].ang PLAYERANGLE
  setplayer[THISACTOR].horiz PLAYERHORIZ
 }
 else
 ifvarn atm_id -1
 {
  setplayer[THISACTOR].movement_lock 127 // 31
  setplayer[THISACTOR].ang PLAYERANGLE
  setplayer[THISACTOR].horiz PLAYERHORIZ
 }
 else
 {
  ifvarn VEHICLEID -1
  {
    setuserdef[THISACTOR].auto_run 0

    ifvare PUBLICBETA? 0
    {
     ifvarand bits 4 setplayer[THISACTOR].movement_lock 127 // No Strafing w/ Vehicles
     else ifvarand bits 4194304 setplayer[THISACTOR].movement_lock 127 // No Strafing w/ Vehicles
     else setplayer[THISACTOR].movement_lock 60 // No Strafing w/ Vehicles
    }
    else setplayer[THISACTOR].movement_lock 60
     
    setplayer[THISACTOR].horiz 100 // PLAYERHORIZ
    getplayer[THISACTOR].ang PLAYERANGLE
    ifvarand extbits 16 subvar PLAYERANGLE -14
    ifvarand extbits 32 addvar PLAYERANGLE -14
    setplayer[THISACTOR].ang PLAYERANGLE
 
    ifvarand bits 4 // trying to attack
    {
     ifvarand PLAYERSTATUS? 2 { setvar TEMPVAR 1 setvar TEMPVAR2 1 }
     else ifvarand PLAYERSTATUS? 4 { setvar TEMPVAR 2 setvar TEMPVAR2 4 }
     else { setvar TEMPVAR 1 setvar TEMPVAR2 2 }
     addvar VEHICLEATTACKTIMER 1
     ifvarvare VEHICLEATTACKTIMER TEMPVAR
     {
      ifvare VEHICLEHUDFRAME 0 setvar VEHICLEHUDFRAME 1
      else ifvare VEHICLEHUDFRAME 1 setvar VEHICLEHUDFRAME 2
      else ifvare VEHICLEHUDFRAME 2 setvar VEHICLEHUDFRAME 1
 
      ifvare VEHICLETYPE 0 
      {
       shoot NEWSHOTSPARK1
       shoot NEWSHOTSPARK1
       sound PISTOL_FIRE
      }
      ifvare VEHICLETYPE 1 
      {
       shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN
       shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN
       sound SHOTGUN_FIRE 
      }
      ifvare VEHICLETYPE 2
      {
       eshoot RPG
       ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
       ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
       ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
       setactor[RETURN].extra 140
       getplayer[THISACTOR].posz TEMPVAR5
       subvar TEMPVAR5 2048
       setactor[RETURN].z TEMPVAR5

       sound RPG_SHOOT
      }
      ifvarg actorvar[VEHICLEID].ACTORQUADTIME 0 sound QUADDAMAGE3
      ifvarg actorvar[VEHICLEID].ACTORVAMPIRETIME 0 sound SHOOT_VAMPIREITEM
     }
     ifvarvarg VEHICLEATTACKTIMER TEMPVAR2 setvar VEHICLEATTACKTIMER 0
    }
    else
    {
     ifvarand bits 4194304 // Alt-Fire
     {
      ifvarand PLAYERSTATUS? 2 { setvar TEMPVAR 1 setvar TEMPVAR2 1 }
      else ifvarand PLAYERSTATUS? 4 { setvar TEMPVAR 2 setvar TEMPVAR2 4 }
      else { setvar TEMPVAR 1 setvar TEMPVAR2 2 }
      addvar VEHICLEATTACKTIMER 1
      ifvarvare VEHICLEATTACKTIMER TEMPVAR
      {
       ifvare VEHICLEHUDFRAME 0 setvar VEHICLEHUDFRAME 1
       else ifvare VEHICLEHUDFRAME 1 setvar VEHICLEHUDFRAME 2
       else ifvare VEHICLEHUDFRAME 2 setvar VEHICLEHUDFRAME 1
  
       ifvare VEHICLETYPE 0 
       {
        eshoot FIRELASER
        ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
        ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
        ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
        setactor[RETURN].extra 30
        getplayer[THISACTOR].posz TEMPVAR5
        subvar TEMPVAR5 4096
        setactor[RETURN].z TEMPVAR5

        eshoot FIRELASER
        ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
        ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
        ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
        setactor[RETURN].extra 30

        sound PRED_ATTACK
       }
       ifvare VEHICLETYPE 1 
       {
        shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK
        shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK
        sound EXPANDERSHOOT
       }
       ifvare VEHICLETYPE 2
       {
        eshoot RPG
        ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
        ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
        ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
        setactor[RETURN].extra 140
        getplayer[THISACTOR].posz TEMPVAR5
        subvar TEMPVAR5 2048
        setactor[RETURN].z TEMPVAR5

        sound RPG_SHOOT
       }
       ifvarg actorvar[VEHICLEID].ACTORQUADTIME 0 sound QUADDAMAGE3
       ifvarg actorvar[VEHICLEID].ACTORVAMPIRETIME 0 sound SHOOT_VAMPIREITEM
      }
      ifvarvarg VEHICLEATTACKTIMER TEMPVAR2 setvar VEHICLEATTACKTIMER 0
     }
     else
     {
      setvar VEHICLEATTACKTIMER 0
      setvar VEHICLEHUDFRAME 0
     }
    }
  }
  else
  {
   setplayer[THISACTOR].movement_lock 0
   getplayer[THISACTOR].ang PLAYERANGLE
   getplayer[THISACTOR].horiz PLAYERHORIZ
  }
 }
}

 ifvare player[THISACTOR].heat_on 1 // if the goggles are on, visibility is set to 0 (full) 
 {
  ifvare mainmenu 0
  {
   ifvare CHARACTERSELECTED? 4 
   { 
    setvar MISCARRAYID 99 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // VISOR-ON-SOUND
    ifvare MISCARRAYID_AMOUNTTEMP 0 
    { 
     stopsound NITEVISION_ONOFF
     sound VRVISOR_ON
     setvar MISCARRAYID 99 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // VISOR-ON-SOUND
     setvar MISCARRAYID 100 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // VISOR-OFF-SOUND
    } 
   }
   ifvare CHARACTERSELECTED? 1 setvar TEMPVAR4 256
   ifvare CHARACTERSELECTED? 2 setvar TEMPVAR4 256 
   ifvare CHARACTERSELECTED? 3 setvar TEMPVAR4 160  
   ifvare CHARACTERSELECTED? 4 setvar TEMPVAR4 120   // VR Goggles increase visibility by 4 times instead of NV Goggles' 2
   ifvare CHARACTERSELECTED? 5 setvar TEMPVAR4 272
   ifvare CHARACTERSELECTED? 6 setvar TEMPVAR4 192 
   ifvare CHARACTERSELECTED? 7 setvar TEMPVAR4 240  
   ifvare CHARACTERSELECTED? 8
   {
    setvar MISCARRAYID 77 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-HACKERVISION?
    ifvare MISCARRAYID_AMOUNTTEMP 1 setvar TEMPVAR4 132 else setvar TEMPVAR4 264 
   }
   ifvare CHARACTERSELECTED? 9 setvar TEMPVAR4 320
   ifvare CHARACTERSELECTED? 10 setvar TEMPVAR4 128 
   ifvare CHARACTERSELECTED? 11 setvar TEMPVAR4 240  
   ifvare CHARACTERSELECTED? 12 setvar TEMPVAR4 224
   ifvare CHARACTERSELECTED? 13 setvar TEMPVAR4 240  
   ifvare CHARACTERSELECTED? 14 setvar TEMPVAR4 80
   ifvare CHARACTERSELECTED? 15 setvar TEMPVAR4 248
  }
  else
  {
   ifvare DEBUG_NOMENUOVERLAY 0 { ifvarg mainmenutransitiontimer 6 setvar TEMPVAR4 16384 } else setvar TEMPVAR4 0
  }
 } 
 else
 {
  ifvare mainmenu 0
  {
   ifvare CHARACTERSELECTED? 4 
   { 
    setvar MISCARRAYID 100 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // VISOR-OFF-SOUND
    ifvare MISCARRAYID_AMOUNTTEMP 0 
    { 
     stopsound NITEVISION_ONOFF 
     sound VRVISOR_OFF 
     setvar MISCARRAYID 100 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // VISOR-OFF-SOUND
     setvar MISCARRAYID 99 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // VISOR-ON-SOUND
    } 
   }
   ifvare CHARACTERSELECTED? 1 setvar TEMPVAR4 512
   ifvare CHARACTERSELECTED? 2 setvar TEMPVAR4 512
   ifvare CHARACTERSELECTED? 3 setvar TEMPVAR4 320
   ifvare CHARACTERSELECTED? 4 setvar TEMPVAR4 480
   ifvare CHARACTERSELECTED? 5 setvar TEMPVAR4 544
   ifvare CHARACTERSELECTED? 6 setvar TEMPVAR4 384
   ifvare CHARACTERSELECTED? 7 setvar TEMPVAR4 480
   ifvare CHARACTERSELECTED? 8 setvar TEMPVAR4 528
   ifvare CHARACTERSELECTED? 9 setvar TEMPVAR4 640
   ifvare CHARACTERSELECTED? 10 setvar TEMPVAR4 256
   ifvare CHARACTERSELECTED? 11 setvar TEMPVAR4 480
   ifvare CHARACTERSELECTED? 12 setvar TEMPVAR4 448
   ifvare CHARACTERSELECTED? 13 setvar TEMPVAR4 480
   ifvare CHARACTERSELECTED? 14 setvar TEMPVAR4 160
   ifvare CHARACTERSELECTED? 15 setvar TEMPVAR4 496
  }
  else
  {
   ifvare DEBUG_NOMENUOVERLAY 0 { ifvarg mainmenutransitiontimer 6 setvar TEMPVAR4 16384 } else setvar TEMPVAR4 0
  }
 }
 setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
 ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar TEMPVAR4 140 divvar TEMPVAR4 100 }
 else ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar TEMPVAR4 120 divvar TEMPVAR4 100 }

 ifp ponsteroids
 {
  ifvare SKILLLEVEL 0 mulvar TEMPVAR4 50
  ifvare SKILLLEVEL 1 mulvar TEMPVAR4 55
  ifvare SKILLLEVEL 2 mulvar TEMPVAR4 60
  ifvare SKILLLEVEL 3 mulvar TEMPVAR4 65
  ifvare SKILLLEVEL 4 mulvar TEMPVAR4 70
  ifvare SKILLLEVEL 5 mulvar TEMPVAR4 75
  ifvare SKILLLEVEL 6 mulvar TEMPVAR4 80
  ifvare SKILLLEVEL 7 mulvar TEMPVAR4 85
  ifvare SKILLLEVEL 8 mulvar TEMPVAR4 90
  ifvare SKILLLEVEL 9 mulvar TEMPVAR4 95
  divvar TEMPVAR4 100
 }
/*
 ifvare gameover? 1
 {
  ifvarg gameovertransitiontimer 13
  {
   addvar gameoverblacknessfade 1

   setvar TEMPVAR6 -26
   ifvarg gameoverblacknessfade 26
   {
    addvarvar TEMPVAR6 gameoverblacknessfade 
    mulvar TEMPVAR6 4
    divvar TEMPVAR6 5
   }
   ifvarl TEMPVAR6 0 setvar TEMPVAR6 0
   ifvarg TEMPVAR6 64 setvar TEMPVAR6 64
   setplayer[THISACTOR].pals_time TEMPVAR6
   setplayer[THISACTOR].pals 0 0
   setplayer[THISACTOR].pals 1 0
   setplayer[THISACTOR].pals 2 0
  }
 }
 else
 {
  setvar gameoverblacknessfade 0
 }
*/
 setuserdef[THISACTOR].const_visibility TEMPVAR4

 setvarvar CRITICALHITCHANCE2 CRITICALHITCHANCE

//********************************
//*Hockey Masks [Equippable Item]*
//********************************
 ifvare PLAYEREQUIPSLOTITEM1 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM2 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM3 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM4 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM5 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM6 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM7 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }
 ifvare PLAYEREQUIPSLOTITEM8 19
 {
  setvarvar TEMPVAR3 CRITICALHITCHANCE2
  subvar TEMPVAR3 1
  divvar TEMPVAR3 3
  addvarvar CRITICALHITCHANCE2 TEMPVAR3
 }

//*****************************
//*Critical-Hit Support [Lisa]*
//*****************************
  setvar DAMAGEMODIFIER 1000
  state support-criticalhit  
  state damagemod-enemy-critical

//*************************************
//*Bloodlusting "Buff" - Cybanis Skill*
//*************************************
  ifvarand PLAYERSTATUS? 8192
  {
   // Step1: +1/4 Rate
   setvarvar TEMPVAR4 CRITICALHITCHANCE2
   divvar TEMPVAR4 4
   addvarvar CRITICALHITCHANCE2 TEMPVAR4

   // Step2: Add the level-specfic extra bonus
   setvar TEMPVAR2 2000 // 20.00% [base amount]
   setvar TEMPVAR3 25 // 0.25% [base increase]

   // Character's Level / 2 = Addition to Base increase
   setvarvar TEMPVAR4 PLAYERLEVEL
   divvar TEMPVAR4 2 

   addvarvar TEMPVAR3 TEMPVAR4

   // Cybanis's Level * Base Increase = Extra Increase
   setvar CHARACTERARRAY 9
   getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR4
   mulvarvar TEMPVAR4 TEMPVAR3

   // 20% + Extra Increase = Full Increase Bonus
   addvarvar TEMPVAR2 TEMPVAR4
 
   // Step3: Final Calculations
   addvarvar CRITICALHITCHANCE2 TEMPVAR2
  }
//*****************************
//*****************************
//*****************************
 ifp ponsteroids mulvar CRITICALHITCHANCE2 2
 setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
 ifvarl MISCARRAYID_AMOUNTTEMP 251 mulvar CRITICALHITCHANCE2 2

 ifvare PLAYEREQUIPSLOTITEM1 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM2 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM3 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM4 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM5 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM6 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM7 28 mulvar CRITICALHITCHANCE2 10
 ifvare PLAYEREQUIPSLOTITEM8 28 mulvar CRITICALHITCHANCE2 10

 // Iron Rune [Equippable Item] (Lowers Final Critical % in trade for resistance to damage)
 setvar DAMAGEMODIFIER 1000
 ifvare PLAYEREQUIPSLOTITEM1 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM2 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM3 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM4 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM5 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM6 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM7 21 subvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM8 21 subvar DAMAGEMODIFIER 250
 ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
 mulvarvar CRITICALHITCHANCE2 DAMAGEMODIFIER
 divvar CRITICALHITCHANCE2 1000
 addvar CRITICALHITCHANCE2 1


smaxammo 1 MAXPISTOL
smaxammo 2 MAXSHOTGUN
smaxammo 3 MAXCHAINGUN
smaxammo 4 MAXRPG
smaxammo 5 MAXPIPEBOMB
smaxammo 6 MAXSHRINKER
smaxammo 11 MAXEXPANDER
smaxammo 7 MAXDEVASTATOR
smaxammo 8 MAXTRIPBOMB
smaxammo 9 MAXFREEZER

 ifvare player[THISACTOR].curr_weapon 0
 {
  setvar CURRENTAMMOA 0
  setvar MAXIMUMAMMO 0
  redefinequote 214 AMMO1
 }
 ifvare player[THISACTOR].curr_weapon 1
 {
  getplayer[THISACTOR].ammo_amount 1 CURRENTAMMOA
  gmaxammo 1 MAXIMUMAMMO
  redefinequote 214 AMMO2
 }
 ifvare player[THISACTOR].curr_weapon 2
 {
  getplayer[THISACTOR].ammo_amount 2 CURRENTAMMOA
  gmaxammo 2 MAXIMUMAMMO
  redefinequote 214 AMMO3
 }
 ifvare player[THISACTOR].curr_weapon 3
 {
  getplayer[THISACTOR].ammo_amount 3 CURRENTAMMOA
  gmaxammo 3 MAXIMUMAMMO
  redefinequote 214 AMMO4
 }
 ifvare player[THISACTOR].curr_weapon 4 
 {
  getplayer[THISACTOR].ammo_amount 4 CURRENTAMMOA
  gmaxammo 4 MAXIMUMAMMO
  redefinequote 214 AMMO5
 }
 ifvare player[THISACTOR].curr_weapon 5
 {
  getplayer[THISACTOR].ammo_amount 5 CURRENTAMMOA
  gmaxammo 5 MAXIMUMAMMO
  redefinequote 214 AMMO6
 }
 ifvare player[THISACTOR].curr_weapon 6
 {
  getplayer[THISACTOR].ammo_amount 6 CURRENTAMMOA
  gmaxammo 6 MAXIMUMAMMO
  redefinequote 214 AMMO7
 }
 ifvare player[THISACTOR].curr_weapon 7
 {
  getplayer[THISACTOR].ammo_amount 7 CURRENTAMMOA
  gmaxammo 7 MAXIMUMAMMO
  redefinequote 214 AMMO8
 }
 ifvare player[THISACTOR].curr_weapon 8
 {
  getplayer[THISACTOR].ammo_amount 8 CURRENTAMMOA
  gmaxammo 8 MAXIMUMAMMO
  redefinequote 214 AMMO9
 }
 ifvare player[THISACTOR].curr_weapon 9
 {
  getplayer[THISACTOR].ammo_amount 9 CURRENTAMMOA
  gmaxammo 9 MAXIMUMAMMO
  redefinequote 214 AMMO10
 }
 ifvare player[THISACTOR].curr_weapon 11
 {
  getplayer[THISACTOR].ammo_amount 11 CURRENTAMMOA 
  gmaxammo 11 MAXIMUMAMMO 
  redefinequote 214 AMMO11
 }

setvarvar DAMAGEPERCENT 1000
subvarvar DAMAGEPERCENT ARMORPERCENT

ifvare mainmenu 0
{
 ifvarg PLAYERDISPLAYTOTALDAMAGE 0
 {
  ifvarg PLAYERDISPLAYDAMAGE 0 ifvare NULLDAMAGE 0 addvar HEALTHDAMAGETIMER 1
  ifvare PLAYERDISPLAYDAMAGE 0 ifvarg NULLDAMAGE 0 addvar HEALTHDAMAGETIMER 1
  ifvarg PLAYERDISPLAYARMORDAMAGE 0 ifvare ARMORNULLDAMAGE 0 addvar ARMORDAMAGETIMER 1
  ifvare PLAYERDISPLAYARMORDAMAGE 0 ifvarg ARMORNULLDAMAGE 0 addvar ARMORDAMAGETIMER 1
  ifvarg PLAYERDISPLAYCELLDAMAGE 0 ifvare BIOSHIELDNULLDAMAGE 0 addvar CELLDAMAGETIMER 1
  ifvare PLAYERDISPLAYCELLDAMAGE 0 ifvarg BIOSHIELDNULLDAMAGE 0 addvar CELLDAMAGETIMER 1
 }

 addvar ATTACKERDISPLAYTIMER 1
 ifvarg TARGETDISPLAYDAMAGE 0 addvar DEFENDERDISPLAYTIMER 1
 ifvarg ACTORNULLDAMAGE 0 addvar DEFENDERDISPLAYTIMER 1
 ifvarg ACTORDISPLAYARMORDAMAGE 0 addvar ACTORARMORDISPLAYTIMER 1
 ifvarg ACTORARMORNULLDAMAGE 0 addvar ACTORARMORDISPLAYTIMER 1
 ifvarn DISPLAYRANKPOINTS 0 addvar RANKDISPLAYTIMER 1
 ifvarg DISPLAYEXPPOINTS 0 addvar EXPDISPLAYTIMER 1

 setvar MISCARRAYID 70 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FORTUNE-COOKIE-TIMER
 ifvarg MISCARRAYID_AMOUNTTEMP 0 
 {
  subvar MISCARRAYID_AMOUNTTEMP 1 
  setvar MISCARRAYID 70 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
 }

 ifvarg DAMAGEHUETIMER 0 subvar DAMAGEHUETIMER 1
 ifvarg PKSHIELDHIT_TIMER 0 subvar PKSHIELDHIT_TIMER 1
 ifvare shop_id -1 ifvare atm_id -1
 {
  ifvarn DISPLAYDOLLARS 0 addvar DISPLAYMONEYTIMER 1
  ifvarn DISPLAYCENTS 0 ifvare DISPLAYDOLLARS 0 addvar DISPLAYMONEYTIMER 1
  ifvarg HPINCREASED 0 addvar HPLUPDISPLAY 1
  ifvarg APINCREASED 0 addvar APLUPDISPLAY 1
  ifvarg EPINCREASED 0 addvar EPLUPDISPLAY 1
  ifvarg ATKINCREASED 0 addvar ATKLUPDISPLAY 1
  ifvarg DEFINCREASED 0 addvar DEFLUPDISPLAY 1
  ifvarg SPDINCREASED 0 addvar SPDLUPDISPLAY 1
  ifvarg AIRINCREASED 0 addvar AIRLUPDISPLAY 1
  ifvarg MNTINCREASED 0 addvar MNTLUPDISPLAY 1
  ifvarg JUMINCREASED 0 addvar JUMLUPDISPLAY 1
 }


 setvar MISCARRAYID 31 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button1timer
 setvar MISCARRAYID 32 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button2timer
 setvar MISCARRAYID 33 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button3timer
 setvar MISCARRAYID 34 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button4timer
 setvar MISCARRAYID 35 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button5timer
 setvar MISCARRAYID 36 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button6timer
 setvar MISCARRAYID 37 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button7timer
 setvar MISCARRAYID 38 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button8timer
 setvar MISCARRAYID 41 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button1timer
 setvar MISCARRAYID 42 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button2timer
 setvar MISCARRAYID 43 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button3timer
 setvar MISCARRAYID 44 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button4timer
 setvar MISCARRAYID 45 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button5timer
 setvar MISCARRAYID 46 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button6timer
 setvar MISCARRAYID 47 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button7timer
 setvar MISCARRAYID 48 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button8timer
 setvar MISCARRAYID 49 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button9timer
 setvar MISCARRAYID 50 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button10timer
 setvar MISCARRAYID 51 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button11timer
 setvar MISCARRAYID 52 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button12timer
}
ifvarg fta 0 { getuserdef[THISACTOR].pause_on temp ifvare temp 0 subvar fta 1 }

getplayer[THISACTOR].posz posz
getplayer[THISACTOR].poszv poszv

// Sets up Lisa's "Lady Luck" ability [to make money drop more often]
 setvar CHARACTERARRAY 8
 getactorvar[CHARACTERARRAY].CHARACTERLEVEL templevel1
 ifvarg templevel1 0 ifvarl templevel1 11 setvar LISAMONEYTURNS2 0
 else ifvarg templevel1 10 ifvarl templevel1 31 setvar LISAMONEYTURNS2 1
 else ifvarg templevel1 30 ifvarl templevel1 61 setvar LISAMONEYTURNS2 2
 else ifvarg templevel1 60 setvar LISAMONEYTURNS2 3
 ifvare templevel1 100 setvar LISAMONEYMAXLEVEL 1 else setvar LISAMONEYMAXLEVEL 0

 // Bio-Shield Stuff
 ifvarg ESHIELDDMGFACTOR 1024 setvar ESHIELDDMGFACTOR 1024
 ifvarg MAXCELLS 2050 setvar MAXCELLS 2050
 ifvarvarg CURRENTCELLS MAXCELLS setvarvar CURRENTCELLS MAXCELLS

 setvarvar CURRENTBIOSHIELDPOWER CURRENTCELLS
 mulvarvar CURRENTBIOSHIELDPOWER ESHIELDDMGFACTOR
 addvarvar CURRENTBIOSHIELDPOWER DAMAGEINCELL
 setvarvar MAXBIOSHIELDPOWER MAXCELLS
 mulvarvar MAXBIOSHIELDPOWER ESHIELDDMGFACTOR
 addvarvar MAXBIOSHIELDPOWER ESHIELDDMGFACTOR

 setvarvar ESHIELDCOMPARISON MAXBIOSHIELDPOWER
 ifvare CHARACTERSELECTED? 8 divvarvar ESHIELDCOMPARISON MAXHITPOINTS
 else
 {
  setvar CHARACTERARRAY 8
  divvarvar ESHIELDCOMPARISON actorvar[CHARACTERARRAY].CHARACTERMAXHP
 }

 ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1 ifvare ENERGYSHIELDMODE 1 ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
 {
  setvar BIOSHIELDFLASHPULSE? 1
  setplayer[THISACTOR].hurt_delay 12 // Constantly sets to 12 to prevent Forcefields and Cacti from damaging Lisa when she has the Bio-Shield turned on
  ifvare mainmenu 0
  {
       // old increments of 4
       addvar SHIELDPULSETIMER 1
       ifvare SHIELDPULSETIMER 1  palfrom  2 0 0 64
       ifvare SHIELDPULSETIMER 2  palfrom  4 0 0 64
       ifvare SHIELDPULSETIMER 3  palfrom  6 0 0 64
       ifvare SHIELDPULSETIMER 4  palfrom  8 0 0 64
       ifvare SHIELDPULSETIMER 5  palfrom 10 0 0 64
       ifvare SHIELDPULSETIMER 6  palfrom 12 0 0 64
       ifvare SHIELDPULSETIMER 7  palfrom 14 0 0 64
       ifvare SHIELDPULSETIMER 8  palfrom 16 0 0 64
       ifvare SHIELDPULSETIMER 9  palfrom 14 0 0 64
       ifvare SHIELDPULSETIMER 10 palfrom 12 0 0 64
       ifvare SHIELDPULSETIMER 11 palfrom 10 0 0 64
       ifvare SHIELDPULSETIMER 12 palfrom  8 0 0 64
       ifvare SHIELDPULSETIMER 13 palfrom  6 0 0 64
       ifvare SHIELDPULSETIMER 14 palfrom  4 0 0 64
       ifvare SHIELDPULSETIMER 15
       {
        palfrom 2 0 0 64 
        setvar SHIELDPULSETIMER 1

        ifvarl ESHIELDCOMPARISON 16 { stopsound BIOSHIELD_HUM_QUIETEST sound BIOSHIELD_HUM_QUIETEST }
        ifvarg ESHIELDCOMPARISON 15 ifvarl ESHIELDCOMPARISON 64 { stopsound BIOSHIELD_HUM_QUIET sound BIOSHIELD_HUM_QUIET }
        ifvarg ESHIELDCOMPARISON 63 ifvarl ESHIELDCOMPARISON 256 { stopsound BIOSHIELD_HUM_NORMAL  sound BIOSHIELD_HUM_NORMAL }
        ifvarg ESHIELDCOMPARISON 255 ifvarl ESHIELDCOMPARISON 1024 { stopsound BIOSHIELD_HUM_LOUD sound BIOSHIELD_HUM_LOUD }
        ifvarg ESHIELDCOMPARISON 1023 { stopsound BIOSHIELD_HUM_LOUDEST sound BIOSHIELD_HUM_LOUDEST }
       }
  }
 }
 else setvar BIOSHIELDFLASHPULSE? 0

// Night Vision
ifvare CHARACTERSELECTED? 4 
{
 setplayer[THISACTOR].heat_amount HEAT_AMOUNT // Ami has infinite NV Goggles :P
 redefinequote 101 ^20MERCURY VR VISOR
 redefinequote 106 ^19MERCURY VR VISOR ON
 redefinequote 107 ^19MERCURY VR VISOR OFF
 ifvare player[THISACTOR].heat_on 1 
 { 
  // old intensity 16
  setvar VRVISORHUE? 1 palfrom 12 0 0 64
 }
 else setvar VRVISORHUE? 0
}
else
ifvare CHARACTERSELECTED? 8
{
 setvar VRVISORHUE? 0
 setvar MISCARRAYID 77 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-HACKERVISION?
 ifvare MISCARRAYID_AMOUNTTEMP 1
 {
  setplayer[THISACTOR].heat_amount HEAT_AMOUNT  // Lisa will have infinite NV with the Hacker Vision Upgrade
  redefinequote 101 ^20HACKER NIGHT-VISION UPGRADE
  redefinequote 106 ^19HACKER NIGHT-VISION ON
  redefinequote 107 ^19HACKER NIGHT-VISION OFF
 }
 else
 {
  redefinequote 101 ^20NIGHT VISION GOGGLES
  redefinequote 106 ^19NIGHT VISION ON
  redefinequote 107 ^19NIGHT VISION OFF
 }
}
else
{
 setvar VRVISORHUE? 0
 redefinequote 101 ^20NIGHT VISION GOGGLES
 redefinequote 106 ^19NIGHT VISION ON
 redefinequote 107 ^19NIGHT VISION OFF
}

// Damage Screen Pulses [low Health]
 ifvare gameover? 0 ifvarn oldskoolmode 1 ifvare DAMAGEVISION? 1
 {
  addvar DAMAGEVISIONTIMER 1

  setvarvar TEMPVAR5 CURRENTHITPOINTS
  mulvar TEMPVAR5 1000
  divvarvar TEMPVAR5 MAXHITPOINTS

  ifvarg TEMPVAR5 250 setvar DAMAGEVISIONTIMER 0
  else
  ifvarg TEMPVAR5 100 ifvarl TEMPVAR5 251
  {
   ifvare DAMAGEVISIONTIMER 0  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 1  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  2 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 10 16 0 48 else palfrom  1 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 2  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  4 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 12 16 0 48 else palfrom  2 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 3  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  3 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 4  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  8 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 16 16 0 48 else palfrom  4 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 5  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 10 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 18 16 0 48 else palfrom  5 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 6  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom  6 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 7  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 14 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 22 16 0 48 else palfrom  7 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 8  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 16 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 24 16 0 48 else palfrom  8 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 9  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom  9 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 10 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 20 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 28 16 0 48 else palfrom 10 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 11 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 22 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 30 16 0 48 else palfrom 11 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 12 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 12 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 13 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 26 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 34 16 0 48 else palfrom 13 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 14 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 28 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 36 16 0 48 else palfrom 14 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 15 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 15 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 16 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 32 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 40 16 0 48 else palfrom 16 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 17 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 15 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 18 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 28 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 36 16 0 48 else palfrom 14 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 19 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 26 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 34 16 0 48 else palfrom 13 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 20 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 12 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 21 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 22 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 30 16 0 48 else palfrom 11 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 22 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 20 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 28 16 0 48 else palfrom 10 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 23 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom  9 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 24 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 16 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 24 16 0 48 else palfrom  8 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 25 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 14 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 22 16 0 48 else palfrom  7 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 26 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom  6 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 27 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 10 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 18 16 0 48 else palfrom  5 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 28 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  8 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 16 16 0 48 else palfrom  4 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 29 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  3 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 30 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  4 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 12 16 0 48 else palfrom  2 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 31 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  2 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 10 16 0 48 else palfrom  1 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 32 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
  }
  else
  ifvarl TEMPVAR5 101
  {
   ifvare DAMAGEVISIONTIMER 0  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 1  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  3 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 11 16 0 48 else palfrom  3 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 2  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  6 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 3  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  9 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 17 16 0 48 else palfrom  9 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 4  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom 12 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 5  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 15 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 23 16 0 48 else palfrom 15 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 6  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom 18 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 7  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 21 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 29 16 0 48 else palfrom 21 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 8  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 24 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 9  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 27 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 35 16 0 48 else palfrom 27 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 10 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 30 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 11 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 33 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 41 16 0 48 else palfrom 33 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 12 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 36 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 44 16 0 48 else palfrom 36 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 13 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 39 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 47 16 0 48 else palfrom 39 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 14 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 42 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 50 16 0 48 else palfrom 42 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 15 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 45 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 53 16 0 48 else palfrom 45 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 16 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 48 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 56 16 0 48 else palfrom 48 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 17 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 45 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 53 16 0 48 else palfrom 45 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 18 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 42 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 50 16 0 48 else palfrom 42 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 19 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 39 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 47 16 0 48 else palfrom 39 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 20 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 36 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 44 16 0 48 else palfrom 36 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 21 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 33 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 41 16 0 48 else palfrom 33 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 22 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 30 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 23 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 27 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 35 16 0 48 else palfrom 27 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 24 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 24 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 25 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 21 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 29 16 0 48 else palfrom 21 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 26 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom 18 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 27 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 15 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 23 16 0 48 else palfrom 15 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 28 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom 12 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 29 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  9 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 17 16 0 48 else palfrom  9 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 30 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  6 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 31 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  3 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 11 16 0 48 else palfrom  3 32 0 0 } }
   ifvare DAMAGEVISIONTIMER 32 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
  }
  ifvarg DAMAGEVISIONTIMER 31 setvar DAMAGEVISIONTIMER 0
 }

// Quad Damage Powerup
 ifvarg QUADTIME 0
 {
   ifvarand POWERUPBITFIELD 1 nullop else addvar POWERUPBITFIELD 1
   ifvare QUADTIME 104 soundonce QUADDAMAGE2

   ifvarg QUADTIME 130 palfrom 16 0 0 64
   ifvarl QUADTIME 131 ifvarg QUADTIME 104 palfrom 6 0 0 64
   ifvarl QUADTIME 105 ifvarg QUADTIME 78 palfrom 5 0 0 64
   ifvarl QUADTIME 79 ifvarg QUADTIME 52 palfrom 3 0 0 64
   ifvarl QUADTIME 53 ifvarg QUADTIME 26 palfrom 2 0 0 64
   ifvarl QUADTIME 27 ifvarg QUADTIME 0 palfrom 1 0 0 64
   ifvare QUADTIME 1 { setvarvar fta fta_normal setvar ftq 163 }

   ifvare mainmenu 0
   {
    ifvarg CURRENTHITPOINTS 0
    {
     ifvarand POWERUPCHEATFLAGS? 1 nullop else subvar QUADTIME 1
     //state itemfullbright
    }
   }
 }
 else
 {
  ifvarand POWERUPBITFIELD 1 subvar POWERUPBITFIELD 1
 }

  // Health Regen Powerup
 ifvarg REGENTIME 0
 {
   ifvarand POWERUPBITFIELD 4 nullop else addvar POWERUPBITFIELD 4
   state removepoison
   ifvarg REGENTIME 130 palfrom 16 64
   ifvarl REGENTIME 131 ifvarg REGENTIME 104 palfrom 6 64
   ifvarl REGENTIME 105 ifvarg REGENTIME 78 palfrom 5 64
   ifvarl REGENTIME 79 ifvarg REGENTIME 52 palfrom 3 64
   ifvarl REGENTIME 53 ifvarg REGENTIME 26 palfrom 2 64
   ifvarl REGENTIME 27 ifvarg REGENTIME 0 palfrom 1 64
   ifvare REGENTIME 1 { setvarvar fta fta_normal setvar ftq 228 setvar PLAYERREGENCOUNTER 0 }

   ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvar PLAYERREGENCOUNTER 1 }

   ifvarg PLAYERREGENCOUNTER 25
   {
    setvarvar PLAYERREGENAMOUNT1 MAXHITPOINTS
    ifvare PUBLICBETA? 1 mulvar PLAYERREGENAMOUNT1 150 else mulvar PLAYERREGENAMOUNT1 50
    setvar TEMPMOD 0
    ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
    ifvarl TEMPMOD 2 setvar TEMPMOD 2
    mulvarvar PLAYERREGENAMOUNT1 TEMPMOD
    divvar PLAYERREGENAMOUNT1 2
    divvar PLAYERREGENAMOUNT1 1000

    setvarvar PLAYERREGENAMOUNT2 MAXHITPOINTS
    ifvare PUBLICBETA? 1 mulvar PLAYERREGENAMOUNT2 50 else mulvar PLAYERREGENAMOUNT2 16
    setvar TEMPMOD 0
    ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
    ifvarl TEMPMOD 2 setvar TEMPMOD 2
    mulvarvar PLAYERREGENAMOUNT2 TEMPMOD
    divvar PLAYERREGENAMOUNT2 2
    divvar PLAYERREGENAMOUNT2 1000

    ifvarvarl CURRENTHITPOINTS MAXHITPOINTSATOMIC ifvarvarg CURRENTHITPOINTS MAXHITPOINTS state playerregen5percenthp
    else ifvarvare CURRENTHITPOINTS MAXHITPOINTS state playerregen5percenthp
    else ifvarvarl CURRENTHITPOINTS MAXHITPOINTS ifvarg CURRENTHITPOINTS 0
    {
     addvarvar CURRENTHITPOINTS PLAYERREGENAMOUNT1
     ifvarn player[THISACTOR].over_shoulder_on 0
     {
      ifvarg PLAYERREGENAMOUNT1 0
      {
       setvarvar SHOWDAMAGE PLAYERREGENAMOUNT1
       setvar SHOWDAMAGETYPE 3
       setvarvar SHOWDAMAGEACTORID THISACTOR
       state showdamage
      }
     }
     ifvarvarg CURRENTHITPOINTS STATLIMITATOMIC setvarvar CURRENTHITPOINTS STATLIMITATOMIC
     ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
     ifvarvarl CURRENTHITPOINTS STATLIMITATOMIC sound REGEN_HEALTH15 setvar PLAYERHPDAMAGED? -1
    }
    setvar PLAYERREGENCOUNTER 0
   }
   ifvare mainmenu 0
   {
    ifvarg CURRENTHITPOINTS 0
    {
     ifvarand POWERUPCHEATFLAGS? 4 nullop else subvar REGENTIME 1
     //state itemfullbright
    }
   }
 }
 else
 {
  ifvarand POWERUPBITFIELD 4 subvar POWERUPBITFIELD 4
 }

  // Armor Regen Powerup
  ifvarg APREGENTIME 0
  {
   ifvarand POWERUPBITFIELD 8 nullop else addvar POWERUPBITFIELD 8
   state removecorrosion
   // Sets AB%
   // setvar ARMORPERCENT 1000 // nerf the old super Armor angle
   setvar TEMPMOD 125
   ifvare SKILLLEVEL 0 setvar TEMPMOD 666
   ifvare SKILLLEVEL 1 setvar TEMPMOD 633
   ifvare SKILLLEVEL 2 setvar TEMPMOD 600
   ifvare SKILLLEVEL 3 setvar TEMPMOD 555
   ifvare SKILLLEVEL 4 setvar TEMPMOD 527
   ifvare SKILLLEVEL 5 setvar TEMPMOD 500
   ifvare SKILLLEVEL 6 setvar TEMPMOD 444
   ifvare SKILLLEVEL 7 setvar TEMPMOD 422
   ifvare SKILLLEVEL 8 setvar TEMPMOD 400
   ifvare SKILLLEVEL 9 setvar TEMPMOD 333
   ifvarvarl ARMORPERCENT TEMPMOD setvarvar ARMORPERCENT TEMPMOD

   // Hue Fading Timer
   ifvarg APREGENTIME 130 palfrom 16 0 64
   ifvarl APREGENTIME 131 ifvarg APREGENTIME 104 palfrom 6 0 64
   ifvarl APREGENTIME 105 ifvarg APREGENTIME 78 palfrom 5 0 64
   ifvarl APREGENTIME 79 ifvarg APREGENTIME 52 palfrom 3 0 64
   ifvarl APREGENTIME 53 ifvarg APREGENTIME 26 palfrom 2 0 64
   ifvarl APREGENTIME 27 ifvarg APREGENTIME 0 palfrom 1 0 64
   ifvare APREGENTIME 1 { setvarvar fta fta_normal setvar ftq 232 setvar PLAYERAPREGENCOUNTER 0 }

   ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvar PLAYERAPREGENCOUNTER 1 }

   ifvarg PLAYERAPREGENCOUNTER 25
   {
    setvarvar PLAYERAPREGENAMOUNT CURRENTARMORPOINTS
    setvarvar PLAYERAPREGENAMOUNT1 MAXARMORPOINTS
    ifvare PUBLICBETA? 1 mulvar PLAYERAPREGENAMOUNT1 150 else mulvar PLAYERAPREGENAMOUNT1 50
    setvar TEMPMOD 0
    ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
    ifvarl TEMPMOD 2 setvar TEMPMOD 2
    mulvarvar PLAYERAPREGENAMOUNT1 TEMPMOD
    divvar PLAYERAPREGENAMOUNT1 2
    divvar PLAYERAPREGENAMOUNT1 1000

    setvarvar PLAYERAPREGENAMOUNT2 MAXARMORPOINTS
    ifvare PUBLICBETA? 1 mulvar PLAYERAPREGENAMOUNT2 50 else mulvar PLAYERAPREGENAMOUNT2 16
    setvar TEMPMOD 0
    ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
    ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
    ifvarl TEMPMOD 2 setvar TEMPMOD 2
    mulvarvar PLAYERAPREGENAMOUNT2 TEMPMOD
    divvar PLAYERAPREGENAMOUNT2 2
    divvar PLAYERAPREGENAMOUNT2 1000

    ifvarvarl PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC ifvarvarg PLAYERAPREGENAMOUNT MAXARMORPOINTS state playerregen5percentap
    else ifvarvare PLAYERAPREGENAMOUNT MAXARMORPOINTS state playerregen5percentap
    else ifvarvarl PLAYERAPREGENAMOUNT MAXARMORPOINTS ifvarg PLAYERAPREGENAMOUNT -1
    {
     addvarvar PLAYERAPREGENAMOUNT PLAYERAPREGENAMOUNT1
     ifvarn player[THISACTOR].over_shoulder_on 0
     {
      ifvarg PLAYERAPREGENAMOUNT1 0
      {
       setvarvar SHOWDAMAGE PLAYERAPREGENAMOUNT1
       setvar SHOWDAMAGETYPE 4
       setvarvar SHOWDAMAGEACTORID THISACTOR
       state showdamage
      }
     }
     ifvarvarg PLAYERAPREGENAMOUNT STATLIMITATOMIC setvarvar PLAYERAPREGENAMOUNT STATLIMITATOMIC
     ifvarvarg PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC setvarvar PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC
     ifvarvarl PLAYERAPREGENAMOUNT STATLIMITATOMIC sound REGEN_ARMOR15 setvar PLAYERAPDAMAGED? -1
     setvarvar CURRENTARMORPOINTS PLAYERAPREGENAMOUNT
    }
    setvar PLAYERAPREGENCOUNTER 0
   }
   ifvare mainmenu 0 
   {
    ifvarg CURRENTHITPOINTS 0
    {
     ifvarand POWERUPCHEATFLAGS? 8 nullop else subvar APREGENTIME 1
     //state itemfullbright
    }
   }
  } 
  else
  {
   ifvarand POWERUPBITFIELD 8 subvar POWERUPBITFIELD 8
  }

// Vampire Powerup
  ifvarg VAMPIRETIME 0
  {
   ifvarand POWERUPBITFIELD 16 nullop else addvar POWERUPBITFIELD 16
   ifvarg VAMPIRETIME 130 palfrom 16 8 64
   ifvarl VAMPIRETIME 131 ifvarg VAMPIRETIME 104 palfrom 6 5 64
   ifvarl VAMPIRETIME 105 ifvarg VAMPIRETIME 78 palfrom 5 4 64
   ifvarl VAMPIRETIME 79 ifvarg VAMPIRETIME 52 palfrom 3 2 64
   ifvarl VAMPIRETIME 53 ifvarg VAMPIRETIME 26 palfrom 2 1 64
   ifvarl VAMPIRETIME 27 ifvarg VAMPIRETIME 0 palfrom 1 1 64
   ifvare VAMPIRETIME 1 { setvarvar fta fta_normal setvar ftq 234 }

   ifvare mainmenu 0
   {
    ifvarg CURRENTHITPOINTS 0 
    {
     ifvarand POWERUPCHEATFLAGS? 16 nullop else subvar VAMPIRETIME 1
     //state itemfullbright
    }
   }
  }
  else
  {
   ifvarand POWERUPBITFIELD 16 subvar POWERUPBITFIELD 16
  }

// Invulnerability Powerup
 state invulnicon-player
 ifvarg INVULNTIME 0
 {
    ifvarand POWERUPBITFIELD 2 nullop else addvar POWERUPBITFIELD 2
    state removeslow
    state removepoison
    state removedimness
    state removeconfusion
    state removecorrosion
    setplayer[THISACTOR].hurt_delay 12
    ifvare INVULNTIME 104 soundonce INVULNITEM2
    ifvarg INVULNTIME 130 palfrom 16 64 64
    ifvarl INVULNTIME 131 ifvarg INVULNTIME 104 palfrom 6 64 64
    ifvarl INVULNTIME 105 ifvarg INVULNTIME 78 palfrom 5 64 64
    ifvarl INVULNTIME 79 ifvarg INVULNTIME 52 palfrom 3 64 64
    ifvarl INVULNTIME 53 ifvarg INVULNTIME 26 palfrom 2 64 64
    ifvarl INVULNTIME 27 ifvarg INVULNTIME 0 palfrom 1 64 64
    ifvare INVULNTIME 1 { setvarvar fta fta_normal setvar ftq 155 }

   ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvar PLAYERINVULNCOUNTER 1 }
   ifvarg PLAYERINVULNCOUNTER 38 { sound INVULN_PULSE setvar PLAYERINVULNCOUNTER 0 }
   setplayer[THISACTOR].falling_counter 0
   ifvare mainmenu 0
   {
    ifvarg CURRENTHITPOINTS 0
    {
     ifvarand POWERUPCHEATFLAGS? 2 nullop else subvar INVULNTIME 1
     //state itemfullbright
    }
   }
 }
 else
 {
  ifvarand POWERUPBITFIELD 2 subvar POWERUPBITFIELD 2
 }

//*******************************
//*JUMPING/FALLING-RELATED STUFF*
//*******************************

ifvare mainmenu 0
{
 ifvarn VEHICLEID -1 // When driving vehicles
 {
  ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
  {
   getinput[THISACTOR].avel TEMPVAR3
   ifvarn TEMPVAR3 0 setvar TEMPVAR3 0
   setinput[THISACTOR].avel TEMPVAR3

   setvar PLAYERMOVEPLUSVEL 524288
   ifvare sector[PLAYERSECTOR].lotag 1 { ifp ponground { mulvar PLAYERMOVEPLUSVEL 75 divvar PLAYERMOVEPLUSVEL 100 } }

   ifvarg PLAYERMOVEPLUSVEL 1048576 setvar PLAYERMOVEPLUSVEL 1048576 // Sets Riot Tank speed to a slow point purposely
   // Set the Negative Speed Limit to an inverse of the positive speed limit
   setvarvar PLAYERMOVEMINUSVEL PLAYERMOVEPLUSVEL mulvar PLAYERMOVEMINUSVEL -1

   getplayer[THISACTOR].posxv posxv
   ifvarn posxv 0
   {
    getinput[THISACTOR].fvel TEMPVAR4
    mulvar posxv 67
    divvar posxv 100
   }
   setplayer[THISACTOR].posxv posxv

   getplayer[THISACTOR].posyv posyv
   ifvarn posyv 0
   {
    getinput[THISACTOR].svel TEMPVAR4
    mulvar posyv 67
    divvar posyv 100
   }
   setplayer[THISACTOR].posyv posyv

   state enforcespeedlimits

  }
 }
 else // When not driving vehicles
 {
  // Get Speed Caps for Characters & Vehicles Based on Speed Stat
  setvarvar PLAYERMOVEPLUSVEL CHARACTERSPEEDTRUE
  subvar PLAYERMOVEPLUSVEL 46500
  ifvare sector[PLAYERSECTOR].lotag 1 { ifp ponground { mulvar PLAYERMOVEPLUSVEL 75 divvar PLAYERMOVEPLUSVEL 100 } }
  ifvare sector[PLAYERSECTOR].lotag 2 { mulvar PLAYERMOVEPLUSVEL 50 divvar PLAYERMOVEPLUSVEL 100 }
  mulvar PLAYERMOVEPLUSVEL 552

  getuserdef[THISACTOR].auto_run TEMPVAR3
  ifvare TEMPVAR3 0
  {
   ifvarand bits 32 nullop else divvar PLAYERMOVEPLUSVEL 2
  }

  ifp pshrunk divvar PLAYERMOVEPLUSVEL 16

  ifvarand PLAYERSTATUS? 2 { mulvar PLAYERMOVEPLUSVEL 125 divvar PLAYERMOVEPLUSVEL 100 }
  else ifvarand PLAYERSTATUS? 4 { mulvar PLAYERMOVEPLUSVEL 75 divvar PLAYERMOVEPLUSVEL 100 }

  ifvare CHARACTERSELECTED? 3 
  {
   setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
  }
  ifvare CHARACTERSELECTED? 4
  {
   setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 2 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
  }
  ifvare CHARACTERSELECTED? 6
  {
   setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar PLAYERMOVEPLUSVEL 80 divvar PLAYERMOVEPLUSVEL 100 } 
  }
  ifvare CHARACTERSELECTED? 10
  {
   setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
  }
  ifvare CHARACTERSELECTED? 13 
  { 
   setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 2 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
  }

  ifvarg PLAYERMOVEPLUSVEL 10405200 setvar PLAYERMOVEPLUSVEL 10405200
  // Set the Negative Speed Limit to an inverse of the positive speed limit
  setvarvar PLAYERMOVEMINUSVEL PLAYERMOVEPLUSVEL mulvar PLAYERMOVEMINUSVEL -1

  getplayer[THISACTOR].posxv posxv
  ifvarn posxv 0
  {
   state getaccelerationlimits
   getinput[THISACTOR].fvel TEMPVAR3
   ifvare TEMPVAR3 0 { addvar ACCELFACTOR -6 ifvarand PLAYERSTATUS? 2 addvar ACCELFACTOR -6 }

   state liftaccelcap
   state moveaccelcap
   state healthaccelcap
   state weaponaccelcap
   state winterclothesaccelcap

   mulvarvar posxv ACCELFACTOR
   divvar posxv 100
  }
  setplayer[THISACTOR].posxv posxv

  getplayer[THISACTOR].posyv posyv
  ifvarn posyv 0
  {
   state getaccelerationlimits
   getinput[THISACTOR].svel TEMPVAR4
   ifvare TEMPVAR4 0 { addvar ACCELFACTOR -6 ifvarand PLAYERSTATUS? 2 addvar ACCELFACTOR -6 }

   state liftaccelcap
   state moveaccelcap
   state healthaccelcap
   state weaponaccelcap
   state winterclothesaccelcap

   mulvarvar posyv ACCELFACTOR
   divvar posyv 100
  }
  setplayer[THISACTOR].posyv posyv

  ifp ponsteroids mulvar PLAYERMOVEPLUSVEL 2
  ifvarg PLAYERMOVEPLUSVEL 20810400 setvar PLAYERMOVEPLUSVEL 20810400
  ifp ponsteroids mulvar PLAYERMOVEMINUSVEL 2
  ifvarl PLAYERMOVEMINUSVEL -20810400 setvar PLAYERMOVEMINUSVEL -20810400

  state enforcespeedlimits
 }
}

// Get Player's move/xvel into sprite/actor terms
getactor[THISACTOR].xvel ACTORXVEL

ifvarn multijumpflag 0
{
 ifvare sector[PLAYERSECTOR].lotag 2 setvar multijumpflag 0
 ifp ponground setvar multijumpflag 0
}

//***************************
//*START OF JUMP HEIGHT CODE*
//***************************

 setvarvar PLAYERJUMPSTRENGTHTEMP PLAYERJUMPSTRENGTH

 // Check for Jump Boots
 setvar DAMAGEMODIFIER 1000
 ifvare PLAYEREQUIPSLOTITEM1 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM2 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM3 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM4 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM5 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM6 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM7 13 addvar DAMAGEMODIFIER 250
 ifvare PLAYEREQUIPSLOTITEM8 13 addvar DAMAGEMODIFIER 250
 mulvarvar PLAYERJUMPSTRENGTHTEMP DAMAGEMODIFIER
 divvar PLAYERJUMPSTRENGTHTEMP 1000

 // Check for Jewel of Four Souls
 setvar DAMAGEMODIFIER 0
 ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 5
 ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 5
 ifvarl DAMAGEMODIFIER 2 setvar DAMAGEMODIFIER 2
 mulvarvar PLAYERJUMPSTRENGTHTEMP DAMAGEMODIFIER
 divvar PLAYERJUMPSTRENGTHTEMP 2

 // Check Health Levels
 ifvarn oldskoolmode 1
 {
  setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
  ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 5 }
  else ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar PLAYERJUMPSTRENGTHTEMP 4 divvar PLAYERJUMPSTRENGTHTEMP 5 }
 }

 // Check Steroids
 ifp ponsteroids { mulvar PLAYERJUMPSTRENGTHTEMP 7 divvar PLAYERJUMPSTRENGTHTEMP 5 }

 // Check Character Forms
 ifvare CHARACTERSELECTED? 3
 {
  setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 1 addvar PLAYERJUMPSTRENGTHTEMP 2

  setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
  ifvare MISCARRAYID_AMOUNTTEMP 1 divvar PLAYERJUMPSTRENGTHTEMP 2
 }
 ifvare CHARACTERSELECTED? 4
 {
  setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 2
  {
   mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 2
  }
 }
 ifvare CHARACTERSELECTED? 6
 {
  setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 0 subvar PLAYERJUMPSTRENGTHTEMP 6
 }
 ifvare CHARACTERSELECTED? 10
 {
  setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 0
  {
   ifvarg PLAYERLEVEL 49 ifvarl PLAYERLEVEL 100 addvar PLAYERJUMPSTRENGTHTEMP 1
   ifvarg PLAYERLEVEL 99 addvar PLAYERJUMPSTRENGTHTEMP 2
  }
  else
  ifvare MISCARRAYID_AMOUNTTEMP 1
  {
   ifvarg PLAYERLEVEL 0 ifvarl PLAYERLEVEL 25 subvar PLAYERJUMPSTRENGTHTEMP 4
   ifvarg PLAYERLEVEL 24 ifvarl PLAYERLEVEL 50 subvar PLAYERJUMPSTRENGTHTEMP 3
   ifvarg PLAYERLEVEL 49 ifvarl PLAYERLEVEL 75 subvar PLAYERJUMPSTRENGTHTEMP 2
   ifvarg PLAYERLEVEL 74 ifvarl PLAYERLEVEL 100 subvar PLAYERJUMPSTRENGTHTEMP 1
  }
 }
 ifvare CHARACTERSELECTED? 13
 {
  setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
  ifvare MISCARRAYID_AMOUNTTEMP 2
  {
   mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 2
  }
 }
 ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
 ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80
 
 // Check Character Weight Encumberment from Carrying Objects
 ifvarn SPRITEID-HOLDING -1 ifvare SPRITEID-TELEKENESIS_P -1
 {
  setvarvar STRENGTHRATIO PLAYERLIFTSTRENGTHTEMP
  mulvar STRENGTHRATIO 100
  divvarvar STRENGTHRATIO actorvar[SPRITEID-HOLDING].ACTORWEIGHT

  // limit player jump
  ifvarvarg STRENGTHRATIO GRABRATIO
  {
   setvarvar PHYSICSTEMPC STRENGTHRATIO
   subvarvar PHYSICSTEMPC GRABRATIO
   addvar PHYSICSTEMPC 1

   setvarvar PHYSICSTEMPB LIFTRATIO
   subvarvar PHYSICSTEMPB GRABRATIO
   addvar PHYSICSTEMPB 1

   mulvar PHYSICSTEMPC 60 // 100
   divvarvar PHYSICSTEMPC PHYSICSTEMPB

   setvar PHYSICSTEMP 20
   addvarvar PHYSICSTEMP PHYSICSTEMPC
   ifvarl PHYSICSTEMP 20 setvar PHYSICSTEMP 20
   ifvarg PHYSICSTEMP 100 setvar PHYSICSTEMP 100
     
   mulvarvar PLAYERJUMPSTRENGTHTEMP PHYSICSTEMP
   divvar PLAYERJUMPSTRENGTHTEMP 100

   ifp pwalking { mulvar PLAYERJUMPSTRENGTHTEMP 4 divvar PLAYERJUMPSTRENGTHTEMP 5 }
   else ifp pducking { mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 5 }

  }
  ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
  ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80

 }

 // Check Weapons
 setvar TEMPVAR4 0
 ifvare CHARACTERSELECTED? 6 addvar TEMPVAR4 1
 ifvare CHARACTERSELECTED? 9 addvar TEMPVAR4 1
 ifvare CHARACTERSELECTED? 14 addvar TEMPVAR4 1
 ifvare TEMPVAR4 0
 {
  ifvare SPRITEID-HOLDING -1
  { 
   ifp ponsteroids 
   {
    ifvare player[THISACTOR].curr_weapon 0 { mulvar PLAYERJUMPSTRENGTHTEMP 3000 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 1 { mulvar PLAYERJUMPSTRENGTHTEMP 2996 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 2 { mulvar PLAYERJUMPSTRENGTHTEMP 2992 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 3 { mulvar PLAYERJUMPSTRENGTHTEMP 2988 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 4 { mulvar PLAYERJUMPSTRENGTHTEMP 2968 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 5 { mulvar PLAYERJUMPSTRENGTHTEMP 2994 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 6 { mulvar PLAYERJUMPSTRENGTHTEMP 2984 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 7 { mulvar PLAYERJUMPSTRENGTHTEMP 2976 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 8 { mulvar PLAYERJUMPSTRENGTHTEMP 2993 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 9 { mulvar PLAYERJUMPSTRENGTHTEMP 2988 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 10 { mulvar PLAYERJUMPSTRENGTHTEMP 3000 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
    else ifvare player[THISACTOR].curr_weapon 11 { mulvar PLAYERJUMPSTRENGTHTEMP 2984 divvar PLAYERJUMPSTRENGTHTEMP 3000 }		
   }
   else
   { 
    ifvare player[THISACTOR].curr_weapon 0 { mulvar PLAYERJUMPSTRENGTHTEMP 300 divvar PLAYERJUMPSTRENGTHTEMP 300 } 
    else ifvare player[THISACTOR].curr_weapon 1 { mulvar PLAYERJUMPSTRENGTHTEMP 296 divvar PLAYERJUMPSTRENGTHTEMP 300 } 
    else ifvare player[THISACTOR].curr_weapon 2 { mulvar PLAYERJUMPSTRENGTHTEMP 292 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 3 { mulvar PLAYERJUMPSTRENGTHTEMP 288 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 4 { mulvar PLAYERJUMPSTRENGTHTEMP 268 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 5 { mulvar PLAYERJUMPSTRENGTHTEMP 294 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 6 { mulvar PLAYERJUMPSTRENGTHTEMP 284 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 7 { mulvar PLAYERJUMPSTRENGTHTEMP 276 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 8 { mulvar PLAYERJUMPSTRENGTHTEMP 293 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 9 { mulvar PLAYERJUMPSTRENGTHTEMP 288 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 10 { mulvar PLAYERJUMPSTRENGTHTEMP 300 divvar PLAYERJUMPSTRENGTHTEMP 300 }
    else ifvare player[THISACTOR].curr_weapon 11 { mulvar PLAYERJUMPSTRENGTHTEMP 284 divvar PLAYERJUMPSTRENGTHTEMP 300 }		
   }
  }
 }
  ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
  ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80

 
 // Check Winter Clothing Levels
 ifvarg winterclothes 0
 {
  setvar tempc 8
  mulvarvar tempc winterclothes
  divvar tempc 100

  setvar tempb 80
  subvarvar tempb tempc

  mulvarvar PLAYERJUMPSTRENGTHTEMP tempb
  divvar PLAYERJUMPSTRENGTHTEMP 80
 }


 ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
 ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80

 // Check Character Jump-Strength Support Levels
 setvar DAMAGEMODIFIER 1000
 ifvare CHARACTERSELECTED? 14
 {
  // Duke
  ifvarg PLAYERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Jack
  ifvarg PLAYERSUPPORTJACK 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTJACK 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Bubsy
  ifvarg PLAYERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Ami
  ifvarg PLAYERSUPPORTAMI 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTAMI 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Lo Wang
  ifvarg PLAYERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // ESSence
  ifvarg PLAYERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Ted
  ifvarg PLAYERSUPPORTTED 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTTED 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Lisa
  ifvarg PLAYERSUPPORTLISA 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTLISA 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Cybanis
  ifvarg PLAYERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Nethra
  ifvarg PLAYERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Paula
  ifvarg PLAYERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Lori
  ifvarg PLAYERSUPPORTLORI 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTLORI 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Minako
  ifvarg PLAYERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 350 // "*" Support
  // Maken
  ifvarg PLAYERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 350 // "*" Support
 }
 else
 {
  ifvarg PLAYERSUPPORTMYSTERY1 0 addvar DAMAGEMODIFIER 50 // "C" Support
  ifvarg PLAYERSUPPORTMYSTERY1 1 addvar DAMAGEMODIFIER 75 // "B" Support
  ifvarg PLAYERSUPPORTMYSTERY1 2 addvar DAMAGEMODIFIER 100 // "A" Support
  ifvarg PLAYERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 125 // "S" Support
  ifvarg PLAYERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 350 // "*" Support
 }
 ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
 ifvarg DAMAGEMODIFIER 1700 setvar DAMAGEMODIFIER 1700
 mulvarvar PLAYERJUMPSTRENGTHTEMP DAMAGEMODIFIER
 divvar PLAYERJUMPSTRENGTHTEMP 1000

 // Check Player's Levels
 ifvarg PLAYERLEVEL 25 ifvarl PLAYERLEVEL 51 { mulvar PLAYERJUMPSTRENGTHTEMP 108 divvar PLAYERJUMPSTRENGTHTEMP 100 }
 ifvarg PLAYERLEVEL 50 ifvarl PLAYERLEVEL 76 { mulvar PLAYERJUMPSTRENGTHTEMP 116 divvar PLAYERJUMPSTRENGTHTEMP 100 }
 ifvarg PLAYERLEVEL 75 { mulvar PLAYERJUMPSTRENGTHTEMP 125 divvar PLAYERJUMPSTRENGTHTEMP 100 }

 // Finalize Jump Height Minimums and Maximums
 ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
 ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80

 // Stop Characters from Jumping if they're Pushing/Pulling Objects
 ifvarn PLAYERPUSHINGTIMER 0 setvar PLAYERJUMPSTRENGTHTEMP 0
 // addlogvar PLAYERJUMPSTRENGTHTEMP

 getplayer[THISACTOR].jumping_counter jumpcounter
 ifvarg jumpcounter 0
 {
  ifvare PLAYERJUMPSTRENGTHTEMP 0 setplayer[THISACTOR].poszv 0
  else
  {
   getplayer[THISACTOR].poszv tempb
   ifvarl tempb -4096 
   {
    setvar tempb -4096
    setplayer[THISACTOR].poszv tempb
   }
  }
 }

 state getjumpheights

//*************************
//*END OF JUMP HEIGHT CODE*
//*************************


//***************
//***FALL CODE***
//***************

 // Check Characters Resistances and alter based on different values
 ifvarn VEHICLEID -1
 {
  ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 setvarvar PLAYERFALLRESISTTEMP 15
 }
 else
 {
  setvarvar PLAYERFALLRESISTTEMP PLAYERFALLRESIST

  // Check Character Forms
  ifvare CHARACTERSELECTED? 3
  {
   setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 1
   {
    ifvarl PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 7 divvar PLAYERFALLRESISTTEMP 8 // 87.5% [-12.5%]
    }
    else
    ifvarg PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 5 divvar PLAYERFALLRESISTTEMP 4 // 125% [+25%]
    }
   }
   setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
   ifvare MISCARRAYID_AMOUNTTEMP 1
   {
    ifvarl PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 7 divvar PLAYERFALLRESISTTEMP 4 // 175% [+75%]
    }
    else
    ifvarg PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 1 divvar PLAYERFALLRESISTTEMP 3 // 33% [-67%]
    }
   }
  }
  ifvare CHARACTERSELECTED? 4
  {
   setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 2
   {
    ifvarl PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 2 divvar PLAYERFALLRESISTTEMP 4 // 50% [-50%]
    }
    else
    ifvarg PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 8 divvar PLAYERFALLRESISTTEMP 4 // 200% [+100%]
    }
   }
  }
  ifvare CHARACTERSELECTED? 6
  {
   setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 0 
   {
    ifvarl PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 8 divvar PLAYERFALLRESISTTEMP 4 // 200% [+100%]
    }
    else
    ifvarg PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 2 divvar PLAYERFALLRESISTTEMP 4 // 50% [-50%]
    }
   }
  }
  ifvare CHARACTERSELECTED? 10
  {
   setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 1
   {
    ifvarl PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 9 divvar PLAYERFALLRESISTTEMP 8 // 112.5% [+12.5%]
    }
    else
    ifvarg PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 3 divvar PLAYERFALLRESISTTEMP 4 // 75% [-25%]
    }
   }
  }
  ifvare CHARACTERSELECTED? 13
  {
   setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
   ifvare MISCARRAYID_AMOUNTTEMP 2
   {
    ifvarl PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 2 divvar PLAYERFALLRESISTTEMP 4 // 50% [-50%]
    }
    else
    ifvarg PLAYERFALLRESISTTEMP 0
    {
     mulvar PLAYERFALLRESISTTEMP 8 divvar PLAYERFALLRESISTTEMP 4 // 200% [+100%]
    }
   }
  }

  // Check Support Bonuses
  setvar DAMAGEMODIFIER 0
  ifvare CHARACTERSELECTED? 3 // Bubsy
  {
   // Duke
   ifvarg PLAYERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Jack
   ifvarg PLAYERSUPPORTJACK 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTJACK 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Ami
   ifvarg PLAYERSUPPORTAMI 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTAMI 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Lo Wang
   ifvarg PLAYERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // ESSence
   ifvarg PLAYERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Ted
   ifvarg PLAYERSUPPORTTED 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTTED 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Lisa
   ifvarg PLAYERSUPPORTLISA 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTLISA 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Cybanis
   ifvarg PLAYERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Nethra
   ifvarg PLAYERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Paula
   ifvarg PLAYERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Lori
   ifvarg PLAYERSUPPORTLORI 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTLORI 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Minako
   ifvarg PLAYERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // "Mystery Lady"
   ifvarg PLAYERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 350 // "*" Support
   // Maken
   ifvarg PLAYERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 350 // "*" Support
  }
  else
  {
   // Bubsy
   ifvarg PLAYERSUPPORTBUBSY 0 addvar DAMAGEMODIFIER 50 // "C" Support
   ifvarg PLAYERSUPPORTBUBSY 1 addvar DAMAGEMODIFIER 75 // "B" Support
   ifvarg PLAYERSUPPORTBUBSY 2 addvar DAMAGEMODIFIER 100 // "A" Support
   ifvarg PLAYERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 125 // "S" Support
   ifvarg PLAYERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 350 // "*" Support
  }
  ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
  ifvarg DAMAGEMODIFIER 700 setvar DAMAGEMODIFIER 700
  setvarvar TEMPVAR5 PLAYERFALLRESISTTEMP
  mulvarvar TEMPVAR5 DAMAGEMODIFIER
  divvar TEMPVAR5 1000
  ifvarl PLAYERFALLRESISTTEMP 0
  {
   subvarvar PLAYERFALLRESISTTEMP TEMPVAR5
  }
  else
  ifvarg PLAYERFALLRESISTTEMP 0
  {
   addvarvar PLAYERFALLRESISTTEMP TEMPVAR5
  }
 }

  // Increases Fall Resistance as You Level Up
  setvarvar TEMPVAR5 PLAYERTEMPLEVEL
  ifvarl SKILLLEVEL 1 divvar TEMPVAR5 14
  ifvare SKILLLEVEL 1 divvar TEMPVAR5 15
  ifvare SKILLLEVEL 2 divvar TEMPVAR5 16
  ifvare SKILLLEVEL 3 divvar TEMPVAR5 17
  ifvare SKILLLEVEL 4 divvar TEMPVAR5 18
  ifvare SKILLLEVEL 5 divvar TEMPVAR5 19
  ifvare SKILLLEVEL 6 divvar TEMPVAR5 20
  ifvare SKILLLEVEL 7 divvar TEMPVAR5 21
  ifvare SKILLLEVEL 8 divvar TEMPVAR5 22
  ifvarg SKILLLEVEL 8 divvar TEMPVAR5 23
  addvarvar PLAYERFALLRESISTTEMP TEMPVAR5

  // Check for Jewel of Four Souls
  ifvarl PLAYERFALLRESISTTEMP 0 { setvarvar TEMPMOD PLAYERFALLRESISTTEMP mulvar TEMPMOD -1 } // saves the pre-jewel value for negative fall resistance into abs
  setvar DAMAGEMODIFIER 0
  ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 5
  ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 5
  ifvarl DAMAGEMODIFIER 2 setvar DAMAGEMODIFIER 2
  ifvarl PLAYERFALLRESISTTEMP 0
  {
   ifvarg DAMAGEMODIFIER 2
   {
    mulvarvar TEMPMOD DAMAGEMODIFIER
    divvarvar TEMPMOD 2
    addvarvar PLAYERFALLRESISTTEMP TEMPMOD
   }
  }
  else
  {
   mulvarvar PLAYERFALLRESISTTEMP DAMAGEMODIFIER
   divvar PLAYERFALLRESISTTEMP 2 
  }
 
  // Check Steroids
  ifp ponsteroids 
  {
   ifvarl PLAYERFALLRESISTTEMP 0
   {
    mulvar PLAYERFALLRESISTTEMP 4 divvar PLAYERFALLRESISTTEMP 5 // 80% [-20%]
   }
   else
   ifvarg PLAYERFALLRESISTTEMP 0
   {
    mulvar PLAYERFALLRESISTTEMP 7 divvar PLAYERFALLRESISTTEMP 5 // 140% [+40%]
   }
  }

 // Allows a Character to crouch in midair to try to soften their fall [increases fall resistance temporarily]
 getinput[THISACTOR].bits TEMP3
 ifvarand TEMP3 2
 {
  setvarvar TEMPVAR5 PLAYERFALLRESISTTEMP
  randvar TEMPVAR4 6
  addvar TEMPVAR4 -3
  
  ifvare CHARACTERSELECTED? 5 { addvar TEMPVAR4 75 } // +72-78%
  else ifvare CHARACTERSELECTED? 14 { addvar TEMPVAR4 45 } // +42-48%
  else ifvare CHARACTERSELECTED? 15 { addvar TEMPVAR4 54 }  // +51-57%
  else { addvar TEMPVAR4 24 } // +21-27%

  mulvarvar TEMPVAR5 TEMPVAR4 
  divvar TEMPVAR5 100
  ifvarg PLAYERFALLRESISTTEMP 0 addvarvar PLAYERFALLRESISTTEMP TEMPVAR5
  ifvarl PLAYERFALLRESISTTEMP 0 subvarvar PLAYERFALLRESISTTEMP TEMPVAR5
 }
 
 // Check Falling Counters/Resistances
 getplayer[THISACTOR].falling_counter fallcounter
 ifvarvarl fallingresistance PLAYERFALLRESISTTEMP // For Positive Resistances
 {
  ifvarg fallcounter 0
  {
   subvar fallcounter 1
   setplayer[THISACTOR].falling_counter fallcounter
   addvar fallingresistance 1
  }
 }
 else
 ifvarvarg fallingresistance PLAYERFALLRESISTTEMP // For Negative Resistances
 {
  ifvarg fallcounter 0
  {
   addvar fallcounter 1
   setplayer[THISACTOR].falling_counter fallcounter
   subvar fallingresistance 1
  }
 }


 ifp pjetpack
 {
  setvar fallcounts 0
  setvar fallcounter2 0
  setvar totalfallcounter 0
  setvar fallingresistance 0 
  state stopfallscreams
  setvar FALLSOUND? 0
 }

 ifp ponground
 {
  setvar fallingresistance 0 
  ifvarg ONGROUNDTIMER 1
  {  
   setvar fallcounts 0
   setvar fallcounter2 0
   setvar totalfallcounter 0
   state stopfallscreams
   redefinequote 245
   setvar GLIDING? 0
  }
 }

 ifvare GLIDING? 1
 {
  redefinequote 245 ^23GLIDING MODE ACTIVE!
  setvarvar fta 50 setvar ftq 245
 }
 else
 {
  ifvare ftq 245
  {
   setvarvar fta 0 setvar ftq 0
  }
 }

 ifp pfalling
 {
  ifvare GLIDING? 1
  {
   redefinequote 245 
   setvar GLIDING? 0
  }
 }

state falling

//**********************
//***END OF FALL CODE***
//**********************

state checkhitscan
ifvarand CHEATBITFIELD? 32 nullop else
{
 ifvare mainmenu 0
 {
  getactor[THISACTOR].htextra TEMP 
  ifvarg TEMP -1 state player_defense
 }
 else
 {
  getactor[THISACTOR].htextra TEMP 
  ifvarn TEMP -1 setactor[THISACTOR].htextra -1
 }
}

 ifvarg CURRENTCELLS -1
 {
  ifvare DAMAGEINCELL 0
  {
   ifvare CURRENTCELLS 0 setvar DAMAGEINCELL 0
   else
   {
    subvar CURRENTCELLS 1
    addvarvar DAMAGEINCELL ESHIELDDMGFACTOR
   }
  }
  else
  ifvarl DAMAGEINCELL 0 setvar DAMAGEINCELL 0
 }
 else setvar CURRENTCELLS 0

 ifvarvarg DAMAGEINCELL ESHIELDDMGFACTOR
 {
  addvar CURRENTCELLS 1
  subvarvar DAMAGEINCELL ESHIELDDMGFACTOR
 }

// Checks for level ups for Active and Non-Active Characters
ifvarg PARTYALIVE 0
{
 ifvare DUKE? 1 { setvar CHARACTERARRAY 1 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 1 state nonactivecharstatcalc } }
 ifvare JACK? 1 { setvar CHARACTERARRAY 2 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 2 state nonactivecharstatcalc } }
 ifvare BUBSY? 1 { setvar CHARACTERARRAY 3 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 3 state nonactivecharstatcalc } }
 ifvare AMI? 1 { setvar CHARACTERARRAY 4 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 4 state nonactivecharstatcalc } }
 ifvare LOWANG? 1 { setvar CHARACTERARRAY 5 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 5 state nonactivecharstatcalc } }
 ifvare ESSENCE? 1 { setvar CHARACTERARRAY 6 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 6 state nonactivecharstatcalc } }
 ifvare TED? 1 { setvar CHARACTERARRAY 7 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 7 state nonactivecharstatcalc } }
 ifvare LISA? 1 { setvar CHARACTERARRAY 8 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 8 state nonactivecharstatcalc } }
 ifvare CYBANIS? 1 { setvar CHARACTERARRAY 9 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 9 state nonactivecharstatcalc } }
 ifvare NETHRA? 1 { setvar CHARACTERARRAY 10 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 10 state nonactivecharstatcalc } }
 ifvare PAULA? 1 { setvar CHARACTERARRAY 11 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 11 state nonactivecharstatcalc } }
 ifvare LORI? 1 { setvar CHARACTERARRAY 12 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 12 state nonactivecharstatcalc } }
 ifvare MINAKO? 1 { setvar CHARACTERARRAY 13 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 13 state nonactivecharstatcalc } }
 ifvare MYSTERY1? 1 { setvar CHARACTERARRAY 14 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 14 state nonactivecharstatcalc } }
 ifvare MAKEN? 1 { setvar CHARACTERARRAY 15 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 15 state nonactivecharstatcalc } }
 state playerstatcalculation
}

setvar MISCARRAYID 63 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // SOMEONE-LEVELS?
ifvarg MISCARRAYID_AMOUNTTEMP 0 
{
 state refreshenemystatsonlevel
 setvar MISCARRAYID 63 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // SOMEONE-LEVELS?
}

setvar MISCARRAYID 64 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // PLAYER-LEVELSUP?
ifvarg MISCARRAYID_AMOUNTTEMP 0
{
 ifvare CHARACTERSELECTED? 8
 {
  randvar RNDVOICE 3
  ifvare RNDVOICE 0
  {
   globalsound LISA_LEVELUP1 
   redefinequote 340 ^7Lisa: All right! Now I'm refreshed, and ready to continue!!
   ifvare oldskoolmode 0 userquote 340
  }
  ifvare RNDVOICE 1
  {
   globalsound LISA_LEVELUP2 
   redefinequote 340 ^7Lisa: I smell your fear, and boy does it reek!!
   ifvare oldskoolmode 0 userquote 340
  }
  ifvare RNDVOICE 2
  {
   globalsound LISA_LEVELUP3 
   redefinequote 340 ^7Lisa: Why do I suddenly feel months younger?!?!
   ifvare oldskoolmode 0 userquote 340
  }
  ifvare RNDVOICE 3
  {
   globalsound LISA_LEVELUP4 
   redefinequote 340 ^7Lisa: Looks like you guys will be yesterday's news soon enough!!
   ifvare oldskoolmode 0 userquote 340
  }
 }
 ifvare CHARACTERSELECTED? 15
 {
  randvar RNDVOICE 3
  ifvare RNDVOICE 0
  {
   globalsound MAKEN_LEVELUP1 
   redefinequote 340 ^10Maken: Surgin' to power like a storm!!
   ifvare oldskoolmode 0 userquote 340
  }
  ifvare RNDVOICE 1
  {
   globalsound MAKEN_LEVELUP2 
   redefinequote 340 ^10Maken: Time to rock like an earthquake!!
   ifvare oldskoolmode 0 userquote 340
  }
  ifvare RNDVOICE 2
  {
   globalsound MAKEN_LEVELUP3 
   redefinequote 340 ^10Maken: Limits?! WHAT limits?!
   ifvare oldskoolmode 0 userquote 340
  }
  ifvare RNDVOICE 3
  {
   globalsound MAKEN_LEVELUP4 
   redefinequote 340 ^10Maken: My inner power swells over!!
   ifvare oldskoolmode 0 userquote 340
  }
 }
 setvar MISCARRAYID 64 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // PLAYER-LEVELSUP?
}

state moneycalc


getplayer[THISACTOR].on_ground PLAYERONGROUND
getactor[PLAYERID].sectnum PLAYERSECTOR
getsector[PLAYERSECTOR].floorpicnum SECTORFLOORPICNUM
//getsector[PLAYERSECTOR].hitag SECTORHITAG
//getsector[PLAYERSECTOR].lotag SECTORLOTAG
getuserdef[THISACTOR].god TEMPVAR
ifvare TEMPVAR 1
{
 ifvarand CHEATBITFIELD? 32 nullop else addvar CHEATBITFIELD? 32
}
else
{
 ifvarand CHEATBITFIELD? 32 subvar CHEATBITFIELD? 32
}

// getuserdef[THISACTOR].cashman CHEATCASH
// getuserdef[THISACTOR].showallmap CHEATCLIP

/*
// Allows Bubsy to use Fanned Floors to glide upwards like in Bubsy 3D [Needs Work to Fix]
ifvare SECTORFLOORPICNUM 407
{
 ifvare mainmenu 0
 {
  ifvare CHARACTERSELECTED? 3
  {
   ifvare GLIDING? 1
   {
    getsector[PLAYERSECTOR].floorz TEMPVAR3
    getplayer[THISACTOR].posz TEMPVAR4
    ifvarvarl TEMPVAR4 TEMPVAR3
    {
     setvarvar TEMPVAR2 TEMPVAR4
     subvarvar TEMPVAR2 TEMPVAR3
     mulvar TEMPVAR2 -1

     setvarvar TEMPVAR5 TEMPVAR2
     divvarvar TEMPVAR5 58
     ifvarg TEMPVAR5 2240 setvar TEMPVAR5 2240
     subvar TEMPVAR5 2240
     getplayer[THISACTOR].poszv poszv
     addvarvar poszv TEMPVAR5
     ifvarl poszv -1344 setvar poszv -1344
     setplayer[THISACTOR].poszv poszv
    }
   }
  }
 }
}
*/

ifvare sector[PLAYERSECTOR].lotag 19997 setvar CHARACTERCHEAT? 2

 // Special Lotag for setting difficulty level [Lotag = 20001, Hitag = 100X, X = Difficulty Number (0 to 9)]
 ifvare sector[PLAYERSECTOR].lotag 20001
 {
  ifvare sector[PLAYERSECTOR].hitag 1000 redefinequote 270 SKILL 0: ^20EAT IT BOY EAT IT!
  ifvare sector[PLAYERSECTOR].hitag 1001 redefinequote 270 SKILL 1: ^13MANY PIECES OF CAKE!
  ifvare sector[PLAYERSECTOR].hitag 1002 redefinequote 270 SKILL 2: ^0LET'S ROCK THE HOUSE!
  ifvare sector[PLAYERSECTOR].hitag 1003 redefinequote 270 SKILL 3: ^16COME GET SOME MORE!
  ifvare sector[PLAYERSECTOR].hitag 1004 redefinequote 270 SKILL 4: ^21DAMN I'M VERY GOOD!
  ifvare sector[PLAYERSECTOR].hitag 1005 redefinequote 270 SKILL 5: ^10YOU A BAD ENOUGH DUDE?!
  ifvare sector[PLAYERSECTOR].hitag 1006 redefinequote 270 SKILL 6: ^7U R MASOCHIST INCARNATE!
  ifvare sector[PLAYERSECTOR].hitag 1007 redefinequote 270 SKILL 7: ^11I WILL EAT YOUR SOUL!
  ifvare sector[PLAYERSECTOR].hitag 1008 redefinequote 270 SKILL 8: ^14YOU ARE DEATH'S BITCH!!
  ifvare sector[PLAYERSECTOR].hitag 1009 redefinequote 270 SKILL 9: ^6THE END OF YOUR DESTINY!!!

  ifvarg sector[PLAYERSECTOR].hitag 999 ifvarl sector[PLAYERSECTOR].hitag 1010
  {
   setvarvar tempc sector[PLAYERSECTOR].hitag
   subvar tempc 1000
   setuserdef[THISACTOR].player_skill tempc
   setvar fta 6 setvar ftq 270
  }
 }

// Special Level Warping Sectors [set Lotag to 20000, and then Hitag to XYY. X = Episode Number (1 to 7) YY = Level Number (01 to 64)]
ifvarg sector[PLAYERSECTOR].lotag 19998 ifvarl sector[PLAYERSECTOR].lotag 20001
{
  ifvare sector[PLAYERSECTOR].lotag 19999 // 19999 will reset all global tallies upon use
  {
   setvar MISCARRAYID 0 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // ENEMIES-KILLED-LEVEL
   setvar MISCARRAYID 2 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-ENEMIES-KILLED-LEVEL
   setvar MISCARRAYID 1 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // ENEMIES-KILLED-GAME
   setvar MISCARRAYID 3 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-ENEMIES-KILLED-GAME
   setvar MISCARRAYID 4 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // SECRETSFOUND-LEVEL
   setvar MISCARRAYID 6 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-SECRETSFOUND-LEVEL
   setvar MISCARRAYID 5 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // SECRETSFOUND-GAME
   setvar MISCARRAYID 7 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-SECRETSFOUND-GAME
   setvar MISCARRAYID 8 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // RANKITEMSFOUND-LEVEL
   setvar MISCARRAYID 10 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-RANKITEMSFOUND-LEVEL
   setvar MISCARRAYID 9 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // RANKITEMSFOUND-GAME
   setvar MISCARRAYID 11 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-RANKITEMSFOUND-GAME
   setvar MISCARRAYID 12 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSSAVED-LEVEL
   setvar MISCARRAYID 14 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSSAVED-LEVEL
   setvar MISCARRAYID 13 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSSAVED-GAME
   setvar MISCARRAYID 15 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSSAVED-GAME
   setvar MISCARRAYID 16 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSKILLED-LEVEL
   setvar MISCARRAYID 18 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSKILLED-LEVEL
   setvar MISCARRAYID 17 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSKILLED-GAME
   setvar MISCARRAYID 19 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSKILLED-GAME
   setvar MISCARRAYID 20 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILESFOUND-LEVEL
   setvar MISCARRAYID 21 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-WORLDTILESFOUND-LEVEL
   setvar TIMERRAWFORMAT 0
   setvar TIMERRAWFORMAT_LEVEL 0
  }

  ifvarg sector[PLAYERSECTOR].hitag 100
  {
   setvarvar TEMPVAR7 sector[PLAYERSECTOR].hitag
   divvar TEMPVAR7 100
   subvarvar TEMPVAR7 1

   setvarvar TEMP sector[PLAYERSECTOR].hitag
   divvar TEMP 100
   mulvar TEMP 100
   setvarvar TEMPVAR8 sector[PLAYERSECTOR].hitag
   subvarvar TEMPVAR8 TEMP
   subvarvar TEMPVAR8 1

   startlevel TEMPVAR7 TEMPVAR8
  }
}

 ifvare sector[PLAYERSECTOR].lotag 20002 // Cheat Sector [Gives 1hr of Artifacts and Level 100 to the current character]
 {
  setvar EXPPTS 10000000
  setvar QUADTIME 93600
  setvar INVULNTIME 93600
  setvar REGENTIME 93600
  setvar APREGENTIME 93600
  setvar VAMPIRETIME 93600
  redefinequote 301 ^10CHEATING SECTOR!
  setvar fta 6 setvar ftq 301
 }

ifvare sector[PLAYERSECTOR].lotag 20003
{
 setvar MISCARRAYID 27 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ADD-DELAY
 ifvare MISCARRAYID_AMOUNTTEMP 0
 {
  ifvare sector[PLAYERSECTOR].hitag 1 
  { 
   ifvare DUKE? 0
   {
    setvar DUKE? 1
    redefinequote 334 DUKE ADDED TO GROUP! 
    setvar fta 6 setvar ftq 334
   }
   else
   {
    ifvarg PARTYSIZE 1
    {
     setvar DUKE? 0
     redefinequote 334 DUKE REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   }
  }
  ifvare sector[PLAYERSECTOR].hitag 2
  { 
   ifvare JACK? 0
   {
    setvar JACK? 1 
    redefinequote 334 JACK ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   }
   else
   {
    ifvarg PARTYSIZE 1
    {
     setvar JACK? 0 
     redefinequote 334 JACK REMOVED FROM GROUP! 
     setvar fta 6 setvar ftq 334
    }
   }
  }
  ifvare sector[PLAYERSECTOR].hitag 3
  { 
   ifvare BUBSY? 0 
   {
    setvar BUBSY? 1
    redefinequote 334 BUBSY ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   }
   else
   {
    ifvarg PARTYSIZE 1
    {
     setvar BUBSY? 0
     redefinequote 334 BUBSY REMOVED FROM GROUP!
    setvar fta 6 setvar ftq 334
    }
   }
  }
  ifvare sector[PLAYERSECTOR].hitag 4
  { 
   ifvare AMI? 0 
   {
    setvar AMI? 1
    redefinequote 334 AMI ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   }
   else
   {
    ifvarg PARTYSIZE 1
    {
     setvar AMI? 0
     redefinequote 334 AMI REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   }
  }
  ifvare sector[PLAYERSECTOR].hitag 5
  { 
   ifvare LOWANG? 0 
   {
    setvar LOWANG? 1 
    redefinequote 334 HIGA ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   }
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar LOWANG? 0 
     redefinequote 334 HIGA REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   }
  }
  ifvare sector[PLAYERSECTOR].hitag 6
  { 
   ifvare ESSENCE? 0 
   { 
    setvar ESSENCE? 1 
    redefinequote 334 ESSENCE ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar ESSENCE? 0 
     redefinequote 334 ESSENCE REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 7
  { 
   ifvare TED? 0 
   { 
    setvar TED? 1 
    redefinequote 334 TED ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar TED? 0 
     redefinequote 334 TED REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 8
  { 
   ifvare LISA? 0 
   { 
    setvar LISA? 1 
    redefinequote 334 LISA ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar LISA? 0 
     redefinequote 334 LISA REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 9
  { 
   ifvare CYBANIS? 0 
   { 
    setvar CYBANIS? 1 
    redefinequote 334 CYBANIS ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar CYBANIS? 0 
     redefinequote 334 CYBANIS REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 10
  { 
   ifvare NETHRA? 0 
   { 
    setvar NETHRA? 1 
    redefinequote 334 NETHRA ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar NETHRA? 0 
     redefinequote 334 NETHRA REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 11
  { 
   ifvare PAULA? 0 
   { 
    setvar PAULA? 1 
    redefinequote 334 PAULA ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar PAULA? 0 
     redefinequote 334 PAULA REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 12
  { 
   ifvare LORI? 0 
   { 
    setvar LORI? 1 
    redefinequote 334 LORI ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar LORI? 0 
     redefinequote 334 LORI REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 13
  { 
   ifvare MINAKO? 0 
   { 
    setvar MINAKO? 1 
    redefinequote 334 MINAKO ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar MINAKO? 0 
     redefinequote 334 MINAKO REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 14
  { 
   ifvare MYSTERY1? 0 
   { 
    setvar MYSTERY1? 1 
    redefinequote 334 ??????? ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar MYSTERY1? 0 
     redefinequote 334 ??????? REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  ifvare sector[PLAYERSECTOR].hitag 15
  { 
   ifvare MAKEN? 0 
   { 
    setvar MAKEN? 1 
    redefinequote 334 MAKEN ADDED TO GROUP!
    setvar fta 6 setvar ftq 334
   } 
   else 
   { 
    ifvarg PARTYSIZE 1
    {
     setvar MAKEN? 0 
     redefinequote 334 MAKEN REMOVED FROM GROUP!
     setvar fta 6 setvar ftq 334
    }
   } 
  }
  setvar MISCARRAYID 27 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 26 // ADD-DELAY
 }
}

 setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // Secrets Found [level]
 setplayer[THISACTOR].secret_rooms MISCARRAYID_AMOUNTTEMP

 setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // Max Secrets Found [level]
 setplayer[THISACTOR].max_secret_rooms MISCARRAYID_AMOUNTTEMP2

// Award Rank Points for Discovering Secrets
 getplayer[THISACTOR].cursectnum SECTORSECRETCHECK
 getactorvar[SECTORSECRETCHECK].SECTORISASECRET? SECRETCHECKFLAG
 ifvare SECRETCHECKFLAG 32767
 {
  setvar MISCARRAYID 4 // Secrets Found [Level]
  getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
  addvar MISCARRAYID_AMOUNTTEMP 1
  setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP

  setvar MISCARRAYID 5 // Secrets Found [Game]
  getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
  addvar MISCARRAYID_AMOUNTTEMP 1
  setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP

  setvar RANKPOINTSTEMP 8
  setvar MISCARRAYID 5 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // Secrets Found [Game]
  setvarvar tempc MISCARRAYID_AMOUNTTEMP
  setvar tempd 0
  whilevarvarn tempd tempc
  {
   addvar tempd 1
   mulvar RANKPOINTSTEMP 5
   divvar RANKPOINTSTEMP 4
   ifvarvare tempd tempc
   {
    setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
    setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
    ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
    {
     mulvar RANKPOINTSTEMP 21
     divvar RANKPOINTSTEMP 4
    }    
   }

   setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
   setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
   ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
   {
    ifvarl RANKPOINTSTEMP 1 { setvar RANKPOINTSTEMP 1 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
    ifvarg RANKPOINTSTEMP 95887 { setvar RANKPOINTSTEMP 95887 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
   }
   else
   {
    ifvarl RANKPOINTSTEMP 1 { setvar RANKPOINTSTEMP 1 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
    ifvarg RANKPOINTSTEMP 26151 { setvar RANKPOINTSTEMP 26151 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
   }
  }

  setvarvar tempc RANKPOINTSTEMP
  setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [level]
  setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [level]
  ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2 divvar tempc 10 else divvar tempc 4
  randvarvar tempd tempc
  ifrnd 128 subvarvar RANKPOINTSTEMP tempd else addvarvar RANKPOINTSTEMP tempd

  setvar TEMPVAR 1
  setvar MISCARRAYID 85 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // FOUND-A-SECRET
  stopsound FOUND_SECRET
  stopsound FOUND_ALLSECRETS

  setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
  setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
  ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2 globalsound FOUND_ALLSECRETS else globalsound FOUND_SECRET
  state expmulti
  ifvarl RANKPOINTSTEMP 1 { setvar RANKPOINTSTEMP 1 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
  ifvarg RANKPOINTSTEMP 2000000 { setvar RANKPOINTSTEMP 2000000 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
  addvarvar RANKPOINTS RANKPOINTSTEMP

  setvar RANKPOINTSTEMP 0
 
  randvar TEMPVAR5 3
  setvarvar fta fta_normal setvar ftq 9
  setvar SECRETCHECKFLAG 32766
  setactorvar[SECTORSECRETCHECK].SECTORISASECRET? SECRETCHECKFLAG
 }

 
 setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
 setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
 ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
 {
  ifvarg MISCARRAYID_AMOUNTTEMP2 0
  {
   setvar MISCARRAYID 84 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // FOUND-A-SECRET
   ifvare MISCARRAYID_AMOUNTTEMP 0
   {
    redefinequote 9 ^17YOU FOUND ALL OF THE SECRET PLACES!  
    setvar MISCARRAYID 84 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1  // FOUND-A-SECRET
   }
  }
  else state showsecretmessages
 }
 else state showsecretmessages

ifvare CHARACTERSELECTED? 1 redefinequote 80 ^17MIGHTY FOOT ENGAGED
ifvare CHARACTERSELECTED? 2 redefinequote 80 ^17SLEDGE HAMMER ENGAGED
ifvare CHARACTERSELECTED? 3 redefinequote 80 ^17KILLER KLAWS ENGAGED
ifvare CHARACTERSELECTED? 4 redefinequote 80 ^17MARTIAL ARTS ENGAGED
ifvare CHARACTERSELECTED? 5 redefinequote 80 ^17KATANA ENGAGED
ifvare CHARACTERSELECTED? 6 redefinequote 80 ^17RAZOR CLAWS ENGAGED
ifvare CHARACTERSELECTED? 7 redefinequote 80 ^17RAPIER SWORD ENGAGED
ifvare CHARACTERSELECTED? 8 redefinequote 80 ^17NUNCHAKU ENGAGED
ifvare CHARACTERSELECTED? 9 redefinequote 80 ^17CLAW GRIPPERS ENGAGED
ifvare CHARACTERSELECTED? 10 
{
 setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
 ifvare MISCARRAYID_AMOUNTTEMP 0 redefinequote 80 ^17SLASHING CLAWS ENGAGED
 else redefinequote 80 ^17MARTIAL ARTS ENGAGED
}
ifvare CHARACTERSELECTED? 11 redefinequote 80 ^17FRYING PAN ENGAGED
ifvare CHARACTERSELECTED? 12 redefinequote 80 ^17ROSHAKUBO ENGAGED
ifvare CHARACTERSELECTED? 13 redefinequote 80 ^17MARTIAL ARTS ENGAGED
ifvare CHARACTERSELECTED? 14 redefinequote 80 ^17ENERGY SABRE ENGAGED
ifvare CHARACTERSELECTED? 15 redefinequote 80 ^17PUNCH-DAGGER ENGAGED


ifvare sector[PLAYERSECTOR].lotag 666 state killallcharacters

 // This is for the initial changes to the player on each restart
 ifvarn INITPLAYER 1
 { 
  setactor[PLAYERID].extra 16384
  setplayer[THISACTOR].ammo_amount 1 12 // 1 Ammo Pick Up, opposed to the usual 4 you start with
  setplayer[THISACTOR].ammo_amount 2 10 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 3 50 // +1 Ammo Pick Up 
  setplayer[THISACTOR].ammo_amount 4 5 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 5 5 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 6 5 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 7 15 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 8 1 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 9 25 // +1 Ammo Pick Up
  setplayer[THISACTOR].ammo_amount 11 20 // +1 Ammo Pick Up
  setplayer[THISACTOR].gotweapon 1 1
  setplayer[THISACTOR].gotweapon 2 1
  setplayer[THISACTOR].gotweapon 3 1
  setplayer[THISACTOR].gotweapon 4 1
  setplayer[THISACTOR].gotweapon 5 1
  setplayer[THISACTOR].gotweapon 6 1
  setplayer[THISACTOR].gotweapon 7 1
  setplayer[THISACTOR].gotweapon 8 1
  setplayer[THISACTOR].gotweapon 9 1
  setplayer[THISACTOR].gotweapon 11 1
  // setplayer[THISACTOR].knuckle_incs 21
  setvar MISCARRAYID 25 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // SWITCHOVER-DELAY
  setvar INITPLAYER 1  
 }

 ifvarand CHEATBITFIELD? 32
 { 
  ifvare mainmenu 0 palfrom 16 64 64 64 // White Hue indicates God Mode
  setplayer[THISACTOR].hurt_delay 12
  setplayer[THISACTOR].falling_counter 0
  setactor[PLAYERID].htextra -1
  ifvarvarl CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS

  setvar CHARACTERARRAY 1 state checkplayermaxhp
  setvar CHARACTERARRAY 2 state checkplayermaxhp
  setvar CHARACTERARRAY 3 state checkplayermaxhp
  setvar CHARACTERARRAY 4 state checkplayermaxhp
  setvar CHARACTERARRAY 5 state checkplayermaxhp
  setvar CHARACTERARRAY 6 state checkplayermaxhp
  setvar CHARACTERARRAY 7 state checkplayermaxhp
  setvar CHARACTERARRAY 8 state checkplayermaxhp
  setvar CHARACTERARRAY 9 state checkplayermaxhp
  setvar CHARACTERARRAY 10 state checkplayermaxhp
  setvar CHARACTERARRAY 11 state checkplayermaxhp
  setvar CHARACTERARRAY 12 state checkplayermaxhp
  setvar CHARACTERARRAY 13 state checkplayermaxhp
  setvar CHARACTERARRAY 14 state checkplayermaxhp
  setvar CHARACTERARRAY 15 state checkplayermaxhp

 }

// Forcefield & Cacti Handling
ifvare player[THISACTOR].hurt_delay 16
{
 stopsound DUKE_LONGTERM_PAIN // Blargh Blargh Blargh! X_X [keep this here so characters can make their pain sounds, dummy! XD]
 ifvare oldskoolmode 0
 {
  randvar TEMPVAR 5
  addvar TEMPVAR 5
  setvarvar temp SKILLLEVEL
  addvar temp 1
  mulvarvar TEMPVAR temp
  divvar TEMPVAR 2
 }
 else
 {
  randvar TEMPVAR 1
  addvar TEMPVAR 5
  mulvarvar TEMPVAR MAXHITPOINTS
  divvar TEMPVAR 100
 }

 //*********************
 //*Check Malakian Gems*
 //*********************
 setvarvar TEMP7 TEMPVAR
 state malakiangemcheck 
 setvarvar TEMPVAR TEMP7

 randvar tempc 4
 addvar tempc 4
 subvarvar freezetimer tempc
 ifvarl freezetimer 0 setvar freezetimer 0

 ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarl TEMPVAR 1 { setvar TEMPVAR 1 } state cheatersound }
 ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
 else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
 subvarvar CURRENTHITPOINTS TEMPVAR
 state checkbuddhamode
 ifvarn player[THISACTOR].over_shoulder_on 0
 {
  ifvarg TEMPVAR 0
  {
   setvarvar SHOWDAMAGE TEMPVAR
   setvar SHOWDAMAGETYPE 0
   setvarvar SHOWDAMAGEACTORID THISACTOR
   state showdamage
  }
 }

 findnearsprite 911 844 tempb // Checks to see if there's a Cactus in close promixity...
 ifvarn tempb -1 // If there is, display the Cactus sprite in the attacker's display with the proper palette
 {
  setvar ATTACKINGACTORPICNUM 911
  setvarvar ATTACKINGACTORPAL wall[tempb].pal
  setvar ACTORCRITICAL? 0
 }
 else // if it's not a cactus, then it can only be a Forcefield
 {
  setvar ATTACKINGACTORPICNUM W_FORCEFIELD
  move 1
  getactor[THISACTOR].htmovflag tempb
  setvarvar ATTACKINGACTORPAL wall[tempb].pal
  setvar ACTORCRITICAL? 0
 }

 setactor[THISACTOR].htpicnum -1
 setvarvar PLAYERDAMAGETEMP TEMPVAR
 setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
 setvar ATTACKERDISPLAYTIMER 0
 ifvarg TEMPVAR 0
 {
  setvarvar PAINSOUNDFACTOR TEMPVAR
  state checkpainfactor
  state characterpainsounds

  setvarvar DAMAGEHUEFACTOR TEMPVAR
  setvar ACTORCRITICAL? 0
  findnearsprite 911 844 tempb // Checks to see if there's a Cactus in close promixity...
  ifvarn tempb -1 state playerdamagehues-normaltype else state playerdamagehues-electrictype

  setvar HEALTHDAMAGETIMER 0
 }
 setvar NULLDAMAGE 0

 setactor[PLAYERID].extra 16384
 setplayer[THISACTOR].hurt_delay 15
}
ifvare player[THISACTOR].hurt_delay 17 setplayer[THISACTOR].hurt_delay 15

 //ifvarg CURRENTHITPOINTS 0 { ifp palive setvar TAUNT? 0 }

 // Custom Oxygen System
 ifvarn sector[PLAYERSECTOR].lotag 2 state playerairrestorecheck
 ifvare sector[PLAYERSECTOR].lotag 2
 {
  setvar MISCARRAYID 25 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SWITCHOVER-DELAY
  ifvare MISCARRAYID_AMOUNTTEMP 0 
  { 
   ifvare mainmenu 1 nullop
   else
   {
    ifvarl SCUBATIME 1
    {
     ifvare INVULNTIME 0
     {
      ifvarg AIRTIME 0
      {
       setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
       ifvare MISCARRAYID_AMOUNTTEMP 0
       {
        ifvarn VEHICLEID -1 
        {
         ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
         else
         {
          ifvare CHARACTERSELECTED? 8
          {
           ifvare HAVEENERGYSHIELD? 1
           {
            ifvare ENERGYSHIELDMODE 1
            {
             ifvare ESHIELDADVANCEMENT 1
             {
              setvarvar TEMPVAR5 MAXHITPOINTS
              mulvar TEMPVAR5 8
              subvar TEMPVAR5 1
              ifvarvarg CURRENTBIOSHIELDPOWER TEMPVAR5
              {
               setvar TEMPVAR4 334
               state airtimedrain-checkequips

               state airtimedrain-checkextratics
              }
              else
              {
               setvar TEMPVAR4 1000
               state airtimedrain-checkequips

               state airtimedrain-checkextratics
              }
             }
             else
             {
              setvar TEMPVAR4 1000
              state airtimedrain-checkequips

              state airtimedrain-checkextratics
             }
            }
            else
            {
             setvar TEMPVAR4 1000
             state airtimedrain-checkequips

             state airtimedrain-checkextratics
            }
           }
           else subvar AIRTIME 1 
           {
            setvar TEMPVAR4 1000
            state airtimedrain-checkequips

            state airtimedrain-checkextratics
           }
          }
          else
          {
           // CHARACTER SPECFIC CHECKS :P
           ifvare CHARACTERSELECTED? 3 // Bubsy
           {
            setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
            ifvare MISCARRAYID_AMOUNTTEMP 1 { setplayer[THISACTOR].scuba_on 0 } // Do NOT drain Bubsy's air if he has the Diving Suit on, even if he has no Scuba Tank
            else
            {
             setvar TEMPVAR4 1000
             state airtimedrain-checkequips

             state airtimedrain-checkextratics
            }
           }
           else
           {
            setvar TEMPVAR4 1000
            state airtimedrain-checkequips
 
            state airtimedrain-checkextratics
           }

          }
         }
        }
        else
        {
          ifvare CHARACTERSELECTED? 8
          {
           ifvare HAVEENERGYSHIELD? 1
           {
            ifvare ENERGYSHIELDMODE 1
            {
             ifvare ESHIELDADVANCEMENT 1
             {
              setvarvar TEMPVAR5 MAXHITPOINTS
              mulvar TEMPVAR5 8
              subvar TEMPVAR5 1
              ifvarvarg CURRENTBIOSHIELDPOWER TEMPVAR5
              {
               setvar TEMPVAR4 334
               state airtimedrain-checkequips

               state airtimedrain-checkextratics
              }
              else
              {
               setvar TEMPVAR4 1000
               state airtimedrain-checkequips

               state airtimedrain-checkextratics
              }
             }
             else
             {
              setvar TEMPVAR4 1000
              state airtimedrain-checkequips

              state airtimedrain-checkextratics
             }
            }
            else
            {
             setvar TEMPVAR4 1000
             state airtimedrain-checkequips

             state airtimedrain-checkextratics
            }
           }
           else
           {
            setvar TEMPVAR4 1000
            state airtimedrain-checkequips

            state airtimedrain-checkextratics
           }
          }
          else
          {
           // CHARACTER SPECFIC CHECKS :P
           ifvare CHARACTERSELECTED? 3 // Bubsy
           {
            setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
            ifvare MISCARRAYID_AMOUNTTEMP 1 { setplayer[THISACTOR].scuba_on 0 } // Do NOT drain Bubsy's air if he has the Diving Suit on, even if he has no Scuba Tank
            else
            {
             setvar TEMPVAR4 1000
             state airtimedrain-checkequips

             state airtimedrain-checkextratics
            }
           }
           else
           {
            setvar TEMPVAR4 1000
            state airtimedrain-checkequips
 
            state airtimedrain-checkextratics
           }
          }
        }
       } 
      }
     }
     else state playerairrestorecheck
     ifvarl AIRTIME 0 setvar AIRTIME 0
    }
    else
    {
     ifvarn VEHICLEID -1 
     {
      ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 setplayer[THISACTOR].scuba_on 0
     }
     else
     {
      ifvare INVULNTIME 0
      {
       setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
       ifvare MISCARRAYID_AMOUNTTEMP 0
       {
        // CHARACTER SPECFIC CHECKS :P
        ifvare CHARACTERSELECTED? 3 // Bubsy
        {
         setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
         ifvare MISCARRAYID_AMOUNTTEMP 1 { setplayer[THISACTOR].scuba_on 0 } // Do NOT drain Bubsy's air if he has the Diving Suit on, even if he has no Scuba Tank
         else
         {
          subvar SCUBATIME 1
          ifvarl SCUBATIME 0 setvar SCUBATIME 0
         }
        }
        else
        {
         subvar SCUBATIME 1
         ifvarl SCUBATIME 0 setvar SCUBATIME 0
        }

       }
      }
     }
    }
   }
  }

// MAKES CHARACTERS RISE/SINK IN WATER SECTORS WHEN IDLE
  ifvare mainmenu 0 
  {
   ifvarand bits 1 nullop
   else ifvarand bits 2 nullop
   else
   {
    ifvarn VEHICLEID -1
    {
     ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
     {
      getsector[THISACTOR].floorz TEMPVAR3
      getactor[THISACTOR].x x
      getactor[THISACTOR].y y
      updatesector x y TEMP
      getflorzofslope TEMP x y TEMPVAR3
      setvarvar TEMPVAR4 TEMPVAR3
      addvar TEMPVAR4 -9800
      getplayer[THISACTOR].posz TEMPVAR5
      ifvarvarl TEMPVAR5 TEMPVAR4 // Above
      {
       ifvare posxv 0 
       {
        ifvare posyv 0 setplayer[THISACTOR].poszv 2688
        else setplayer[THISACTOR].poszv 896
       }
       else setplayer[THISACTOR].poszv 896
      }
      else setplayer[THISACTOR].posz TEMPVAR4 // Below
     }
    }
    else
    {
     ifvare CHARACTERSELECTED? 1 // Duke
     {
      setplayer[THISACTOR].poszv 352
     }
     else
     ifvare CHARACTERSELECTED? 2 // Jack
     {
      setplayer[THISACTOR].poszv -288
     }
     else
     ifvare CHARACTERSELECTED? 3 // Bubsy
     {
      setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
      ifvare MISCARRAYID_AMOUNTTEMP 1 // Makes Bubsy heavy as hell in the water when wearing the Diving Suit.
      {
       setplayer[THISACTOR].poszv 480
      }
      else
      {
       setplayer[THISACTOR].poszv -320
      }
     }
     else
     ifvare CHARACTERSELECTED? 5 // Lo Wang
     {
      setplayer[THISACTOR].poszv 288
     }
     else
     ifvare CHARACTERSELECTED? 6 // ESSence
     {
      setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
      ifvare MISCARRAYID_AMOUNTTEMP 0 // Makes ESSence heavy with his armor equipped
      {
       setplayer[THISACTOR].poszv 896
      }
      else ifvare MISCARRAYID_AMOUNTTEMP 1 // Makes him less heavy without the armor equipped
      {
       setplayer[THISACTOR].poszv 448
      }
     }
     else
     ifvare CHARACTERSELECTED? 7 // Ted
     {
      setplayer[THISACTOR].poszv -288
     }
     else
     ifvare CHARACTERSELECTED? 8 // Lisa
     {
      setplayer[THISACTOR].poszv -352
     }
     else
     ifvare CHARACTERSELECTED? 9 // Cybanis
     {
      setplayer[THISACTOR].poszv 416
     }
     else
     ifvare CHARACTERSELECTED? 11 // Paula
     {
      setplayer[THISACTOR].poszv -384
     }
     else
     ifvare CHARACTERSELECTED? 12 // Lori
     {
      setplayer[THISACTOR].poszv -352
     }
     else
     ifvare CHARACTERSELECTED? 13 // Minako
     {
      setplayer[THISACTOR].poszv -320
     }
     else
     ifvare CHARACTERSELECTED? 15 // Maken
     {
      setplayer[THISACTOR].poszv -384
     }
 //  Ami has equal buyoncy in the water
 //  Nethra has equal buyoncy in the water
 //  "Mystery Woman" has equal buyoncy in the water
    }
   }
  }

// AIR TIME EFFECTS

  // JETPACK Bubble effect
  ifp pjetpack
  {
    ifvarand bits 1
    {
      ifvare mainmenu 0 addvar JETPACKBUBBLEVAR 1
      ifvarg JETPACKBUBBLEVAR 7
      {
       state jetpackbubbles
       setvar JETPACKBUBBLEVAR 0
      }
    }
 
    ifvarand bits 2
    {
      ifvare mainmenu 0 addvar JETPACKBUBBLEVAR 1
      ifvarg JETPACKBUBBLEVAR 7
      {
       state jetpackbubbles
       setvar JETPACKBUBBLEVAR 0
      }
    }
 
    ifvarand bits 3 nullop
    else
    {
      ifvare mainmenu 0 addvar JETPACKBUBBLEVAR 1
      ifvarg JETPACKBUBBLEVAR 15
      {
       state jetpackbubbles
       setvar JETPACKBUBBLEVAR 0
      }
    }

  }
 }

  // MAIN EFFECT for Underwater Airtime stuff >.>
  ifvare mainmenu 0
  {
   ifvarg SCUBATIME 0
   {
    ifvarvarl AIRTIME MAXAIRTIME
    {
      addvar AIRTICCOUNTER 1
      ifvare AIRTICCOUNTER 1
      {
       setvarvar TEMPVAR5 MAXAIRTIME
       divvar TEMPVAR5 130
       ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
       ifvare mainmenu 0 
       ifvarg CURRENTHITPOINTS 0 // ifp palive 
       {
        ifvarvarl SCUBATIME TEMPVAR5
        {
         addvarvar AIRTIME SCUBATIME
         ifvarvarg AIRTIME MAXAIRTIME 
         {
          setvarvar TEMPVAR AIRTIME 
          subvarvar TEMPVAR MAXAIRTIME 
          addvarvar SCUBATIME TEMPVAR
          setvarvar AIRTIME MAXAIRTIME
          setvar AIRTIMEEXTRA 1000
         }
         else setvar SCUBATIME 0
        }
        else
        {
         ifvarvarg AIRTIME MAXAIRTIME 
         {
          setvarvar TEMPVAR AIRTIME 
          subvarvar TEMPVAR MAXAIRTIME 
          addvarvar SCUBATIME TEMPVAR
          setvarvar AIRTIME MAXAIRTIME
          setvar AIRTIMEEXTRA 1000
         }
         else
         {
          addvarvar AIRTIME TEMPVAR5
          subvarvar SCUBATIME TEMPVAR5
         }
        }
       }
       setvar AIRTICCOUNTER 0
      }
    }
    else ifvarvare AIRTIME MAXAIRTIME nullop
    else
    ifvarvarg AIRTIME MAXAIRTIME 
    {
     setvarvar TEMPVAR AIRTIME 
     subvarvar TEMPVAR MAXAIRTIME 
     addvarvar SCUBATIME TEMPVAR
     setvarvar AIRTIME MAXAIRTIME
     setvar AIRTIMEEXTRA 1000
    }
   }
   else
   {
    ifvarn VEHICLEID -1
    {
     ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 state playerairrestorecheck
    }
   }
  }

  // DROWNING, DUDE.
  ifvare AIRTIME 0
  {
   ifvare mainmenu 0 addvar AIRTICCOUNTER2 1
   ifvare AIRTICCOUNTER2 8
   {
    ifvarg INVULNTIME 0 nullop
    else
    {
     randvar TEMPVAR8 3
     addvarvar DROWNDMGFACTOR TEMPVAR8
     setvarvar TEMPVAR2 MAXHITPOINTS
     mulvarvar TEMPVAR2 DROWNDMGFACTOR
     divvar TEMPVAR2 1000

     //*********************
     //*Check Malakian Gems*
     //*********************
     setvarvar TEMP7 TEMPVAR2
     state malakiangemcheck 
     setvarvar TEMPVAR2 TEMP7

     state drowndamage-checkequips

     ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR2 1000 ifvarl TEMPVAR2 1 setvar TEMPVAR2 1 state cheatersound }
     subvarvar CURRENTHITPOINTS TEMPVAR2
     state checkbuddhamode
     ifvarl TEMPVAR2 0 setvar PLAYERHPDAMAGED? -1
     else ifvarg TEMPVAR2 0 setvar PLAYERHPDAMAGED? 1

     ifvarand CHEATBITFIELD? 32 nullop else
     {
      ifvarg CURRENTHITPOINTS 0 
      {
       setvarvar DAMAGEHUEFACTOR TEMPVAR2
       state playerdamagehues-watertype

       setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
       ifvare TEMPHITCHARACTERVAR 5 setvarvar ATTACKINGACTORPICNUM 6909
       else setvarvar ATTACKINGACTORPICNUM 6910
       setvar ATTACKINGACTORPAL 0
       setvar ACTORCRITICAL? 0
       setactor[THISACTOR].htpicnum -1
       setvarvar PLAYERDAMAGETEMP TEMPVAR2
       state showdamage_player-drown
       ifvarg TEMPVAR2 0 setvar HEALTHDAMAGETIMER 0
       setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0

       ifrnd 192
       {
        ifrnd 128
        { 
         stopsound SOMEONE_DROWNING1 
         stopsound SOMEONE_DROWNING2 
        }
        ifrnd 128 sound SOMEONE_DROWNING1 else sound SOMEONE_DROWNING2
       }
       ifvare CHARACTERSELECTED? 5 // Higa
       {
        ifrnd 4 stopsound WANG_DROWNING1
        globalsound WANG_DROWNING1
       }
       ifvare CHARACTERSELECTED? 8 // Lisa
       {
        ifrnd 16
        {
         stopsound LISA_DROWNING1
         stopsound LISA_DROWNING2
         stopsound LISA_DROWNING3
         stopsound LISA_DROWNING4
        }
        randvar RNDVOICE 3
        ifvare RNDVOICE 0 globalsound LISA_DROWNING1
        ifvare RNDVOICE 1 globalsound LISA_DROWNING2
        ifvare RNDVOICE 2 globalsound LISA_DROWNING3
        ifvare RNDVOICE 3 globalsound LISA_DROWNING4
       }
       ifvare CHARACTERSELECTED? 15 // Maken
       {
        ifrnd 16
        {
         stopsound MAKEN_DROWNING1
         stopsound MAKEN_DROWNING2
         stopsound MAKEN_DROWNING3
         stopsound MAKEN_DROWNING4
        }
        randvar RNDVOICE 3
        ifvare RNDVOICE 0 globalsound MAKEN_DROWNING1
        ifvare RNDVOICE 1 globalsound MAKEN_DROWNING2
        ifvare RNDVOICE 2 globalsound MAKEN_DROWNING3
        ifvare RNDVOICE 3 globalsound MAKEN_DROWNING4
       }
      }
      else 
      {
       stopsound SOMEONE_DROWNING1
       stopsound SOMEONE_DROWNING2
       stopsound SOMEONE_DROWNED1
       stopsound SOMEONE_DROWNED2
       ifrnd 128 globalsound SOMEONE_DROWNED1 else globalsound SOMEONE_DROWNED2

       ifvare CHARACTERSELECTED? 8 { ifrnd 128 globalsound LISA_DROWNDEATH1 else globalsound LISA_DROWNDEATH2 }
       ifvare CHARACTERSELECTED? 15 { ifrnd 128 globalsound MAKEN_DROWNDEATH1 else globalsound MAKEN_DROWNDEATH2 }
       setvarvar CURRENTHITPOINTS 0
      } 
     }

    }
    state drownbubbles
    state drownbubbles
    setvar AIRTICCOUNTER2 0
   }
  }
  else setvar DROWNDMGFACTOR 10

/*
ifvarn hitsector -1 
{
}
*/

ifvarn hitwall -1 
{
// x

 setvar MISCARRAYID 208 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-x
 setvar MISCARRAYID 203 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-x
 getwall[hitwall].x MISCARRAYID_AMOUNTTEMP2
 setvar MISCARRAYID 203 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-x
 setvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2

 setvar MISCARRAYID 205 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
 getwall[hitwall].point2 MISCARRAYID_AMOUNTTEMP2
 setvar MISCARRAYID 205 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
 getwall[MISCARRAYID_AMOUNTTEMP2].x MISCARRAYID_AMOUNTTEMP2
 setvar MISCARRAYID 206 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2-x
 addvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2

 divvar MISCARRAYID_AMOUNTTEMP 2
 setvar MISCARRAYID 208 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-x
 //addlogvar MISCARRAYID_AMOUNTTEMP


// y

 setvar MISCARRAYID 209 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-y
 setvar MISCARRAYID 204 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-y
 getwall[hitwall].y MISCARRAYID_AMOUNTTEMP2
 setvar MISCARRAYID 204 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-y
 setvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2

 setvar MISCARRAYID 205 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
 getwall[hitwall].point2 MISCARRAYID_AMOUNTTEMP2
 setvar MISCARRAYID 205 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
 getwall[MISCARRAYID_AMOUNTTEMP2].y MISCARRAYID_AMOUNTTEMP2
 setvar MISCARRAYID 207 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2-y
 addvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2

 divvar MISCARRAYID_AMOUNTTEMP 2
 setvar MISCARRAYID 209 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-y
 //addlogvar MISCARRAYID_AMOUNTTEMP

// other vars

 setvar MISCARRAYID 210 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-hitag
 getwall[hitwall].hitag MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 210 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-hitag

 setvar MISCARRAYID 211 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
 getwall[hitwall].lotag MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 211 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag

 setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
 getwall[hitwall].extra MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 212 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 getwall[hitwall].picnum MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 213 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum

 setvar MISCARRAYID 214 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-overpicnum
 getwall[hitwall].overpicnum MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 214 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-overpicnum

 setvar MISCARRAYID 215 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextwall
 getwall[hitwall].nextwall MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 215 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextwall

 setvar MISCARRAYID 216 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextsector
 getwall[hitwall].nextsector MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 216 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextsector

 setvar MISCARRAYID 217 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-cstat
 getwall[hitwall].cstat MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 217 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-cstat

 setvar MISCARRAYID 218 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-shade
 getwall[hitwall].shade MISCARRAYID_AMOUNTTEMP

 setvar MISCARRAYID 219 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-pal
 getwall[hitwall].pal MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 219 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-pal

 setvar MISCARRAYID 220 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xrepeat
 getwall[hitwall].xrepeat MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 220 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xrepeat

 setvar MISCARRAYID 221 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-yrepeat
 getwall[hitwall].yrepeat MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 221 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-yrepeat

 setvar MISCARRAYID 222 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xpanning
 getwall[hitwall].xpanning MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 222 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xpanning

 setvar MISCARRAYID 223 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-ypanning
 getwall[hitwall].ypanning MISCARRAYID_AMOUNTTEMP
 setvar MISCARRAYID 223 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-ypanning

}

ifvarn hitsprite -1 
{ 
 getactor[hitsprite].statnum TARGETTYPE
 getactor[hitsprite].picnum TARGETSPECIES
 getactor[hitsprite].pal TARGETPAL
}

ifvare mainmenu 0
{
 ifvare shop_id -1
 {
  getplayer[THISACTOR].posx posx 
  getplayer[THISACTOR].posy posy 
  getplayer[THISACTOR].posxv posxv
  getplayer[THISACTOR].posyv posyv 
  getplayer[THISACTOR].jumping_counter jumpcountertemp
  getplayer[THISACTOR].falling_counter fallcountertemp
 }
 else
 ifvare atm_id -1
 {
  getplayer[THISACTOR].posx posx 
  getplayer[THISACTOR].posy posy 
  getplayer[THISACTOR].posxv posxv
  getplayer[THISACTOR].posyv posyv 
  getplayer[THISACTOR].jumping_counter jumpcountertemp
  getplayer[THISACTOR].falling_counter fallcountertemp
 }
 else
 {
  setplayer[THISACTOR].posxv 0 // Completely Halts X movement when menu is open
  setplayer[THISACTOR].posyv 0 // Completely Halts Y movement when menu is open
  setplayer[THISACTOR].poszv -256 // -256 is needed to freeze the player in the air when the menu is open
  setplayer[THISACTOR].falling_counter fallcountertemp // Locks the fall counter so players don't abuse the menu to evade fall damage/death
 } 
}
else
ifvare mainmenu 1 
{
 setplayer[THISACTOR].posxv 0 // Completely Halts X movement when menu is open
 setplayer[THISACTOR].posyv 0 // Completely Halts Y movement when menu is open
 setplayer[THISACTOR].poszv -256 // -256 is needed to freeze the player in the air when the menu is open
 setplayer[THISACTOR].falling_counter fallcountertemp // Locks the fall counter so players don't abuse the menu to evade fall damage/death
}
else
ifvare mainmenu -1 
{
 setplayer[THISACTOR].posxv 0 // Completely Halts X movement when menu is open
 setplayer[THISACTOR].posyv 0 // Completely Halts Y movement when menu is open
 setplayer[THISACTOR].poszv -256 // -256 is needed to freeze the player in the air when the menu is open
 setplayer[THISACTOR].falling_counter fallcountertemp // Locks the fall counter so players don't abuse the menu to evade fall damage/death
}

//********************************************************
//*Usable Walls (Vending Machines/Cola Machines/ATMs/Etc)*
//********************************************************

 setvar MISCARRAYID 208 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-x
 setvarvar wallxdist MISCARRAYID_AMOUNTTEMP
 subvarvar wallxdist posx

 setvar MISCARRAYID 209 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-y
 setvarvar wallydist MISCARRAYID_AMOUNTTEMP
 subvarvar wallydist posy

 //addlogvar wallxdist
 //addlogvar wallydist

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 867 
 {
  setvar MISCARRAYID 211 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
  ifvarn MISCARRAYID_AMOUNTTEMP 16384 ifvare oldskoolmode 0
  {
   ifvarg wallxdist -845 ifvarl wallxdist 845 ifvarg wallydist -845 ifvarl wallydist 845 ifvarg CURRENTHITPOINTS 0 // ifp palive
   {
    ifhitspace
    { 
     state stopsearchsounds
     ifvare com_pause 0
     {
      ifvare atm_id -1
      {
       setvarvar atm_id hitwall
       setvar atm_type 2
       setvar atm_mode 0
       randvar atm_background 47
       randvar atm_wscreen 3
       addvar atm_wscreen 1
       randvar atm_extquote 21
      }
      setvar com_pause 39
     }
    }
   }
  }
 } 

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 888 
 {
  setvar MISCARRAYID 211 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
  ifvarn MISCARRAYID_AMOUNTTEMP 16384 ifvare oldskoolmode 0
  {
   ifvarg wallxdist -845 ifvarl wallxdist 845 ifvarg wallydist -845 ifvarl wallydist 845 ifvarg CURRENTHITPOINTS 0 // ifp palive
   {
    ifhitspace
    { 
     state stopsearchsounds
     ifvare com_pause 0
     {
      ifvare CHARACTERSELECTED? 8
      {
       ifvarg DOLLARS 10499 ifvarg CURRENTENERGYPOINTS 39
       {
        setwall[hitwall].picnum 867 // fix the ATM machine :P
        sound MENU_ENTER
        ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 40
        subvar DOLLARS 10500
        subvar DISPLAYDOLLARS 10500
        state displaymoney
        setvarvar ARRAYPOSITION hitwall state createmusicsfx_atm
        ifvarand CHEATBITFIELD? 128 redefinequote 321 ^20LISA FIXED THE ATM, FOR A COST OF $10500.00!
        else redefinequote 321 ^20LISA FIXED THE ATM, FOR A COST OF $10500.00 AND 40 EP!
        setvarvar fta fta_normal setvar ftq 321
       }
       else
       {
        sound MENU_ERROR
        state atmbroken_dealdamage
        redefinequote 321 ^10THE ATM MACHINE IS BROKEN!
        setvarvar fta fta_normal setvar ftq 321
        }
      }
       else
      {
       sound MENU_ERROR
       state atmbroken_dealdamage
       redefinequote 321 ^10THE ATM MACHINE IS BROKEN!
       setvarvar fta fta_normal setvar ftq 321
      }
      setvar com_pause 39
     }
    }
   }
  }
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 1212
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1
  {
   state pressonsnackmachine
  }
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 1214
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1 ifvare oldskoolmode 0
  {
   ifvarg wallxdist -845 ifvarl wallxdist 845 ifvarg wallydist -845 ifvarl wallydist 845 ifvarg CURRENTHITPOINTS 0 // ifp palive
   {
         ifhitspace
         { 
          state stopsearchsounds
          ifvare com_pause 0
          {
           ifvare CHARACTERSELECTED? 8
           {
            ifvarg DOLLARS 499 ifvarg CURRENTENERGYPOINTS 9
            {
             setwall[hitwall].picnum 1212 // fix the Vending machine :P
             sound MENU_ENTER
             ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 10
             subvar DOLLARS 500
             subvar DISPLAYDOLLARS 500
             state displaymoney
             setvarvar ARRAYPOSITION hitwall state createmusicsfx_snackcola
             ifvarand CHEATBITFIELD? 128 redefinequote 321 ^20LISA FIXED THE VENDING MACHINE, FOR A COST OF $500.00!
             else redefinequote 321 ^20LISA FIXED THE VENDING MACHINE, FOR A COST OF $500.00 AND 10 EP!
             setvarvar fta fta_normal setvar ftq 321
            }
            else
            {
             sound MENU_ERROR
             redefinequote 321 ^10THE VENDING MACHINE IS BROKEN!
             setvarvar fta fta_normal setvar ftq 321
            }
           }
           else
           {
            sound MENU_ERROR
            redefinequote 321 ^10THE VENDING MACHINE IS BROKEN!
            setvarvar fta fta_normal setvar ftq 321
           }
           setvar com_pause 39
          }
         }
   }
  }
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 1215
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1 state pressoncolamachine
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 1217
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1
  {
   ifvare oldskoolmode 0
   {
    ifvarg wallxdist -845 ifvarl wallxdist 845 ifvarg wallydist -845 ifvarl wallydist 845 ifvarg CURRENTHITPOINTS 0 // ifp palive
    {
         ifhitspace
         { 
          state stopsearchsounds
          ifvare com_pause 0
          {
           ifvare CHARACTERSELECTED? 8
           {
            ifvarg DOLLARS 499 ifvarg CURRENTENERGYPOINTS 9
            {
             setwall[hitwall].picnum 1215 // fix the Cola machine :P
             sound MENU_ENTER
             subvar DOLLARS 500
             subvar DISPLAYDOLLARS 500
             ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 10
             state displaymoney
             setvarvar ARRAYPOSITION hitwall state createmusicsfx_snackcola
             ifvarand CHEATBITFIELD? 128 redefinequote 321 ^20LISA FIXED THE COLA MACHINE, FOR A COST OF $500.00!
             else redefinequote 321 ^20LISA FIXED THE COLA MACHINE, FOR A COST OF $500.00 AND 10 EP!
             setvarvar fta fta_normal setvar ftq 321
            }
            else
            {
             sound MENU_ERROR
             redefinequote 321 ^10THE COLA MACHINE IS BROKEN!
             setvarvar fta fta_normal setvar ftq 321
            }
           }
           else
           {
            sound MENU_ERROR
            redefinequote 321 ^10THE COLA MACHINE IS BROKEN!
            setvarvar fta fta_normal setvar ftq 321
           }
           setvar com_pause 39
          }
         }
    }
   }
  }
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvarg MISCARRAYID_AMOUNTTEMP 7635 ifvarl MISCARRAYID_AMOUNTTEMP 7677
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1 state pressoncolamachine
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvarg MISCARRAYID_AMOUNTTEMP 7676 ifvarl MISCARRAYID_AMOUNTTEMP 7679
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1 state pressonsnackmachine
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvare MISCARRAYID_AMOUNTTEMP 7679
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1 state pressoncolamachine
 }

 setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
 ifvarg MISCARRAYID_AMOUNTTEMP 10495 ifvarl MISCARRAYID_AMOUNTTEMP 10750
 {
  setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
  ifvare MISCARRAYID_AMOUNTTEMP -1
  {
   ifvare oldskoolmode 0
   {
    ifvarg wallxdist -845 ifvarl wallxdist 845 ifvarg wallydist -845 ifvarl wallydist 845 ifvarg CURRENTHITPOINTS 0 // ifp palive
    {
         ifhitspace
         { 
          state stopsearchsounds
          state getpartime
          addvar upresstime 1
          ifvarvare temppartime upresstime nullop
          else { sound MENU_SELECTED setvarvar ARRAYPOSITION hitwall state swapscreen1 }
          setvarvar upresstime temppartime
         }
    }
   }
  }
 }

// Code for Regenerating Player-Character's HP/AP/EP when below 100%
ifvare oldskoolmode 0
{
 ifvare mainmenu 0
 {
  state playerregenhealthnormal
  state playerregenarmornormal
  state playerregenenergynormal
 }
}
// End Code for Regenerating HP/AP/EP

ifvare oldskoolmode 1
{
 redefinequote 12 ^19USED STEROIDS
 redefinequote 90 ^20STEROIDS
 ifvarg CURRENTHITPOINTS 0 setvar PLAYERSTATUS? 0
}

ifvarand PLAYERSTATUS? 2 // Haste
{ 
 ifvare CHARACTERSELECTED? 14
 {
  ifvare PUBLICBETA? 0
  {
   setvar WEAPON0_FIREDELAY 2
   setvar WEAPON0_TOTALTIME 4
  }
  else
  {
   setvar WEAPON0_FIREDELAY 5
   setvar WEAPON0_TOTALTIME 10
  }
 }
 else
 {
  setvar WEAPON0_FIREDELAY 5
  setvar WEAPON0_TOTALTIME 10
 }
 setvar WEAPON1_TOTALTIME 4 // 6
 setvar WEAPON2_TOTALTIME 15 // 21
 ifvare CHAINGUNMODE 0 setvar WEAPON3_TOTALTIME 14 else setvar WEAPON3_TOTALTIME 13
 setvar WEAPON4_TOTALTIME 14 // 20
 setvar WEAPON5_TOTALTIME 14 // 19
 setvar WEAPON6_TOTALTIME 9 // 12
 setvar WEAPON7_TOTALTIME 4 // 5
 setvar WEAPON8_TOTALTIME 29 // 40
 setvar WEAPON9_TOTALTIME 10 // 8
 setvar WEAPON10_TOTALTIME 7 // 10
 setvar WEAPON11_TOTALTIME 4 // 5
} 

ifvarand PLAYERSTATUS? 4 // Slowed
{ 
 ifvare CHARACTERSELECTED? 14
 {
  ifvare PUBLICBETA? 0
  {
   setvar WEAPON0_FIREDELAY 4
   setvar WEAPON0_TOTALTIME 8
  }
  else
  {
   setvar WEAPON0_FIREDELAY 9
   setvar WEAPON0_TOTALTIME 18
  }
 }
 else
 {
  setvar WEAPON0_FIREDELAY 9
  setvar WEAPON0_TOTALTIME 18
 }
 setvar WEAPON1_TOTALTIME 8 // 6
 setvar WEAPON2_TOTALTIME 27 // 21
 ifvare CHAINGUNMODE 0 setvar WEAPON3_TOTALTIME 8 else setvar WEAPON3_TOTALTIME 7
// setvar WEAPON3_TOTALTIME 7 // 10
 setvar WEAPON4_TOTALTIME 26 // 20
 setvar WEAPON5_TOTALTIME 24 // 19
 setvar WEAPON6_TOTALTIME 15 // 12
 setvar WEAPON7_TOTALTIME 6 // 5
 setvar WEAPON8_TOTALTIME 51 // 40
 setvar WEAPON9_TOTALTIME 6 // 8
 setvar WEAPON10_TOTALTIME 13 // 10
 setvar WEAPON11_TOTALTIME 6 // 5
}

ifvarand PLAYERSTATUS? 6 nullop
else // If neither Haste or Slow is detected, revert to normal shooting times
{
 ifvare CHARACTERSELECTED? 14
 {
  ifvare PUBLICBETA? 0
  {
   setvar WEAPON0_FIREDELAY 3
   setvar WEAPON0_TOTALTIME 6
  }
  else
  {
   setvar WEAPON0_FIREDELAY 7
   setvar WEAPON0_TOTALTIME 14
  }
 }
 else
 {
  setvar WEAPON0_FIREDELAY 7
  setvar WEAPON0_TOTALTIME 14
 }
 setvar WEAPON1_TOTALTIME 6 // 6 [Pistol]
 setvar WEAPON2_TOTALTIME 21 // 21 [Shotgun]
 setvar WEAPON3_TOTALTIME 10 // 10 [Chaingun] (reverse)
 setvar WEAPON4_TOTALTIME 20 // 20
 setvar WEAPON5_TOTALTIME 19 // 19
 setvar WEAPON6_TOTALTIME 12 // 12
 setvar WEAPON7_TOTALTIME 5 // 5
 setvar WEAPON8_TOTALTIME 40 // 40
 setvar WEAPON9_TOTALTIME 8 // 8
 setvar WEAPON10_TOTALTIME 10 // 10
 setvar WEAPON11_TOTALTIME 5 // 5
}

ifvarand PLAYERSTATUS? 16
{
 // Sets a Dim hue over the player's vision to represent "Dimness" status
 getplayer[THISACTOR].player_par temp
 modvar temp 24
 ifvare temp 0 palfrom 60 0 0 0
 ifvare temp 1 palfrom 60 0 0 0
 ifvare temp 2 palfrom 60 0 0 0
 ifvare temp 3 palfrom 60 0 0 0

 ifvare temp 4 palfrom 61 0 0 0
 ifvare temp 5 palfrom 61 0 0 0
 ifvare temp 6 palfrom 61 0 0 0
 ifvare temp 7 palfrom 61 0 0 0

 ifvare temp 8 palfrom 62 0 0 0
 ifvare temp 9 palfrom 62 0 0 0
 ifvare temp 10 palfrom 62 0 0 0
 ifvare temp 11 palfrom 62 0 0 0

 ifvare temp 12 palfrom 63 0 0 0
 ifvare temp 13 palfrom 63 0 0 0
 ifvare temp 14 palfrom 63 0 0 0
 ifvare temp 15 palfrom 63 0 0 0

 ifvare temp 16 palfrom 62 0 0 0
 ifvare temp 17 palfrom 62 0 0 0
 ifvare temp 18 palfrom 62 0 0 0
 ifvare temp 19 palfrom 62 0 0 0

 ifvare temp 20 palfrom 61 0 0 0
 ifvare temp 21 palfrom 61 0 0 0
 ifvare temp 22 palfrom 61 0 0 0
 ifvare temp 23 palfrom 61 0 0 0
}

ifvarand PLAYERSTATUS? 32 // Checks for the Triad Refractor status
{
 ifvarn CHARACTERSELECTED? 12 subvar PLAYERSTATUS? 32 // Only Lori can use Traid Refractor
}
setvar CHARACTERARRAY 1 state charchecktriadrefractor
setvar CHARACTERARRAY 2 state charchecktriadrefractor
setvar CHARACTERARRAY 3 state charchecktriadrefractor
setvar CHARACTERARRAY 4 state charchecktriadrefractor
setvar CHARACTERARRAY 5 state charchecktriadrefractor
setvar CHARACTERARRAY 6 state charchecktriadrefractor
setvar CHARACTERARRAY 7 state charchecktriadrefractor
setvar CHARACTERARRAY 8 state charchecktriadrefractor
setvar CHARACTERARRAY 9 state charchecktriadrefractor
setvar CHARACTERARRAY 10 state charchecktriadrefractor
setvar CHARACTERARRAY 11 state charchecktriadrefractor
setvar CHARACTERARRAY 13 state charchecktriadrefractor
setvar CHARACTERARRAY 14 state charchecktriadrefractor
setvar CHARACTERARRAY 15 state charchecktriadrefractor

ifvarand PLAYERSTATUS? 64 // Checks for the Triad Ragnarok status
{
 ifvarn CHARACTERSELECTED? 12 subvar PLAYERSTATUS? 64 // Only Lori can use Triad Ragnarok
}
setvar CHARACTERARRAY 1 state charchecktriadragnarok
setvar CHARACTERARRAY 2 state charchecktriadragnarok
setvar CHARACTERARRAY 3 state charchecktriadragnarok
setvar CHARACTERARRAY 4 state charchecktriadragnarok
setvar CHARACTERARRAY 5 state charchecktriadragnarok
setvar CHARACTERARRAY 6 state charchecktriadragnarok
setvar CHARACTERARRAY 7 state charchecktriadragnarok
setvar CHARACTERARRAY 8 state charchecktriadragnarok
setvar CHARACTERARRAY 9 state charchecktriadragnarok
setvar CHARACTERARRAY 10 state charchecktriadragnarok
setvar CHARACTERARRAY 11 state charchecktriadragnarok
setvar CHARACTERARRAY 13 state charchecktriadragnarok
setvar CHARACTERARRAY 14 state charchecktriadragnarok
setvar CHARACTERARRAY 15 state charchecktriadragnarok

ifvarand PLAYERSTATUS? 128 // For spinning around the player's angle and vangle when confused.
{ 
 ifvare mainmenu 0 // only mess with the view angles when the menu isn't open
 {
  randvar TEMPVAR4 5 // 7
  ifrnd 128 mulvar TEMPVAR4 -1
  addvar TEMPVAR4 20 // 25

  addvar CONFUSESWITCHTIMER 1
  ifvarvarg CONFUSESWITCHTIMER TEMPVAR4 // Will randomly set the direction of spinning while confused every second
  {
   randvar CONFUSEDIRECTION 1
   setvar CONFUSESWITCHTIMER 0
  }

  ifvare CONFUSEDIRECTION 0
  { 
   randvar TEMPVAR 16
   randvar TEMPVAR2 2 addvar TEMPVAR2 1
   mulvarvar TEMPVAR TEMPVAR2
   ifrnd 128 mulvar TEMPVAR -1
   ifrnd 85 addvar PLAYERANGLE 32 else ifrnd 128 addvar PLAYERANGLE 64 else addvar PLAYERANGLE 96
   addvarvar PLAYERANGLE TEMPVAR
  }
  else
  {
   randvar TEMPVAR 16
   randvar TEMPVAR2 2 addvar TEMPVAR2 1
   mulvarvar TEMPVAR TEMPVAR2
   ifrnd 128 mulvar TEMPVAR -1
   ifrnd 85 subvar PLAYERANGLE 32 else ifrnd 128 subvar PLAYERANGLE 64 else subvar PLAYERANGLE 96
   subvarvar PLAYERANGLE TEMPVAR
  }
  setplayer[THISACTOR].ang PLAYERANGLE 

  getplayer[THISACTOR].horiz PLAYERHORIZ
  ifvare CONFUSEDVDIRECTION 0 // Moves Angle Up
  {
   ifvarl PLAYERHORIZ 298 
   { 
    randvar TEMPVAR 6
    randvar TEMPVAR2 2 addvar TEMPVAR2 1
    mulvarvar TEMPVAR TEMPVAR2
    ifrnd 128 mulvar TEMPVAR -1
    ifrnd 85 addvar PLAYERHORIZ 12 else ifrnd 128 addvar PLAYERHORIZ 24 else addvar PLAYERHORIZ 36
    addvarvar PLAYERHORIZ TEMPVAR
   }
   else setvar CONFUSEDVDIRECTION 1
  }
  ifvare CONFUSEDVDIRECTION 1 // Moves Angle Down
  {
   ifvarg PLAYERHORIZ -98
   {
    randvar TEMPVAR 6
    randvar TEMPVAR2 2 addvar TEMPVAR2 1
    mulvarvar TEMPVAR TEMPVAR2
    ifrnd 128 mulvar TEMPVAR -1
    ifrnd 85 subvar PLAYERHORIZ 12 else ifrnd 128 subvar PLAYERHORIZ 24 else subvar PLAYERHORIZ 36
    subvarvar PLAYERHORIZ TEMPVAR
   }
   else setvar CONFUSEDVDIRECTION 0
  }
  setplayer[THISACTOR].horiz PLAYERHORIZ

 }
} 

ifvarand PLAYERSTATUS? 256 // Checks for the Aqua Protection status
{
 ifvarn CHARACTERSELECTED? 4 subvar PLAYERSTATUS? 256 // Only Ami can use Aqua Protection
// ifvare CHARACTERSELECTED? 4 { ifvarand PLAYERSTATUS? 512 subvar PLAYERSTATUS? 512 } // Ami cannot have the "Damage Shell" status while using Aqua Protection
}
setvar CHARACTERARRAY 1 state charcheckaquaprotection
setvar CHARACTERARRAY 2 state charcheckaquaprotection
setvar CHARACTERARRAY 3 state charcheckaquaprotection
setvar CHARACTERARRAY 5 state charcheckaquaprotection
setvar CHARACTERARRAY 6 state charcheckaquaprotection
setvar CHARACTERARRAY 7 state charcheckaquaprotection
setvar CHARACTERARRAY 8 state charcheckaquaprotection
setvar CHARACTERARRAY 9 state charcheckaquaprotection
setvar CHARACTERARRAY 10 state charcheckaquaprotection
setvar CHARACTERARRAY 11 state charcheckaquaprotection
setvar CHARACTERARRAY 12 state charcheckaquaprotection
setvar CHARACTERARRAY 13 state charcheckaquaprotection
setvar CHARACTERARRAY 14 state charcheckaquaprotection
setvar CHARACTERARRAY 15 state charcheckaquaprotection

ifvarand PLAYERSTATUS? 2048 // Checks for the Triad Blitzkrieg status
{
 ifvarn CHARACTERSELECTED? 15 subvar PLAYERSTATUS? 2048 // Only Maken can use Traid Blitzkrieg
}
setvar CHARACTERARRAY 1 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 2 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 3 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 4 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 5 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 6 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 7 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 8 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 9 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 10 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 11 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 12 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 13 state charchecktriadblitzkrieg
setvar CHARACTERARRAY 14 state charchecktriadblitzkrieg

ifp ponground addvar ONGROUNDTIMER 1 else setvar ONGROUNDTIMER 0

ifvare FALLSOUND? 1
{
 ifp ponground
 {
  ifvarg ONGROUNDTIMER 1
  {
   ifvare sector[PLAYERSECTOR].lotag 1 nullop
   else ifvare sector[PLAYERSECTOR].lotag 2 nullop
   else
   {
    setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
    ifvare MISCARRAYID_AMOUNTTEMP 0
    {
     ifvarl INVULNTIME 1
     {

      ifvarand CHEATBITFIELD? 32 nullop else
      {
       stopsound DUKE_LAND_HURT
       ifvare VEHICLEID -1 setvarvar tempd MAXHITPOINTS else getactorvar[VEHICLEID].ACTORMAXHP tempd

       ifvarg totalfallcounter 7
       {
        setvar falldamageratio 80
        setvarvar TEMPVAR2 totalfallcounter
        subvar TEMPVAR2 8
        mulvarvar TEMPVAR2 17
        addvarvar falldamageratio TEMPVAR2
       }

       randvar TEMPVAR 51
       subvarvar falldamageratio TEMPVAR

       // Check for ShockAb Boots [Equippable Item]
       setvar DAMAGEMODIFIER 10000
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM1 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM2 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM3 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM4 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM5 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM6 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM7 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM8 14
       {
        randvar TEMPVAR5 250
        ifrnd 128 mulvar TEMPVAR5 -1
        addvar TEMPVAR5 1750
        subvarvar DAMAGEMODIFIER TEMPVAR5
        ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
        // addlogvar DAMAGEMODIFIER
       }
       mulvarvar falldamageratio DAMAGEMODIFIER
       divvar falldamageratio 10000

       ifvarl falldamageratio 1 setvar falldamageratio 1
       ifvarg falldamageratio 8320 setvar falldamageratio 8320
       // addlogvar falldamageratio

       // Up to 244
       mulvarvar tempd falldamageratio
       divvar tempd 1000
       ifvarl tempd 0 setvar tempd 0
       ifvarvarg tempd STATLIMITATOMIC setvarvar tempd STATLIMITATOMIC
       ifvarg tempd 0
       {
        setvarvar tempe tempd
        addvarvar tempe rfallcounter
       }

       //*********************
       //*Check Malakian Gems*
       //*********************
       setvarvar TEMP7 tempe
       state malakiangemcheck 
       setvarvar tempe TEMP7

       ifvarand CHEATBITFIELD? 16 { divvar tempe 1000 ifvarl tempe 1 setvar tempe 1 state cheatersound }
       ifvare VEHICLEID -1
       {
        ifvare ESHIELDADVANCEMENT 0
        {
         // Level 1 Bio-Shield Support (33.4-66.6% dmg reduction) >.>
         setvarvar BIOSHIELDABSORBSOLID 500 // 500 (lesser means less damage is ignored)
         randvar BIOSHIELDABSORBRANDOM 166 // 166 (lesser means less damage is ignored)
         ifrnd 128 addvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM else subvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM
        }
        else
        {
         // Level 2 Bio-Shield Support (98.1-99.9% dmg reduction) >.>
         setvarvar BIOSHIELDABSORBSOLID 10 // 990 (lesser means less damage is ignored)
         randvar BIOSHIELDABSORBRANDOM 9 // 9 (lesser means less damage is ignored)
         ifrnd 128 addvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM else subvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM
        }
        setvarvar BIOSHIELDIGNOREDDAMAGE tempe
        mulvarvar BIOSHIELDIGNOREDDAMAGE BIOSHIELDABSORBSOLID
        divvar BIOSHIELDIGNOREDDAMAGE 1000

        setvarvar TEMPVAR tempe
        subvarvar TEMPVAR BIOSHIELDIGNOREDDAMAGE // Take out the random Bio-shield damage to prevent full absorbsion
        ifvarl TEMPVAR 1 setvar TEMPVAR 1
        // Main Formula
        ifvare CHARACTERSELECTED? 8
        {
         ifvare HAVEENERGYSHIELD? 1 
         {
          ifvare ENERGYSHIELDMODE 1 
          {
           ifvarg TEMPVAR 0
           {
            ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
            {
             setvarvar CELLDAMAGE TEMPVAR
             setvarvar CELLDAMAGETEMP CELLDAMAGE setvar CELLDAMAGETIMER 0 // For the displays
             ifvarn ESHIELDDMGFACTOR 0 divvarvar CELLDAMAGE ESHIELDDMGFACTOR
             ifvarvarg CELLDAMAGE CURRENTCELLS setvarvar CELLDAMAGE CURRENTCELLS
             setvarvar tempc CELLDAMAGE
             mulvarvar tempc ESHIELDDMGFACTOR
             subvarvar TEMPVAR tempc
             subvarvar CURRENTCELLS CELLDAMAGE
             setvar CELLDAMAGELEFT 0 
             ifvarg TEMPVAR 0 subvarvar CELLDAMAGETEMP TEMPVAR // For the displays 

             // Now to Calculate to deal with remaining TEMPVAR
             ifvarg CURRENTCELLS 0 // 1 or more cells left
             {
              ifvarvarg TEMPVAR DAMAGEINCELL // Damage exceeds the remaining power in the current cell
              {
               setvarvar TEMP3 TEMPVAR
               setvar TEMPVAR 0
               addvarvar CELLDAMAGETEMP TEMP3
               subvarvar DAMAGEINCELL TEMP3
               ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
              }
              else // Damage is less than or equal to the remaining power in the current cell
              {
               addvarvar CELLDAMAGETEMP TEMPVAR
               subvarvar DAMAGEINCELL TEMPVAR
               setvar TEMPVAR 0
               ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
              }
             }
             else // 0 cells
             {
              ifvarvarg TEMPVAR DAMAGEINCELL // Damage exceeds the remaining power in the last cell
              {
               addvarvar CELLDAMAGETEMP DAMAGEINCELL
               subvarvar TEMPVAR DAMAGEINCELL
               setvar DAMAGEINCELL 0
              }
              else // Damage is less than the remaining power in the last cell
              {
               addvarvar CELLDAMAGETEMP TEMPVAR
               subvarvar DAMAGEINCELL TEMPVAR
               setvar TEMPVAR 0
              }
             }
 
             stopsound NODAMAGE
             ifvare ENERGYSHIELDMODE 1 { setvar sparkflag 1 state sparkstate }
             state bioshieldhitsounds
             palfrom 32 0 0 64
            }
           }
          }
         }
        }
        setvarvar FULLSHIELDDAMAGE CELLDAMAGE
        mulvarvar FULLSHIELDDAMAGE ESHIELDDMGFACTOR
        addvarvar FULLSHIELDDAMAGE CELLDAMAGELEFT
        // End Main Formula
        setvarvar tempe TEMPVAR
        addvarvar tempe BIOSHIELDIGNOREDDAMAGE // Reinsert the random Bio-shield damage to prevent full absorbsion
// Bio-Shield Support (33.4-66.6% dmg reduction) >.>

        ifvare CHARACTERSELECTED? 8
        {
         ifvare HAVEENERGYSHIELD? 1
         {
          ifvare ENERGYSHIELDMODE 1 
          {
           ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
           {
            ifvarg CELLDAMAGETEMP 0
            {
             ifvarn player[THISACTOR].over_shoulder_on 0
             {
              setvarvar SHOWDAMAGE CELLDAMAGETEMP
              setvar SHOWDAMAGETYPE 2
              setvarvar SHOWDAMAGEACTORID THISACTOR
              state showdamage
             }
            }
           }
          }
         }
        }
        setvarvar tempb CURRENTHITPOINTS
        subvarvar tempb tempe
        ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
        else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
        ifvarn player[THISACTOR].over_shoulder_on 0
        {
         ifvarg tempe 0
         {
          setvarvar SHOWDAMAGE tempe
          setvar SHOWDAMAGETYPE 0
          setvarvar SHOWDAMAGEACTORID THISACTOR
          state showdamage
         }
        }
        ifvarl tempb 0 setvar tempb 0
        setactor[PLAYERID].htpicnum -1
        setvarvar CURRENTHITPOINTS tempb
        state checkbuddhamode
       }
       else
       {
        getactorvar[VEHICLEID].ACTORHP tempb // setvarvar tempb CURRENTHITPOINTS
        subvarvar tempb tempe
        ifvarl tempe 0 setvar VEHICLEHPDAMAGED? -1
        else ifvarg tempe 0 setvar VEHICLEHPDAMAGED? 1
        ifvarn player[THISACTOR].over_shoulder_on 0
        {
         ifvarg tempe 0
         {
          setvarvar SHOWDAMAGE tempe
          setvar SHOWDAMAGETYPE 0
          setvarvar SHOWDAMAGEACTORID THISACTOR
          state showdamage
         }
        }
        ifvarl tempb 0 setvar tempb 0
        setactor[PLAYERID].htpicnum -1
        setactorvar[VEHICLEID].ACTORHP tempb // setvarvar CURRENTHITPOINTS tempb
        state checkbuddhamode
       }

       ifvarg FULLSHIELDDAMAGE 0
       {
        setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
        ifvare TEMPHITCHARACTERVAR 5 setvarvar ATTACKINGACTORPICNUM 6911
        else ifvare TEMPHITCHARACTERVAR 6 setvarvar ATTACKINGACTORPICNUM 6911
        else ifvare TEMPHITCHARACTERVAR 9 setvarvar ATTACKINGACTORPICNUM 6911
        else ifvare TEMPHITCHARACTERVAR 10 
        {
         setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
         ifvare MISCARRAYID_AMOUNTTEMP 0 setvarvar ATTACKINGACTORPICNUM 6908 else setvarvar ATTACKINGACTORPICNUM 6911 
        }
        else setvarvar ATTACKINGACTORPICNUM 6911
        setvarvar ATTACKINGACTORPAL 0
        setvar ACTORCRITICAL? 0
        setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
        ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
       }
 
       ifvarg tempe 0
       {
        setvar ATTACKINGACTORPAL 0
        setvar ACTORCRITICAL? 0
        setvarvar PLAYERDAMAGETEMP tempe
        ifvare VEHICLEID -1
        {
         setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
         ifvare TEMPHITCHARACTERVAR 5 setvarvar ATTACKINGACTORPICNUM 6911
         else ifvare TEMPHITCHARACTERVAR 6 setvarvar ATTACKINGACTORPICNUM 6911
         else ifvare TEMPHITCHARACTERVAR 9 setvarvar ATTACKINGACTORPICNUM 6911
         else ifvare TEMPHITCHARACTERVAR 10 
         {
          setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
          ifvare MISCARRAYID_AMOUNTTEMP 0 setvarvar ATTACKINGACTORPICNUM 6908 else setvarvar ATTACKINGACTORPICNUM 6911 
         }
         else setvarvar ATTACKINGACTORPICNUM 6911
        }
        else setvarvar ATTACKINGACTORPICNUM 6911

        ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
        setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
       } 

       ifvare VEHICLEID -1
       {
        ifvarg tempe 0
        {
         // addlogvar tempe

         setvarvar TEMPVAR3 tempe
         mulvar TEMPVAR3 1000
         divvarvar TEMPVAR3 MAXHITPOINTS

         setvarvar DAMAGEHUEFACTOR tempe
         state playerdamagehues-normaltype

         // addlogvar TEMPVAR3
         ifvare CHARACTERSELECTED? 1
         {
          stopsound DUKE_SCREAM
          globalsound DUKE_LAND_HURT2
         }
         else
         ifvare CHARACTERSELECTED? 2
         {
          stopsound JACK_FALLSCREAM

          // addlogvar CHARACTERSELECTED?
          // Insert Fall Damage Sounds Later
         }
         else
         ifvare CHARACTERSELECTED? 5
         {
          stopsound WANG_SCREAM
          globalsound WANG_LONGTERM_PAIN6
         }
         else
         ifvare CHARACTERSELECTED? 6
         {
          stopsound ESSENCE_FALLSCREAM
          // Insert Fall Damage Sounds Later
         }
         else
         ifvare CHARACTERSELECTED? 8 
         {
          stopsound LISA_FALLDAMAGE
          stopsound LISA_FALLDAMAGE2
          stopsound LISA_FALLDAMAGE3
          stopsound LISA_FALLSCREAM

          ifvarl TEMPVAR3 100 globalsound LISA_FALLDAMAGE2 // Minor Fall Damage
          else ifvarg TEMPVAR3 99 ifvarl TEMPVAR3 834 globalsound LISA_FALLDAMAGE // Normal Fall Damage
          else globalsound LISA_FALLDAMAGE3 // Major Fall Damage
         }
         else
         ifvare CHARACTERSELECTED? 9
         {
          stopsound CYBANIS_FALLDAMAGE1
          stopsound CYBANIS_FALLDAMAGE2
          stopsound CYBANIS_FALLSCREAM

          ifvarl TEMPVAR3 334 globalsound CYBANIS_FALLDAMAGE1
          else globalsound CYBANIS_FALLDAMAGE2
         }
         else
         ifvare CHARACTERSELECTED? 15
         {
          stopsound MAKEN_FALLDAMAGE1
          stopsound MAKEN_FALLDAMAGE2
          stopsound MAKEN_FALLDAMAGE3
          stopsound MAKEN_FALLSCREAM

          ifvarl TEMPVAR3 100 globalsound MAKEN_FALLDAMAGE1 // Minor Fall Damage
          else ifvarg TEMPVAR3 99 ifvarl TEMPVAR3 834 globalsound MAKEN_FALLDAMAGE2 // Normal Fall Damage
          else sound MAKEN_FALLDAMAGE3 // Major Fall Damage
         }
        }
       }
       else
       {
        ifvarg tempe 0
        {
         setvarvar DAMAGEHUEFACTOR tempe
         mulvar DAMAGEHUEFACTOR 1000
         divvarvar DAMAGEHUEFACTOR MAXHITPOINTS
         state playerdamagehues_vehicle
        }
        globalsound METALTHUD
       }
      }

     }
    }
   }
   setvar fallcounter2 0
   setvar totalfallcounter 0
   setvar FALLSOUND? 0
  }
 }
}


// Holoform Displays >_>
getplayer[THISACTOR].holoduke_on TEMPVAR
ifvarn TEMPVAR -1
{
 getactor[TEMPVAR].mdflags TEMP
 orvar TEMP 16
 setactor[TEMPVAR].mdflags TEMP 
}

//***************************************************
//*Damage Ceiling/Sector Control for Invuln/God Mode*
//***************************************************
setvar CEILINGDAMAGETYPE? 0
setvar FLOORDAMAGETYPE? 0
setvar EMUCEILINGDAMAGETYPE? 0
setvar EMUFLOORDAMAGETYPE? 0

setvar CANDMGFLOOR? 0

setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
ifvare MISCARRAYID_AMOUNTTEMP 0 { ifvarg CURRENTHITPOINTS 0 { ifvarand CHEATBITFIELD? 32 nullop else { ifvare mainmenu 0 setvar CANDMGFLOOR? 1 } } } // Checks Conditions for being able to take damage from damagefloors

setvar CANDMGFLOOR2? 0
ifp ponground { state playergetcorrectz ifvarvarl PLAYERDMGFLRZ tempe { ifvarvarg PLAYERDMGFLRZ tempb setvar CANDMGFLOOR2? 1 } }
setvar CANDMGFLOOR3? 0

ifvare player[THISACTOR].spritebridge 0 ifvare player[THISACTOR].jetpack_on 0 setvar CANDMGFLOOR3? 1 
//addlogvar CANDMGFLOOR3?

//

ifvare sector[PLAYERSECTOR].lotag 2
{
 getactor[THISACTOR].sectnum temp
 getsector[temp].ceilingpicnum PLAYERCEILINGTILE
 getsector[temp].floorpicnum PLAYERFLOORTILE

 ifvare PLAYERCEILINGTILE 84 // BIGORBIT1
 {
  getsector[temp].ceilingstat TEMPVAR
  ifvarand TEMPVAR 1 // if the ceiling is paralaxxed
  {

   ifvarand CHEATBITFIELD? 32 nullop else
   {
    getsector[temp].ceilingpal TEMPVAR
    ifvare TEMPVAR 0 setvar INSTANTDEATH 1
   }

  }
 }
 else
 ifvare PLAYERFLOORTILE 84 // BIGORBIT1
 {
  getsector[temp].floorstat TEMPVAR
  ifvarand TEMPVAR 1 // if the ceiling is paralaxxed
  {

   ifvarand CHEATBITFIELD? 32 nullop else
   {
    getsector[temp].floorpal TEMPVAR
    ifvare TEMPVAR 0 setvar INSTANTDEATH 1
   }

  }
 }

 ifvare PLAYERCEILINGTILE 5385 // NEWFLOORSLIME
 {
  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 1
    state player_do_floorslime_checks1_c
   }
   else
   {
    state player_do_floorslime_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 5388 // NEWHURTRAIL
 {
  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 2
    state player_do_hurtrail_checks1_c
   }
   else
   {
    state player_do_hurtrail_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 5389 // NEWFLOORPLASMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 1 addvar tempg 2
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 3
    state player_do_floorplasma_checks1_c
   }
   else
   {
    state player_do_floorplasma_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 5395 // NEWPURPLELAVA
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare player[THISACTOR].spritebridge 0
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     setvar CEILINGDAMAGETYPE? 4
     state player_do_purplelava_checks1_c
    }
    else
    {
     state player_do_purplelava_checks2
    }
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 3780 // HOTLAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 2 addvar tempg 5
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 6
    state player_do_hotlava_checks1_c
   }
   else
   {
    state player_do_hotlava_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 3796 // AMOEBAACID
 {
  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 5
    state player_do_amoebaacid_checks1_c
   }
   else
   {
    state player_do_amoebaacid_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 4091 // MEGALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 8 addvar tempg 17
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 7
    state player_do_megalava_checks1_c
   }
   else
   {
    state player_do_megalava_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 5401 // ULTRALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 20 addvar tempg 41
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 8
    state player_do_ultralava_checks1_c
   }
   else
   {
    state player_do_ultralava_checks2
   }
  }
 }
 else
 ifvare PLAYERCEILINGTILE 5443 // HYPERMAGMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 80 addvar tempg 161
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar CEILINGDAMAGETYPE? 8
    state player_do_hypermagma_checks1_c
   }
   else
   {
    state player_do_hypermagma_checks2
   }
  }
 }
}
//*************************************************
//*Damage Floor/Sector Control for Invuln/God Mode*
//*************************************************
else
{
 getactor[THISACTOR].sectnum temp
 getsector[temp].ceilingpicnum PLAYERCEILINGTILE
 getsector[temp].floorpicnum PLAYERFLOORTILE

 ifvare PLAYERCEILINGTILE 84 // BIGORBIT1
 {
  ifvarand sector[temp].ceilingstat 1 // if the ceiling is paralaxxed
  {

   ifvarand CHEATBITFIELD? 32 nullop else
   {
    ifvare sector[temp].ceilingpal 0 setvar INSTANTDEATH 1
   }

  }
 }
 else
 ifvare PLAYERFLOORTILE 84 // BIGORBIT1
 {
  ifvarand sector[temp].floorstat 1 // if the ceiling is paralaxxed
  {

   ifvarand CHEATBITFIELD? 32 nullop else
   {
    ifvare sector[temp].floorpal 0 setvar INSTANTDEATH 1
   }

  }
 }

 ifvare PLAYERFLOORTILE 5385 // NEWFLOORSLIME
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 1
      state player_do_floorslime_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_floorslime_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 5388 // NEWHURTRAIL
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 2
      state player_do_hurtrail_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_hurtrail_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 5389 // NEWFLOORPLASMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 1 addvar tempg 2
    subvarvar freezetimer tempg
    state checkfreezetimer_heatratio
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 3
      state player_do_floorplasma_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_floorplasma_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 5395 // NEWPURPLELAVA
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare player[THISACTOR].spritebridge 0
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     setvar FLOORDAMAGETYPE? 4
     state player_do_purplelava_checks1_f
    }
    else
    {
     state player_do_purplelava_checks2
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 3780 // HOTLAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 2 addvar tempg 5
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 6
      state player_do_hotlava_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_hotlava_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 3796 // AMOEBAACID
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 5
      state player_do_amoebaacid_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_amoebaacid_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 4091 // MEGALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 8 addvar tempg 17
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 7
      state player_do_megalava_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_megalava_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 5401 // ULTRALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 20 addvar tempg 41
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 8
      state player_do_ultralava_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_ultralava_checks2
     }
    }
   }
  }
 }
 else
 ifvare PLAYERFLOORTILE 5443 // HYPERMAGMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 80 addvar tempg 161
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar FLOORDAMAGETYPE? 8
      state player_do_hypermagma_checks1_f
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_hypermagma_checks2
     }
    }
   }
  }
 }
}


//**************************************************************************************
//*Damagefloor Emulation to allow special damage properties without a specfic floortile*
//**************************************************************************************
{

getactor[THISACTOR].sectnum temp
ifvare sector[PLAYERSECTOR].lotag 2 // Being in water should make the emulation damage throughout the whole vertical plane of the sector
{
 ifvare actorvar[temp].SECTOREXTRA 5385 // NEWFLOORSLIME
 {
   ifvare CANDMGFLOOR? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     setvar EMUCEILINGDAMAGETYPE? 1
     state player_do_floorslime_checks1_ec
    }
    else
    {
     state player_do_floorslime_checks2
    }
   }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5388 // NEWHURTRAIL
 {
   ifvare CANDMGFLOOR? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     setvar EMUCEILINGDAMAGETYPE? 2
     state player_do_hurtrail_checks1_ec
    }
    else
    {
     state player_do_hurtrail_checks2
    }
   }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5389 // NEWFLOORPLASMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 1 addvar tempg 2
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar EMUCEILINGDAMAGETYPE? 3
    state player_do_floorplasma_checks1_ec
   }
   else
   {
    state player_do_floorplasma_checks2
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5395 // NEWPURPLELAVA
 {
   ifvare CANDMGFLOOR? 1
   {
    ifvare player[THISACTOR].spritebridge 0
    {
     state dmgflr-checkinvulntime
     ifvarl tempf 1
     {
      setvar EMUCEILINGDAMAGETYPE? 4
      state player_do_purplelava_checks1_ec
     }
     else
     {
      state player_do_purplelava_checks2
     }
    }
   }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 3780 // HOTLAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 2 addvar tempg 5
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar EMUCEILINGDAMAGETYPE? 6
    state player_do_hotlava_checks1_ec
   }
   else
   {
    state player_do_hotlava_checks2
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 3796 // AMOEBAACID
 {
  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar EMUCEILINGDAMAGETYPE? 5
    state player_do_amoebaacid_checks1_ec
   }
   else
   {
    state player_do_amoebaacid_checks2
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 4091 // MEGALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 8 addvar tempg 17
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar EMUCEILINGDAMAGETYPE? 7
    state player_do_megalava_checks1_ec
   }
   else
   {
    state player_do_megalava_checks2
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5401 // ULTRALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 20 addvar tempg 41
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar EMUCEILINGDAMAGETYPE? 8
    state player_do_ultralava_checks1_ec
   }
   else
   {
    state player_do_ultralava_checks2
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5443 // HYPERMAGMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 80 addvar tempg 161
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   state dmgflr-checkinvulntime
   ifvarl tempf 1
   {
    setvar EMUCEILINGDAMAGETYPE? 8
    state player_do_hypermagma_checks1_ec
   }
   else
   {
    state player_do_hypermagma_checks2
   }
  }
 }
}
else // If it is not an underwater sector, treat it like a normal damagefloor-type
{
 ifvare actorvar[temp].SECTOREXTRA 5385 // NEWFLOORSLIME
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 1
      state player_do_floorslime_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_floorslime_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5388 // NEWHURTRAIL
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 2
      state player_do_hurtrail_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_hurtrail_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5389 // NEWFLOORPLASMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 1 addvar tempg 2
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 3
      state player_do_floorplasma_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_floorplasma_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5395 // NEWPURPLELAVA
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare player[THISACTOR].spritebridge 0
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     setvar EMUFLOORDAMAGETYPE? 4
     state player_do_purplelava_checks1_ef
    }
    else
    {
     state player_do_purplelava_checks2
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 3780 // HOTLAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 2 addvar tempg 5
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 6
      state player_do_hotlava_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_hotlava_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 3796 // AMOEBAACID
 {
  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 5
      state player_do_amoebaacid_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_amoebaacid_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 4091 // MEGALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 8 addvar tempg 17
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 7
      state player_do_megalava_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_megalava_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5401 // ULTRALAVA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 20 addvar tempg 41
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 8
      state player_do_ultralava_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_ultralava_checks2
     }
    }
   }
  }
 }
 else
 ifvare actorvar[temp].SECTOREXTRA 5443 // HYPERMAGMA
 {
  state dmgflr-checkinvulntime
  ifvarl tempf 1
  {
   ifvare VEHICLEID -1 ifvarg freezetimer 0
   {
    randvar tempg 80 addvar tempg 161
    state checkfreezetimer_heatratio
    subvarvar freezetimer tempg
    ifvarl freezetimer 0 setvar freezetimer 0
   }
  }

  ifvare CANDMGFLOOR? 1
  {
   ifvare CANDMGFLOOR3? 1
   {
    state dmgflr-checkinvulntime
    ifvarl tempf 1
    {
     ifvare CANDMGFLOOR2? 1
     {
      setvar EMUFLOORDAMAGETYPE? 8
      state player_do_hypermagma_checks1_ef
     }
    }
    else
    {
     ifvare CANDMGFLOOR2? 1
     {
      state player_do_hypermagma_checks2
     }
    }
   }
  }
 }
}

} // End of Emulation state

findnearsprite RPG 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite RPG_NOAIM 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite GENERAL_RPG 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite COMMANDER_RPG 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite LEADER_RPG 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite BAALO_RPG 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite OCTANINE_RPG 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite GATEMISSILE_MAIN 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite GATEMISSILE_SPLIT 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite STROKEMISSILE_MAIN 1536 TEMPVAR5
ifvare TEMPVAR5 -1 findnearsprite STROKEMISSILE_SPLIT 1536 TEMPVAR5
ifvarn TEMPVAR5 -1
{
 getactor[TEMPVAR5].owner temp
 ifvarvarn temp THISACTOR
 {
  state projectilehitscan
  ifvarvarn hitsprite THISACTOR { ifvare mainmenu 0 soundonce WHOOSH }
 }
}

ifp pdead nullop else state stepsoundstuff_player

ifvarl LEVELUPTIMER 65 ifvarg LEVELUPTIMER 56 palfrom 24 64 64
ifvarl LEVELUPTIMER 57 ifvarg LEVELUPTIMER 48 palfrom 21 64 64
ifvarl LEVELUPTIMER 49 ifvarg LEVELUPTIMER 40 palfrom 18 64 64
ifvarl LEVELUPTIMER 41 ifvarg LEVELUPTIMER 32 palfrom 15 64 64
ifvarl LEVELUPTIMER 33 ifvarg LEVELUPTIMER 24 palfrom 12 64 64
ifvarl LEVELUPTIMER 25 ifvarg LEVELUPTIMER 16 palfrom 9 64 64
ifvarl LEVELUPTIMER 17 ifvarg LEVELUPTIMER 8 palfrom 6 64 64
ifvarl LEVELUPTIMER 9 ifvarg LEVELUPTIMER 0 palfrom 3 64 64
ifvarg LEVELUPTIMER 0 subvar LEVELUPTIMER 1

setvarvar TEMPVAR2 PLAYERMOVEPLUSVEL
divvar TEMPVAR2 100

setvarvar TEMPVAR3 PLAYERMOVEMINUSVEL
divvar TEMPVAR3 100

ifvarn sector[PLAYERSECTOR].lotag 2
{
 ifvarvarg posxv TEMPVAR3
 {
  ifvarvarl posxv TEMPVAR2
  {
   ifvarvarg posyv TEMPVAR3
   {
    ifvarvarl posyv TEMPVAR2
    {
     setvar BREATHCAMERAFX 1
    }
    else setvar BREATHCAMERAFX 0
   }
   else setvar BREATHCAMERAFX 0
  }
  else setvar BREATHCAMERAFX 0
 }
 else setvar BREATHCAMERAFX 0
}
else setvar BREATHCAMERAFX 0

ifvare BREATHCAMERAFX 1 ifvarn oldskoolmode 1
{
 addvar BREATHCAMERATIMER 1

 setvarvar TEMPVAR5 CURRENTHITPOINTS
 mulvar TEMPVAR5 1000
 divvarvar TEMPVAR5 MAXHITPOINTS

 ifvarg TEMPVAR5 750
 {
  ifvarg BREATHCAMERATIMER 47 setvar BREATHCAMERATIMER 0
 }
 else
 ifvarg TEMPVAR5 500 ifvarl TEMPVAR5 751
 {
  ifvarg BREATHCAMERATIMER 43 setvar BREATHCAMERATIMER 0
 }
 else
 ifvarg TEMPVAR5 250 ifvarl TEMPVAR5 501
 {
  ifvarg BREATHCAMERATIMER 39 setvar BREATHCAMERATIMER 0
 }
 else
 ifvarg TEMPVAR5 100 ifvarl TEMPVAR5 251
 {
  ifvarg BREATHCAMERATIMER 35 setvar BREATHCAMERATIMER 0
 }
 else
 ifvarl TEMPVAR5 101
 {
  ifvarl CURRENTHITPOINTS 1 setvar BREATHCAMERATIMER 0
  else
  {
   ifvarg BREATHCAMERATIMER 31 setvar BREATHCAMERATIMER 0
  }
 }
}
else setvar BREATHCAMERATIMER 0

ifvare mainmenu 1 palfrom 0 0 0 0

state slipperycode_players getplayer[THISACTOR].posxv oposxv getplayer[THISACTOR].posyv oposyv
 
setvar MISCARRAYID 62 // NUMBER-OF-PARTY-DEAD
getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
setvarvar MISCARRAYID_AMOUNTTEMP PARTYSIZE
subvarvar MISCARRAYID_AMOUNTTEMP PARTYALIVE
setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP

//***************************************************************
//*NO EXTRA CODE BEYOND THIS LINE, PUT ALL OF IT ABOVE THIS LINE*
//***************************************************************

  ifaction 0 state setplayeraction_pstand

  ifaction PFROZEN
  {
    setactor[THISACTOR].htpicnum SHOTSPARK1
    cstat 257

    fall

    palfrom 16 0 0 24

    ifmove 0
    {
      ifhitweapon
      {
        ifwasweapon FREEZEBLAST { state freezeblast_frozen-player break }
        setactor[PLAYERID].htpicnum -1
        lotsofglass 60
        ifrnd 84 { espawn NEWBLOODPOOL setactor[RETURN].cstat 34 setactor[RETURN].pal 1 }

        ifvarl PARTYALIVE 1 
        {
         state gameover
         state resetplayeritems 
        }

        sound GLASS_BREAKING // Player's Ice-Breaking
        ifvarg PARTYALIVE 0 
        { 
         ifvare CHARACTERSELECTED? 3
         {
          state checkbubsylives
          ifvarg ITEMARRAYID_AMOUNTTEMP 0
          {
           setactor[PLAYERID].extra 16384
           state setplayeraction_pstand
           state unfreeze
           setvarvar CURRENTHITPOINTS MAXHITPOINTS
           setvarvar AIRTIME MAXAIRTIME
           state checkbubsylives subvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount
           setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
           redefinequote 321 ^2BUBSY LOSES ONE LIFE!!
           setvarvar fta fta_normal setvar ftq 321
          }
          else
          {
           setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
           ifvarl MISCARRAYID_AMOUNTTEMP 26 
           { 
            state switchtolivingcharacter 
            state setplayeraction_pstand
            state unfreeze
            setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
           } 
          }
         }
         else
         {
          setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
          ifvarl MISCARRAYID_AMOUNTTEMP 26 
          { 
           state switchtolivingcharacter 
           state setplayeraction_pstand
           state unfreeze
           setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
          } 
         }
        }

        move 1
        break
      }
    }
    else
    {
      ifvarl PARTYALIVE 1
      {
       setvar gameover? 1
       cstat 32768
       setvarvar fta fta_normal setvar ftq 13
       ifhitspace
       {
        ifvarg gameover? 0
        {
         state setplayeraction_pstand
         state gameover
        }
       }
      }
      break
    }

    state actorcheck_frozentimer
    ifvarl FROZENTIMER 1 // ifactioncount THAWTIME
    {
      state unfreeze
      move 0
      state setplayeraction_pstand
    }
    else
    {
     ifvarl FROZENTIMER 39 // ifactioncount FROZENDRIPTIME
     {
      ifrnd 32
      spawn WATERDRIP
     }
    }

    ifp pfacing   // assumes another other player  (multiplayer)
      ifpdistl FROZENQUICKKICKDIST
        pkick

    break
  }

  ifdead
  {
    ifaction PGROWING
    {
      ifmove PGROWINGPOP
      {
       ifvarl PARTYALIVE 1
       {
        setvar gameover? 1
        setvarvar fta fta_normal setvar ftq 13
        ifhitspace
        {
         ifvarg gameover? 0
         {
          action 0
          state gameover
         }
        }
       }
       break
      }
      else
      {
        ifcount 32
        {
          sound SQUISHED
          palfrom 48 64

          state standard_pjibs

          guts JIBS4 20
          guts JIBS6 20
          move PGROWINGPOP
          cstat 32768
          // tossweapon
          hitradius 2048 60 70 80 90

        }
        else
          sizeto MAXXSTRETCH MAXYSTRETCH
      }
      break
    }

    ifsquished
     palfrom 32 63 63 63
    else
      fall

    ifactioncount 7
      move 0
    else
      ifactioncount 6
    {
      ifmultiplayer nullop
      else
      {
       ifrnd 240
       { 
        state resetplayeritems
        ifcount 20
        { 
         ifvarl PARTYALIVE 1 
         { 
          setvar gameover? 1
          state randomdeathtaunt 
         } 
         resetcount 
        }
       }
       else
       {
        ifvare CHARACTERSELECTED? 1
        {
         ifrnd 53
          sound DUKE_KILLED5
         else
          ifrnd 64
            sound DUKE_KILLED3
         else
          ifrnd 85
            sound DUKE_KILLED1
         else
          ifrnd 128
            sound DUKE_KILLED2
        }
       }
      }
    }

    ifaction PLYINGDEAD
    {
      ifactioncount 3
        move PSTOPED
      ifvarl PARTYALIVE 1
      {
       setvar gameover? 1
/*
       ifvare TAUNT? 0 
       { 
        ifvare gameovertransitiontimer 13 { state randomdeathtaunt setvar TAUNT? 1 }         
       }
*/
       ifvare gameovertransitiontimer 13 state randomdeathtaunt         
       setvarvar fta fta_normal setvar ftq 13
       ifhitspace
       {
        ifvarg gameover? 0
        {        
         state gameover
         state setplayeraction_pstand
        }
       }
      }
      break
    }

    ifaction PTHROWNBACK
    {
      ifactioncount 5
      {
        espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34
        action PLYINGDEAD
      }
      else
        ifactioncount 1
          move 0
      break
    }

    ifaction PEXPLODEAD
    {
      ifvarl PARTYALIVE 1
      {
       setvar gameover? 1
       setvarvar fta fta_normal setvar ftq 13
       ifhitspace
       {
        ifvarg gameover? 0
        {
         state gameover
         state setplayeraction_pstand
        }
       }
      }
      break
    }
    ifaction PEXPLODE
    {
      ifactioncount 5
      {
        action PEXPLODEAD
        espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34
      }
      break
    }


    ifp pshrunk
    {
      state standard_pjibs
      espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34

      sound SQUISHED
      ifvare CHARACTERSELECTED? 1 sound DUKE_DEAD
      ifvare CHARACTERSELECTED? 5 sound WANG_SCREAM

      cstat 32768         // Hide the sprite

      action PLYINGDEAD
    }
    else
    {
      ifinwater
      {
        action PLYINGDEAD
        ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds
        ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds
      }
      else
      {
        action PEXPLODE
        state standard_pjibs
        cstat 32768
        sound SQUISHED
        ifvare CHARACTERSELECTED? 1 sound DUKE_DEAD
        ifvare CHARACTERSELECTED? 5 sound WANG_SCREAM
      }
    }

    // tossweapon

    break
  }

  ifsquished
  {
    strength -1
    sound SQUISHED
    state random_ooz
    break
  }

  ifp ponsteroids
  {
    ifp pstanding nullop
    else
      spawn FRAMEEFFECT1
  }

  ifmove PSHRINKING
  {
    ifcount 32
    {
      ifcount SHRUNKDONECOUNT
      {
        move 0
        cstat 257
      }
      else
        ifcount SHRUNKCOUNT
      {
        setvar SHRUNK? 0
        setactor[THISACTOR].htpicnum SHOTSPARK1
        sizeto 42 36
        ifgapzl 24
        {
          strength 0
          sound SQUISHED
          palfrom 48 64
          break
        }
      }
      else
        ifp ponsteroids
          count SHRUNKCOUNT
    }
    else
    {
      ifp ponsteroids
        count SHRUNKCOUNT
      else
      {
        sizeto 8 9
        spawn FRAMEEFFECT1
      }
    }
  }
  else ifhitweapon
  {
    ifdead
    {
/*
      ifmultiplayer
      {
       ifvare CHARACTERSELECTED? 1 { sound DUKE_KILLED4 }
      }
*/
      ifwasweapon GROWSPARK
      {
        palfrom 48 48
        action PGROWING
        count 0

        move 0
        sound ACTOR_GROWING
        cstat 0
        break
      }
    }
    else
    {
/*
      ifmultiplayer
      {        
       ifvarg INVULNTIME 0
       {
        stopsound PISTOL_BODYHIT
       }
       else
       ifvarl PLAYERDAMAGE 1
       {
        stopsound PISTOL_BODYHIT
        ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1 ifvare ENERGYSHIELDMODE 1 ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0 nullop else sound NODAMAGE
       }
       else
       {
        setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
        ifvarl MISCARRAYID_AMOUNTTEMP 251
        {
         ifvare CHARACTERSELECTED? 1
         {
          ifrnd 64
            sound DUKE_LONGTERM_PAIN2
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN3
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN4
          else
            sound DUKE_DEAD
         }
         else
         ifvare CHARACTERSELECTED? 5
         {
          ifrnd 64
            sound WANG_LONGTERM_PAIN1
          else ifrnd 64
            sound WANG_LONGTERM_PAIN2
          else ifrnd 64
            sound WANG_LONGTERM_PAIN3
          else
            sound WANG_LONGTERM_PAIN4
         }
        }
        else
        {
         ifvare CHARACTERSELECTED? 1
         {
          ifrnd 64
            sound DUKE_LONGTERM_PAIN5
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN6
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN7
          else
            sound DUKE_LONGTERM_PAIN8
         }
         else
         ifvare CHARACTERSELECTED? 5
         {
          ifrnd 64
            sound WANG_LONGTERM_PAIN5
          else ifrnd 64
            sound WANG_LONGTERM_PAIN6
          else ifrnd 64
            sound WANG_LONGTERM_PAIN7
          else
            sound WANG_LONGTERM_PAIN8
         }
        }
       }
      }
*/
       ifvarg INVULNTIME 0 stopsound PISTOL_BODYHIT
       else ifvarl PLAYERDAMAGE 1
       {
        stopsound PISTOL_BODYHIT
        ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1 ifvare ENERGYSHIELDMODE 1 ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0 nullop else sound NODAMAGE
       }
       else
       {
        setvarvar PAINSOUNDFACTOR PLAYERDAMAGE
        ifwasweapon SHRINKER setvar PAINSOUNDFACTOR -1
        else ifwasweapon SHRINKSPARK setvar PAINSOUNDFACTOR -1
        state checkpainfactor

        ifvarn VEHICLEID -1
        {
         ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
         {
          stopsound PISTOL_BODYHIT
          sound LANDMETAL_HEAVY
         }
        }
        else
        {
         ifvare CHARACTERSELECTED? 1 state dukepainsounds // Duke
         else ifvare CHARACTERSELECTED? 5 state lowangpainsounds // Lo Wang
         else ifvare CHARACTERSELECTED? 8 state lisapainsounds // Lisa
         else ifvare CHARACTERSELECTED? 15 state makenpainsounds // Maken
        }
       }
    }
    ifstrength TOUGH
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       state headhitstate
       ifvare CHARACTERSELECTED? 1 sound DUKE_GRUNT
       ifp pstanding action PFLINTCHING
      }
    }

    ifwasweapon RPG
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon RPG_NOAIM
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon OCTANINE_RPG
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon GENERAL_RPG
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon COMMANDER_RPG
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon LEADER_RPG
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon BAALO_RPG
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon GATEMISSILE_MAIN
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon GATEMISSILE_SPLIT
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon STROKEMISSILE_MAIN
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon STROKEMISSILE_SPLIT
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon RADIUSEXPLOSION
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
    ifwasweapon FIREEXT
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else
      {
       ifrnd 32
        spawn BLOOD
       ifdead
        state standard_pjibs
       palfrom 48 52
       break
      }
    }
// Start Customized Weapon hits
    ifwasweapon SHOTGUN
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
    }
    ifwasweapon CHAINGUN
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
    }
    ifwasweapon HEAVYHBOMB
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
    }
    ifwasweapon MORTER
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
    }
    ifwasweapon SPIT
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
    }
    ifwasweapon SEENINE
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
    }
    ifwasweapon ZAPPER1
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else ifvarg PLAYERDAMAGE 0
      {
        sound SHORT_CIRCUIT
        palfrom 32 32 0 0 
      }
    }
    ifwasweapon ZAPPER2
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else ifvarg PLAYERDAMAGE 0
      {
       sound SHORT_CIRCUIT
       palfrom 32 32 0 0 
      }
    }
    ifwasweapon ZAPPER3
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else ifvarg PLAYERDAMAGE 0
      {
       sound SHORT_CIRCUIT
       palfrom 32 32 0 0 
      }
    }
// End Customized Weapon hits
    ifwasweapon GROWSPARK
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else ifvarg PLAYERDAMAGE 0
      {
       palfrom 48 52
       sound EXPANDERHIT
       break
      }
    }
    ifwasweapon SHRINKSPARK
    {
      ifvarg INVULNTIME 0     
      {
       state invulnflash 
       state deflectshrinker 
      }
      else
      {
       ifvare CHARACTERSELECTED? 8
       {
        ifvare HAVEENERGYSHIELD? 1 
        {
         ifvare ENERGYSHIELDMODE 1 
         {
          ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
          {
           ifvarl CURRENTCELLS 1 setvar DAMAGEINCELL 0 else subvar CURRENTCELLS 1
           state deflectshrinker
          }
          else state playershrink
         }
         else state playershrink
        }
        else state playershrink
       }
       else state playershrink
      }
    }
    ifwasweapon SHRINKER
    {
      ifvarg INVULNTIME 0     
      {
       state invulnflash 
       state deflectshrinker 
      }
      else
      {
       ifvare CHARACTERSELECTED? 8
       {
        ifvare HAVEENERGYSHIELD? 1 
        {
         ifvare ENERGYSHIELDMODE 1 
         {
          ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
          {
           ifvarl CURRENTCELLS 1 setvar DAMAGEINCELL 0 else subvar CURRENTCELLS 1
           state deflectshrinker
          }
          else state playershrink
         }
         else state playershrink
        }
        else state playershrink
       }
       else state playershrink
      }
    }
    ifwasweapon SHOTSPARK1
    {
     ifvarg INVULNTIME 0 state invulnflash
     else ifvarl PLAYERDAMAGE 1 state nullflash
     else palfrom 24 48
    }
    ifwasweapon FREEZEBLAST
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
//      else palfrom 48 0 0 48

      ifp pdead // ifp pdead
      {
       state freezeup
       state frosty 
       spritepal 1
       move 0
       action PFROZEN
       break
      }
    }
    ifwasweapon COOLEXPLOSION1
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else palfrom 48 48 0 48
    }
    ifwasweapon KNEE
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else palfrom 16 32
    }
    ifwasweapon FIRELASER
    {
      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else palfrom 32 32
    }
    ifdead
    {
      action PTHROWNBACK
      // tossweapon
    }

      ifvarg INVULNTIME 0 state invulnflash
      else ifvarl PLAYERDAMAGE 1 state nullflash
      else state random_wall_jibs

    break
  }

  ifaction PFLINTCHING
  {
    ifactioncount 2 state setplayeraction_pstand
    break
  }

  ifinwater
  {
    ifaction PTREDWATER
    {
     ifp pwalking prunning
     {
      state setplayeraction_pswimminggo
     }
    }
    else
    ifp pstanding pwalkingback prunningback
    {
     state setplayeraction_ptredwater
    }
    else
    {
     ifaction PSWIMMING
     {
      ifrnd 4 { ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds }
      ifactioncount 4
      {
       state setplayeraction_pswimmingwait
      }
     }
     else
     ifaction PSWIMMINGWAIT
     {
      ifactioncount 2
      {
       state setplayeraction_pswimminggo
      }
     }
     else
     ifaction PSWIMMINGGO
     {
      ifactioncount 2
      {
       state setplayeraction_pswimming
      }
     }
     else
     {
      state setplayeraction_ptredwater
     }
    }

    ifrnd 4 { ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds } // For effect

    break
  }
  else ifp pjetpack
  {
   ifaction PJPHOUVER
   {
    ifactioncount 4 resetactioncount
   }
   else
   {
    state setplayeraction_pjphouver
   }
   break
  }
  else
  {
   ifaction PTREDWATER
   {
    state setplayeraction_pstand
   }
   ifaction PSWIMMING
   {
    state setplayeraction_pstand
   }
   ifaction PSWIMMINGWAIT
   {
    state setplayeraction_pstand
   }
   ifaction PSWIMMINGGO
   {
    state setplayeraction_pstand
   }
   ifaction PJPHOUVER
   {
    state setplayeraction_pfalling
   }
  }

  ifaction PFALLING
  {
   state STOPSTEPSOUNDS_PLAYER
   ifp ponground
   {
    state setplayeraction_pstand
    state landsounds_player
   }
   else
   {
    ifp pfalling break else state check_pstandard
   }
  }

  ifaction PDUCKING
  {
   state STOPSTEPSOUNDS_PLAYER
   ifgapzl 48
   {
    ifp pwalking pwalkingback prunning prunningback
    {
     state setplayeraction_pcrawling
    }
   }
   else ifp pducking
   {
    ifp pwalking pwalkingback prunning prunningback
    {
     state setplayeraction_pcrawling
    }
   }
   else
   {
    ifp pstanding
    {
     state setplayeraction_pstand
    }
    else
    {
     state check_pstandard
    }
   }
  }

  else ifaction PCRAWLING
  {
   state STOPSTEPSOUNDS_PLAYER
   ifgapzl 48
   {
    ifp pstanding
    {
     state setplayeraction_pcrawling
    }
   }
   else
   ifp pducking
   {
    ifp pstanding
    {
     state setplayeraction_pducking
    }
   }
   else
   {
    ifp pstanding
    {
     state setplayeraction_pstand
    }
    else
    {
     state check_pstandard
    }
   }
  }
  else
  ifgapzl 48
  {
   state setplayeraction_pducking
  }

  else
  ifaction PJUMPING
  {
   state STOPSTEPSOUNDS_PLAYER
   ifp ponground
   {
    state setplayeraction_pstand
   }
   else
   ifactioncount 4
   {
    ifp pfalling
    {
     state setplayeraction_pfalling
    }
   }
  }

  ifp pfalling
  {
   state setplayeraction_pfalling
  }
  else
  ifaction PSTAND
  {
   state check_pstandard
  }

  else
  ifaction PAKICKING
  {
   ifactioncount 2
   {
    state setplayeraction_pstand
   }
   break
  }

  else
  ifaction PWALK
  {
   ifp pfalling
   {
    state setplayeraction_pfalling
   }
   else
   ifp pstanding
   {
    state setplayeraction_pstand
   }
   else
   ifp prunning
   {
    state setplayeraction_prun
   }
   else
   ifp pwalkingback
   {
    state setplayeraction_pwalkback
   }
   else
   ifp prunningback
   {
    state setplayeraction_prunback
   }
   else
   ifp pjumping
   {
    state setplayeraction_pjumping
   }
   else
   ifp pducking
   {
    state setplayeraction_pducking
   }
  }

  else
  ifaction PRUN
  {
   ifp pstanding
   {
    state setplayeraction_pstand
   }
   else
   ifp pwalking
   {
    state setplayeraction_pwalk
   }
   else
   ifp pwalkingback
   {
    state setplayeraction_pwalkback
   }
   else
   ifp prunningback
   {
    state setplayeraction_prunback
   }
   else
   ifp pjumping
   {
    state setplayeraction_pjumping
   }
   else
   ifp pducking
   {
    state setplayeraction_pducking
   }
  }

  else
  ifaction PWALKBACK
  {
   ifp pstanding
   {
    state setplayeraction_pstand
   }
   else
   ifp pwalking
   {
    state setplayeraction_pwalk
   }
   else
   ifp prunning
   {
    state setplayeraction_prun
   }
   else
   ifp prunningback
   {
    state setplayeraction_prunback
   }
   else
   ifp pjumping
   {
    state setplayeraction_pjumping
   }
   else
   ifp pducking
   {
    state setplayeraction_pducking
   }
  }

  else
  ifaction PRUNBACK
  {
   ifp pstanding
   {
    state setplayeraction_pstand
   }
   else
   ifp pwalking
   {
    state setplayeraction_pwalk
   }
   else
   ifp prunning
   {
    state setplayeraction_prun
   }
   else
   ifp pwalkingback
   {
    state setplayeraction_pwalkback
   }
   else
   ifp pjumping
   {
    state setplayeraction_pjumping
   }
   else
   ifp pducking
   {
    state setplayeraction_pducking
   }
  }

// Riot Tank

  else
  ifaction PTANKWAIT
  {
   ifvare VEHICLEID -1
   {
    ifp pstanding
    {
     state setplayeraction_pstand
    }
    else
    ifp pwalking
    {
     state setplayeraction_pwalk
    }
    else
    ifp prunning
    {
     state setplayeraction_prun
    }
    else
    ifp pwalkingback
    {
     state setplayeraction_pwalkback
    }
    else
    ifp pjumping
    {
     state setplayeraction_pjumping
    }
    else
    ifp pducking
    {
     state setplayeraction_pducking
    }
   }
  }

enda

