state freezecode_player
	ifvare mainmenu 0
	{
		ifvarand CHEATBITFIELD? 32
		{
			ifvarg freezetimer 0 { randvar tempb 2 addvar tempb 1 subvarvar freezetimer tempb }
			ifvarl freezetimer 0 setvar freezetimer 0
		}
		else
		{
			ifvarl INVULNTIME 1
			{
				ifvare VEHICLEID -1
				{
					setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
					ifvarl MISCARRAYID_AMOUNTTEMP 1
					{
						setvarvar tempe freezing
						ifvarl tempe 1 setvar tempe 1
			
						// Checks if you're outside, inside, underwater, sitting in water, etc
						ifoutside
						{
							ifvare WATER? 1 // 240%
							{
								getactor[THISACTOR].sectnum temp
								getsector[temp].floorpicnum TEMPVAR3
								ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
								else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
								else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
								else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
								else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
								else
								{
									getactor[THISACTOR].sectnum temp
									getsector[temp].hitag TEMPVAR3
									ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
									else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
									else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
									else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
									else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
									else
									{
										mulvar tempe 12
										divvar tempe 5
									}
								}
							}
							else
							ifvare WATER? 2 // 560%
							{
								getactor[THISACTOR].sectnum temp
								getsector[temp].ceilingpicnum TEMPVAR3
								ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
								else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
								else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
								else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
								else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
								else
								{
									getactor[THISACTOR].sectnum temp
									getsector[temp].hitag TEMPVAR3
									ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
									else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
									else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
									else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
									else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
									else
									{
										mulvar tempe 28
										divvar tempe 5
									}
								}
							}
							else // 100%
							{
								mulvar tempe 5
								divvar tempe 5
							}
							ifvarl tempe 1 setvar tempe 1
						}
						else
						{
							ifvare WATER? 1 // 240%
							{
								getactor[THISACTOR].sectnum temp
								getsector[temp].floorpicnum TEMPVAR3
								ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
								else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
								else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
								else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
								else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
								else
								{
									getactor[THISACTOR].sectnum temp
									getsector[temp].hitag TEMPVAR3
									ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
									else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
									else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
									else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
									else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
									else
									{
										mulvar tempe 12
										divvar tempe 5
									}
								}
							}
							else
							ifvare WATER? 2 // 560%
							{
								getactor[THISACTOR].sectnum temp
								getsector[temp].ceilingpicnum TEMPVAR3
								ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
								else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
								else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
								else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
								else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
								else
								{
									getactor[THISACTOR].sectnum temp
									getsector[temp].hitag TEMPVAR3
									ifvare TEMPVAR3 NEWFLOORPLASMA mulvar tempe 0
									else ifvare TEMPVAR3 HOTLAVA mulvar tempe 0
									else ifvare TEMPVAR3 MEGALAVA mulvar tempe 0
									else ifvare TEMPVAR3 ULTRALAVA mulvar tempe 0
									else ifvare TEMPVAR3 HYPERMAGMA mulvar tempe 0
									else
									{
										mulvar tempe 28
										divvar tempe 5
									}
								}
							}
							else // 25%
							{
								mulvar tempe 1
								divvar tempe 4
							}
						}
						ifvarg winterclothes 0
						{
							setvar tempc 95
							mulvarvar tempc winterclothes
							divvar tempc 100
				
							setvar tempb 100
							subvarvar tempb tempc
				
							mulvarvar tempe tempb
							divvar tempe 100
						}
			
						// Character conditionals
						ifvare CHARACTERSELECTED? 3
						{
							setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
							ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar tempe 50 divvar tempe 100 } // -50% Ice damage w/ Diving Suit on
						}
					
						ifvare PLAYEREQUIPSLOTITEM1 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM2 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM3 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM4 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM5 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM6 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM7 28 divvar tempe 10
						ifvare PLAYEREQUIPSLOTITEM8 28 divvar tempe 10
						ifvarl tempe 1
						{
							setvarvar RNDMIZERLIMIT freezing
							ifvare PLAYEREQUIPSLOTITEM1 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM2 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM3 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM4 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM5 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM6 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM7 28 divvar RNDMIZERLIMIT 10
							ifvare PLAYEREQUIPSLOTITEM8 28 divvar RNDMIZERLIMIT 10
							ifvarg winterclothes 0
							{
								mulvar RNDMIZERLIMIT -4 addvar RNDMIZERLIMIT 256
								ifvarl RNDMIZERLIMIT 0 setvar RNDMIZERLIMIT 0 ifvarg RNDMIZERLIMIT 256 setvar RNDMIZERLIMIT 256
								mulvarvar RNDMIZERLIMIT winterclothes
								divvar RNDMIZERLIMIT 100
								state rndmizer256
				
								ifvarvarg RNDMIZER RNDMIZERLIMIT setvar tempe 1
								else
								{
									setvar tempe 0
									setvar RNDMIZERLIMIT 20
									mulvarvar RNDMIZERLIMIT winterclothes
									divvar RNDMIZERLIMIT 100
									addvar RNDMIZERLIMIT 5
									mulvar RNDMIZERLIMIT -1
									addvar RNDMIZERLIMIT 256
									ifvarl RNDMIZERLIMIT 0 setvar RNDMIZERLIMIT 0 ifvarg RNDMIZERLIMIT 256 setvar RNDMIZERLIMIT 256
									state rndmizer256
									ifvarvarg RNDMIZER RNDMIZERLIMIT { subvar freezetimer 1 ifvarl freezetimer 0 setvar freezetimer 0 }
								}
							}
							else
							{
								mulvar RNDMIZERLIMIT -40 addvar RNDMIZERLIMIT 256
								ifvarl RNDMIZERLIMIT 0 setvar RNDMIZERLIMIT 0 ifvarg RNDMIZERLIMIT 256 setvar RNDMIZERLIMIT 256
								state rndmizer256
				
								ifvarvarg RNDMIZER RNDMIZERLIMIT setvar tempe 1
								else
								{
									setvar tempe 0					
									ifrnd 5 { subvar freezetimer 1 ifvarl freezetimer 0 setvar freezetimer 0 }
								}
							}
						}
			
						// Sound Checks dependant on Freezing Strength
						ifvarg freezing 76
						{
							ifoutside ifvarn WATER? 2
							{
								soundonce WIND_AMBIENCE_NR1
								ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
								ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
								ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
							}
							else
							{
								ifvarn WATER? 2
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									soundonce WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
								else
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
							}
						}
						else ifvarg freezing 40 ifvarl freezing 77
						{
							ifoutside ifvarn WATER? 2
							{
								ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
								soundonce WIND_AMBIENCE_NR2
								ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
								ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
							}
							else
							{
								ifvarn WATER? 2
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									soundonce WIND_AMBIENCE_NR4
								}
								else
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
							}
						}
						else ifvarg freezing 16 ifvarl freezing 41
						{
							ifoutside ifvarn WATER? 2
							{
								ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
								ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
								ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
								soundonce WIND_AMBIENCE_NR4
							}
							else
							{
								ifvarn WATER? 2
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									soundonce WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
								else
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
							}
						}
						else ifvarg freezing 0 ifvarl freezing 17
						{
							ifoutside ifvarn WATER? 2
							{
								ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
								ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
								soundonce WIND_AMBIENCE_NR3
								ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
							}
							else
							{
								ifvarn WATER? 2
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
								else
								{
									ifsound WIND_AMBIENCE_NR1 stopsound WIND_AMBIENCE_NR1
									ifsound WIND_AMBIENCE_NR2 stopsound WIND_AMBIENCE_NR2
									ifsound WIND_AMBIENCE_NR3 stopsound WIND_AMBIENCE_NR3
									ifsound WIND_AMBIENCE_NR4 stopsound WIND_AMBIENCE_NR4
								}
							}
						}
			
						ifvare FROZEN? 0 addvarvar freezetimer tempe
						state dealfreezedamage-player
					}
				}
				else
				{
					ifvarg freezetimer 0 { randvar tempb 2 addvar tempb 1 subvarvar freezetimer tempb }
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
			else
			{
				ifvarg freezetimer 0 { randvar tempb 2 addvar tempb 1 subvarvar freezetimer tempb }
				ifvarl freezetimer 0 setvar freezetimer 0
			}
		}
	}
ends

// Mantling?

define MANTDIST 384 // 480-384=96
state pythagoras
	// next code gets distance between (x,y) and (hitx,hity), puts result in xydist
	setvarvar temp x
	setvarvar tempb hitx
	
	subvarvar temp tempb
	mulvarvar temp temp
	
	setvarvar tempc y
	setvarvar tempd hity
	
	subvarvar tempc tempd
	mulvarvar tempc tempc
	
	addvarvar temp tempc
	sqrt temp temp
	setvarvar xydist temp
ends

state checkmantlesprite
	ifvarn hitsprite -1
	{
		getactor[hitsprite].picnum picnum
		ifvare picnum 3699 // special mantling sprite
		ifvarl xydist MANTDIST
		setvar EDGEGRAPPLING 1
	}
ends

state checkwall
	setvar EDGEGRAPPLING 0
	// we start by checking for the dreaded slope at feet problem
	getactor[THISACTOR].z z
	getactor[THISACTOR].x x
	getactor[THISACTOR].y y
	getactor[THISACTOR].sectnum mysector
	getactor[THISACTOR].ang angvar
	setvar zdist 0
	cos mycos angvar
	sin mysin angvar
	hitscan x y z mysector mycos mysin zdist hitsector hitwall hitsprite hitx hity hitz clipmask
	state pythagoras
	setvarvar xydist2 xydist // saves the distance
	subvar z 1536
	hitscan x y z mysector mycos mysin zdist hitsector hitwall2 hitsprite hitx hity hitz clipmask
	state pythagoras
	/*
	ifvarn hitsprite -1
	{
		getactor[hitsprite].picnum picnum
		ifvare picnum CRATE2 ifvarl xydist 844
		{
		setvar EDGEGRAPPLING 1 break 
		}
	}
	*/
	
	ifvarn hitwall -1
	ifvarvare hitwall hitwall2 ifvarvarg xydist xydist2 break // it's one of those slopes...
	// Character Reach Z (the value determines how far the character can 'reach up' to grapple/mantle on an edge
	setvarvar TEMPVAR PLAYERHEIGHT
	divvar TEMPVAR 3
	subvarvar z TEMPVAR
	// subvar z 3072 // 1536 // now we do the first "real" hitscan
	// End Character Reach Z
	
	hitscan x y z mysector mycos mysin zdist hitsector hitwall hitsprite hitx hity hitz clipmask
	state pythagoras
	
	ifvarg xydist MANTDIST
	{
		subvar z 3072
		hitscan x y z mysector mycos mysin zdist hitsector hitwall hitsprite hitx hity hitz clipmask
		addvar z 3072
		state checkmantlesprite
		ifvare EDGEGRAPPLING 1 break
		ifvarg xydist MANTDIST break
	}
	ifvarn hitsprite -1
	{
		state checkmantlesprite
		ifvare EDGEGRAPPLING 1 break
		getactor[hitsprite].cstat temp
		ifvarand temp 1 nullop else break // a non-blocking sprite will prevent mantling
	}
	
	//ifvare hitwall -1 ifvarn hitsprite -1 setvarvar hitwall hitsprite // treats sprite as wall
	
	// now a second hitscan to see whether the upper body is above the wall
	
	subvar z 7168
	hitscan x y z mysector mycos mysin zdist hitsector hitwall2 hitsprite hitx hity hitz clipmask
	
	//ifvare hitwall2 -1 ifvarn hitsprite2 -1 setvarvar hitwall2 hitsprite2 // treats sprite as wall
	
	state pythagoras
	state checkmantlesprite
	ifvare INTHEAIR? 0 setvar tempb MANTDIST else setvar tempb 256
	ifvarvarg xydist tempb 
	ifvarvarn hitwall hitwall2
	{
		setvar EDGEGRAPPLING 1
	}
	else
	{
		subvar z 3072
		hitscan x y z mysector mycos mysin zdist hitsector hitwall2 hitsprite hitx hity hitz clipmask
	
		ifvarvare hitwall hitwall2 break
		state pythagoras
		state checkmantlesprite
		ifvare EDGEGRAPPLING 1 break
		ifvarl xydist MANTDIST 
		{
			// there's still the possibility it could be a duct...
			ifvarn hitsprite -1
			{
				getactor[hitsprite].picnum picnum
				ifvare picnum BGRATE1 setvar EDGEGRAPPLING 1
				ifvare picnum FANSPRITEBROKE setvar EDGEGRAPPLING 1
			}
			break
		}
	}
	
	setvar EDGEGRAPPLING 1
ends

state edgegrabbing
	ifp ponground ifvare INTHEAIR? 1 setvar INTHEAIR? 0
	ifvarl EDGEGRAPPLING 0 addvar EDGEGRAPPLING 1
	ifvare EDGEGRAPPLING 1 addvar EDGEGRAPPLEDELAY 1 else setvar EDGEGRAPPLEDELAY 0
	ifvarn ONAWALL? 0 break
	ifvarn VEHICLEID -1 break
	
	ifvare EDGEGRAPPLING 0
	{
		ifvare PLAYERPULLUPSOUND? 1 setvar PLAYERPULLUPSOUND? 0
		getplayer[THISACTOR].posx x
		getplayer[THISACTOR].posy y
		getactor[THISACTOR].z z
		getplayer[THISACTOR].cursectnum mysector
		getflorzofslope mysector x y mz // mz is the return var
		subvarvar mz z // mz is now the distance to the ground
		setvar temp 0
		ifvarl mz 6144 nullop else    
		{
			getplayer[THISACTOR].poszv temp
			ifvare INTHEAIR? 1 setvar tempb 0 else setvar tempb 1536
			ifvarvarg temp tempb
			{
				state checkwall
				ifvare EDGEGRAPPLING 1 
				{
					getplayer[THISACTOR].posz EDGEGRAPPLEZ
					ifvare CHARACTERSELECTED? 1 
					{
						stopsound DUKE_GRUNT
						sound DUKE_GRUNT 
					}
					ifvare CHARACTERSELECTED? 8
					{ 
						stopsound LISA_WALLGRAB
						sound LISA_WALLGRAB 
					}
					ifvare CHARACTERSELECTED? 15 
					{
						stopsound MAKEN_WALLGRAB
						sound MAKEN_WALLGRAB
					}
					wackplayer
					getplayer[THISACTOR].posz z
					subvar z 512
					setplayer[THISACTOR].posz z
					shiftvarr temp 7
					addvar temp 3
					setvarvar EDGEWAITTIME temp
					ifvarg EDGEWAITTIME 40 setvar EDGEWAITTIME 40
				}
			}
		}
	}
	
	ifvarg EDGEGRAPPLING 0
	{
		ifvare mainmenu 0
		{
			ifvarl INVULNTIME 1
			{
				ifvarn CHARACTERSELECTED? 9 // Cybanis has unlimited mantle-strength
				{
					setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
					ifvare MISCARRAYID_AMOUNTTEMP 0
					{
						ifvare EDGEGRAPPLING 1 // Drain at normal rate
						{
							ifp ponsteroids // Triple your Mantling time if using steroids
							{
								setvar TEMPVAR5 334 // Base Drain rate [1000 = 1 tic]
				
								// Character Specfic conditions [sans Cybanis]
								ifvare CHARACTERSELECTED? 3
								{
									setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
									ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvarvar TEMPVAR5 5 divvar TEMPVAR5 4 } // +25% Drain w/ Diving Suit on
								}
				
								// Check for Power Wrist [equippable item]
								setvar DAMAGEMODIFIER 1000
								ifvare PLAYEREQUIPSLOTITEM1 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM2 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM3 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM4 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM5 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM6 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM7 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM8 18 subvar DAMAGEMODIFIER 125
								ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
								mulvarvar TEMPVAR5 DAMAGEMODIFIER
								divvar TEMPVAR5 1000
				
								// Check for Jewel of Four Souls [equippable item]
								ifvare PLAYEREQUIPSLOTITEM1 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM2 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM3 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM4 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM5 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM6 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM7 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM8 28 divvar TEMPVAR5 10
				
								subvarvar MANTLINGTIMEREXTRA TEMPVAR5
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1 
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1 
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
							}
							else
							{
								setvar TEMPVAR5 1000 // Base Drain rate [1000 = 1 tic]
				
								// Character Specfic conditions [sans Cybanis]
								ifvare CHARACTERSELECTED? 3
								{
									setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
									ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvarvar TEMPVAR5 5 divvar TEMPVAR5 4 } // +25% Drain w/ Diving Suit on
								}
				
								// Check for Power Wrist [equippable item]
								setvar DAMAGEMODIFIER 1000
								ifvare PLAYEREQUIPSLOTITEM1 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM2 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM3 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM4 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM5 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM6 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM7 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM8 18 subvar DAMAGEMODIFIER 125
								ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
								mulvarvar TEMPVAR5 DAMAGEMODIFIER
								divvar TEMPVAR5 1000
				
								// Check for Jewel of Four Souls [equippable item]
								ifvare PLAYEREQUIPSLOTITEM1 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM2 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM3 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM4 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM5 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM6 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM7 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM8 28 divvar TEMPVAR5 10
				
								subvarvar MANTLINGTIMEREXTRA TEMPVAR5
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1 
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1 
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
							}
						}
						else // Drain at double rate when pulling up
						{
							ifvare PLAYERPULLUPSOUND? 0
							{
								ifvare CHARACTERSELECTED? 8 
								{ 
									stopsound LISA_WALLGRAB 
									stopsound LISA_WALLPULLUP 
									sound LISA_WALLPULLUP 
								}
								ifvare CHARACTERSELECTED? 15 
								{ 
									stopsound MAKEN_WALLGRAB
									stopsound MAKEN_WALLPULLUP
									sound MAKEN_WALLPULLUP 
								}
								setvar PLAYERPULLUPSOUND? 1
							}
							ifp ponsteroids // Triple your Mantling time if using steroids
							{
								setvar TEMPVAR5 500
								// Check for Power Wrist [equippable item]
								setvar DAMAGEMODIFIER 1000
								ifvare PLAYEREQUIPSLOTITEM1 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM2 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM3 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM4 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM5 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM6 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM7 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM8 18 subvar DAMAGEMODIFIER 125
								ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
								mulvarvar TEMPVAR5 DAMAGEMODIFIER
								divvar TEMPVAR5 1000
				
								// Check for Jewel of Four Souls [equippable item]
								ifvare PLAYEREQUIPSLOTITEM1 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM2 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM3 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM4 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM5 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM6 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM7 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM8 28 divvar TEMPVAR5 10
				
								subvarvar MANTLINGTIMEREXTRA TEMPVAR5
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
							}
							else
							{
								setvar TEMPVAR5 1500
								// Check for Power Wrist [equippable item]
								setvar DAMAGEMODIFIER 1000
								ifvare PLAYEREQUIPSLOTITEM1 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM2 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM3 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM4 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM5 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM6 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM7 18 subvar DAMAGEMODIFIER 125
								ifvare PLAYEREQUIPSLOTITEM8 18 subvar DAMAGEMODIFIER 125
								ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
								mulvarvar TEMPVAR5 DAMAGEMODIFIER
								divvar TEMPVAR5 1000
				
								// Check for Jewel of Four Souls [equippable item]
								ifvare PLAYEREQUIPSLOTITEM1 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM2 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM3 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM4 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM5 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM6 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM7 28 divvar TEMPVAR5 10
								ifvare PLAYEREQUIPSLOTITEM8 28 divvar TEMPVAR5 10
				
								subvarvar MANTLINGTIMEREXTRA TEMPVAR5
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
							}
						}
					} 
				}
				else
				{
					setvarvar tempc MANTLINGTIMERMAX
					subvarvar tempc 1
					setvarvar MANTLINGTIMER tempc
				}
			}
			else
			{
				ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
				{
					setvarvar tempc MANTLINGTIMERMAX
					subvarvar tempc 1
					setvarvar MANTLINGTIMER tempc
				}
			}
		}
		
		ifvare EDGEGRAPPLING 1 // hanging there, possibly strafing
		{
			setplayer[THISACTOR].falling_counter 0
	
			getplayer[THISACTOR].posxv xvel
			ifvare CHARACTERSELECTED? 1 mulvar xvel 75
			ifvare CHARACTERSELECTED? 2 mulvar xvel 63
			ifvare CHARACTERSELECTED? 3 mulvar xvel 88
			ifvare CHARACTERSELECTED? 4 mulvar xvel 38
			ifvare CHARACTERSELECTED? 5 mulvar xvel 91
			ifvare CHARACTERSELECTED? 6 mulvar xvel 69
			ifvare CHARACTERSELECTED? 7 mulvar xvel 66
			ifvare CHARACTERSELECTED? 8 mulvar xvel 58 // 40
			ifvare CHARACTERSELECTED? 9 mulvar xvel 81
			ifvare CHARACTERSELECTED? 10 mulvar xvel 53
			ifvare CHARACTERSELECTED? 11 mulvar xvel 47
			ifvare CHARACTERSELECTED? 12 mulvar xvel 71
			ifvare CHARACTERSELECTED? 13 mulvar xvel 78
			ifvare CHARACTERSELECTED? 14 mulvar xvel 94
			ifvare CHARACTERSELECTED? 15 mulvar xvel 44
			divvar xvel 100
			setplayer[THISACTOR].posxv xvel
	
			getplayer[THISACTOR].posyv yvel
			ifvare CHARACTERSELECTED? 1 mulvar yvel 75
			ifvare CHARACTERSELECTED? 2 mulvar yvel 63
			ifvare CHARACTERSELECTED? 3 mulvar yvel 88
			ifvare CHARACTERSELECTED? 4 mulvar yvel 38
			ifvare CHARACTERSELECTED? 5 mulvar yvel 91
			ifvare CHARACTERSELECTED? 6 mulvar yvel 69
			ifvare CHARACTERSELECTED? 7 mulvar yvel 66
			ifvare CHARACTERSELECTED? 8 mulvar yvel 58 // 40
			ifvare CHARACTERSELECTED? 9 mulvar yvel 81
			ifvare CHARACTERSELECTED? 10 mulvar yvel 53
			ifvare CHARACTERSELECTED? 11 mulvar yvel 47
			ifvare CHARACTERSELECTED? 12 mulvar yvel 71
			ifvare CHARACTERSELECTED? 13 mulvar yvel 78
			ifvare CHARACTERSELECTED? 14 mulvar yvel 94
			ifvare CHARACTERSELECTED? 15 mulvar yvel 44
			divvar yvel 100
			setplayer[THISACTOR].posyv yvel
	
			setplayer[THISACTOR].posz EDGEGRAPPLEZ
			setplayer[THISACTOR].poszv 0
			state checkwall	
		}
		else
		{
			ifvare CHARACTERSELECTED? 1 setplayer[THISACTOR].poszv -1536
			ifvare CHARACTERSELECTED? 2 setplayer[THISACTOR].poszv -1280
			ifvare CHARACTERSELECTED? 3 setplayer[THISACTOR].poszv -1792
			ifvare CHARACTERSELECTED? 4 setplayer[THISACTOR].poszv -768
			ifvare CHARACTERSELECTED? 5 setplayer[THISACTOR].poszv -1856
			ifvare CHARACTERSELECTED? 6 setplayer[THISACTOR].poszv -1408
			ifvare CHARACTERSELECTED? 7 setplayer[THISACTOR].poszv -1344
			ifvare CHARACTERSELECTED? 8 setplayer[THISACTOR].poszv -1212 // -832
			ifvare CHARACTERSELECTED? 9 setplayer[THISACTOR].poszv -1664
			ifvare CHARACTERSELECTED? 10 setplayer[THISACTOR].poszv -1088
			ifvare CHARACTERSELECTED? 11 setplayer[THISACTOR].poszv -960
			ifvare CHARACTERSELECTED? 12 setplayer[THISACTOR].poszv -1472
			ifvare CHARACTERSELECTED? 13 setplayer[THISACTOR].poszv -1600
			ifvare CHARACTERSELECTED? 14 setplayer[THISACTOR].poszv -1920
			ifvare CHARACTERSELECTED? 15 setplayer[THISACTOR].poszv -896
			getplayer[THISACTOR].ang angvar
			cos xvel angvar
			sin yvel angvar
			mulvar xvel 64 
			mulvar yvel 64
			setplayer[THISACTOR].posxv xvel
			setplayer[THISACTOR].posyv yvel
			getactor[THISACTOR].z z
			getactor[THISACTOR].x x
			getactor[THISACTOR].y y
			getactor[THISACTOR].sectnum mysector
			getactor[THISACTOR].ang angvar
			setvar zdist 0
			cos mycos angvar
			sin mysin angvar
			hitscan x y z mysector mycos mysin zdist hitsector hitwall hitsprite hitx hity hitz clipmask
			state pythagoras
			ifvarg xydist 384 setvar EDGEGRAPPLING -10
			addvar EDGEGRAPPLING 1
			ifvarg EDGEGRAPPLING 20 setvar EDGEGRAPPLING -10
		}
	}
	
ends

state checkhitscan
	getplayer[THISACTOR].posx x
	getplayer[THISACTOR].posy y
	getplayer[THISACTOR].posz z
	getplayer[THISACTOR].cursectnum mysector
	getplayer[THISACTOR].ang angvar
	getplayer[THISACTOR].horiz zdist2
	subvar zdist2 100
	mulvar zdist2 -2048
	cos mycos angvar
	sin mysin angvar
	hitscan x y z mysector mycos mysin zdist2 hitsector hitwall hitsprite hitx hity hitz clipmask
	updatesector hitx hity hitsector
ends

state falling
	ifvarg fallcounter -1 ifvarl fallcounter 47 state stopfallscreams
	ifvare fallcounter 47 
	{ 
		ifvare oldskoolmode 0
		{
			redefinequote 241 ^21YOU'RE FALLING WAY TOO FAR!!
			setvarvar fta fta_normal setvar ftq 241
		}
		ifvarg CURRENTHITPOINTS 0 // ifp palive 
		{ 
			ifvare CHARACTERSELECTED? 1 globalsound DUKE_SCREAM2
			else ifvare CHARACTERSELECTED? 2 globalsound JACK_FALLSCREAM
			else ifvare CHARACTERSELECTED? 5 globalsound WANG_SCREAM
			else ifvare CHARACTERSELECTED? 6 globalsound ESSENCE_FALLSCREAM
			else ifvare CHARACTERSELECTED? 8 globalsound LISA_FALLSCREAM
			else ifvare CHARACTERSELECTED? 9 globalsound CYBANIS_FALLSCREAM
			else ifvare CHARACTERSELECTED? 15 globalsound MAKEN_FALLSCREAM
			else globalsound DUKE_SCREAM2
		}
		else ifp pdead state stopfallscreams
	}

	ifvarg fallcounter 60
	{ 
		setvar FALLSOUND? 1
		ifvarl fallcounter2 63 addvar fallcounter2 1
		setvar fallcounter 60
		setplayer[THISACTOR].falling_counter fallcounter
	}
	ifvarg fallcounter 8
	{
		setvar FALLSOUND? 1
		setvarvar totalfallcounter fallcounter
		addvarvar totalfallcounter fallcounter2
		ifp ponground nullop else setvarvar rfallcounter fallcounter
	}

	ifvarl fallcounts 0 ifvarg fallcounter 0 // each count shaves off 2 fallcounter tics
	{ 
		setplayer[THISACTOR].falling_counter 0
		addvar fallcounts 1 
		resetcount
	}
ends

state lockplayerhealthfloors
	state stoppainsounds
ends

state playerregen5percenthp
	addvarvar CURRENTHITPOINTS PLAYERREGENAMOUNT2
	ifvarn player[THISACTOR].over_shoulder_on 0
	{
		ifvarg PLAYERREGENAMOUNT2 0
		{
			setvarvar SHOWDAMAGE PLAYERREGENAMOUNT2
			setvar SHOWDAMAGETYPE 3
			setvarvar SHOWDAMAGEACTORID THISACTOR
			state showdamage
		}
	}
	ifvarvarg CURRENTHITPOINTS STATLIMITATOMIC setvarvar CURRENTHITPOINTS STATLIMITATOMIC
	ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
	ifvarvarl CURRENTHITPOINTS STATLIMITATOMIC sound REGEN_HEALTH5 setvar PLAYERHPDAMAGED? -1
ends

state playerregen5percentap
	addvarvar PLAYERAPREGENAMOUNT PLAYERAPREGENAMOUNT2
	ifvarn player[THISACTOR].over_shoulder_on 0
	{
		ifvarg PLAYERAPREGENAMOUNT2 0
		{
			setvarvar SHOWDAMAGE PLAYERAPREGENAMOUNT2
			setvar SHOWDAMAGETYPE 4
			setvarvar SHOWDAMAGEACTORID THISACTOR
			state showdamage
		}
	}
	ifvarvarg PLAYERAPREGENAMOUNT STATLIMITATOMIC setvarvar PLAYERAPREGENAMOUNT STATLIMITATOMIC
	ifvarvarg PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC setvarvar PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC
	ifvarvarl PLAYERAPREGENAMOUNT STATLIMITATOMIC sound REGEN_ARMOR5 setvar PLAYERAPDAMAGED? -1
	setvarvar CURRENTARMORPOINTS PLAYERAPREGENAMOUNT
ends

state determineregenrates // affects how regeneration speed for HP and EP works.
	ifvarn TEMPVAR8 1 ifp ponsteroids mulvar TEMPMOD 4 // Steroids = 400% Speed
	
	ifvarand PLAYERSTATUS? 2 { mulvar TEMPMOD 1250 divvar TEMPMOD 1000 } // Haste = 125% Speed
	ifvarand PLAYERSTATUS? 4 { mulvar TEMPMOD 750 divvar TEMPMOD 1000 } // Slow = 75% Speed
	
	// Defending
	ifvare DEFENSEMODE? 1
	{
		ifvare TEMPVAR8 0 // HP Regen
		{ 
			ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 750 divvar TEMPMOD 1000 } // Defend Mode = 75% Speed if Poisoned
			else { mulvar TEMPMOD 1333 divvar TEMPMOD 1000 } // Defend Mode = 133% Speed
		}
		ifvare TEMPVAR8 2 // EP Regen
		{ 
			ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 750 divvar TEMPMOD 1000 } // Defend Mode = 75% Speed if Mindblown
			else { mulvar TEMPMOD 1333 divvar TEMPMOD 1000 } // Defend Mode = 133% Speed
		}
	}
	
	// In a Vehicle
	ifvarn VEHICLEID -1 
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 714 divvar TEMPMOD 1000 } // 71.4% speed if Poisoned
				else { mulvar TEMPMOD 1400 divvar TEMPMOD 1000 } // using a Riot Tank will put a character at rest, giving a 40% bonus to regen speeds
			}
			ifvare TEMPVAR8 2 // AP Regen
			{ 
				ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 714 divvar TEMPMOD 1000 } // 71.4% speed if Mindblown
				else { mulvar TEMPMOD 1400 divvar TEMPMOD 1000 } // using a Riot Tank will put a character at rest, giving a 40% bonus to regen speeds
			}
		}
	}
	else // NOT in a Vehicle
	{
		ifvarand bits 536870912 ifvarand extbits 12 // "Focusing" EP
		{
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				mulvar TEMPMOD 4
			}
		}
	
		ifvarand bits 1 // Jump
		{ 
			ifp ponground
			{
				ifvare TEMPVAR8 0 // HP Regen
				{ 
					ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
					else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
				}
				ifvare TEMPVAR8 2 // EP Regen
				{ 
					ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if MindBlown
					else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
				}
			}
			else 
			{
				ifp pjetpack 
				{
					ifvare TEMPVAR8 0 // HP Regen
					{ 
						ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 1500 divvar TEMPMOD 1000 } // 150% speed if Poisoned
						else { mulvar TEMPMOD 600 divvar TEMPMOD 1000 }
					}
					ifvare TEMPVAR8 2 // EP Regen
					{ 
						ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 1500 divvar TEMPMOD 1000 } // 150% speed if Mindblown
						else { mulvar TEMPMOD 600 divvar TEMPMOD 1000 }
					}
				}
				else
				{
					ifvare TEMPVAR8 0 // HP Regen
					{ 
						ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
						else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
					}
					ifvare TEMPVAR8 2 // EP Regen
					{ 
						ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
						else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
					}
				}
			} 
		}
		else ifvarg jumpcounter 0 
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
		}
		else ifvarand bits 2 // Crouch
		{
			ifp ponground 
			{
				ifvare TEMPVAR8 0 // HP Regen
				{ 
					ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 555 divvar TEMPMOD 1000 } // 55.5% speed if Poisoned
					else { mulvar TEMPMOD 1800 divvar TEMPMOD 1000 }
				}
				ifvare TEMPVAR8 2 // EP Regen
				{ 
					ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 555 divvar TEMPMOD 1000 } // 55.5% speed if MindBlown
					else { mulvar TEMPMOD 1800 divvar TEMPMOD 1000 }
				}
			}
			else 
			{
				ifp pjetpack 
				{
					ifvare TEMPVAR8 0 // HP Regen
					{ 
						ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 1500 divvar TEMPMOD 1000 } // 150% speed if Poisoned
						else { mulvar TEMPMOD 600 divvar TEMPMOD 1000 }
					}
					ifvare TEMPVAR8 2 // EP Regen
					{ 
						ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 1500 divvar TEMPMOD 1000 } // 150% speed if MindBlown
						else { mulvar TEMPMOD 600 divvar TEMPMOD 1000 }
					}
				}
				else 
				{
					ifvare TEMPVAR8 0 // HP Regen
					{ 
						ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 1333 divvar TEMPMOD 1000 } // 133.3% Speed if Poisoned
						else { mulvar TEMPMOD 750 divvar TEMPMOD 1000 }
					}
					ifvare TEMPVAR8 2 // EP Regen
					{ 
						ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 1333 divvar TEMPMOD 1000 } // 133.3% Speed if MindBlown
						else { mulvar TEMPMOD 750 divvar TEMPMOD 1000 }
					}
				}
			} 
		}
		ifvarand bits 4 // Fire
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2000 divvar TEMPMOD 1000 } // 200% Speed if Poisoned
				else { mulvar TEMPMOD 500 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 2000 divvar TEMPMOD 1000 } // 200% Speed if Mindblown
				else { mulvar TEMPMOD 500 divvar TEMPMOD 1000 }
			}
		}
		else ifvarand bits 4194304 // Alt-Fire/Quick Kick
		{ 
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2000 divvar TEMPMOD 1000 } // 200% Speed if Poisoned
				else { mulvar TEMPMOD 500 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand PLAYERSTATUS? 32768 { mulvar TEMPMOD 2000 divvar TEMPMOD 1000 } // 200% Speed if Mindblown
				else { mulvar TEMPMOD 500 divvar TEMPMOD 1000 }
			}
		}
	
		ifvarand extbits 1 // Move Forward
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
		}
		else ifvarand extbits 2 // Move Backwards
		{ 
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
		}
		else ifvarand extbits 4 // Strafe Left
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{
				ifvarand extbits 12 nullop
				else
				{
					ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
					else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
				}
			}
		}
		else ifvarand extbits 8 // Strafe Right
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand extbits 12 nullop
				else
				{
					ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
					else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
				}
			}
		}
		else ifvarand extbits 16 // Turn Left
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
		}
		else ifvarand extbits 32 // Turn Right
		{
			ifvare TEMPVAR8 0 // HP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Poisoned
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
			ifvare TEMPVAR8 2 // EP Regen
			{ 
				ifvarand PLAYERSTATUS? 8 { mulvar TEMPMOD 2500 divvar TEMPMOD 1000 } // 250% speed if Mindblown
				else { mulvar TEMPMOD 400 divvar TEMPMOD 1000 }
			}
		}
	}
ends

state playerregenhealthnormal
	ifvare PUBLICBETA? 0 { ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENINTERVAL 390 else setvar HITPOINTREGENINTERVAL 780 } else { setvar HITPOINTREGENINTERVAL 260 }
	ifvarand PLAYERSTATUS? 8 { setvarvar TEMP STATLIMITATOMIC addvar TEMP 1 } else { setvarvar TEMP MAXHITPOINTS } // If player is poisoned, their health will go down even if above 100%
	ifvarvarl CURRENTHITPOINTS TEMP // TEMP or MAXHITPOINTS
	{
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifvare mainmenu 0 
			{
				setvar TEMPMOD 0
				ifvarvarl CURRENTHITPOINTS MAXHITPOINTS 
				{ 
					ifvare REGENTIME 0 setvar TEMPMOD 10
				} 
				else
				{
					ifvarand PLAYERSTATUS? 8
					{ 
						setvar TEMPMOD 10
					}
					else
					{
						setvar HITPOINTREGENTICS 0
					}
				}
				ifvarn TEMPMOD 0
				{ 
					setvar TEMPVAR8 0 state determineregenrates
					addvarvar HITPOINTREGENTICS TEMPMOD 
				}
			}
			// The Actual regeneration process
			ifvarvarg HITPOINTREGENTICS HITPOINTREGENINTERVAL
			{ 
				ifvarl REGENTIME 1 // Only Regenerate at the usual rate when NOT using Regen Powerup
				{
					setvarvar TEMPVAR MAXHITPOINTS
					mulvarvar TEMPVAR PLAYERLEVEL
					ifp ponsteroids divvar TEMPVAR 6667 else divvar TEMPVAR 10000
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
		
					randvar TEMPVAR8 120
					addvar TEMPVAR8 1
					ifvarg TEMPVAR8 0 ifvarl TEMPVAR8 2 mulvar TEMPVAR 5 // 1
					ifvarg TEMPVAR8 1 ifvarl TEMPVAR8 5 mulvar TEMPVAR 4 // 2-4 +3
					ifvarg TEMPVAR8 4 ifvarl TEMPVAR8 14 mulvar TEMPVAR 3 // 5-13 +9
					ifvarg TEMPVAR8 13 ifvarl TEMPVAR8 41 mulvar TEMPVAR 2 // 14-40 +27
					ifvarg TEMPVAR8 40 ifvarl TEMPVAR8 122 mulvar TEMPVAR 1 // 41-121 +81
		
					ifvarand PLAYERSTATUS? 8 // If the player is 'Poisoned', turn the gain into a loss and flash the screen a sickly green
					{
						setvarvar TEMPVAR MAXHITPOINTS
						randvar TEMPVAR2 10
						setvar TEMPVAR3 20
						ifrnd 128 addvarvar TEMPVAR3 TEMPVAR2 else subvarvar TEMPVAR3 TEMPVAR2
						mulvarvar TEMPVAR TEMPVAR3
						divvar TEMPVAR 1000
			
						ifvare CHARACTERSELECTED? 2 mulvar TEMPVAR 2 // Jack Inverts Poison Damage to 2x Healing         
						else ifvare CHARACTERSELECTED? 4 { ifvare sector[PLAYERSECTOR].lotag 1 { mulvar TEMPVAR -4 divvar TEMPVAR 5 } else ifvare sector[PLAYERSECTOR].lotag 2 { mulvar TEMPVAR -2 divvar TEMPVAR 5 } else { mulvar TEMPVAR -1 } } // Ami loses less HP in or under water when poisoned
						else ifvare CHARACTERSELECTED? 12 divvar TEMPVAR -2 // Lori only suffers 1/2 damage from Poison
						else mulvar TEMPVAR -1 // All others
			
						ifp ponsteroids { mulvar TEMPVAR 9 divvar TEMPVAR 2 }
			
						ifvare CHARACTERSELECTED? 2
						{
							setvar TEMPMOD 0
							ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3 // Charm Ankh
							ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3 // Charm Ankh
							ifvarl TEMPMOD 1 setvar TEMPMOD 1
							ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
							mulvarvar TEMPVAR TEMPMOD
							ifvarl TEMPVAR 1 setvar TEMPVAR 1
			
							setvar TEMPMOD 0
							ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPMOD 10 // Jewel of Four Souls
							ifvarl TEMPMOD 1 setvar TEMPMOD 1
							mulvarvar TEMPVAR TEMPMOD
							ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
						}
			
						// Check Slurpee Machine [Permenant Boost Item]
						state checkslurpeemachines
						ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
						ifvare CHARACTERSELECTED? 2 mulvar TEMP6 2 else mulvar TEMP6 -2 // 2% per item
						addvar TEMP6 100
						mulvarvar TEMPVAR TEMP6
						divvar TEMPVAR 100
			
						ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarg TEMPVAR -1 setvar TEMPVAR -1 state cheatersound }
						ifvarn CHARACTERSELECTED? 2 ifvarg TEMPVAR -1 setvar TEMPVAR -1
						palfrom 32 0 32 
			
						ifvarl TEMPVAR 0
						{
							setvarvar PAINSOUNDFACTOR TEMPVAR
							mulvar PAINSOUNDFACTOR -1
							state checkpainfactor
			
							setvarvar DAMAGEHUEFACTOR TEMPVAR
							mulvar DAMAGEHUEFACTOR -1
							state playerdamagehues-acidtype
			
							ifvarl TEMPVAR3 11 { ifrnd 40 state characterpainsounds }
							ifvare TEMPVAR3 11 { ifrnd 48 state characterpainsounds }
							ifvare TEMPVAR3 12 { ifrnd 56 state characterpainsounds }
							ifvare TEMPVAR3 13 { ifrnd 64 state characterpainsounds }
							ifvare TEMPVAR3 14 { ifrnd 72 state characterpainsounds }
							ifvare TEMPVAR3 15 { ifrnd 80 state characterpainsounds }
							ifvare TEMPVAR3 16 { ifrnd 88 state characterpainsounds }
							ifvare TEMPVAR3 17 { ifrnd 96 state characterpainsounds }
							ifvare TEMPVAR3 18 { ifrnd 112 state characterpainsounds }
							ifvare TEMPVAR3 19 { ifrnd 120 state characterpainsounds }
							ifvare TEMPVAR3 20 { ifrnd 128 state characterpainsounds }
							ifvare TEMPVAR3 21 { ifrnd 136 state characterpainsounds }
							ifvare TEMPVAR3 22 { ifrnd 144 state characterpainsounds }
							ifvare TEMPVAR3 23 { ifrnd 152 state characterpainsounds }
							ifvare TEMPVAR3 24 { ifrnd 160 state characterpainsounds }
							ifvare TEMPVAR3 25 { ifrnd 168 state characterpainsounds }
							ifvare TEMPVAR3 26 { ifrnd 176 state characterpainsounds }
							ifvare TEMPVAR3 27 { ifrnd 184 state characterpainsounds }
							ifvare TEMPVAR3 28 { ifrnd 192 state characterpainsounds }
							ifvare TEMPVAR3 29 { ifrnd 200 state characterpainsounds }
							ifvarg TEMPVAR3 29 { ifrnd 208 state characterpainsounds }
							setvarvar tempe TEMPVAR
							mulvar tempe -1
							setvar ATTACKINGACTORPICNUM 5216
							getactor[THISACTOR].pal TEMP
							setvarvar ATTACKINGACTORPAL TEMP
							setvar ACTORCRITICAL? 0
							setvarvar PLAYERDAMAGETEMP tempe
			
							ifvarn player[THISACTOR].over_shoulder_on 0
							{
								ifvarg tempe 0
								{
									setvarvar SHOWDAMAGE tempe
									setvar SHOWDAMAGETYPE 0
									setvarvar SHOWDAMAGEACTORID THISACTOR
									state showdamage
								}
							}
			
							setactor[THISACTOR].htpicnum -1
							setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
							setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
							ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
						}
					} 
					else 
					{ 
						ifvare CHARACTERSELECTED? 1 mulvar TEMPVAR 3 // Duke always recovers 3x the normal HP
						else ifvare CHARACTERSELECTED? 4 { ifvare sector[PLAYERSECTOR].lotag 1 { mulvar TEMPVAR 2 } else ifvare sector[PLAYERSECTOR].lotag 2 { mulvar TEMPVAR 5 } else { mulvar TEMPVAR 1 } } // Ami Recovers more HP in or under water
						else ifvare CHARACTERSELECTED? 5 mulvar TEMPVAR 2 // Higa always recovers 2x the normal HP
						else ifvare CHARACTERSELECTED? 7 { mulvar TEMPVAR 9 divvar TEMPVAR 4 } // Ted always recovers 2.25x the normal HP
						else ifvare CHARACTERSELECTED? 8 { mulvar TEMPVAR 3 divvar TEMPVAR 2 } // Lisa always recovers 1.5x the normal HP
						else ifvare CHARACTERSELECTED? 10 mulvar TEMPVAR 2 // Christina/Nethra always recovers 2x the normal HP 
						else ifvare CHARACTERSELECTED? 12 { mulvar TEMPVAR 7 divvar TEMPVAR 4 } // Lori always recovers 1.75x the normal HP
						else ifvare CHARACTERSELECTED? 14 mulvar TEMPVAR 4 // 'Mystery Lady' always recovers 4x the normal HP 
						else ifvare CHARACTERSELECTED? 15 { mulvar TEMPVAR 5 divvar TEMPVAR 4 } // Maken always recovers 1.25x the normal HP
						else mulvar TEMPVAR 1 // All others recover HP at a normal rate
			
						setvar DAMAGEMODIFIER 1000
						state support-hpregen
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
						mulvarvar TEMPVAR DAMAGEMODIFIER
						divvar TEMPVAR 1000
			
						ifvare PUBLICBETA? 0 divvar TEMPVAR 9 else divvar TEMPVAR 3
			
						ifvarl TEMPVAR 1 setvar TEMPVAR 1
						ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
			
						setvar TEMPMOD 0
						ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3 // Charm Ankh
						ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3 // Charm Ankh
						ifvarl TEMPMOD 1 setvar TEMPMOD 1
						ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
						mulvarvar TEMPVAR TEMPMOD
						ifvarl TEMPVAR 1 setvar TEMPVAR 1
			
						setvar TEMPMOD 0
						ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPMOD 10 // Jewel of Four Souls
						ifvarl TEMPMOD 1 setvar TEMPMOD 1
						mulvarvar TEMPVAR TEMPMOD
						ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
			
						ifvarl TEMPVAR 1 setvar TEMPVAR 1
						// Check Slurpee Machine [Permenant Boost Item]
						state checkslurpeemachines
						ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
						mulvar TEMP6 2 // 2% per item
						addvar TEMP6 100
						mulvarvar TEMPVAR TEMP6
						divvar TEMPVAR 100
			
						ifvarl TEMPVAR 1 setvar TEMPVAR 1
						ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
					}
		
					ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
					else ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
					addvarvar CURRENTHITPOINTS TEMPVAR
					state checkbuddhamode
					ifvarvarg CURRENTHITPOINTS STATLIMITATOMIC setvarvar CURRENTHITPOINTS STATLIMITATOMIC
					ifvarand PLAYERSTATUS? 8 nullop else { ifvarvarg CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS } // Prevents Poison ailment from setting above 100% HP to 100% :P
		
					ifvarn player[THISACTOR].over_shoulder_on 0
					{
						ifvarg TEMPVAR 0
						{
							setvarvar SHOWDAMAGE TEMPVAR
							setvar SHOWDAMAGETYPE 3
							setvarvar SHOWDAMAGEACTORID THISACTOR
							state showdamage
						}
					}
					setvar TEMPVAR 0
		
					//**************************
					//*Reset the interval timer*
					//**************************
		
					// Character Check
					ifvare CHARACTERSELECTED? 1 // Duke Nukem
					{ 
						ifvarand PLAYERSTATUS? 8 { setvar HITPOINTREGENTICS -2 randvar TEMPVAR5 2 subvarvar HITPOINTREGENTICS TEMPVAR5 } // - 2 to 4 tics of Poison Damage
						else { setvar HITPOINTREGENTICS 4 randvar TEMPVAR5 4 addvarvar HITPOINTREGENTICS TEMPVAR5 } // + 4 to 8 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 4 // Ami Mizuno 
					{ 
						ifvarand PLAYERSTATUS? 8
						{
							// Ami suffers poison damage in slower intervals in and under the water
							ifvare sector[PLAYERSECTOR].lotag 1 setvar HITPOINTREGENTICS -4
							else ifvare sector[PLAYERSECTOR].lotag 2 setvar HITPOINTREGENTICS -7
							else setvar HITPOINTREGENTICS -1
						}
						else
						{
							// Ami recovers in quicker intervals in and under the water
							ifvare sector[PLAYERSECTOR].lotag 1 setvar HITPOINTREGENTICS 8
							else ifvare sector[PLAYERSECTOR].lotag 2 setvar HITPOINTREGENTICS 14
							else { setvar HITPOINTREGENTICS 1 randvar TEMPVAR5 1 addvarvar HITPOINTREGENTICS TEMPVAR5 }
						}
					} 
					ifvare CHARACTERSELECTED? 5 // Lo Wang
					{ 
						ifvarand PLAYERSTATUS? 8 { setvar HITPOINTREGENTICS -1 randvar TEMPVAR5 2 subvarvar HITPOINTREGENTICS TEMPVAR5 } // - 1 to 3 tics of Poison Damage
						else { setvar HITPOINTREGENTICS 2 randvar TEMPVAR5 4 addvarvar HITPOINTREGENTICS TEMPVAR5 } // + 2 to 6 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 6 // ESSence Margalan
					{ 
						ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -4 // - 4 tics of Poison Damage
						else setvar HITPOINTREGENTICS 8 // + 8 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 7 // Ted Maldoras
					{ 
						ifvarand PLAYERSTATUS? 8 { setvar HITPOINTREGENTICS -3 randvar TEMPVAR5 1 subvarvar HITPOINTREGENTICS TEMPVAR5 } // - 3 to 4 tics of Poison Damage
						else { setvar HITPOINTREGENTICS 6 randvar TEMPVAR5 2 addvarvar HITPOINTREGENTICS TEMPVAR5 } // + 6 to 8 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 8 // Lisa Bates
					{ 
						ifvarand PLAYERSTATUS? 8 { setvar HITPOINTREGENTICS -6 randvar TEMPVAR5 2 subvarvar HITPOINTREGENTICS TEMPVAR5 } // - 6 to 8 tics of Poison Damage
						else { setvar HITPOINTREGENTICS 12 randvar TEMPVAR5 4 addvarvar HITPOINTREGENTICS TEMPVAR5 } // + 12 to 16 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 9 // Cybanis Morgandos
					{ 
						ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -4 // - 4 tics of Poison Damage
						else setvar HITPOINTREGENTICS 8 // + 8 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 10 // Nethra Maboroshi / Christina Mitchell
					{ 
						setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0 // Nethra heals 8 times faster than Christina
						{
							ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -8 // - 8 tics of Poison Damage
							else setvar HITPOINTREGENTICS 16 // + 16 tics of Healing
						}
						else
						{
							ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -1 // - 1 tic of Poison Damage
							else setvar HITPOINTREGENTICS 2 // + 2 tics of Healing
						}
					}
					else
					ifvare CHARACTERSELECTED? 12 // Lori Stephens
					{ 
						ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -3 // - 3 tics of Poison Damage
						else setvar HITPOINTREGENTICS 6 // + 6 tics of Healing
					}
					else
					ifvare CHARACTERSELECTED? 13 // Minako Aino
					{ 
						ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -5 // - 5 tics of Poison Damage
						else setvar HITPOINTREGENTICS 10 // + 10 tics of Healing
					} 
					else
					ifvare CHARACTERSELECTED? 15 // Maken Shinkara
					{ 
						ifvarand PLAYERSTATUS? 8 setvar HITPOINTREGENTICS -3 // - 3 tics of Poison Damage
						else setvar HITPOINTREGENTICS 6 // + 6 tics of Healing
					}
					else setvar HITPOINTREGENTICS 0 // Jack, Bubsy, Paula & Mystery Lady
					ifvarn HITPOINTREGENTICS 0 mulvar HITPOINTREGENTICS 10
		
					// Add Speed from Character Levels
					setvarvar TEMPVAR4 PLAYERLEVEL divvar TEMPVAR4 20
					ifvarand PLAYERSTATUS? 8 subvarvar HITPOINTREGENTICS TEMPVAR4
					else addvarvar HITPOINTREGENTICS TEMPVAR4
		
					// Add Speed from Equipped Charm Ankhs
					setvar TEMPMOD 0
					ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 10
					divvar TEMPMOD 20
					// Add Speed from Equipped Jewels of Four Souls
					ifvare PUBLICBETA? 0
					{
						ifvare PLAYEREQUIPSLOTITEM1 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM2 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM3 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM4 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM5 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM6 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM7 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM8 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
					}
					else
					{
						ifvare PLAYEREQUIPSLOTITEM1 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM2 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM3 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM4 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM5 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM6 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM7 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM8 28 { ifvarand PLAYERSTATUS? 8 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
					}
					ifvarand PLAYERSTATUS? 8 subvarvar HITPOINTREGENTICS TEMPMOD
					else addvarvar HITPOINTREGENTICS TEMPMOD
				}
			}
		}
	}
ends

state playerregenarmornormal
	ifvare PUBLICBETA? 0 { ifvarand PLAYERSTATUS? 16384 setvar ARMORPOINTREGENINTERVAL 390 else setvar ARMORPOINTREGENINTERVAL 780 } else { setvar ARMORPOINTREGENINTERVAL 260 }
	ifvarand PLAYERSTATUS? 16384 { setvarvar TEMP STATLIMITATOMIC addvar TEMP 1 } else { setvarvar TEMP MAXARMORPOINTS } // If player is poisoned, their health will go down even if above 100%
	ifvarvarl CURRENTARMORPOINTS TEMP // TEMP or MAXARMORPOINTS
	{
		ifvarg CURRENTARMORPOINTS 0 // if the player has SOME armor, the effect will kick in
		{
			ifvare mainmenu 0 
			{
				setvar TEMPMOD 0
				ifvarvarl CURRENTARMORPOINTS MAXARMORPOINTS 
				{ 
					ifvarand PLAYERSTATUS? 16384
					{ 
						setvar TEMPMOD 10
					}
					else
					{
						setvar TEMPVAR8 0
						ifvare PLAYEREQUIPSLOTITEM1 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM2 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM3 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM4 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM5 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM6 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM7 29 addvar TEMPVAR8 1
						ifvare PLAYEREQUIPSLOTITEM8 29 addvar TEMPVAR8 1
						ifvarg TEMPVAR8 0 { ifvare APREGENTIME 0 setvar TEMPMOD 10 }
					}
				} 
				else
				{
					ifvarand PLAYERSTATUS? 16384
					{ 
						setvar TEMPMOD 10
					}
					else
					{
						setvar ARMORPOINTREGENTICS 0
					}
				}
				ifvarn TEMPMOD 0
				{ 
					setvar TEMPVAR8 1 state determineregenrates
					addvarvar ARMORPOINTREGENTICS TEMPMOD 
				}
			}
	
			// The Actual regeneration process
			ifvarvarg ARMORPOINTREGENTICS ARMORPOINTREGENINTERVAL
			{ 
				ifvarl APREGENTIME 1 // Only Regenerate at the usual rate when NOT using APRegen Powerup
				{
					setvarvar TEMPVAR MAXARMORPOINTS
					mulvarvar TEMPVAR PLAYERLEVEL
					divvar TEMPVAR 10000
					//ifp ponsteroids divvar TEMPVAR 6667 else divvar TEMPVAR 10000
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
		
					randvar TEMPVAR8 120
					addvar TEMPVAR8 1
					ifvarg TEMPVAR8 0 ifvarl TEMPVAR8 2 mulvar TEMPVAR 5 // 1
					ifvarg TEMPVAR8 1 ifvarl TEMPVAR8 5 mulvar TEMPVAR 4 // 2-4 +3
					ifvarg TEMPVAR8 4 ifvarl TEMPVAR8 14 mulvar TEMPVAR 3 // 5-13 +9
					ifvarg TEMPVAR8 13 ifvarl TEMPVAR8 41 mulvar TEMPVAR 2 // 14-40 +27
					ifvarg TEMPVAR8 40 ifvarl TEMPVAR8 122 mulvar TEMPVAR 1 // 41-121 +81
		
					ifvarand PLAYERSTATUS? 16384 // If the player has 'Corrosion', turn the gain into a loss and flash the screen a sickly green
					{
						setvarvar TEMPVAR MAXARMORPOINTS
						randvar TEMPVAR2 10
						setvar TEMPVAR3 20
						ifrnd 128 addvarvar TEMPVAR3 TEMPVAR2 else subvarvar TEMPVAR3 TEMPVAR2
						mulvarvar TEMPVAR TEMPVAR3
						divvar TEMPVAR 1000
			
						// Riot Shield Check
						setvar DAMAGEMODIFIER 1000
						ifvare PLAYEREQUIPSLOTITEM1 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM2 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM3 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM4 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM5 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM6 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM7 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvare PLAYEREQUIPSLOTITEM8 10 addvar DAMAGEMODIFIER -100 // Riot Shield (-10% Damage)
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
						mulvarvar TEMPVAR DAMAGEMODIFIER
						divvar TEMPVAR 1000
						ifvarl TEMPVAR 1 setvar TEMPVAR 1
			
						// Character Check
						ifvare CHARACTERSELECTED? 11 divvar TEMPVAR 2 // Paula only suffers 1/2 damage from Corrosion
						mulvar TEMPVAR -1
			
						ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarg TEMPVAR -1 setvar TEMPVAR -1 state cheatersound }
						palfrom 32 0 32 
			
						ifvarl TEMPVAR 0
						{
							setvarvar DAMAGEHUEFACTOR TEMPVAR
							mulvar DAMAGEHUEFACTOR -1
							state playerdamagehues-acidtype
			
							setvarvar tempe TEMPVAR
							mulvar tempe -1
							setvar ATTACKINGACTORPICNUM 5299 // Needs a new graphic to represent corrosion
							getactor[THISACTOR].pal TEMP
							setvarvar ATTACKINGACTORPAL TEMP
							setvar ACTORCRITICAL? 0
							setvarvar PLAYERARMORDAMAGETEMP tempe
			
							ifvarn player[THISACTOR].over_shoulder_on 0
							{
								ifvarg tempe 0
								{
									setvarvar SHOWDAMAGE tempe
									setvar SHOWDAMAGETYPE 1
									setvarvar SHOWDAMAGEACTORID THISACTOR
									state showdamage
								}
							}
			
							setactor[THISACTOR].htpicnum -1
							setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
							setvar ATTACKERDISPLAYTIMER 0 setvar ARMORNULLDAMAGE 0
							ifvarg tempe 0 setvar ARMORDAMAGETIMER 0
			
							// Start of 'Damage AP-Absorb' Code
							randvar TEMPVAR5 10 addvar TEMPVAR5 5 // [0.5% to 1.5% AP-Absorb loss per interval (base)]
							ifvare CHARACTERSELECTED? 11 { mulvar TEMPVAR5 333 divvar TEMPVAR5 1000 } // Paula's AP-Absorb only suffers 1/3 the amount of the others'
			
							// Riot Shield Check [AP-Absorb Damage]
							setvar DAMAGEMODIFIER 1000
							ifvare PLAYEREQUIPSLOTITEM1 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM2 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM3 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM4 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM5 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM6 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM7 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvare PLAYEREQUIPSLOTITEM8 10 addvar DAMAGEMODIFIER -50 // Riot Shield (-5% Damage)
							ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
							mulvarvar TEMPVAR5 DAMAGEMODIFIER
							divvar TEMPVAR5 1000
			
							setvar TEMPVAR8 437 // 7/16 chance of AP-Absorb loss occuring at all [base]
							mulvarvar TEMPVAR8 DAMAGEMODIFIER
							divvar TEMPVAR8 1000
							ifvare CHARACTERSELECTED? 11 { mulvar TEMPVAR8 667 divvar TEMPVAR8 1000 } // Paula's Armor only suffers AP-Absorb loss 2/3s as often as the others
			
							randvar TEMPVAR7 999 addvar TEMPVAR7 1
							ifvarvarg TEMPVAR7 TEMPVAR8 nullop else { subvarvar ARMORPERCENT TEMPVAR5 ifvarl ARMORPERCENT 100 setvar ARMORPERCENT 100 }
						}
					}
					else
					{
					ifvare CHARACTERSELECTED? 11 { mulvar TEMPVAR 3 divvar TEMPVAR 1 } // Paula always recovers 3x the normal AP
					ifvare PUBLICBETA? 0 divvar TEMPVAR 9 else divvar TEMPVAR 3
		
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
					ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
		
					setvar TEMPVAR8 0
					ifvare PLAYEREQUIPSLOTITEM1 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM2 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM3 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM4 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM5 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM6 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM7 29 addvar TEMPVAR8 1
					ifvare PLAYEREQUIPSLOTITEM8 29 addvar TEMPVAR8 1
					ifvarl TEMPVAR8 1 setvar TEMPVAR8 1
					ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
					mulvarvar TEMPVAR TEMPVAR8
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
		
					setvar TEMPMOD 0
					ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPMOD 10 // Jewel of Four Souls
					ifvarl TEMPMOD 1 setvar TEMPMOD 1
					mulvarvar TEMPVAR TEMPMOD
					ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
		
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
					}
		
					// Show Damage Numbers
					ifvarg TEMPVAR 0 setvar PLAYERAPDAMAGED? -1
					else ifvarl TEMPVAR 0 setvar PLAYERAPDAMAGED? 1
					addvarvar CURRENTARMORPOINTS TEMPVAR
					ifvarvarg CURRENTARMORPOINTS STATLIMITATOMIC setvarvar CURRENTARMORPOINTS STATLIMITATOMIC
					ifvarand PLAYERSTATUS? 16384 nullop else { ifvarvarg CURRENTARMORPOINTS MAXHITPOINTS setvarvar CURRENTARMORPOINTS MAXARMORPOINTS } // Prevents Corrosion ailment from setting above 100% AP to 100% :P
		
					ifvarn player[THISACTOR].over_shoulder_on 0
					{
						ifvarg TEMPVAR 0
						{
							setvarvar SHOWDAMAGE TEMPVAR
							setvar SHOWDAMAGETYPE 4
							setvarvar SHOWDAMAGEACTORID THISACTOR
							state showdamage
						}
					}
					setvar TEMPVAR 0
		
					//**************************
					//*Reset the interval timer*
					//**************************
					ifvare CHARACTERSELECTED? 11 // Paula Polestar
					{ 
						ifvarand PLAYERSTATUS? 16384 setvar ARMORPOINTREGENTICS -8 // -8 tics of Corrosion Damage
						else setvar ARMORPOINTREGENTICS 16 // +16 tics of Healing
					}
					else setvar ARMORPOINTREGENTICS 0
					ifvarn ARMORPOINTREGENTICS 0 mulvar ARMORPOINTREGENTICS 10
					// Add Speed from Character Levels
					setvarvar TEMPVAR4 PLAYERLEVEL divvar TEMPVAR4 20
					ifvarand PLAYERSTATUS? 16384 subvarvar ARMORPOINTREGENTICS TEMPVAR4
					else addvarvar ARMORPOINTREGENTICS TEMPVAR4
		
					// Add Speed from Equipped Liquid Metal Amulets
					setvar TEMPMOD 0
					ifvare PLAYEREQUIPSLOTITEM1 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM2 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM3 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM4 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM5 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM6 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM7 29 addvar TEMPMOD 10
					ifvare PLAYEREQUIPSLOTITEM8 29 addvar TEMPMOD 10
					divvar TEMPMOD 20
					// Add Speed from Equipped Jewels of Four Souls
					ifvare PUBLICBETA? 0
					{
						ifvare PLAYEREQUIPSLOTITEM1 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM2 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM3 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM4 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM5 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM6 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM7 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM8 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 355 } else { addvar TEMPMOD 710 } } // Jewel of Four Souls
					}
					else
					{
						ifvare PLAYEREQUIPSLOTITEM1 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM2 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM3 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM4 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM5 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM6 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM7 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
						ifvare PLAYEREQUIPSLOTITEM8 28 { ifvarand PLAYERSTATUS? 16384 { addvar TEMPMOD 240 } else { addvar TEMPMOD 240 } } // Jewel of Four Souls
					}
					ifvarand PLAYERSTATUS? 16384 subvarvar ARMORPOINTREGENTICS TEMPMOD
					else addvarvar ARMORPOINTREGENTICS TEMPMOD
					//addlogvar ARMORPOINTREGENTICS
				}
			}
		}
	}
ends

state playerregenenergynormal
	ifvare PUBLICBETA? 0 setvar ENERGYPOINTREGENINTERVAL 6240 else setvar ENERGYPOINTREGENINTERVAL 2080
	ifvarvarl CURRENTENERGYPOINTS MAXENERGYPOINTS // TEMP or MAXHITPOINTS
	{
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifvare mainmenu 0 
			{
				setvar TEMPMOD 0
				ifvarvarl CURRENTENERGYPOINTS MAXENERGYPOINTS 
				{
					setvar TEMPMOD 10
				} 
				ifvarn TEMPMOD 0 
				{
					setvar TEMPVAR8 2 state determineregenrates
					addvarvar ENERGYPOINTREGENTICS TEMPMOD
				}
			}
			ifvarvarg ENERGYPOINTREGENTICS ENERGYPOINTREGENINTERVAL
			{ 
				setvarvar TEMPVAR MAXENERGYPOINTS
				mulvarvar TEMPVAR PLAYERLEVEL
				ifp ponsteroids divvar TEMPVAR 6667 else divvar TEMPVAR 10000
				ifvarl TEMPVAR 1 setvar TEMPVAR 1
	
				randvar TEMPVAR8 120
				addvar TEMPVAR8 1
				ifvarg TEMPVAR8 0 ifvarl TEMPVAR8 2 mulvar TEMPVAR 5 // 1
				ifvarg TEMPVAR8 1 ifvarl TEMPVAR8 5 mulvar TEMPVAR 4 // 2-4 +3
				ifvarg TEMPVAR8 4 ifvarl TEMPVAR8 14 mulvar TEMPVAR 3 // 5-13 +9
				ifvarg TEMPVAR8 13 ifvarl TEMPVAR8 41 mulvar TEMPVAR 2 // 14-40 +27
				ifvarg TEMPVAR8 40 ifvarl TEMPVAR8 122 mulvar TEMPVAR 1 // 41-121 +81
	
				// Character Specfic Multipliers/Dividors
				ifvare CHARACTERSELECTED? 1 { ifrnd 8 mulvar TEMPVAR 2 } // Duke has 3.1% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 2 { ifrnd 25 mulvar TEMPVAR 2 } // Jack has 9.7% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 3 { ifrnd 13 mulvar TEMPVAR 2 } // Bubsy has 5.1% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 4 { ifrnd 112 mulvar TEMPVAR 2 } // Ami has 43.75% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 5 { ifrnd 56 mulvar TEMPVAR 2 } // Higa has 21.8% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 6 { ifrnd 45 mulvar TEMPVAR 2 } // ESSence has 17.5% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 7 { ifrnd 23 mulvar TEMPVAR 2 } // Ted has 8.9% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 8 { ifrnd 19 mulvar TEMPVAR 2 } // Lisa has 7.4% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 9 { ifrnd 12 mulvar TEMPVAR 2 } // Cybanis has 4.6% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 10 { ifrnd 78 mulvar TEMPVAR 2 } // Christina has 30.4% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 11 { ifrnd 64 mulvar TEMPVAR 2 } // Paula has 25% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 12 { ifrnd 48 mulvar TEMPVAR 2 } // Lori has 18.75% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 13 { ifrnd 32 mulvar TEMPVAR 2 } // Minako has 12.5% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 14 { ifrnd 85 mulvar TEMPVAR 2 } // Mystery Lady has 33% chance of recovering 2x EP
				else ifvare CHARACTERSELECTED? 15 { ifrnd 48 mulvar TEMPVAR 2 } // Maken has 18.75% chance of recovering 2x EP
	
				ifvare PUBLICBETA? 0 divvar TEMPVAR 9 else divvar TEMPVAR 3
	
				ifvarl TEMPVAR 1 setvar TEMPVAR 1
				// Check Slurpee Machine [Permenant Boost Item]
				state checkslurpeemachines
				ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
				mulvar TEMP6 2 // 2% per item
				addvar TEMP6 100
				mulvarvar TEMPVAR TEMP6
				divvar TEMPVAR 100
				ifvarl TEMPVAR 1 setvar TEMPVAR 1
				ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
	
				setvar TEMPMOD 0
				ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPMOD 10 // Jewel of Four Souls
				ifvarl TEMPMOD 1 setvar TEMPMOD 1
				mulvarvar TEMPVAR TEMPMOD
	
				ifvarl TEMPVAR 1 setvar TEMPVAR 1
				ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
	
				addvarvar CURRENTENERGYPOINTS TEMPVAR
				ifvarvarg CURRENTENERGYPOINTS STATLIMITATOMIC setvarvar CURRENTENERGYPOINTS STATLIMITATOMIC
				ifvarvarg CURRENTENERGYPOINTS MAXENERGYPOINTS setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTS
				setvar TEMPVAR 0
	
				//***************************
				//*Reset the interval timer*
				//***************************
				setvarvar TEMPVAR4 PLAYERLEVEL divvar TEMPVAR4 5
	
				// Character Specfic Timer Alterations
				ifvare CHARACTERSELECTED? 1 setvar ENERGYPOINTREGENTICS -260 // Duke has 1 second MORE regen wait
				else ifvare CHARACTERSELECTED? 3 setvar ENERGYPOINTREGENTICS -130 // Bubsy has 1/2 second MORE regen wait
				else ifvare CHARACTERSELECTED? 4 setvar ENERGYPOINTREGENTICS 520 // Ami has 2 seconds less regen wait
				else ifvare CHARACTERSELECTED? 5 setvar ENERGYPOINTREGENTICS 260 // Higa has 1 second less regen wait
				else ifvare CHARACTERSELECTED? 6 setvar ENERGYPOINTREGENTICS -130 // ESSence has 1/2 second MORE regen wait
				else ifvare CHARACTERSELECTED? 8 setvar ENERGYPOINTREGENTICS 130 // Lisa has 1/2 second less regen wait
				else ifvare CHARACTERSELECTED? 9 setvar ENERGYPOINTREGENTICS 130 // Cybanis has 1/2 second less regen wait
				else ifvare CHARACTERSELECTED? 10 setvar ENERGYPOINTREGENTICS 260 // Christina has 1 second less regen wait
				else ifvare CHARACTERSELECTED? 11 setvar ENERGYPOINTREGENTICS 390 // Paula has 1 1/2 seconds less regen wait
				else ifvare CHARACTERSELECTED? 12 setvar ENERGYPOINTREGENTICS 130 // Lori has 1/2 second less regen wait
				else ifvare CHARACTERSELECTED? 13 setvar ENERGYPOINTREGENTICS 520 // Minako has 2 seconds less regen wait
				else ifvare CHARACTERSELECTED? 14 setvar ENERGYPOINTREGENTICS 650 // Mystery Lady 2 1/2 seconds less regen wait
				else ifvare CHARACTERSELECTED? 15 setvar ENERGYPOINTREGENTICS 130 // Maken has 1/2 second less regen wait
				else setvar ENERGYPOINTREGENTICS 0 // Jack and Ted have normal regen rates
	
				// Add Speed from Equipped Jewels of Four Souls
				ifvare PUBLICBETA? 0 
				{
					ifvare PLAYEREQUIPSLOTITEM1 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM2 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM3 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM4 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM5 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM6 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM7 28 addvar ENERGYPOINTREGENTICS 5620
					ifvare PLAYEREQUIPSLOTITEM8 28 addvar ENERGYPOINTREGENTICS 5620
				}
				else
				{
					ifvare PLAYEREQUIPSLOTITEM1 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM2 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM3 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM4 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM5 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM6 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM7 28 addvar ENERGYPOINTREGENTICS 1873
					ifvare PLAYEREQUIPSLOTITEM8 28 addvar ENERGYPOINTREGENTICS 1873
				}
	
				// Add Speed from Character Levels
				addvarvar ENERGYPOINTREGENTICS TEMPVAR4        
			}
		}
	}
ends

state pressoncolamachine
	ifvare oldskoolmode 0
	{
		ifvarg wallxdist VENDINGMACHINEMINDIST ifvarl wallxdist VENDINGMACHINEMAXDIST ifvarg wallydist VENDINGMACHINEMINDIST ifvarl wallydist VENDINGMACHINEMAXDIST ifvarg CURRENTHITPOINTS 0
		{
				ifhitspace
				{ 
					state stopsearchsounds
					ifvare com_pause 0
					{
						getactorvar[hitwall].VENDINGQUANITY tempe
						ifvarg tempe 0
						{
							ifvarg DOLLARS 49
							{
								setvar tempf 0
								ifvare CHARACTERSELECTED? 4 setvarvar tempg MAXHITPOINTSATOMIC else setvarvar tempg MAXHITPOINTS
								ifvarvarl CURRENTHITPOINTS tempg addvar tempf 1
								ifvare CHARACTERSELECTED? 4 setvarvar temph MAXENERGYPOINTSATOMIC else setvarvar temph MAXENERGYPOINTS
								ifvarvarl CURRENTENERGYPOINTS temph addvar tempf 1
								ifvarg tempf 0
								{
									state gotmedsyoureallyneeded
									subvar DOLLARS 50
									subvar DISPLAYDOLLARS 50
									state displaymoney
			
									// HP Restore
									setvarvar temp MAXHITPOINTS
									ifvare CHARACTERSELECTED? 4 setvar TEMP7 150 else setvar TEMP7 100 
									state secretrecipecheck
									mulvarvar temp TEMP7
									divvar temp 1000
									ifvarvarl CURRENTHITPOINTS tempg
									{
										addvarvar CURRENTHITPOINTS temp
										ifvarvarg CURRENTHITPOINTS tempg setvarvar CURRENTHITPOINTS tempg
									}
			
									// EP Restore
									setvarvar temp MAXENERGYPOINTS
									ifvare CHARACTERSELECTED? 4 setvar TEMP7 75 else setvar TEMP7 50 
									state secretrecipecheck
									mulvarvar temp TEMP7
									divvar temp 1000
									ifvarvarl CURRENTENERGYPOINTS temph
									{
										addvarvar CURRENTENERGYPOINTS temp
										ifvarvarg CURRENTENERGYPOINTS temph setvarvar CURRENTENERGYPOINTS temph
									}
			
									ifvarn player[THISACTOR].over_shoulder_on 0
									{
										ifvarg temp 0
										{
											setvarvar SHOWDAMAGE temp
											setvar SHOWDAMAGETYPE 3
											setvarvar SHOWDAMAGEACTORID THISACTOR
											state showdamage
										}
									}
			
									sound COLA_DISPENSE1
									ifrnd 168
									{
										ifvare CHARACTERSELECTED? 1 globalsound DUKE_EATFOOD1
										ifvare CHARACTERSELECTED? 5 globalsound WANG_EATFOOD1
										ifvare CHARACTERSELECTED? 8 globalsound LISA_EATFOOD1
										ifvare CHARACTERSELECTED? 15 globalsound MAKEN_EATFOOD1
									}
									getactorvar[hitwall].VENDINGQUANITY tempe
									subvar tempe 1
									setactorvar[hitwall].VENDINGQUANITY tempe
			
									ifvare CHARACTERSELECTED? 4 setvar TEMP7 150 else setvar TEMP7 100
									state secretrecipecheck_text
									state checksecretrecipes
									ifvarg ITEMARRAYID_AMOUNTTEMP 0
									{
										setvarvar TEMP4 TEMP7
										divvar TEMP4 10
										setvarvar TEMP5 TEMP7
										modvar TEMP5 10
										setvarvar TEMP8 TEMP7 divvar TEMP8 2
										setvarvar TEMP2 TEMP8
										divvar TEMP2 10
										setvarvar TEMP3 TEMP8
										modvar TEMP3 10
										redefinequote 321 ^20YOU DRANK A COLA FROM THE MACHINE! +%d.%d% HP/+%d.%d% EP!
										qsprintf 321 321 TEMP4 TEMP5 TEMP2 TEMP3
									}
									else
									{
										ifvare CHARACTERSELECTED? 4 redefinequote 321 ^20YOU DRANK A COLA FROM THE MACHINE! +15% HP/+7.5% EP!
										else redefinequote 321 ^20YOU DRANK A COLA FROM THE MACHINE! +10% HP/+5% EP!
									}
									setvar PLAYERHPDAMAGED? -1
								}
								else
								{
									sound MENU_ERROR
									redefinequote 321 ^23YOU DO NOT NEED TO DRINK ANYTHING!
								}
							}
							else
							{
								sound MENU_ERROR
								redefinequote 321 ^21YOU DO NOT HAVE ENOUGH MONEY ($50)!
							}
						}
						else 
						{
							sound MENU_ERROR
							redefinequote 321 ^21THE COLA MACHINE IS OUT OF ORDER!
						}
		
						setvarvar fta fta_normal setvar ftq 321
						state stopsearchsounds
						setvar com_pause 39
					}
				}
		}
	}
	
ends

state pressonsnackmachine
	ifvare oldskoolmode 0
	{
		ifvarg wallxdist VENDINGMACHINEMINDIST ifvarl wallxdist VENDINGMACHINEMAXDIST ifvarg wallydist VENDINGMACHINEMINDIST ifvarl wallydist VENDINGMACHINEMAXDIST ifvarg CURRENTHITPOINTS 0
		{
			ifhitspace
			{ 
				state stopsearchsounds
				ifvare com_pause 0
				{
					getactorvar[hitwall].VENDINGQUANITY tempe
					ifvarg tempe 0
					{
						ifvarg DOLLARS 24
						{          
							setvar tempf 0
							ifvarvarl CURRENTHITPOINTS MAXHITPOINTS addvar tempf 1
							ifvarvarl CURRENTENERGYPOINTS MAXENERGYPOINTS addvar tempf 1
							ifvarg tempf 0
							{
								state gotmedsyoureallyneeded
								subvar DOLLARS 25
								subvar DISPLAYDOLLARS 25
								state displaymoney
			
								// HP Restore
								setvarvar temp MAXHITPOINTS
								setvar TEMP7 50 
								state secretrecipecheck
								mulvarvar temp TEMP7
								divvar temp 1000
								addvarvar CURRENTHITPOINTS temp
								ifvarvarg CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
			
								// EP Restore
								setvarvar temp MAXENERGYPOINTS
								setvar TEMP7 100
								state secretrecipecheck
								mulvarvar temp TEMP7
								divvar temp 1000
								addvarvar CURRENTENERGYPOINTS temp
								ifvarvarg CURRENTENERGYPOINTS MAXENERGYPOINTS setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTS
			
								ifvarn player[THISACTOR].over_shoulder_on 0
								{
									ifvarg temp 0
									{
										setvarvar SHOWDAMAGE temp
										setvar SHOWDAMAGETYPE 3
										setvarvar SHOWDAMAGEACTORID THISACTOR
										state showdamage
									}
								}
			
								sound SNACK_DISPENSE1
								ifrnd 136
								{
									ifvare CHARACTERSELECTED? 1 globalsound DUKE_EATFOOD1
									ifvare CHARACTERSELECTED? 5 globalsound WANG_EATFOOD1
									ifvare CHARACTERSELECTED? 8 globalsound LISA_EATFOOD1
									ifvare CHARACTERSELECTED? 15 globalsound MAKEN_EATFOOD1
								}
								getactorvar[hitwall].VENDINGQUANITY tempe
								subvar tempe 1
								setactorvar[hitwall].VENDINGQUANITY tempe
			
								setvar TEMP7 50
								state secretrecipecheck_text
								state checksecretrecipes
								ifvarg ITEMARRAYID_AMOUNTTEMP 0
								{
									setvarvar TEMP4 TEMP7
									divvar TEMP4 10
									setvarvar TEMP5 TEMP7
									modvar TEMP5 10
									setvarvar TEMP8 TEMP7 mulvar TEMP8 2
									setvarvar TEMP2 TEMP8
									divvar TEMP2 10
									setvarvar TEMP3 TEMP8
									modvar TEMP3 10
									redefinequote 321 ^20YOU ATE A SNACK FROM THE MACHINE! +%d.%d% HP/+%d.%d% EP!
									qsprintf 321 321 TEMP4 TEMP5 TEMP2 TEMP3
								}
								else
								{
									redefinequote 321 ^20YOU ATE A SNACK FROM THE MACHINE! +5% HP/+10% EP!
								}      
								setvar PLAYERHPDAMAGED? -1
							}
							else
							{
								sound MENU_ERROR
								redefinequote 321 ^23YOU DO NOT NEED TO EAT ANYTHING!
							}
						}
						else
						{
							sound MENU_ERROR
							redefinequote 321 ^21YOU DO NOT HAVE ENOUGH MONEY ($25)!
						}
					}
					else
					{
						sound MENU_ERROR
						redefinequote 321 ^21THE SNACK MACHINE IS OUT OF ORDER!
					}
		  
					setvarvar fta fta_normal setvar ftq 321
					state stopsearchsounds
					setvar com_pause 39
				}
			}
		}
	}
ends

state gameover
	setuserdef[THISACTOR].eog 1 
	endofgame 1
	startlevel 0 0
ends

state invulnicon-player
	ifvare oldskoolmode 0
	{
		getactor[THISACTOR].x TESTX 
		getactor[THISACTOR].y TESTY
		getactor[THISACTOR].z TESTZ
		setactor[THISACTOR].x TESTX
		setactor[THISACTOR].y TESTY 
		setactor[THISACTOR].z TESTZ
		getactor[THISACTOR].xrepeat TESTXREPEAT1 
		getactor[THISACTOR].yrepeat TESTYREPEAT1 
		getactorvar[THISACTOR].ACTORSHEIGHT INVULNAURARANGEZ
		mulvarvar INVULNAURARANGEZ TESTYREPEAT1
		mulvar INVULNAURARANGEZ 4
		setvar INVULNAURARANGEXY 844
		addvarvar INVULNAURARANGEXY TESTXREPEAT1
		addvar INVULNAURARANGEZ 1688
		addvarvar INVULNAURARANGEZ TESTYREPEAT1
		addvarvar INVULNAURARANGEZ TESTYREPEAT1
		ifvare VEHICLEID -1
		{
			ifvarg INVULNTIME 0 state invulntarget_player
		}
		else
		{
			getactorvar[VEHICLEID].ACTORINVULNTIME tempb
			ifvarg tempb 0 { state invulntarget_player }
		}
	}
ends

state globaltimer
	ifvare mainmenu 0 { ifvarl TIMERRAWFORMAT 21474836 addvar TIMERRAWFORMAT 1 }
	ifvare mainmenu 0 { ifvarl TIMERRAWFORMAT 21474836 { ifvarl TIMERRAWFORMAT_LEVEL 21474836 addvar TIMERRAWFORMAT_LEVEL 1 } }
ends

state standard_pjibs
	/*
	guts JIBS1 1
	guts JIBS3 2
	guts JIBS4 1
	guts JIBS5 1
	guts JIBS6 2
	guts DUKETORSO 1
	guts DUKELEG 2
	guts DUKEGUN 1
	*/
ends

state randomdeathtaunt
	ifrnd 28 globalsound KAHNTAUNT1
	else ifrnd 32 globalsound KAHNTAUNT2
	else ifrnd 37 globalsound KAHNTAUNT3
	else ifrnd 42 globalsound KAHNTAUNT4
	else ifrnd 53 globalsound KAHNTAUNT5
	else ifrnd 64 globalsound KAHNTAUNT6
	else ifrnd 85 globalsound KAHNTAUNT7
	else ifrnd 128 globalsound KAHNTAUNT8
	else globalsound KAHNTAUNT9
ends

move DUKENOTMOVING
state handle_dead_dukes
	ifvare mainmenu 0 fall
	ifmove 0   // 1st time initializiation...
	{
		ifrnd 128
			cstat 4
		else
			cstat 0
		move DUKENOTMOVING
	}
	
	ifsquished
	{
		sound SQUISHED
		state random_ooz
		killit
	}
	else
		ifcount 1024
			ifpdistg 4096
				killit
	else
	{
		strength 0
		ifhitweapon
			ifwasweapon RADIUSEXPLOSION
		{
			state standard_jibs
			killit
		}
	}
ends

action PLYINGFRAMES 0 1 0 1 1
actor DUKELYINGDEAD 0 PLYINGFRAMES
	state handle_dead_dukes
enda

//************************************************************
//*Actions for all of the sprites representing the characters*
//************************************************************
// APLAYER Sprite = 1405

// Duke Nukem [sprite actions]
action PGROWING   		0
action PSTAND     		0   1   5   1  1
action PEXPLODE   		106   5   1   1   10
action PEXPLODEAD		113   1   1
action PJPHOUVER  		15   1   5   1
action PWALK    		20   4   5   1   16
action PRUN     		20   4   5   1   10
action PWALKBACK  		45   4   5  -1   16
action PRUNBACK   		45   4   5  -1   10
action PJUMPING   		50   4   5   1   30
action PFALLING   		65   1   5
action PDUCKING   		86   1   5
action PCRAWLING  		86   3   5   1   20
action PAKICKING  		40   2   5   1   25
action PFLINTCHING		106  1   1   1   10
action PTHROWNBACK		106  5   1   1   18
action PFROZEN    		20  1   5
action PLYINGDEAD  		113  1   1
action PSWIMMINGGO		375   1   5   1   10
action PSWIMMING   		375   4   5   1   13
action PSWIMMINGWAIT 	395   1   5   1   13
action PTREDWATER  		395   2   5   1   17
// Jack Walker

// Bubsy Bobcat [Normal]

// Bubsy Bobcat [The Mask]

// Ami Mizuno [Civilian]

// Ami Mizuno [Senshi]

// Ami Mizuno [Balanced]

// Higa Hakaisha

// ESSence Margalan [Armor]

// ESSence Margalan [Armorless]

// Ted Maldoras

// Lisa Bates

// Cybanis Morgandos

// Nethra Maboroshi [Drone Form]

// Nethra Maboroshi [Human Form]

// Paula Polestar

// Lori Stephens

// Minako Aino [Civilian]

// Minako Aino [Senshi]

// Minako Aino [Balanced]

// "Mystery Woman"

// Maken Shinkara

// Riot Tanks

action PTANKWAIT 4030 1 7 1 1 cstat 1 // 5435 = 1405 = 4030
// action PTANKWAIT 4766 1 7 1 1 cstat 1 // 6171 = 1405 = 4766

move PSTOPED
move PSHRINKING 		// used as a var only
move PGROWINGPOP        // Used only as a variable

//***********************************************
//*States for Handling Branching APLAYER actions*
//***********************************************

state setplayeraction_pstand
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PSTAND
	}
	else action PSTAND
ends

state setplayeraction_prun
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PRUN
	}
	else action PRUN
ends

state setplayeraction_prunback
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PRUNBACK
	}
	else action PRUNBACK
ends

state setplayeraction_pwalk
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PWALK
	}
	else action PWALK
ends

state setplayeraction_pwalkback
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PWALKBACK
	}
	else action PWALKBACK
ends

state setplayeraction_pjumping
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PJUMPING
	}
	else action PJUMPING
ends

state setplayeraction_pfalling
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PFALLING
	}
	else action PFALLING
ends

state setplayeraction_pducking
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PDUCKING
	}
	else action PDUCKING
ends

state setplayeraction_pcrawling
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PCRAWLING
	}
	else action PCRAWLING
ends

state setplayeraction_pakicking
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PAKICKING
	}
	else action PAKICKING
ends

state setplayeraction_pjphouver
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PJPHOUVER
	}
	else action PJPHOUVER
ends

state setplayeraction_pswimming
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PSWIMMING
	}
	else action PSWIMMING
ends

state setplayeraction_pswimminggo
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PSWIMMINGGO
	}
	else action PSWIMMINGGO
ends

state setplayeraction_pswimmingwait
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PSWIMMINGWAIT
	}
	else action PSWIMMINGWAIT
ends

state setplayeraction_ptredwater
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 action PTANKWAIT
		else action PTREDWATER
	}
	else action PTREDWATER
ends

state check_pstandard
	ifp pwalking state setplayeraction_pwalk
	else ifp pkicking state setplayeraction_pakicking
	else ifp pwalkingback state setplayeraction_pwalkback
	else ifp prunning state setplayeraction_prun
	else ifp prunningback state setplayeraction_prunback
	else ifp pjumping state setplayeraction_pjumping
	else ifp pducking state setplayeraction_pducking
ends

state wallclimbspeedcheck
	addvar WALLCLIMBSNDTIMER 1
	getuserdef[THISACTOR].auto_run tempc
	setvarvar CHARACTERSPEEDVARTEMP CHARACTERSPEEDVAR

	setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
	ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar CHARACTERSPEEDVARTEMP 3 divvar CHARACTERSPEEDVARTEMP 5 }
	else ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar CHARACTERSPEEDVARTEMP 4 divvar CHARACTERSPEEDVARTEMP 5 }

	ifvare tempc 0 // Walking...
	{
		ifvarg CHARACTERSPEEDVARTEMP -1 ifvarl CHARACTERSPEEDVARTEMP 14 setvar TEMP 17 // 0-13
		ifvarg CHARACTERSPEEDVARTEMP 13 ifvarl CHARACTERSPEEDVARTEMP 26 setvar TEMP 16 // 14-25
		ifvarg CHARACTERSPEEDVARTEMP 25 ifvarl CHARACTERSPEEDVARTEMP 39 setvar TEMP 15 // 26-38
		ifvarg CHARACTERSPEEDVARTEMP 38 ifvarl CHARACTERSPEEDVARTEMP 51 setvar TEMP 14 // 39-50
		ifvarg CHARACTERSPEEDVARTEMP 50 ifvarl CHARACTERSPEEDVARTEMP 58 setvar TEMP 13 // 51-57
		ifvarg CHARACTERSPEEDVARTEMP 57 ifvarl CHARACTERSPEEDVARTEMP 65 setvar TEMP 12 // 58-64
		ifvarg CHARACTERSPEEDVARTEMP 64 ifvarl CHARACTERSPEEDVARTEMP 71 setvar TEMP 11 // 65-70
		ifvarg CHARACTERSPEEDVARTEMP 70 ifvarl CHARACTERSPEEDVARTEMP 81 setvar TEMP 10 // 71-80
		ifvarg CHARACTERSPEEDVARTEMP 80 ifvarl CHARACTERSPEEDVARTEMP 86 setvar TEMP 9 // 81-85
		ifvarg CHARACTERSPEEDVARTEMP 85 ifvarl CHARACTERSPEEDVARTEMP 91 setvar TEMP 8 // 86-90
		ifvarg CHARACTERSPEEDVARTEMP 90 ifvarl CHARACTERSPEEDVARTEMP 96 setvar TEMP 7 // 91-95
		ifvarg CHARACTERSPEEDVARTEMP 95 ifvarl CHARACTERSPEEDVARTEMP 106 setvar TEMP 6 // 96-105
		ifvarg CHARACTERSPEEDVARTEMP 105 ifvarl CHARACTERSPEEDVARTEMP 116 setvar TEMP 5 // 106-115
		ifvarg CHARACTERSPEEDVARTEMP 115 setvar TEMP 4 // 116+
	}
	else // Running
	{
		ifvarg CHARACTERSPEEDVARTEMP -1 ifvarl CHARACTERSPEEDVARTEMP 26 setvar TEMP 9 // 0-25
		ifvarg CHARACTERSPEEDVARTEMP 25 ifvarl CHARACTERSPEEDVARTEMP 51 setvar TEMP 8 // 26-50
		ifvarg CHARACTERSPEEDVARTEMP 50 ifvarl CHARACTERSPEEDVARTEMP 61 setvar TEMP 7 // 51-60
		ifvarg CHARACTERSPEEDVARTEMP 60 ifvarl CHARACTERSPEEDVARTEMP 71 setvar TEMP 6 // 61-70
		ifvarg CHARACTERSPEEDVARTEMP 70 ifvarl CHARACTERSPEEDVARTEMP 91 setvar TEMP 5 // 71-90
		ifvarg CHARACTERSPEEDVARTEMP 90 ifvarl CHARACTERSPEEDVARTEMP 116 setvar TEMP 4 // 91-115
		ifvarg CHARACTERSPEEDVARTEMP 115 setvar TEMP 3 // 116+
	}

	switch WALLCLIMBSOUND
		case 535 case 536
			ifvarvarg WALLCLIMBSNDTIMER TEMP { ifvare footstepsndtoggle 1 { ifrnd 128 sound LADDER_CLIMB1 else sound LADDER_CLIMB2 } setvar WALLCLIMBSNDTIMER 0 }
			break
		default
			ifvarvarg WALLCLIMBSNDTIMER TEMP { ifvare footstepsndtoggle 1 { ifvarn WALLCLIMBSOUND -1 soundvar WALLCLIMBSOUND } setvar WALLCLIMBSNDTIMER 0 }
			break
	endswitch
	/*
	ifvare WALLCLIMBSOUND 535 
	{
		ifvarvarg WALLCLIMBSNDTIMER TEMP
		{
			ifvare footstepsndtoggle 1 { ifrnd 128 sound LADDER_CLIMB1 else sound LADDER_CLIMB2 }
			setvar WALLCLIMBSNDTIMER 0
		}
	}
	else
	ifvare WALLCLIMBSOUND 536
	{
		ifvarvarg WALLCLIMBSNDTIMER TEMP
		{
			ifvare footstepsndtoggle 1 { ifrnd 128 sound LADDER_CLIMB1 else sound LADDER_CLIMB2 }
			setvar WALLCLIMBSNDTIMER 0
		}
	}
	else
	{
		ifvarvarg WALLCLIMBSNDTIMER TEMP
		{
			ifvare footstepsndtoggle 1 { ifvarn WALLCLIMBSOUND -1 soundvar WALLCLIMBSOUND }
			setvar WALLCLIMBSNDTIMER 0
		}
	}
	*/
ends


state wallclimbcode
	ifaction PSTAND nullop
	else state setplayeraction_pstand
	
	/*
	ifvare WALLTYPE 4
	{
		getplayer[THISACTOR].ang CLIMBWALLANG
		setvarvar digx CLIMBWALLIDX
		addvar digx 320
		subvar digy 0
		rotatepoint CLIMBWALLIDX CLIMBWALLIDY digx digy CLIMBWALLANG CLIMBWALLX CLIMBWALLY
		updatesectorz CLIMBWALLX CLIMBWALLY z mysector
		ifvarn mysector -1
		{
			setplayer[THISACTOR].posx CLIMBWALLX
			setplayer[THISACTOR].posy CLIMBWALLY
			setactor[PLAYERID].x CLIMBWALLX
			setactor[PLAYERID].y CLIMBWALLY
		}
	
		// addlogvar CLIMBWALLIDX
		// addlogvar CLIMBWALLIDY
		// addlogvar digx
		// addlogvar digy
		// addlogvar CLIMBWALLANG
		// addlogvar CLIMBWALLX
		// addlogvar CLIMBWALLY
	
		setvarvar TEMPVAR4 CLIMBWALLIDX
		setvarvar TEMPVAR5 CLIMBWALLIDY
		getplayer[THISACTOR].posx TEMPVAR2
		getplayer[THISACTOR].posy TEMPVAR3
		subvarvar TEMPVAR4 TEMPVAR2
		subvarvar TEMPVAR5 TEMPVAR3
		getangle TEMPVAR TEMPVAR4 TEMPVAR5
		setplayer[THISACTOR].ang TEMPVAR
	}
	*/
	
	ifp ponground setvar bpress 0
	setplayer[THISACTOR].falling_counter 0
	ifvare fpress 0 ifvare bpress 0
	{
		setvar CLIMBINGSPEED -256
		getplayer[THISACTOR].posx CLIMBWALLX
		getplayer[THISACTOR].posy CLIMBWALLY
		getactor[PLAYERID].x CLIMBWALLX
		getactor[PLAYERID].y CLIMBWALLY
	}
	else
	{
		getplayer[THISACTOR].posz z
		updatesectorz CLIMBWALLX CLIMBWALLY z mysector
		ifvarn mysector -1
		{
			setplayer[THISACTOR].posx CLIMBWALLX
			setplayer[THISACTOR].posy CLIMBWALLY
			setactor[PLAYERID].x CLIMBWALLX
			setactor[PLAYERID].y CLIMBWALLY
		}
	}
	
	ifp ponground setvar CLIMBINGSPEED 0 else
	{
		setplayer[THISACTOR].posxv 0
		setplayer[THISACTOR].posyv 0
	}
	
	subvar ONAWALL? 1
	
	setplayer[THISACTOR].poszv CLIMBINGSPEED
	ifvarg CLIMBINGSPEED 256 state wallclimbspeedcheck else ifvarl CLIMBINGSPEED -256 state wallclimbspeedcheck
ends

state playershrink
	ifvare oldskoolmode 0
	{
		randvar TEMPVAR5 999 addvar TEMPVAR5 1
		ifvarvarg TEMPVAR5 SHRINKINGRESISTPLAYER
		{
			state stoppainsounds
			ifrnd 128 state deflectshrinker 
			else 
			{ 
				ifvarn VEHICLEID -1 nullop
				else
				{
				setvar SHRUNK? 1
				palfrom 48 0 48
				move PSHRINKING // used as a var only.
				sound ACTOR_SHRINKING
				cstat 0
				break
				}
			}
		}
		else state deflectshrinker 
	}
	else
	{
		state stoppainsounds
		setvar SHRUNK? 1
		palfrom 48 0 48
		move PSHRINKING // used as a var only.
		sound ACTOR_SHRINKING
		cstat 0
		break
	}
ends

state canceldeadactions
	ifaction PEXPLODE { ifvarg PARTYALIVE 0 state setplayeraction_pstand }
	ifaction PEXPLODEAD { ifvarg PARTYALIVE 0 state setplayeraction_pstand }
	ifaction PFLINTCHING { ifvarg PARTYALIVE 0 state setplayeraction_pstand }
	ifaction PTHROWNBACK { ifvarg PARTYALIVE 0 state setplayeraction_pstand }
	ifaction PLYINGDEAD { ifvarg PARTYALIVE 0 state setplayeraction_pstand }
ends

state mercurycomputerautomapcheck
	setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
	ifvare MISCARRAYID_AMOUNTTEMP 1
	{
		getuserdef[THISACTOR].showallmap temp
		ifvarn temp 1 activatecheat 17 
	}
ends

state checkplayergrowthrates
	setvarvar CHARACTERARRAY CHARACTERSELECTED?
	getactorvar[CHARACTERARRAY].CHARACTERHPINCREASECURVE PLAYERHPINCREASECURVE
	getactorvar[CHARACTERARRAY].CHARACTERAPINCREASECURVE PLAYERAPINCREASECURVE
	getactorvar[CHARACTERARRAY].CHARACTEREPINCREASECURVE PLAYEREPINCREASECURVE
	getactorvar[CHARACTERARRAY].CHARACTERATKINCREASECURVE PLAYERATKINCREASECURVE
	getactorvar[CHARACTERARRAY].CHARACTERDEFINCREASECURVE PLAYERDEFINCREASECURVE
	// getactorvar[CHARACTERARRAY].CHARACTERLIFTSTRENGTH PLAYERLIFTSTRENGTH
ends

state checkplayerinventoryitems
	setvarvar CHARACTERARRAY CHARACTERSELECTED?
	ifvarg INVENTORYSLOTMAX 0 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 PLAYEREQUIPSLOTITEM1 else setvar PLAYEREQUIPSLOTITEM1 -1
	ifvarg INVENTORYSLOTMAX 1 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 PLAYEREQUIPSLOTITEM2 else setvar PLAYEREQUIPSLOTITEM2 -1
	ifvarg INVENTORYSLOTMAX 2 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 PLAYEREQUIPSLOTITEM3 else setvar PLAYEREQUIPSLOTITEM3 -1
	ifvarg INVENTORYSLOTMAX 3 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 PLAYEREQUIPSLOTITEM4 else setvar PLAYEREQUIPSLOTITEM4 -1
	ifvarg INVENTORYSLOTMAX 4 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 PLAYEREQUIPSLOTITEM5 else setvar PLAYEREQUIPSLOTITEM5 -1
	ifvarg INVENTORYSLOTMAX 5 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 PLAYEREQUIPSLOTITEM6 else setvar PLAYEREQUIPSLOTITEM6 -1
	ifvarg INVENTORYSLOTMAX 6 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 PLAYEREQUIPSLOTITEM7 else setvar PLAYEREQUIPSLOTITEM7 -1
	ifvarg INVENTORYSLOTMAX 7 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 PLAYEREQUIPSLOTITEM8 else setvar PLAYEREQUIPSLOTITEM8 -1
ends

state removeexcessinventory-checkids
	ifvare TEMPVAR3 1 { state checksunrings addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 2 { state checkaquarings addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 3 { state checkplasmarings addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 4 { state checkspiritrings addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 5 { state checkcharmankhs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 6 { state checkmirrorshields addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 7 { state checkexpbadges addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 8 { state checkrankbadges addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 9 { state checkmoneybadges addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 10 { state checkriotshields addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 11 { state checknyxglovepairs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 12 { state checkrabbitsfoots addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 13 { state checkjumpbootpairs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 14 { state checkshockabbootpairs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 15 { state checkhappyshoepairs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 16 { state checkstyleshoepairs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 17 { state checkcharmshoepairs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 18 { state checkpowerwrists addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 19 { state checkhockeymasks addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 20 { state checkgemstonecrowns addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 21 { state checkironrunes addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 22 { state checktwilightcapes addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 23 { state checksnakearmbands addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 24 { state checkmedicbags addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 25 { state checkserpenthelmets addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 26 { state checkenergyincurments addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 27 { state checkyinyangorbs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 28 { state checkshikonjewels addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 29 { state checkliquidmetalamulets addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 30 { state checkmandalabracelets addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare TEMPVAR3 31 { state checkaqualungs addvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	//addlogvar TEMPVAR3
	setvar TEMPVAR3 0
ends

state characterperformremoveslot1
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 TEMPVAR3 }
ends
state characterperformremoveslot2
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 TEMPVAR3 }
ends
state characterperformremoveslot3
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 TEMPVAR3 }
ends
state characterperformremoveslot4
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 TEMPVAR3 }
ends
state characterperformremoveslot5
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 TEMPVAR3 }
ends
state characterperformremoveslot6
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 TEMPVAR3 }
ends
state characterperformremoveslot7
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 TEMPVAR3 }
ends
state characterperformremoveslot8
	getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 TEMPVAR3 ifvarn TEMPVAR3 0 { state removeexcessinventory-checkids setactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 TEMPVAR3 }
ends

state removeexcessinventoryslots
	ifvarl INVENTORYSLOTMAX 8
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot8
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot8
	}
	ifvarl INVENTORYSLOTMAX 7
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot7
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot7
	}
	ifvarl INVENTORYSLOTMAX 6
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot6
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot6
	}
	ifvarl INVENTORYSLOTMAX 5
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot5
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot5
	}
	ifvarl INVENTORYSLOTMAX 4
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot4
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot4
	}
	ifvarl INVENTORYSLOTMAX 3
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot3
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot3
	}
	ifvarl INVENTORYSLOTMAX 2
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot2
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot2
	}
	ifvarl INVENTORYSLOTMAX 1
	{
		setvarvar CHARACTERARRAY 1 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 2 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 3 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 4 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 5 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 6 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 7 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 8 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 9 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 10 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 11 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 12 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 13 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 14 state characterperformremoveslot1
		setvarvar CHARACTERARRAY 15 state characterperformremoveslot1
	}
ends

state checkplayersupportlevels
	setvarvar CHARACTERARRAY CHARACTERSELECTED?
	ifvare DUKE? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTDUKE PLAYERSUPPORTDUKE else setvar PLAYERSUPPORTDUKE -1
	ifvare JACK? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTJACK PLAYERSUPPORTJACK else setvar PLAYERSUPPORTJACK -1
	ifvare BUBSY? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTBUBSY PLAYERSUPPORTBUBSY else setvar PLAYERSUPPORTBUBSY -1
	ifvare AMI? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTAMI PLAYERSUPPORTAMI else setvar PLAYERSUPPORTAMI -1
	ifvare LOWANG? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTLOWANG PLAYERSUPPORTLOWANG else setvar PLAYERSUPPORTLOWANG -1
	ifvare ESSENCE? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTESSENCE PLAYERSUPPORTESSENCE else setvar PLAYERSUPPORTESSENCE -1
	ifvare TED? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTTED PLAYERSUPPORTTED else setvar PLAYERSUPPORTTED -1
	ifvare LISA? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTLISA PLAYERSUPPORTLISA else setvar PLAYERSUPPORTLISA -1
	ifvare CYBANIS? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTCYBANIS PLAYERSUPPORTCYBANIS else setvar PLAYERSUPPORTCYBANIS -1
	ifvare NETHRA? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTNETHRA PLAYERSUPPORTNETHRA else setvar PLAYERSUPPORTNETHRA -1
	ifvare PAULA? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTPAULA PLAYERSUPPORTPAULA else setvar PLAYERSUPPORTPAULA -1
	ifvare LORI? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTLORI PLAYERSUPPORTLORI else setvar PLAYERSUPPORTLORI -1
	ifvare MINAKO? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTMINAKO PLAYERSUPPORTMINAKO else setvar PLAYERSUPPORTMINAKO -1
	ifvare MYSTERY1? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTMYSTERY1 PLAYERSUPPORTMYSTERY1 else setvar PLAYERSUPPORTMYSTERY1 -1
	ifvare MAKEN? 1 getactorvar[CHARACTERARRAY].CHARACTERSUPPORTMAKEN PLAYERSUPPORTMAKEN else setvar PLAYERSUPPORTMAKEN -1
ends

state checkplayermaxhp
	getactorvar[CHARACTERARRAY].CHARACTERHP temp
	getactorvar[CHARACTERARRAY].CHARACTERMAXHP tempb
	ifvarvarl temp tempb setvarvar temp tempb
	setactorvar[CHARACTERARRAY].CHARACTERHP temp
ends

state characterformspeedmod
	getplayer[THISACTOR].posxv posxv
	mulvarvar posxv TEMPVAR4
	divvar posxv 100
	setplayer[THISACTOR].posxv posxv
	getplayer[THISACTOR].posyv posyv
	mulvarvar posyv TEMPVAR4
	divvar posyv 100
	setplayer[THISACTOR].posyv posyv
ends

state getaccelerationlimits
	getplayer[THISACTOR].runspeed CALCVAR1
	subvar CALCVAR1 46500
	ifvarl CALCVAR1 0 setvar CALCVAR1 0
	ifvarg CALCVAR1 14500 setvar CALCVAR1 14500
	divvar CALCVAR1 145
	
	ifvare CALCVAR1 0 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 0 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 0 else setvar ACCELFACTOR 0 }
	ifvare CALCVAR1 1 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 19 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 12 else setvar ACCELFACTOR 16 }
	ifvare CALCVAR1 2 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 33 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 22 else setvar ACCELFACTOR 28 }
	ifvare CALCVAR1 3 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 44 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 31 else setvar ACCELFACTOR 38 }
	ifvare CALCVAR1 4 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 53 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 38 else setvar ACCELFACTOR 46 }
	ifvare CALCVAR1 5 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 61 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 44 else setvar ACCELFACTOR 53 }
	ifvare CALCVAR1 6 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 67 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 50 else setvar ACCELFACTOR 59 }
	ifvare CALCVAR1 7 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 72 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 54 else setvar ACCELFACTOR 64 }
	ifvare CALCVAR1 8 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 76 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 59 else setvar ACCELFACTOR 68 }
	ifvare CALCVAR1 9 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 80 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 62 else setvar ACCELFACTOR 72 }
	ifvare CALCVAR1 10 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 83 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 66 else setvar ACCELFACTOR 76 }
	ifvare CALCVAR1 11 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 86 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 69 else setvar ACCELFACTOR 79 }
	ifvare CALCVAR1 12 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 88 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 72 else setvar ACCELFACTOR 81 }
	ifvare CALCVAR1 13 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 91 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 74 else setvar ACCELFACTOR 84 }
	ifvare CALCVAR1 14 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 92 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 76 else setvar ACCELFACTOR 86 }
	ifvare CALCVAR1 15 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 94 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 78 else setvar ACCELFACTOR 88 }
	ifvare CALCVAR1 16 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 96 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 80 else setvar ACCELFACTOR 89 }
	ifvare CALCVAR1 17 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 97 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 82 else setvar ACCELFACTOR 91 }
	ifvare CALCVAR1 18 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 98 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 84 else setvar ACCELFACTOR 92 }
	ifvare CALCVAR1 19 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 99 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 85 else setvar ACCELFACTOR 93 }
	ifvare CALCVAR1 20 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 100 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 86 else setvar ACCELFACTOR 95 }
	ifvare CALCVAR1 21 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 101 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 88 else setvar ACCELFACTOR 96 }
	ifvare CALCVAR1 22 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 89 else setvar ACCELFACTOR 97 }
	ifvare CALCVAR1 23 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 90 else setvar ACCELFACTOR 97 }
	ifvare CALCVAR1 24 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 91 else setvar ACCELFACTOR 98 }
	ifvare CALCVAR1 25 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 92 else setvar ACCELFACTOR 99 }
	ifvare CALCVAR1 26 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 92 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 27 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 93 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 28 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 94 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 29 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 94 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 30 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 95 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 31 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 96 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 32 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 96 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 33 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 97 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 34 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 97 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 35 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 97 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 36 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 37 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 38 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 39 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 40 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 41 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 42 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 43 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 44 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 45 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 46 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 47 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 48 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 49 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 50 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 51 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 52 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 53 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 54 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 55 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 56 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 57 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 58 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 59 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 60 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 108 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 61 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 62 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 63 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 64 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 65 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 105 }
	ifvare CALCVAR1 66 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 67 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 68 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 107 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 69 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 70 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 71 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 101 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 72 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 73 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 74 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 104 }
	ifvare CALCVAR1 75 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 106 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 76 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 77 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 78 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 79 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 80 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 81 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 105 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 82 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 100 else setvar ACCELFACTOR 103 }
	ifvare CALCVAR1 83 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 84 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 } 
	ifvare CALCVAR1 85 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 86 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 87 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 104 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 88 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 89 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 102 }
	ifvare CALCVAR1 90 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 91 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 99 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 92 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 93 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 103 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 94 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 95 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 101 }
	ifvare CALCVAR1 96 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 97 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 98 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 98 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 99 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 102 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 97 else setvar ACCELFACTOR 100 }
	ifvare CALCVAR1 100 { ifvarand PLAYERSTATUS? 2 setvar ACCELFACTOR 101 else ifvarand PLAYERSTATUS? 4 setvar ACCELFACTOR 97 else setvar ACCELFACTOR 100 }
	
	ifvare sector[PLAYERSECTOR].lotag 1 { ifp ponground subvar ACCELFACTOR 3 }
	ifvare CHARACTERSELECTED? 3 
	{
		setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 1 addvar ACCELFACTOR 1 
		setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
		ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar ACCELFACTOR 75 divvar ACCELFACTOR 100 }
	}
	ifvare CHARACTERSELECTED? 4
	{
		setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 2 addvar ACCELFACTOR 1 
	}
	ifvare CHARACTERSELECTED? 6
	{
		setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar ACCELFACTOR 875 divvar ACCELFACTOR 1000 }
	}
	ifvare CHARACTERSELECTED? 10 
	{
		setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 1 addvar ACCELFACTOR 1 
	}
	ifvare CHARACTERSELECTED? 13
	{
		setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 2 addvar ACCELFACTOR 1 
	}
ends

state liftaccelcap
	ifvarn SPRITEID-HOLDING -1 ifvare SPRITEID-TELEKENESIS_P -1
	{
		setvarvar STRENGTHRATIO PLAYERLIFTSTRENGTHTEMP
		mulvar STRENGTHRATIO 100
		divvarvar STRENGTHRATIO actorvar[SPRITEID-HOLDING].ACTORWEIGHT
	
		// limit player speed
		ifvarvarg STRENGTHRATIO GRABRATIO
		{
		setvarvar PHYSICSTEMPC STRENGTHRATIO
		subvarvar PHYSICSTEMPC GRABRATIO
		addvar PHYSICSTEMPC 1
	
		setvarvar PHYSICSTEMPB LIFTRATIO
		subvarvar PHYSICSTEMPB GRABRATIO
		addvar PHYSICSTEMPB 1
	
		mulvar PHYSICSTEMPC 60 // 100
		divvarvar PHYSICSTEMPC PHYSICSTEMPB
	
		setvar PHYSICSTEMP 20
		addvarvar PHYSICSTEMP PHYSICSTEMPC
		ifvarl PHYSICSTEMP 20 setvar PHYSICSTEMP 20
		ifvarg PHYSICSTEMP 100 setvar PHYSICSTEMP 100
		
		mulvarvar ACCELFACTOR PHYSICSTEMP
		divvar ACCELFACTOR 100
	
		ifp pwalking { mulvar ACCELFACTOR 4 divvar ACCELFACTOR 5 }
		else ifp pducking { mulvar ACCELFACTOR 3 divvar ACCELFACTOR 5 }
		}
	}
ends

state moveaccelcap
	ifvarn PLAYERPUSHINGTIMER 0
	{
		ifvarand extbits 1 mulvar ACCELFACTOR 35 divvar ACCELFACTOR 100
		ifvarand extbits 2 mulvar ACCELFACTOR 25 divvar ACCELFACTOR 100
	}
ends

state healthaccelcap
	ifvarn oldskoolmode 1
	{
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar ACCELFACTOR 3 divvar ACCELFACTOR 5 }
		else ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar ACCELFACTOR 4 divvar ACCELFACTOR 5 }
	}
ends

state weaponaccelcap
	setvar TEMPVAR4 0
	ifvare CHARACTERSELECTED? 6 addvar TEMPVAR4 1 // ESSence has the strength to carry all of his weapons with no weight-penalty
	ifvare CHARACTERSELECTED? 9 addvar TEMPVAR4 1 // Cybanis has the strength to carry all of his weapons with no weight-penalty
	ifvare CHARACTERSELECTED? 14 addvar TEMPVAR4 1 // 'Mystery Lady' has the strength to carry all of her weapons with no weight-penalty
	ifvare TEMPVAR4 0 // other characters will experience some degree of weight-penalty when equipped with certain weapons
	{
		ifvare SPRITEID-HOLDING -1 // ifvare SPRITEID-TELEKENESIS_P -1
		{
			ifvare VEHICLEID -1
			{
				ifp ponsteroids 
				{
					ifvare player[THISACTOR].curr_weapon 0 { mulvar ACCELFACTOR 3000 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 1 { mulvar ACCELFACTOR 2999 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 2 { mulvar ACCELFACTOR 2997 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 3 { mulvar ACCELFACTOR 2996 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 4 { mulvar ACCELFACTOR 2991 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 5 { mulvar ACCELFACTOR 2998 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 6 { mulvar ACCELFACTOR 2995 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 7 { mulvar ACCELFACTOR 2993 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 8 { mulvar ACCELFACTOR 2997 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 9 { mulvar ACCELFACTOR 2996 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 10 { mulvar ACCELFACTOR 3000 divvar ACCELFACTOR 3000 }
					else ifvare player[THISACTOR].curr_weapon 11 { mulvar ACCELFACTOR 2995 divvar ACCELFACTOR 3000 }		
				}
				else
				{
					ifvare player[THISACTOR].curr_weapon 0 { mulvar ACCELFACTOR 300 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 1 { mulvar ACCELFACTOR 299 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 2 { mulvar ACCELFACTOR 297 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 3 { mulvar ACCELFACTOR 296 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 4 { mulvar ACCELFACTOR 291 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 5 { mulvar ACCELFACTOR 298 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 6 { mulvar ACCELFACTOR 295 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 7 { mulvar ACCELFACTOR 293 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 8 { mulvar ACCELFACTOR 297 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 9 { mulvar ACCELFACTOR 296 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 10 { mulvar ACCELFACTOR 300 divvar ACCELFACTOR 300 }
					else ifvare player[THISACTOR].curr_weapon 11 { mulvar ACCELFACTOR 295 divvar ACCELFACTOR 300 }		
				}
		
			}
		}
	}
ends

state winterclothesaccelcap
	ifvarg winterclothes 0
	{
		setvar tempc 8
		mulvarvar tempc winterclothes
		divvar tempc 100
	
		setvar tempb 150
		subvarvar tempb tempc
	
		mulvarvar ACCELFACTOR tempb
		divvar ACCELFACTOR 150
	}
ends

// Factors regenerating air supply
state playerairrestorecheck
	ifvarvarl AIRTIME MAXAIRTIME
	{
		ifvare mainmenu 0 addvar AIRTICCOUNTER 1
		ifvare AIRTICCOUNTER 1
		{
		setvarvar TEMPVAR5 MAXAIRTIME
		divvar TEMPVAR5 130
		ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
		ifvare mainmenu 0 ifvarg CURRENTHITPOINTS 0 addvarvar AIRTIME TEMPVAR5
		setvar AIRTICCOUNTER 0
		}
	}
	ifvarvarg AIRTIME MAXAIRTIME setvarvar AIRTIME MAXAIRTIME 
ends

state enforceoverheadsprites
	ifvare OVERHEADSPRITE 0 setvar OVERHEADSPRITE 1
	addvar OVERHEADSPRITE 1
	ifvarg OVERHEADSPRITE 16 setvar OVERHEADSPRITE 1
ends

state enforcespeedlimits
	ifvarvarg posxv PLAYERMOVEPLUSVEL
	{
		setvarvar posxv PLAYERMOVEPLUSVEL
		setplayer[THISACTOR].posxv posxv
	
		ifvarvarg posyv PLAYERMOVEPLUSVEL
		{
		setvarvar posyv PLAYERMOVEPLUSVEL
		setplayer[THISACTOR].posyv posyv
		}
		else
		{
		ifvarvarl posyv PLAYERMOVEMINUSVEL
		{
			setvarvar posyv PLAYERMOVEMINUSVEL
			setplayer[THISACTOR].posyv posyv
		}
		}
	}
	else
	{
		ifvarvarl posxv PLAYERMOVEMINUSVEL
		{
			setvarvar posxv PLAYERMOVEMINUSVEL
			setplayer[THISACTOR].posxv posxv
		
			ifvarvarg posyv PLAYERMOVEPLUSVEL
			{
				setvarvar posyv PLAYERMOVEPLUSVEL
				setplayer[THISACTOR].posyv posyv
			}
			else
			{
				ifvarvarl posyv PLAYERMOVEMINUSVEL
				{
					setvarvar posyv PLAYERMOVEMINUSVEL
					setplayer[THISACTOR].posyv posyv
				}
			}
		}
		else
		{
			ifvarvarg posyv PLAYERMOVEPLUSVEL
			{
				setvarvar posyv PLAYERMOVEPLUSVEL
				setplayer[THISACTOR].posyv posyv
			}
			else
			{
				ifvarvarl posyv PLAYERMOVEMINUSVEL
				{
					setvarvar posyv PLAYERMOVEMINUSVEL
					setplayer[THISACTOR].posyv posyv
				}
			}
		}
	}
ends

state checkspeeddisplays
	setvarvar CHARACTERSPEEDVAR CHARACTERSPEEDTRUE
	setvarvar TEMPVAR5 CHARACTERSPEEDVAR
	subvar TEMPVAR5 46500
	mulvar TEMPVAR5 25
	divvar TEMPVAR5 100
	ifvarand PLAYERSTATUS? 2 addvarvar CHARACTERSPEEDVAR TEMPVAR5
	else ifvarand PLAYERSTATUS? 4 subvarvar CHARACTERSPEEDVAR TEMPVAR5
	setvarvar CHARACTERSPEEDDEBUG CHARACTERSPEEDVAR
	
	setvarvar CHARACTERSPEEDVAR CHARACTERSPEEDTRUE
	subvar CHARACTERSPEEDVAR 46500
	ifvarn CHARACTERSPEEDVAL 0 divvarvar CHARACTERSPEEDVAR CHARACTERSPEEDVAL
	ifvarand PLAYERSTATUS? 2 { mulvar CHARACTERSPEEDVAR 125 divvar CHARACTERSPEEDVAR 100 }
	else ifvarand PLAYERSTATUS? 4 { mulvar CHARACTERSPEEDVAR 75 divvar CHARACTERSPEEDVAR 100 }
	setvarvar CHARACTERSPEEDSTAT CHARACTERSPEEDVAR
ends

state showsecretmessages
	ifvare TEMPVAR5 0 redefinequote 9 ^17A SECRET PLACE!
	ifvare TEMPVAR5 1 redefinequote 9 ^17YOU FOUND A SECRET AREA!
	ifvare TEMPVAR5 2 redefinequote 9 ^17A SECRET IS REVEALED!
	ifvare TEMPVAR5 3 redefinequote 9 ^17YOU HAVE UNCOVERED A SECRET!
ends

state happystylecharm_rndmulti
	ifrnd 192 mulvar TEMPVAR4 1
	else ifrnd 192 mulvar TEMPVAR4 2
	else ifrnd 192 mulvar TEMPVAR4 3
	else mulvar TEMPVAR4 4
ends

state happystylecharm_lvlcalc
	setvarvar TEMPVAR3 AVERAGELEVEL divvar TEMPVAR2 2
	setvarvar TEMPVAR2 PLAYERLEVEL divvar TEMPVAR2 4
	addvarvar TEMPVAR3 TEMPVAR2
ends

state player_havehappyshoes
	setvarvar TEMPVAR4 EXPPTS
	randvar TEMPVAR5 25600 addvar TEMPVAR5 25600
	divvarvar TEMPVAR4 TEMPVAR5
	ifvarl TEMPVAR4 1 setvar TEMPVAR4 1
	
	state happystylecharm_rndmulti
	state happystylecharm_lvlcalc
	mulvarvar TEMPVAR4 TEMPVAR3
	
	ifvare CHARACTERSELECTED? 2 { mulvar TEMPVAR4 5 divvar TEMPVAR4 4 } // Jack gets 25% more EXP
	ifvare CHARACTERSELECTED? 9 { mulvar TEMPVAR4 11 divvar TEMPVAR4 8 } // Cybanis gets 37.5% more EXP
	ifvare CHARACTERSELECTED? 12 { mulvar TEMPVAR4 3 divvar TEMPVAR4 2 } // Lori gets 50% more EXP
	ifvare CHARACTERSELECTED? 15 { mulvar TEMPVAR4 5 divvar TEMPVAR4 4 } // Maken gets 25% more EXP
	
	// Support System
	setvar DAMAGEMODIFIER 100
	ifvarn CHARACTERSELECTED? 2 // If the character is not Jack, check their support level with him once
	{
		// Jack
		ifvarg PLAYERSUPPORTJACK 0 addvar DAMAGEMODIFIER 4 // "C" Support
		ifvarg PLAYERSUPPORTJACK 1 addvar DAMAGEMODIFIER 6 // "B" Support
		ifvarg PLAYERSUPPORTJACK 2 addvar DAMAGEMODIFIER 9 // "A" Support
		ifvarg PLAYERSUPPORTJACK 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTJACK 4 addvar DAMAGEMODIFIER 36 // "*" Support
	}
	else // If the character is Jack, check for "S" and "*" support levels with all 14 other characters
	{
		// Duke
		ifvarg PLAYERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Bubsy
		ifvarg PLAYERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Ami
		ifvarg PLAYERSUPPORTAMI 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTAMI 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Lo Wang
		ifvarg PLAYERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// ESSence
		ifvarg PLAYERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Ted
		ifvarg PLAYERSUPPORTTED 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTTED 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Lisa
		ifvarg PLAYERSUPPORTLISA 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTLISA 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Cybanis
		ifvarg PLAYERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Nethra
		ifvarg PLAYERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Paula
		ifvarg PLAYERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Lori
		ifvarg PLAYERSUPPORTLORI 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTLORI 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Minako
		ifvarg PLAYERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// "Mystery Lady"
		ifvarg PLAYERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
		// Maken
		ifvarg PLAYERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 12 // "S" Support /w Jack
		ifvarg PLAYERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 36 // "*" Support /w Jack
	}
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	ifvarg DAMAGEMODIFIER 234 setvar DAMAGEMODIFIER 234
	mulvarvar TEMPVAR4 DAMAGEMODIFIER
	divvar TEMPVAR4 100
	
	// EXP Badge
	setvar TEMP3 0
	ifvare PLAYEREQUIPSLOTITEM1 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM2 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM3 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM4 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM5 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM6 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM7 7 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM8 7 addvar TEMP3 2
	ifvarg TEMP3 0 mulvarvar TEMPVAR4 TEMP3
	
	addvarvar EXPPTS TEMPVAR4
ends

state player_havestyleshoes
	setvarvar TEMPVAR4 RANKPOINTS
	randvar TEMPVAR5 25600 addvar TEMPVAR5 25600
	divvarvar TEMPVAR4 TEMPVAR5
	ifvarl TEMPVAR4 1 setvar TEMPVAR4 1
	
	state happystylecharm_rndmulti
	state happystylecharm_lvlcalc
	mulvarvar TEMPVAR4 TEMPVAR3
	
	ifvare CHARACTERSELECTED? 6 { mulvar TEMPVAR4 11 divvar TEMPVAR4 8 } // ESSence gets 37.5% more RANK
	ifvare CHARACTERSELECTED? 7 { mulvar TEMPVAR4 3 divvar TEMPVAR4 2 } // Ted gets 50% more RANK
	ifvare CHARACTERSELECTED? 11 { mulvar TEMPVAR4 5 divvar TEMPVAR4 4 } // Paula gets 25% more RANK
	ifvare CHARACTERSELECTED? 15 { mulvar TEMPVAR4 5 divvar TEMPVAR4 4 } // Maken gets 25% more RANK
	
	// Support System
	setvar DAMAGEMODIFIER 100
	ifvarn CHARACTERSELECTED? 6 // If the character is not ESSence, check their support level with him once
	{
		// ESSence
		ifvarg PLAYERSUPPORTESSENCE 0 addvar DAMAGEMODIFIER 4 // "C" Support
		ifvarg PLAYERSUPPORTESSENCE 1 addvar DAMAGEMODIFIER 6 // "B" Support
		ifvarg PLAYERSUPPORTESSENCE 2 addvar DAMAGEMODIFIER 9 // "A" Support
		ifvarg PLAYERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 36 // "*" Support
	}
	else // If the character is ESSence, check for "S" and "*" support levels with all 14 other characters
	{
		// Duke
		ifvarg PLAYERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Jack
		ifvarg PLAYERSUPPORTJACK 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTJACK 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Bubsy
		ifvarg PLAYERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Ami
		ifvarg PLAYERSUPPORTAMI 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTAMI 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Lo Wang
		ifvarg PLAYERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Ted
		ifvarg PLAYERSUPPORTTED 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTTED 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Lisa
		ifvarg PLAYERSUPPORTLISA 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTLISA 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Cybanis
		ifvarg PLAYERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Nethra
		ifvarg PLAYERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Paula
		ifvarg PLAYERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Lori
		ifvarg PLAYERSUPPORTLORI 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTLORI 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Minako
		ifvarg PLAYERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// "Mystery Lady"
		ifvarg PLAYERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 36 // "*" Support
		// Maken
		ifvarg PLAYERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 12 // "S" Support
		ifvarg PLAYERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 36 // "*" Support
	}
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	ifvarg DAMAGEMODIFIER 234 setvar DAMAGEMODIFIER 234
	mulvarvar TEMPVAR4 DAMAGEMODIFIER
	divvar TEMPVAR4 100
	
	// Rank Badge
	setvar TEMP3 0
	ifvare PLAYEREQUIPSLOTITEM1 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM2 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM3 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM4 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM5 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM6 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM7 8 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM8 8 addvar TEMP3 2
	ifvarg TEMP3 0 mulvarvar TEMPVAR4 TEMP3
	
	addvarvar RANKPOINTS TEMPVAR4
ends

state player_havecharmshoes
	setvarvar TEMPVAR4 DOLLARS
	randvar TEMPVAR5 25600 addvar TEMPVAR5 25600
	divvarvar TEMPVAR4 TEMPVAR5
	ifvarl TEMPVAR4 1 setvar TEMPVAR4 1
	
	state happystylecharm_rndmulti
	state happystylecharm_lvlcalc
	mulvarvar TEMPVAR4 TEMPVAR3
	
	ifvare CHARACTERSELECTED? 8 // Lisa's "Lady Luck" ability also affects Charm Shoes and their effect
	{
		ifvarg PLAYERTEMPLEVEL 10 ifvarl PLAYERTEMPLEVEL 31 { mulvar TEMPVAR4 9 divvar TEMPVAR4 8 }
		else ifvarg PLAYERTEMPLEVEL 30 ifvarl PLAYERTEMPLEVEL 61 { mulvar TEMPVAR4 5 divvar TEMPVAR4 4 }
		else ifvarg PLAYERTEMPLEVEL 60 { mulvar TEMPVAR4 3 divvar TEMPVAR4 2 }
		ifvare PLAYERTEMPLEVEL 100 { mulvar TEMPVAR4 3 divvar TEMPVAR4 2 }
	}
	
	// Money Badge
	setvar TEMP3 0
	ifvare PLAYEREQUIPSLOTITEM1 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM2 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM3 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM4 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM5 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM6 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM7 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM8 9 addvar TEMP3 2
	ifvarg TEMP3 0 mulvarvar TEMPVAR4 TEMP3
	
	ifvarg TEMPVAR4 10000000 setvar TEMPVAR4 10000000
	
	addvarvar CENTS TEMPVAR4
	addvarvar DISPLAYCENTS TEMPVAR4
	state displaymoney
	
	setvar TEMPVAR2 0
	setvarvar CHARACTERARRAY CHARACTERSELECTED?
	getactorvar[CHARACTERARRAY].CHARACTERATMMONEYCENTS TEMPVAR3
	divvar TEMPVAR4 8
	ifrnd 32 { ifvarl TEMPVAR4 1 setvar TEMPVAR4 1 }
	addvarvar TEMPVAR3 TEMPVAR4
	ifvarg TEMPVAR3 99
	{ 
		setvarvar TEMPVAR2 TEMPVAR3
		divvar TEMPVAR2 100
		modvar TEMPVAR3 100
	
	}
	setactorvar[CHARACTERARRAY].CHARACTERATMMONEYCENTS TEMPVAR3
	
	getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR5
	addvarvar TEMPVAR5 TEMPVAR2
	ifvarg TEMPVAR5 2000000000 setvar TEMPVAR5 2000000000
	setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR5
	setvar TEMPVAR2 0
ends

state getskillusecosts
	setvar CHARACTERARRAY 1 // Duke
	getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR
	// Nothing For Duke [Yet :P]
	
	
	setvar CHARACTERARRAY 2 // Jack
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 1 // 1 is "Damage Shell"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 1 // 1 is "Damage Shell"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 5
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 1 // 1 is "Damage Shell"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 4
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 1 // 1 is "Damage Shell"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 3
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 3 // Bubsy
	getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR
	// Nothing For Bubsy [Yet :P]
	
	
	setvar CHARACTERARRAY 4 // Ami
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 2 // 2 is "Mercury Aqua Protection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 20
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 3 // 3 is "Mercury Quickening"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 2 // 2 is "Mercury Aqua Protection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 18
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 3 // 3 is "Mercury Quickening"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 5
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 2 // 2 is "Mercury Aqua Protection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 16
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 3 // 3 is "Mercury Quickening"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 4
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 2 // 2 is "Mercury Aqua Protection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 13
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 3 // 3 is "Mercury Quickening"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 3
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 5 // Higa
	getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR
	// Nothing For Higa [Yet :P]
	
	
	setvar CHARACTERARRAY 6 // ESSence
	getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR
	// Nothing For ESSence [Yet :P]
	
	
	setvar CHARACTERARRAY 7 // Ted
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 4 // 4 is "Fortify [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 14
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 5 // 5 is "Fortify [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 35
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 6 // 6 is "Fortify [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 63
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 4 // 4 is "Fortify [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 13
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 5 // 5 is "Fortify [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 33
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 6 // 6 is "Fortify [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 60
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 4 // 4 is "Fortify [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 12
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 5 // 5 is "Fortify [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 31
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 6 // 6 is "Fortify [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 57
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 4 // 4 is "Fortify [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 10
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 5 // 5 is "Fortify [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 29
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 6 // 6 is "Fortify [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 53
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 8 // Lisa
	getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR
	// Nothing For Lisa [Yet :P]
	
	
	setvar CHARACTERARRAY 9 // Cybanis
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 7 // 7 is "Bloodlusting"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 7 // 7 is "Bloodlusting"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 5
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 7 // 7 is "Bloodlusting"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 4
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 7 // 7 is "Bloodlusting"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 3
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 10 // Christina/Nethra
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 8 // 8 is "Lesser Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 16
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 9 // 9 is "Heal Life [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 8
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 10 // 10 is "Cure Ailment [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 12
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 11 // 11 is "Heal Life [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 20
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 12 // 12 is "Greater Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 32
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 13 // 13 is "Cure Ailment [Greatest]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 24
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 8 // 8 is "Lesser Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 15
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 9 // 9 is "Heal Life [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 7
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 10 // 10 is "Cure Ailment [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 11
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 11 // 11 is "Heal Life [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 19
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 12 // 12 is "Greater Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 30
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 13 // 13 is "Cure Ailment [Greatest]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 22
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 8 // 8 is "Lesser Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 14
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 9 // 9 is "Heal Life [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 10 // 10 is "Cure Ailment [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 10
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 11 // 11 is "Heal Life [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 17
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 12 // 12 is "Greater Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 28
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 13 // 13 is "Cure Ailment [Greatest]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 20
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 8 // 8 is "Lesser Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 12
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 9 // 9 is "Heal Life [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 5
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 10 // 10 is "Cure Ailment [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 9
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 11 // 11 is "Heal Life [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 15
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 12 // 12 is "Greater Resurrection"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 25
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 13 // 13 is "Cure Ailment [Greatest]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 17
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 11 // Paula
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 14 // 14 is "PK Shield"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 14 // 14 is "PK Shield"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 5
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 14 // 14 is "PK Shield"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 4
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 14 // 14 is "PK Shield"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 3
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 12 // Lori
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 15 // 15 is "Triad Refractor"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 15
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 16 // 16 is "Triad Ragnarok"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 21
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 15 // 15 is "Triad Refractor"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 14
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 16 // 16 is "Triad Ragnarok"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 20
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 15 // 15 is "Triad Refractor"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 13
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 16 // 16 is "Triad Ragnarok"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 18
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 15 // 15 is "Triad Refractor"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 11
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 16 // 16 is "Triad Ragnarok"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 15
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 13 // Minako
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 21 // 21 is "Venus Steel Mending [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 10
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 22 // 22 is "Venus Steel Mending [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 24
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 23 // 23 is "Venus Steel Mending [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 42
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 21 // 21 is "Venus Steel Mending [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 9
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 22 // 22 is "Venus Steel Mending [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 23
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 23 // 23 is "Venus Steel Mending [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 40
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 21 // 21 is "Venus Steel Mending [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 8
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 22 // 22 is "Venus Steel Mending [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 22
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 23 // 23 is "Venus Steel Mending [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 39
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 21 // 21 is "Venus Steel Mending [Lesser]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 22 // 22 is "Venus Steel Mending [Moderate]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 20
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 23 // 23 is "Venus Steel Mending [Greater]"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 36
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 14 // Mystery Lady
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 17 // 17 is "Resurrection Prime"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 12
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 18 // 18 is "Resurrection Ultima"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 30
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 17 // 17 is "Resurrection Prime"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 11
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 18 // 18 is "Resurrection Ultima"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 28
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 17 // 17 is "Resurrection Prime"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 10
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 18 // 18 is "Resurrection Ultima"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 26
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 17 // 17 is "Resurrection Prime"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 9
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 18 // 18 is "Resurrection Ultima"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 23
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	
	setvar CHARACTERARRAY 15 // Maken
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL -1 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 34
	{
		setvar USESKILLARRAY 19 // 19 is "Triad Blitzkrieg"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 18
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 20 // 20 is "Triad Booster"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 6
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 33 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 67
	{
		setvar USESKILLARRAY 19 // 19 is "Triad Blitzkrieg"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 17
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 20 // 20 is "Triad Booster"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 5
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvarg actorvar[CHARACTERARRAY].CHARACTERLEVEL 66 ifvarl actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 19 // 19 is "Triad Blitzkrieg"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 15
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 20 // 20 is "Triad Booster"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 4
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	else
	ifvare actorvar[CHARACTERARRAY].CHARACTERLEVEL 100
	{
		setvar USESKILLARRAY 19 // 19 is "Triad Blitzkrieg"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 13
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	
		setvar USESKILLARRAY 20 // 20 is "Triad Booster"
		setactorvar[USESKILLARRAY].USESKILLPERCENTCOST 3
		setactorvar[USESKILLARRAY].USESKILLEXACTCOST 0
	}
	
	setvar CHARACTERARRAY 0 // ?
	setvar USESKILLARRAY 0 // ?
ends

state checknonusecharcAP
	ifvarl actorvar[CHARACTERARRAY].CHARACTERAP 1
	{
		setactorvar[CHARACTERARRAY].CHARACTERAPABSORB 0
	}
	else
	{
		ifvarl actorvar[CHARACTERARRAY].CHARACTERAPABSORB 100 setactorvar[CHARACTERARRAY].CHARACTERAPABSORB 100
	}
ends

state checkfreezetimer_heatratio
	getactorvar[temp].FLOORHEATRATIO temph mulvarvar tempg temph divvar tempg 100
ends

state shikonchecker2
	ifvarg INVENTORYSLOTMAX 0 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 1 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 2 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 3 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 4 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 5 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 6 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
	ifvarg INVENTORYSLOTMAX 7 getactorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 TEMPVAR5 else setvar TEMPVAR5 -1
	ifvare TEMPVAR5 28 setvar HAVEASHIKONJEWEL? 2
ends

state checkforexistingshikons
	setvar HAVEASHIKONJEWEL? 0
	
	state checkshikonjewels ifvarg ITEMARRAYID_AMOUNTTEMP 0 setvar HAVEASHIKONJEWEL? 1
	setvar CHARACTERARRAY 1 state shikonchecker2
	setvar CHARACTERARRAY 2 state shikonchecker2
	setvar CHARACTERARRAY 3 state shikonchecker2
	setvar CHARACTERARRAY 4 state shikonchecker2
	setvar CHARACTERARRAY 5 state shikonchecker2
	setvar CHARACTERARRAY 6 state shikonchecker2
	setvar CHARACTERARRAY 7 state shikonchecker2
	setvar CHARACTERARRAY 8 state shikonchecker2
	setvar CHARACTERARRAY 9 state shikonchecker2
	setvar CHARACTERARRAY 10 state shikonchecker2
	setvar CHARACTERARRAY 11 state shikonchecker2
	setvar CHARACTERARRAY 12 state shikonchecker2
	setvar CHARACTERARRAY 13 state shikonchecker2
	setvar CHARACTERARRAY 14 state shikonchecker2
	setvar CHARACTERARRAY 15 state shikonchecker2
	
	ifvare HAVEASHIKONJEWEL? 1 { state checkshikonjewels ifvarg ITEMARRAYID_AMOUNTTEMP 1 setvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount }
	ifvare HAVEASHIKONJEWEL? 2 { state checkshikonjewels ifvarg ITEMARRAYID_AMOUNTTEMP 0 setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount }
ends

state randomseedgen-2
	// Randomseed Randomizer - Version 2
	ifvare DUKE? 1 ifrnd 1 { }
	ifvare JACK? 1 ifrnd 1 { }
	ifvare BUBSY? 1 ifrnd 1 { }
	ifvare AMI? 1 ifrnd 1 { }
	ifvare LOWANG? 1 ifrnd 1 { }
	ifvare ESSENCE? 1 ifrnd 1 { }
	ifvare TED? 1 ifrnd 1 { }
	ifvare LISA? 1 ifrnd 1 { }
	ifvare CYBANIS? 1 ifrnd 1 { }
	ifvare NETHRA? 1 ifrnd 1 { }
	ifvare PAULA? 1 ifrnd 1 { }
	ifvare LORI? 1 ifrnd 1 { }
	ifvare MINAKO? 1 ifrnd 1 { }
	ifvare MYSTERY1? 1 ifrnd 1 { }
	ifvare MAKEN? 1 ifrnd 1 { }
	
	ifvarg PARTYSIZE 0 ifrnd 1 { }
	ifvarg PARTYSIZE 1 ifrnd 1 { }
	ifvarg PARTYSIZE 2 ifrnd 1 { }
	ifvarg PARTYSIZE 3 ifrnd 1 { }
	ifvarg PARTYSIZE 4 ifrnd 1 { }
	ifvarg PARTYSIZE 5 ifrnd 1 { }
	ifvarg PARTYSIZE 6 ifrnd 1 { }
	ifvarg PARTYSIZE 7 ifrnd 1 { }
	ifvarg PARTYSIZE 8 ifrnd 1 { }
	ifvarg PARTYSIZE 9 ifrnd 1 { }
	ifvarg PARTYSIZE 10 ifrnd 1 { }
	ifvarg PARTYSIZE 11 ifrnd 1 { }
	ifvarg PARTYSIZE 12 ifrnd 1 { }
	ifvarg PARTYSIZE 13 ifrnd 1 { }
	ifvarg PARTYSIZE 14 ifrnd 1 { }
	
	setvarvar TEMPVAR randomseed
	modvar TEMPVAR 2
	ifvarl TEMPVAR 0 mulvar TEMPVAR -1
	setvarvar TEMPVAR2 randomseed
	modvar TEMPVAR2 8
	ifvarl TEMPVAR2 0 mulvar TEMPVAR2 -1
	setvarvar TEMPVAR3 randomseed
	modvar TEMPVAR3 128
	ifvarl TEMPVAR3 0 mulvar TEMPVAR3 -1
	setvarvar TEMPVAR4 randomseed
	modvar TEMPVAR4 512
	ifvarl TEMPVAR4 0 mulvar TEMPVAR4 -1
	setvarvar TEMPVAR5 randomseed
	modvar TEMPVAR5 2048
	ifvarl TEMPVAR5 0 mulvar TEMPVAR5 -1
	setvarvar TEMPVAR6 randomseed
	modvar TEMPVAR6 8192
	ifvarl TEMPVAR6 0 mulvar TEMPVAR6 -1
	
	randvarvar temp TEMPVAR addvar temp 1
	ifrnd 128 addvarvar randomseed temp else subvarvar randomseed temp
	ifrnd 64 mulvarvar randomseed temp
	randvarvar temp TEMPVAR2 addvar temp 1
	ifrnd 128 addvarvar randomseed temp else subvarvar randomseed temp
	ifrnd 32 mulvarvar randomseed temp
	randvarvar temp TEMPVAR3 addvar temp 1
	ifrnd 128 addvarvar randomseed temp else subvarvar randomseed temp
	ifrnd 16 mulvarvar randomseed temp
	randvarvar temp TEMPVAR4 addvar temp 1
	ifrnd 128 addvarvar randomseed temp else subvarvar randomseed temp
	ifrnd 8 mulvarvar randomseed temp
	randvarvar temp TEMPVAR5 addvar temp 1
	ifrnd 128 addvarvar randomseed temp else subvarvar randomseed temp
	ifrnd 4 mulvarvar randomseed temp
	randvarvar temp TEMPVAR6 addvar temp 1
	ifrnd 128 addvarvar randomseed temp else subvarvar randomseed temp
	ifrnd 2 mulvarvar randomseed temp
ends

state rank_payment_stuff
	ifvare DUKE? 1
	{
		setvar CHARACTERARRAY 1
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare JACK? 1
	{
		setvar CHARACTERARRAY 2
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare BUBSY? 1
	{
		setvar CHARACTERARRAY 3
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare AMI? 1
	{
		setvar CHARACTERARRAY 4
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare LOWANG? 1
	{
		setvar CHARACTERARRAY 5
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare ESSENCE? 1
	{
		setvar CHARACTERARRAY 6
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare TED? 1
	{
		setvar CHARACTERARRAY 7
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare LISA? 1
	{
		setvar CHARACTERARRAY 8
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare CYBANIS? 1
	{
		setvar CHARACTERARRAY 9
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare NETHRA? 1
	{
		setvar CHARACTERARRAY 10
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare PAULA? 1
	{
		setvar CHARACTERARRAY 11
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare LORI? 1
	{
		setvar CHARACTERARRAY 12
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare MINAKO? 1
	{
		setvar CHARACTERARRAY 13
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare MYSTERY1? 1
	{
		setvar CHARACTERARRAY 14
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	
	ifvare MAKEN? 1
	{
		setvar CHARACTERARRAY 15
		setvarvar TEMPVAR2 TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
		addvarvar TEMPVAR3 TEMPVAR2
		setactorvar[CHARACTERARRAY].CHARACTERATMMONEYDOLLARS TEMPVAR3
	}
	redefinequote 1058 ^22RECEIVED $%d PAYMENT FROM EDF FOR YOUR RANK! ^14[CHECK YOUR CHARACTERS' ATM ACCOUNTS]
	qsprintf 1058 1058 TEMPVAR
	userquote 1058
	palfrom 12 0 64
	globalsound RANK_PAYOUT
	globalsound GEMSMALL
	globalsound RANK_PAYOUT
	globalsound GEMMEDIUM
	globalsound RANK_PAYOUT
	globalsound GEMLARGE
ends

state checkpkshieldamounts
	getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR7
	getactorvar[CHARACTERARRAY].CHARACTERPSISHIELDTIMER TEMPVAR8
	ifvarand TEMPVAR7 1024 nullop
	else
	{
		ifvarg TEMPVAR8 0 addvar TEMPVAR7 1024
		setactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR7
		setactorvar[CHARACTERARRAY].CHARACTERPSISHIELDTIMER TEMPVAR8
	}
ends

state drowndamage-checkequips
	setvar TEMPVAR5 1000
	ifvare PLAYEREQUIPSLOTITEM1 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM2 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM3 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM4 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM5 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM6 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM7 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvare PLAYEREQUIPSLOTITEM8 31 subvar TEMPVAR5 50 // Aqualung [-5% Drowning Damage]
	ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
	// addlogvar TEMPVAR5
	mulvarvar TEMPVAR2 TEMPVAR5
	divvar TEMPVAR2 1000
	// addlogvar TEMPVAR2
ends

state airtimedrain-checkequips
	ifvare PLAYEREQUIPSLOTITEM1 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM2 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM3 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM4 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM5 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM6 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM7 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM8 28 divvar TEMPVAR4 10 // Jewel of Four Souls
	ifvarl TEMPVAR4 1 setvar TEMPVAR4 1               
	
	setvar TEMPVAR5 1000
	ifvare PLAYEREQUIPSLOTITEM1 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM2 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM3 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM4 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM5 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM6 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM7 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvare PLAYEREQUIPSLOTITEM8 31 subvar TEMPVAR5 100 // Aqualung [-10% Oxygen Consumption]
	ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
	// addlogvar TEMPVAR5
	mulvarvar TEMPVAR4 TEMPVAR5
	divvar TEMPVAR4 1000
	// addlogvar TEMPVAR4
ends

state airtimedrain-checkextratics
	subvarvar AIRTIMEEXTRA TEMPVAR4
	ifvarl AIRTIMEEXTRA 1
	{
		subvar AIRTIME 1
		addvar AIRTIMEEXTRA 1000
	}
ends

state initsetplayermaxhpep
	getactorvar[CHARACTERARRAY].CHARACTERHP TEMPVAR
	getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMPVAR2
	ifvare TEMPVAR 0 setvarvar TEMPVAR TEMPVAR2
	setactorvar[CHARACTERARRAY].CHARACTERHP TEMPVAR
	// addlogvar TEMPVAR
	
	getactorvar[CHARACTERARRAY].CHARACTEREP TEMPVAR
	getactorvar[CHARACTERARRAY].CHARACTERMAXEP TEMPVAR2
	ifvare TEMPVAR 0 setvarvar TEMPVAR TEMPVAR2
	setactorvar[CHARACTERARRAY].CHARACTEREP TEMPVAR
	// addlogvar TEMPVAR
ends

state player-hockeymask
	setvarvar TEMPVAR3 CRITICALHITCHANCE2
	subvar TEMPVAR3 1
	divvar TEMPVAR3 3
	addvarvar CRITICALHITCHANCE2 TEMPVAR3
ends

//************************************************************************************************************************
//************************************************************************************************************************
//************************************************************************************************************************
//******************************************Here Comes the Huge APLAYER code O.O******************************************
//************************************************************************************************************************
//************************************************************************************************************************
//************************************************************************************************************************

actor APLAYER MAXPLAYERHEALTH PSTAND 0 0

	// Temporary Fix for the issue where the starting character's EP likes not being set to the max based on the initial load up of a first level in a new game. :V
	ifvarg TIMERRAWFORMAT -1 ifvarl TIMERRAWFORMAT 16
	{
		ifvarvarn CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
		ifvarvarn CURRENTENERGYPOINTS MAXENERGYPOINTS setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTS
	
		setvar CHARACTERARRAY 1 state initsetplayermaxhpep
		setvar CHARACTERARRAY 2 state initsetplayermaxhpep
		setvar CHARACTERARRAY 3 state initsetplayermaxhpep
		setvar CHARACTERARRAY 4 state initsetplayermaxhpep
		setvar CHARACTERARRAY 5 state initsetplayermaxhpep
		setvar CHARACTERARRAY 6 state initsetplayermaxhpep
		setvar CHARACTERARRAY 7 state initsetplayermaxhpep
		setvar CHARACTERARRAY 8 state initsetplayermaxhpep
		setvar CHARACTERARRAY 9 state initsetplayermaxhpep
		setvar CHARACTERARRAY 10 state initsetplayermaxhpep
		setvar CHARACTERARRAY 11 state initsetplayermaxhpep
		setvar CHARACTERARRAY 12 state initsetplayermaxhpep
		setvar CHARACTERARRAY 13 state initsetplayermaxhpep
		setvar CHARACTERARRAY 14 state initsetplayermaxhpep
		setvar CHARACTERARRAY 15 state initsetplayermaxhpep
	}

	setvar MISCARRAYID 229 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANK-POINTS-LOWEST
	ifvarvarl RANKPOINTS MISCARRAYID_AMOUNTTEMP setvarvar RANKPOINTS MISCARRAYID_AMOUNTTEMP
	setvar MISCARRAYID 230 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANK-POINTS-HIGHEST
	ifvarvarg RANKPOINTS MISCARRAYID_AMOUNTTEMP setvarvar RANKPOINTS MISCARRAYID_AMOUNTTEMP
	
	ifvare player[THISACTOR].pals_time 0
	{
		setplayer[THISACTOR].pals 0 0 //Red
		setplayer[THISACTOR].pals 1 0 //Green
		setplayer[THISACTOR].pals 2 0 //Blue
	}


	ifvarg INVULNREFLECTRATE 2000 setvar INVULNREFLECTRATE 2000
	ifvarg INVULNHEALTHDRAIN 2001 setvar INVULNHEALTHDRAIN 2001
	ifvare CURRENTARMORPOINTS 0 state removecorrosion_armorgone // makes sure corrosion ailment is removed if it destroys your current armor.
	
	ifvarn mainmenusubmenu 7 
	{
		ifvare WORLDTILEVIEWMODE 2 { setvar WORLDTILEVIEWMODE 1 savegamevar WORLDTILEVIEWMODE }
	}
	else
	{
		ifvare WORLDTILEVIEWMODE 2 { ifvare mainmenupage 10 ifvarg mainmenuselection 5 { setvar WORLDTILEVIEWMODE 1 savegamevar WORLDTILEVIEWMODE } }
	}
	
	ifvare mainmenu 1 ifvarg mainmenutransitiontimer 6
	{
		setvar MISCARRAYID 88 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-ang
		addvar MISCARRAYID_AMOUNTTEMP 37
		setvar MISCARRAYID 88 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-ang
		
		getplayer[THISACTOR].ang temp
		getplayer[THISACTOR].oang tempb
		getincangle angvar temp tempb
		divvar angvar 3
		setvar MISCARRAYID 86 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-x
		subvarvar MISCARRAYID_AMOUNTTEMP angvar
		setplayer[THISACTOR].ang player[THISACTOR].oang
		ifvarl MISCARRAYID_AMOUNTTEMP 0 setvar MISCARRAYID_AMOUNTTEMP 0
		ifvarg MISCARRAYID_AMOUNTTEMP 320 setvar MISCARRAYID_AMOUNTTEMP 320
		setvar MISCARRAYID 86 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-x
		
		getplayer[THISACTOR].horiz temp
		getplayer[THISACTOR].ohoriz tempb
		subvarvar temp tempb
		getuserdef[THISACTOR].mouseflip tempc
		setvar MISCARRAYID 87 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-y
		ifvare tempc 0 addvarvar MISCARRAYID_AMOUNTTEMP temp else subvarvar MISCARRAYID_AMOUNTTEMP temp
		ifvarl MISCARRAYID_AMOUNTTEMP 0 setvar MISCARRAYID_AMOUNTTEMP 0
		ifvarg MISCARRAYID_AMOUNTTEMP 200 setvar MISCARRAYID_AMOUNTTEMP 200
		setvar MISCARRAYID 87 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // mouse-cursor-y
	}

	// Determine Inventory Maximums
	ifvare EQUIPCHEAT? 0
	{
		ifvare SKILLLEVEL 0 setvar INVENTORYSLOTMAX 4
		ifvare SKILLLEVEL 1 setvar INVENTORYSLOTMAX 3
		ifvare SKILLLEVEL 2 setvar INVENTORYSLOTMAX 3
		ifvare SKILLLEVEL 3 setvar INVENTORYSLOTMAX 3
		ifvare SKILLLEVEL 4 setvar INVENTORYSLOTMAX 2
		ifvare SKILLLEVEL 5 setvar INVENTORYSLOTMAX 2
		ifvare SKILLLEVEL 6 setvar INVENTORYSLOTMAX 2
		ifvare SKILLLEVEL 7 setvar INVENTORYSLOTMAX 1
		ifvare SKILLLEVEL 8 setvar INVENTORYSLOTMAX 1
		ifvare SKILLLEVEL 9 setvar INVENTORYSLOTMAX 1
	}
	else
	{
		ifvare EQUIPCHEAT? 2 setvar INVENTORYSLOTMAX 8
		else setvar INVENTORYSLOTMAX 4
	} 
	state checkmysticsatchels ifvarg ITEMARRAYID_AMOUNTTEMP 0 addvarvar INVENTORYSLOTMAX ITEMARRAYID_AMOUNTTEMP
	ifvarl INVENTORYSLOTMAX 1 setvar INVENTORYSLOTMAX 1
	ifvarg INVENTORYSLOTMAX 8 setvar INVENTORYSLOTMAX 8
	
	
	ifvare autosavetoggle 1 ifvarvare TIMERRAWFORMAT NEXTAUTOSAVEINTERVAL
	{
		setvarvar LASTAUTOSAVEINTERVAL TIMERRAWFORMAT
		state reset_autosavetimes
		state autosave_slot10
	}

	ifvare shop_id -1 setvar shopamount 1
	ifvarn atm_id -1 ifvarand atm_type 4
	{
		addvar SOUNDPITCH -256
		setplayer[THISACTOR].sound_pitch SOUNDPITCH
		soundonce ATM_HUM 
		subvar SOUNDPITCH -256
		setplayer[THISACTOR].sound_pitch SOUNDPITCH
	}

	setvar MISCARRAYID 65 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // CHEAT-PHASE
	ifvare MISCARRAYID_AMOUNTTEMP 1
	{
		setplayer[THISACTOR].got_access 127
		setvar ACCESSCARDS? 127
		setvar MISCARRAYID 65 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CHEAT-PHASE
	}
	
	ifvare mainmenu 0 addvar RANKPAYMENTTIMER 1
	ifvarvarl RANKPAYMENTTIMER RANKPAYMENTINTERVAL nullop
	else
	{
		setvarvar varname RANKPOINTS
		ifvarl varname -262143999 { setvar TEMPVAR 35 state rank_payment_stuff } // [O] Rank
		ifvarg varname -262144000 ifvarl varname -65536000 { setvar TEMPVAR 100 state rank_payment_stuff } // [N] Rank 
		ifvarg varname -65536001 ifvarl varname -16384000 { setvar TEMPVAR 250 state rank_payment_stuff } // [M] Rank
		ifvarg varname -16384001 ifvarl varname -4096000 { setvar TEMPVAR 375 state rank_payment_stuff } // [L] Rank
		ifvarg varname -4096001 ifvarl varname -1024000 { setvar TEMPVAR 500 state rank_payment_stuff } // [K] Rank
		ifvarg varname -1024001 ifvarl varname -256000 { setvar TEMPVAR 750 state rank_payment_stuff } // [J] Rank
		ifvarg varname -256001 ifvarl varname -64000 { setvar TEMPVAR 1000 state rank_payment_stuff } // [I] Rank
		ifvarg varname -64001 ifvarl varname -16000 { setvar TEMPVAR 1500 state rank_payment_stuff } // [H] Rank
		ifvarg varname -16001 ifvarl varname -4000 { setvar TEMPVAR 2000 state rank_payment_stuff } // [G] Rank
		ifvarg varname -4001 ifvarl varname 0 { setvar TEMPVAR 2250 state rank_payment_stuff } // [F] Rank
		ifvare varname 0 { setvar TEMPVAR 2500 state rank_payment_stuff } // [-] Rank
		ifvarg varname 0 ifvarl varname 4001 { setvar TEMPVAR 3750 state rank_payment_stuff } // [E] Rank
		ifvarg varname 4000 ifvarl varname 16001 { setvar TEMPVAR 5000 state rank_payment_stuff } // [D] Rank
		ifvarg varname 16000 ifvarl varname 64001 { setvar TEMPVAR 8000 state rank_payment_stuff } // [C] Rank
		ifvarg varname 64000 ifvarl varname 256001 { setvar TEMPVAR 12000 state rank_payment_stuff } // [B] Rank
		ifvarg varname 256000 ifvarl varname 1024001 { setvar TEMPVAR 26000 state rank_payment_stuff } // [A] Rank
		ifvarg varname 1024000 ifvarl varname 4096001 { setvar TEMPVAR 55000 state rank_payment_stuff } // [S] Rank
		ifvarg varname 4096000 ifvarl varname 16384001 { setvar TEMPVAR 120000 state rank_payment_stuff } // [SS] Rank
		ifvarg varname 16384000 ifvarl varname 65536000 { setvar TEMPVAR 280000 state rank_payment_stuff } // [Z] Rank
		ifvarg varname 65535999 ifvarl varname 262144000 { setvar TEMPVAR 640000 state rank_payment_stuff } // [ZZ] Rank
		ifvarg varname 262143999 { setvar TEMPVAR 2150000 state rank_payment_stuff } // [NR] Rank
		setvar RANKPAYMENTTIMER 0
	}
	
	state randomseedgen-2

	// .textscale = Default ranges from 100 to 400 and increments in a value of 50, 100 150 200 etc.
	setuserdef[THISACTOR].textscale 125
	
	ifvare player[THISACTOR].player_par 1
	{
		ifvarn rainstart 0 { setvarvar raining rainstart setvar rainstart -1 }
		ifvarn freezestart 0 { setvarvar freezingbase freezestart setvar freezestart -1 }
	}
	
	ifvarvarl player[THISACTOR].posz player[THISACTOR].truecz setplayer[THISACTOR].posz player[THISACTOR].truecz
	//setactorvar[THISACTOR].ACTORMAXHP actorvar[THISACTOR].ACTORHP

	ifvarg MAXPISTOL 24576 setvar MAXPISTOL 24576
	ifvarg MAXSHOTGUN 24576 setvar MAXSHOTGUN 24576
	ifvarg MAXCHAINGUN 24576 setvar MAXCHAINGUN 24576
	ifvarg MAXRPG 24576 setvar MAXRPG 24576
	ifvarg MAXPIPEBOMB 24576 setvar MAXPIPEBOMB 24576
	ifvarg MAXSHRINKER 24576 setvar MAXSHRINKER 24576
	ifvarg MAXEXPANDER 24576 setvar MAXEXPANDER 24576
	ifvarg MAXDEVASTATOR 24576 setvar MAXDEVASTATOR 24576
	ifvarg MAXTRIPBOMB 24576 setvar MAXTRIPBOMB 24576
	ifvarg MAXFREEZER 24576 setvar MAXFREEZER 24576

	state checkoverflowmods
	
	state checkforexistingshikons
	ifvare mainmenu 0
	{
		ifvarn raining 0 state raincode
		
		ifvarl winterclothes 0 setvar winterclothes 0
		ifvarg winterclothes 100 setvar winterclothes 100
		ifvarl freezetimer 0 setvar freezetimer 0 
		setvarvar freezing freezingbase
		getactor[THISACTOR].sectnum TEMPVAR2 getactorvar[TEMPVAR2].freezingmod TEMPVAR3
		addvarvar freezing TEMPVAR3
		ifvarl freezing 0 setvar freezing 0
		ifvarn freezing 0 state freezecode_player
		else 
		{
			ifvarg freezetimer 0 { randvar tempb 2 ifrnd 128 mulvar tempb -1 addvar tempb 4 subvarvar freezetimer tempb }
		}
	}

	// Healing Sector
	ifvare mainmenu 0 ifvarg CURRENTHITPOINTS 0
	{
		getactor[THISACTOR].sectnum temph
		
		ifvarg actorvar[temph].healsectortype 0
		{
			addvar healsectordelaycur 1
			ifvarvarl healsectordelaycur actorvar[temph].healsectordelaymax nullop
			else
			{
				ifvarand actorvar[temph].healsectortype 1 // HP Healing
				{
					getactorvar[temph].healsectormaxheal TEMPVAR4
					ifvarg TEMPVAR4 0
					{
						mulvarvar TEMPVAR4 MAXHITPOINTS
						divvar TEMPVAR4 1000
					}
					else mulvar TEMPVAR4 -1
					
					ifvarvarl CURRENTHITPOINTS TEMPVAR4
					{
						getactorvar[temph].healsectoramount TEMPVAR5
						ifvarg TEMPVAR5 0
						{
							mulvarvar TEMPVAR5 MAXHITPOINTS
							divvar TEMPVAR5 1000
						}
						else mulvar TEMPVAR5 -1
				
						addvarvar CURRENTHITPOINTS TEMPVAR5
						ifvarvarg CURRENTHITPOINTS TEMPVAR4 setvarvar CURRENTHITPOINTS TEMPVAR4
						state checkbuddhamode
						ifvarn player[THISACTOR].over_shoulder_on 0
						{
							ifvarg TEMPVAR5 0
							{
							setvarvar SHOWDAMAGE TEMPVAR5
							setvar SHOWDAMAGETYPE 3
							setvarvar SHOWDAMAGEACTORID THISACTOR
							state showdamage
							}
						}
						sound MYSTERIOUS_HEALING // REGEN_HEALTH5
						setvar PLAYERHPDAMAGED? -1
					}
				}
			
				ifvarand actorvar[temph].healsectortype 2 // AP Healing
				{
					getactorvar[temph].healsectormaxheal TEMPVAR4
					ifvarg TEMPVAR4 0
					{
						mulvarvar TEMPVAR4 MAXARMORPOINTS
						divvar TEMPVAR4 1000
						}
						else mulvar TEMPVAR4 -1
						
						ifvarvarl CURRENTARMORPOINTS TEMPVAR4
						{
						getactorvar[temph].healsectoramount TEMPVAR5
						ifvarg TEMPVAR5 0
						{
							mulvarvar TEMPVAR5 MAXARMORPOINTS
							divvar TEMPVAR5 1000
						}
						else mulvar TEMPVAR5 -1
				
						getactorvar[temph].healsectorarmorab TEMPVAR3
						ifvarvarl ARMORPERCENT TEMPVAR3 setvarvar ARMORPERCENT TEMPVAR3
				
						addvarvar CURRENTARMORPOINTS TEMPVAR5
						ifvarvarg CURRENTARMORPOINTS TEMPVAR4 setvarvar CURRENTARMORPOINTS TEMPVAR4
						ifvarn player[THISACTOR].over_shoulder_on 0
						{
							ifvarg TEMPVAR5 0
							{
							setvarvar SHOWDAMAGE TEMPVAR5
							setvar SHOWDAMAGETYPE 4
							setvarvar SHOWDAMAGEACTORID THISACTOR
							state showdamage
							}
						}
						sound MYSTERIOUS_ARMOR // REGEN_ARMOR5
						setvar PLAYERAPDAMAGED? -1
					}
				}
			
				ifvarand actorvar[temph].healsectortype 4 // EP Healing
				{
					getactorvar[temph].healsectormaxheal TEMPVAR4
					ifvarg TEMPVAR4 0
					{
						mulvarvar TEMPVAR4 MAXENERGYPOINTS
						divvar TEMPVAR4 1000
					}
					else mulvar TEMPVAR4 -1
					
					ifvarvarl CURRENTENERGYPOINTS TEMPVAR4
					{
						getactorvar[temph].healsectoramount TEMPVAR5
						ifvarg TEMPVAR5 0
						{
							mulvarvar TEMPVAR5 MAXENERGYPOINTS
							divvar TEMPVAR5 1000
						}
						else mulvar TEMPVAR5 -1
				
						addvarvar CURRENTENERGYPOINTS TEMPVAR5
						ifvarvarg CURRENTENERGYPOINTS TEMPVAR4 setvarvar CURRENTENERGYPOINTS TEMPVAR4
						sound MYSTERIOUS_ENERGY
					}
				}
			
				setvar healsectordelaycur 0
			}
		}
		else
		{
			setvar healsectordelaycur 0
		}
	}

	// EP Drain code involving transformations or special items that drain the character's EP slowly [i.e. Loki Mask transformation, Mercury VR Visor, etc]
	ifvare mainmenu 0
	{
		ifvare CHARACTERSELECTED? 3 // Bubsy
		{
			setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 1 // If Bubsy's in "Loki Mask" form, drain EP
			{
				addvar TRANSFORMTIMER 1
				ifvarvarg TRANSFORMTIMER TRANSFORMTIMERMAX
				{
					ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 1
					setvar TRANSFORMTIMER 0
				}
			
				ifvarl CURRENTENERGYPOINTS 1
				{
					globalsound TELEPORTER
					redefinequote 334 ^10BUBSY HAS RUN OUT OF EP!
					setvarvar fta fta_normal setvar ftq 334
					setvar MISCARRAYID 103 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // BUBSY-FORM?
				}
			}
		}
		else
		ifvare CHARACTERSELECTED? 4 // Ami
		{
			ifvare player[THISACTOR].heat_on 1
			{
				addvar VRVISORMSG1 1
				setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
				ifvare MISCARRAYID_AMOUNTTEMP 1 // If Ami is using her VR Visor, drain EP
				{
					ifvarg VRVISORMSG1 155 { ifvarand CHEATBITFIELD? 128 nullop else { subvar CURRENTENERGYPOINTS 1 } setvar VRVISORMSG1 0 }
				}
				else
				{
					ifvarg VRVISORMSG1 64 { ifvarand CHEATBITFIELD? 128 nullop else { subvar CURRENTENERGYPOINTS 1 } setvar VRVISORMSG1 0 }
				}
				ifvarl CURRENTENERGYPOINTS 1
				{
					setplayer[THISACTOR].heat_on 0
					setvar MISCARRAYID 100 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // VISOR-OFF-SOUND
					ifvare MISCARRAYID_AMOUNTTEMP 0 
					{
					stopsound NITEVISION_ONOFF
					sound VRVISOR_OFF
					redefinequote 334 ^10AMI HAS RUN OUT OF EP!
					setvar MISCARRAYID 100 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // VISOR-OFF-SOUND
					setvar MISCARRAYID 99 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // VISOR-ON-SOUND
					}
				}
			}
			setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 2 // If Ami's in her "Balanced" form, drain EP
			{
			addvar TRANSFORMTIMER 1
			ifvarvarg TRANSFORMTIMER TRANSFORMTIMERMAX
			{
				ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 1
				setvar TRANSFORMTIMER 0
			}
		
			ifvarl CURRENTENERGYPOINTS 1
			{
				globalsound TELEPORTER
				redefinequote 334 ^10AMI HAS RUN OUT OF EP!
				setvarvar fta fta_normal setvar ftq 334
				
				ifrnd 128 { setvar MISCARRAYID 104 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 } else { setvar MISCARRAYID 104 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 } // AMI-FORM?
			}
			}
		}
		else
		ifvare CHARACTERSELECTED? 13 // Minako
		{
			setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 2 // If Minako's in her "Balanced" form, drain EP
			{
				addvar TRANSFORMTIMER 1
				ifvarvarg TRANSFORMTIMER TRANSFORMTIMERMAX
				{
					ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 1
					setvar TRANSFORMTIMER 0
				}
			
				ifvarvarl CURRENTENERGYPOINTS 1
				{
					globalsound TELEPORTER
					redefinequote 334 ^10MINAKO HAS RUN OUT OF EP!
					setvarvar fta fta_normal setvar ftq 334
					ifrnd 128 { setvar MISCARRAYID 113 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 } else { setvar MISCARRAYID 113 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 } // MINAKO-FORM? 
				}
			}
		}
	}

	getactor[THISACTOR].sectnum tempf
	ifvare actorvar[tempf].SPACESECTOR? 1 // If In Space Sector
	{
		ifvare mainmenu 0
		{
			ifvarand CHEATBITFIELD? 32 nullop else
			{
				ifvarl INVULNTIME 1
				{
					ifvare VEHICLEID -1
					{
						setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
						ifvarl MISCARRAYID_AMOUNTTEMP 1
						{
							ifvare CHARACTERSELECTED? 14 nullop // Mystery Lady is able to breath in spaaaaaaace! :P
							else
							{
								// HP Damage
								ifvare CHARACTERSELECTED? 10 { setvarvar tempd MAXHITPOINTS mulvar tempd 1 divvar tempd 300 }
								else { setvarvar tempd MAXHITPOINTS mulvar tempd 3 divvar tempd 100 }
				
								ifvarand CHEATBITFIELD? 16
								{
									ifvarg tempd 0 { divvar tempd 1000 ifvarl tempd 1 setvar tempd 1 state cheatersound }
								}
				
								ifvarg CURRENTHITPOINTS 0
								{
									subvarvar CURRENTHITPOINTS tempd
									state checkbuddhamode
									ifvarg tempd 0 setvar PLAYERHPDAMAGED? 1
									ifvarl tempd 0 setvar PLAYERHPDAMAGED? -1
									ifvarn player[THISACTOR].over_shoulder_on 0
									{
										ifvarg tempd 0
										{
										setvarvar SHOWDAMAGE tempd
										setvar SHOWDAMAGETYPE 0
										setvarvar SHOWDAMAGEACTORID PLAYERID
										state showdamage
										}
									}
					
									ifvarg tempd 0
									{
										setvarvar PAINSOUNDFACTOR tempd
										state checkpainfactor
					
										setvar ATTACKINGACTORPICNUM BIGORBIT1
										getactor[THISACTOR].pal TEMP
										setvarvar ATTACKINGACTORPAL TEMP
										setvar ACTORCRITICAL? 0
										setvarvar PLAYERDAMAGETEMP tempd
										setactor[THISACTOR].htpicnum -1
										setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
										setvar ACTORCRITICAL? 0
										setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
										ifvarg actorvar[tempf].SPACESECTOR? 0 setvar HEALTHDAMAGETIMER 0
					
										state characterpainsounds
										setvarvar DAMAGEHUEFACTOR tempd
										state playerdamagehues-electrictype
									}
								}
							}
						}
					}
				}
				else
				{
					state invulnflash
				}
			}
		}
	}
	
	getplayer[THISACTOR].ang tempe
	ifvarl tempe 0 addvar tempe 2048
	ifvarg tempe 2047 subvar tempe 2048
	setplayer[THISACTOR].ang tempe
	
	ifvarg PLAYERPUSHINGTIMER 0 subvar PLAYERPUSHINGTIMER 1
	ifvarl PLAYERPUSHINGTIMER 0 addvar PLAYERPUSHINGTIMER 1
	
	state calcbank_interests
	state getskillusecosts
	
	// Lifting Strength
	setvarvar PLAYERLIFTSTRENGTHTEMP PLAYERLIFTSTRENGTH
	
	setvarvar TEMPVAR5 PLAYERLEVEL
	mulvar TEMPVAR5 3
	divvar TEMPVAR5 2
	addvarvar PLAYERLIFTSTRENGTHTEMP TEMPVAR5
	
	setvarvar TEMPVAR5 PLAYERLEVEL
	subvar TEMPVAR5 1
	divvar TEMPVAR5 3
	addvar TEMPVAR5 100
	mulvarvar PLAYERLIFTSTRENGTHTEMP TEMPVAR5
	divvar PLAYERLIFTSTRENGTHTEMP 100

	ifvare CHARACTERSELECTED? 3
	{ 
		setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERLIFTSTRENGTHTEMP 3 divvar PLAYERLIFTSTRENGTHTEMP 2 }
	
		setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
		ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERLIFTSTRENGTHTEMP 3 divvar PLAYERLIFTSTRENGTHTEMP 5 } // Cuts Bubsy's lifting strength by 40%
	}
	ifvare CHARACTERSELECTED? 4
	{
		setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar PLAYERLIFTSTRENGTHTEMP 2
	}
	ifvare CHARACTERSELECTED? 10 
	{
		setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar PLAYERLIFTSTRENGTHTEMP 5 divvar PLAYERLIFTSTRENGTHTEMP 8 }
	}
	ifvare CHARACTERSELECTED? 13
	{
		setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar PLAYERLIFTSTRENGTHTEMP 2
	}


	// Check for Power Wrist [equippable item]
	setvar DAMAGEMODIFIER 100
	ifvare PLAYEREQUIPSLOTITEM1 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM2 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM3 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM4 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM5 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM6 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM7 18 addvar DAMAGEMODIFIER 25
	ifvare PLAYEREQUIPSLOTITEM8 18 addvar DAMAGEMODIFIER 25
	mulvarvar PLAYERLIFTSTRENGTHTEMP DAMAGEMODIFIER
	divvar PLAYERLIFTSTRENGTHTEMP 100
	
	// Check for Jewel of Four Souls
	setvar DAMAGEMODIFIER 0
	ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 5
	ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
	mulvarvar PLAYERLIFTSTRENGTHTEMP DAMAGEMODIFIER
	
	setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
	ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar PLAYERLIFTSTRENGTHTEMP 3 divvar PLAYERLIFTSTRENGTHTEMP 5 }
	ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar PLAYERLIFTSTRENGTHTEMP 4 divvar PLAYERLIFTSTRENGTHTEMP 5 }
	
	ifp ponsteroids { mulvar PLAYERLIFTSTRENGTHTEMP 9 divvar PLAYERLIFTSTRENGTHTEMP 2 }



	// Controls which barrel of the Devastator is "shooting" in Old Skool Mode
	getplayer[THISACTOR].weapon_pos TEMPVAR3 // [negatives are "going down" [last_weapon], positives are "coming up" [curr_weapon]]
	ifvarg TEMPVAR3 -11 ifvarl TEMPVAR3 0 getplayer[THISACTOR].last_weapon TEMPVAR
	else ifvarg TEMPVAR3 -1 ifvarl TEMPVAR3 11 getplayer[THISACTOR].curr_weapon TEMPVAR
	
	ifvare TEMPVAR 7
	{
		getplayer[THISACTOR].kickback_pic TEMPVAR2
		ifvare TEMPVAR2 0
		{
			ifvare DEVASTATORBARRELDISPLAY2 0 setvar DEVASTATORBARRELDISPLAY 0
			ifvare DEVASTATORBARRELDISPLAY2 1 setvar DEVASTATORBARRELDISPLAY 1
		}
	
		ifvare DEVASTATORBARRELDISPLAY 0 { ifvare TEMPVAR2 1 setvar DEVASTATORBARRELDISPLAY2 1 }
		ifvare DEVASTATORBARRELDISPLAY 1 { ifvare TEMPVAR2 1 setvar DEVASTATORBARRELDISPLAY2 0 }
	}
	//

	// Check for Happy/Style/Charm Shoe items
	setvar EQUIP_ISMOVING? 0
	ifvare mainmenu 0
	{
		ifvarn shop_id -1 nullop // lol no increasing timers while using the keys to shop, that's just derptastically cheap and lolz
		else ifvarn atm_id -1 nullop // same for ATMs, although it's harder to really think to press movement keys while in the ATM <.<
		else
		{  
			ifvare sector[PLAYERSECTOR].lotag 2 // Underwater
			{
				ifvarand bits 1 addvar EQUIP_ISMOVING? 1
				ifvarand bits 2 addvar EQUIP_ISMOVING? 1
			}
			else
			{
				ifp pjetpack
				{
					ifvarand bits 1 addvar EQUIP_ISMOVING? 1
					ifvarand bits 2 addvar EQUIP_ISMOVING? 1
				}
			}
			ifvarand extbits 1 addvar EQUIP_ISMOVING? 1
			ifvarand extbits 2 addvar EQUIP_ISMOVING? 1
			ifvarand extbits 3 addvar EQUIP_ISMOVING? 1
			ifvarand extbits 4 addvar EQUIP_ISMOVING? 1
		}
	}
	ifvarg EQUIP_ISMOVING? 0
	{
		addvar EQUIP_MOVETIMER 1
		ifvarand PLAYERSTATUS? 2 setvar TEMPVAR5 19
		else ifvarand PLAYERSTATUS? 4 setvar TEMPVAR5 31
		else setvar TEMPVAR5 25
		ifvarvarg EQUIP_MOVETIMER TEMPVAR5
		{
			setvar EQUIP_MOVETIMER 0  
		
			ifvare PLAYEREQUIPSLOTITEM1 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM1 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM1 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM2 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM2 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM2 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM3 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM3 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM3 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM4 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM4 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM4 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM5 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM5 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM5 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM6 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM6 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM6 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM7 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM7 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM7 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		
			ifvare PLAYEREQUIPSLOTITEM8 15 state player_havehappyshoes // Happy Shoes = EXP
			ifvare PLAYEREQUIPSLOTITEM8 16 state player_havestyleshoes // Style Shoes = RANK
			ifvare PLAYEREQUIPSLOTITEM8 17 state player_havecharmshoes // Charm Shoes = Cents[money]
		}
	}
	//

	ifvarn BIOMETRIC_TIMER 0
	{
		ifvare CHARACTERSELECTED? 8
		{
			ifvare HAVEENERGYSHIELD? 1
			{
				// Checks # of Yin-Yang Orbs
				setvar DAMAGEMODIFIER 1000
		
				ifvarg INVENTORYSLOTMAX 0 ifvare PLAYEREQUIPSLOTITEM1 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 1 ifvare PLAYEREQUIPSLOTITEM2 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 2 ifvare PLAYEREQUIPSLOTITEM3 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 3 ifvare PLAYEREQUIPSLOTITEM4 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 4 ifvare PLAYEREQUIPSLOTITEM5 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 5 ifvare PLAYEREQUIPSLOTITEM6 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 6 ifvare PLAYEREQUIPSLOTITEM7 27 subvar DAMAGEMODIFIER 200
				ifvarg INVENTORYSLOTMAX 7 ifvare PLAYEREQUIPSLOTITEM8 27 subvar DAMAGEMODIFIER 200
		
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				setvar TEMPVAR5 25
				mulvarvar TEMPVAR5 DAMAGEMODIFIER
				divvar TEMPVAR5 1000
				ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
		
				ifvarvarl CURRENTENERGYPOINTS TEMPVAR5 nullop
				else
				{
					ifvarg CURRENTCELLS 4
					{
						subvar CURRENTCELLS 5
						subvarvar CURRENTENERGYPOINTS TEMPVAR5
						stopsound LISA_MELEE1
						stopsound LISA_MELEE2
						stopsound LISA_MELEE3
						ifrnd 85 sound LISA_MELEE1
						else ifrnd 128 sound LISA_MELEE2
						else sound LISA_MELEE3
						sound BIOMETRIC_FIRE
						eshoot BIOMETRICBLAST1
						setvarvar TEMPVAR5 CURRENTBIOSHIELDPOWER
						divvarvar TEMPVAR5 MAXHITPOINTS
						ifvarl TEMPVAR5 16 { setactor[RETURN].pal 0 }
						else ifvarg TEMPVAR5 15 ifvarl TEMPVAR5 64 { setactor[RETURN].pal 17 }
						else ifvarg TEMPVAR5 63 ifvarl TEMPVAR5 256 { setactor[RETURN].pal 23 }
						else ifvarg TEMPVAR5 255 ifvarl TEMPVAR5 1024 { setactor[RETURN].pal 21 }
						else ifvarg TEMPVAR5 1023 { setactor[RETURN].pal 20 } 
			
						getactor[THISACTOR].x ROTATEXORIGIN
						getactor[THISACTOR].y ROTATEYORIGIN
						getplayer[THISACTOR].ang TEMP
						setvarvar ROTATEXPOINT ROTATEXORIGIN
						addvar ROTATEXPOINT 384 // 384 // NOTE: APPEARANTLY ROTATEXPOINT IS THE KEY HERE FOR PROPER FRONT ALIGNMENT
						setvarvar ROTATEYPOINT ROTATEYORIGIN
						subvar ROTATEYPOINT 0
						rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT TEMP ROTATEXRETURN ROTATEYRETURN
						setactor[RETURN].x ROTATEXRETURN
						setactor[RETURN].y ROTATEYRETURN
					}
				}
			}
		} 
		setvar BIOMETRIC_TIMER 0
	}

	ifvarg ACCESSINCS 0 setplayer[THISACTOR].knuckle_incs ACCESSINCS
	
	setvar TEMPVAR 0
	addvarvar TEMPVAR fpress
	addvarvar TEMPVAR bpress
	ifvarg TEMPVAR 0 { ifvarl TEMPVAR 4 { ifp ponground addvar CUSTOMBOBCOUNTER 1 else setvar CUSTOMBOBCOUNTER 0 } else setvar CUSTOMBOBCOUNTER 0 } else setvar CUSTOMBOBCOUNTER 0
	
	ifvarg ftq 69 ifvarl ftq 73 { ifvarvare fta fta_normal state character_keycard_sounds }
	
	ifvare mainmenu 0
	{
		ifvarg mainmenutransitiontimer 0 subvar mainmenutransitiontimer 1
	}
	else
	{
		ifvarl mainmenutransitiontimer 8 addvar mainmenutransitiontimer 1
	}
	
	ifvare shop_id -1
	{
		ifvarg shoptransitiontimer 0 subvar shoptransitiontimer 1
	}
	else
	{
		ifvarl shoptransitiontimer 8 addvar shoptransitiontimer 1
	}

	ifvare gameover? 0
	{
		ifvarg gameovertransitiontimer 0 ifvarl gameovertransitiontimer 14 setvar gameovertransitiontimer 0
		ifvarl gameovertransitiontimer 14 randvar gameoverscreen 24
		ifvarg gameovertransitiontimer 0 subvar gameovertransitiontimer 1
	}
	else
	{
		ifvarl gameovertransitiontimer 28 addvar gameovertransitiontimer 1
	}
	
	ifvarl mainmenutransitiontimer 0 setvar mainmenutransitiontimer 0
	ifvarl shoptransitiontimer 0 setvar shoptransitiontimer 0
	ifvarl gameovertransitiontimer 0 setvar gameovertransitiontimer 0
	
	state checkspeeddisplays

	ifvare mainmenu 0
	{
		ifvarand POWERUPCHEATFLAGS? 1 setvar QUADTIME 130
		ifvarand POWERUPCHEATFLAGS? 2 setvar INVULNTIME 130
		ifvarand POWERUPCHEATFLAGS? 4 setvar REGENTIME 130
		ifvarand POWERUPCHEATFLAGS? 8 setvar APREGENTIME 130
		ifvarand POWERUPCHEATFLAGS? 16 setvar VAMPIRETIME 130
		
		ifvarand CHEATBITFIELD? 1
		{
			getplayer[THISACTOR].max_ammo_amount 0 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 0 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 1 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 1 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 2 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 2 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 3 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 3 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 4 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 4 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 5 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 5 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 6 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 6 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 7 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 7 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 8 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 8 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 9 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 9 TEMP
		
			getplayer[THISACTOR].max_ammo_amount 11 TEMP
			ifvarg TEMP 1 subvar TEMP 1
			setplayer[THISACTOR].ammo_amount 11 TEMP
		}
	}

	ifvarand bits 4 setvar SHOPCHEATBIT1 4 else setvar SHOPCHEATBIT1 0
	ifvarand bits 4194304 setvar SHOPCHEATBIT2 4194304 else setvar SHOPCHEATBIT2 0
	setvar SHOPCHEATBITTOTAL 0
	addvarvar SHOPCHEATBITTOTAL SHOPCHEATBIT1
	addvarvar SHOPCHEATBITTOTAL SHOPCHEATBIT2
	
	getactor[THISACTOR].mdflags TEMP
	orvar TEMP 16
	setactor[THISACTOR].mdflags TEMP 

	// Set's Up Overhead Sprite Animation Frames
	ifvare player[THISACTOR].on_ground 1
	{
		// getplayer[THISACTOR].posxv posxv
		// getplayer[THISACTOR].posyv posyv
		ifvarg player[THISACTOR].posxv 65536 state enforceoverheadsprites
		else
		{
			ifvarl player[THISACTOR].posxv -65536 state enforceoverheadsprites
			else
			{
				ifvarg player[THISACTOR].posyv 65536 state enforceoverheadsprites
				else
				{
					ifvarl player[THISACTOR].posyv -65536 state enforceoverheadsprites
					else setvar OVERHEADSPRITE 0
				}
			}
		}
	}
	else
	{
		setvar OVERHEADSPRITE 0
	}
	
	ifvarn VEHICLEID -1
	{
		setplayer[THISACTOR].hurt_delay 12 // Constantly sets to 12 to prevent Forcefields and Cacti from damaging a Vehicle
		setplayer[THISACTOR].footprintcount 0
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
		{
			ifvare CHARACTERSELECTED? 6 setvar bits 268435456
			ifvare CHARACTERSELECTED? 9 setvar bits 268435456
		}
	}

	setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
	ifvare MISCARRAYID_AMOUNTTEMP 1 state checkfloors-freeze
	
	setvar MISCARRAYID 75 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ARMOR-APPEARANCE?
	ifvare CHARACTERSELECTED? 1 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
	ifvare CHARACTERSELECTED? 2 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
	ifvare CHARACTERSELECTED? 3 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
	ifvare CHARACTERSELECTED? 4 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 5 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
	ifvare CHARACTERSELECTED? 6 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 2 }
	ifvare CHARACTERSELECTED? 7 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 }
	ifvare CHARACTERSELECTED? 8 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 9 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 3 }
	ifvare CHARACTERSELECTED? 10 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 11 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 12 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 13 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 14 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	ifvare CHARACTERSELECTED? 15 { setvar MISCARRAYID 75 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 }
	
	setvarvar DEFENSEMODE? player[THISACTOR].holster_weapon
	
	state checkplayergrowthrates
	state checkplayerinventoryitems
	state removeexcessinventoryslots
	state checkplayersupportlevels
	
	state support-maxhp
	state support-airtime
	state support-mantling
	state support-speed
	state support-randomstat
	state support-maxap
	
	state holdingcode
	state mercurycomputerautomapcheck
	
	ifvarn CHARACTERSELECTED? 1 { setvar CHARACTERARRAY 1 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 2 { setvar CHARACTERARRAY 2 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 3 { setvar CHARACTERARRAY 3 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 4 { setvar CHARACTERARRAY 4 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 5 { setvar CHARACTERARRAY 5 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 6 { setvar CHARACTERARRAY 6 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 7 { setvar CHARACTERARRAY 7 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 8 { setvar CHARACTERARRAY 8 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 9 { setvar CHARACTERARRAY 9 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 10 { setvar CHARACTERARRAY 10 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 11 { setvar CHARACTERARRAY 11 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 12 { setvar CHARACTERARRAY 12 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 13 { setvar CHARACTERARRAY 13 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 14 { setvar CHARACTERARRAY 14 state checknonusecharcAP }
	ifvarn CHARACTERSELECTED? 15 { setvar CHARACTERARRAY 15 state checknonusecharcAP }

	ifaction PFROZEN nullop
	else
	{
		ifvarn VEHICLEID -1
		{
			ifvare VEHICLETYPE 0 setactor[THISACTOR].pal 0
			ifvare VEHICLETYPE 1 setactor[THISACTOR].pal 17
			ifvare VEHICLETYPE 2 setactor[THISACTOR].pal 19
		}
		else
		{
			ifvare CHARACTERSELECTED? 1 setactor[THISACTOR].pal 0
			ifvare CHARACTERSELECTED? 2 setactor[THISACTOR].pal 15
			ifvare CHARACTERSELECTED? 3 setactor[THISACTOR].pal 21
			ifvare CHARACTERSELECTED? 4 setactor[THISACTOR].pal 16
			ifvare CHARACTERSELECTED? 5 setactor[THISACTOR].pal 15
			ifvare CHARACTERSELECTED? 6 setactor[THISACTOR].pal 24
			ifvare CHARACTERSELECTED? 7 setactor[THISACTOR].pal 23
			ifvare CHARACTERSELECTED? 8 setactor[THISACTOR].pal 14
			ifvare CHARACTERSELECTED? 9 setactor[THISACTOR].pal 24
			ifvare CHARACTERSELECTED? 10 setactor[THISACTOR].pal 20
			ifvare CHARACTERSELECTED? 11 setactor[THISACTOR].pal 21
			ifvare CHARACTERSELECTED? 12 setactor[THISACTOR].pal 15
			ifvare CHARACTERSELECTED? 13 setactor[THISACTOR].pal 23
			ifvare CHARACTERSELECTED? 14 setactor[THISACTOR].pal 0
			ifvare CHARACTERSELECTED? 15 setactor[THISACTOR].pal 18
		}
	}

	// Checks a Character's PK Shield Hits, and makes sure they stay intact even if a character dies.
	setvar CHARACTERARRAY 1 state checkpkshieldamounts
	setvar CHARACTERARRAY 2 state checkpkshieldamounts
	setvar CHARACTERARRAY 3 state checkpkshieldamounts
	setvar CHARACTERARRAY 4 state checkpkshieldamounts
	setvar CHARACTERARRAY 5 state checkpkshieldamounts
	setvar CHARACTERARRAY 6 state checkpkshieldamounts
	setvar CHARACTERARRAY 7 state checkpkshieldamounts
	setvar CHARACTERARRAY 8 state checkpkshieldamounts
	setvar CHARACTERARRAY 9 state checkpkshieldamounts
	setvar CHARACTERARRAY 10 state checkpkshieldamounts
	setvar CHARACTERARRAY 11 state checkpkshieldamounts
	setvar CHARACTERARRAY 12 state checkpkshieldamounts
	setvar CHARACTERARRAY 13 state checkpkshieldamounts
	setvar CHARACTERARRAY 14 state checkpkshieldamounts
	setvar CHARACTERARRAY 15 state checkpkshieldamounts

	//********************
	//* MAIN MENU CHECKS *
	//********************
	ifvare mainmenu 0 // Main Menu is NOT open
	{
		// Bio-Shield Checks/Regen
		ifvare BIOSHIELDRECHARGABLE? 2 // The Bio-Shield will Auto-Recharge itself until it hits full cells and damage-strength
		{
			ifvare LISA? 1
			{
				ifvare HAVEENERGYSHIELD? 1
				{
					setvarvar TEMP2 MAXCELLS
					addvar TEMP2 1
					ifvarvarl CURRENTCELLS TEMP2
					{
						ifvare CHARACTERSELECTED? 8
						{
							ifvare ENERGYSHIELDMODE 1
							{
								ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 66
								else addvar BIOSHIELDRECHARGETIMER 3
							}
							else
							ifvare ENERGYSHIELDMODE 0
							{
								ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 264
								else addvar BIOSHIELDRECHARGETIMER 24
							}
						}
						else
						{
							ifvare ENERGYSHIELDMODE 1
							{
								ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 22
								else addvar BIOSHIELDRECHARGETIMER 1
							}
							else
							ifvare ENERGYSHIELDMODE 0
							{
								ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 88
								else addvar BIOSHIELDRECHARGETIMER 8
							}
						}
						ifvare ESHIELDADVANCEMENT 0 setvar TEMPVAR5 255 else setvar TEMPVAR5 191
						ifvarvarg BIOSHIELDRECHARGETIMER TEMPVAR5
						{
							ifvare CURRENTCELLS 0 { setvar BIOSHIELDRECHARGETIMER 0 } else { ifvare ESHIELDADVANCEMENT 0 subvar BIOSHIELDRECHARGETIMER 256 else subvar BIOSHIELDRECHARGETIMER 192 }
							setvarvar TEMP3 ESHIELDDMGFACTOR
							divvar TEMP3 16
							ifvare ESHIELDADVANCEMENT 1 { mulvar TEMP3 9 divvar TEMP3 8 }
							ifvarl TEMP3 1 setvar TEMP3 1
							ifvarvarl CURRENTCELLS MAXCELLS nullop else { ifvarvarl DAMAGEINCELL ESHIELDDMGFACTOR nullop else setvar TEMP3 0 }
				
							ifvarn player[THISACTOR].over_shoulder_on 0 ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1
							{
								ifvarg TEMP3 0
								{
								setvarvar SHOWDAMAGE TEMP3
								setvar SHOWDAMAGETYPE 5
								setvarvar SHOWDAMAGEACTORID PLAYERID
								state showdamage
								}
							}
				
							ifvarvare CURRENTCELLS MAXCELLS ifvarvare DAMAGEINCELL ESHIELDDMGFACTOR nullop
							else
							{
								addvarvar DAMAGEINCELL TEMP3
								ifvarvare CURRENTCELLS MAXCELLS ifvarvare DAMAGEINCELL ESHIELDDMGFACTOR { soundonce ESHIELD_CHARGEDMAX }
								ifvarvare CURRENTCELLS MAXCELLS ifvarvarg DAMAGEINCELL ESHIELDDMGFACTOR { setvarvar DAMAGEINCELL ESHIELDDMGFACTOR soundonce ESHIELD_CHARGEDMAX }
							}
						}
					}
					else setvar BIOSHIELDRECHARGETIMER 0
				}
			}
		}
		else
		ifvare BIOSHIELDRECHARGABLE? 1 // Only recharges the 'Free Cell' inside the shield to full power and nothing more.
		{
			ifvare LISA? 1
			{
				ifvare HAVEENERGYSHIELD? 1
				{
					ifvare CURRENTCELLS 0
					{
						ifvarvarl DAMAGEINCELL ESHIELDDMGFACTOR
						{
							ifvare CHARACTERSELECTED? 8
							{
								ifvare ENERGYSHIELDMODE 1
								{
									ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 132
									else addvar BIOSHIELDRECHARGETIMER 3
								}
								else
								ifvare ENERGYSHIELDMODE 0
								{
									ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 264
									else addvar BIOSHIELDRECHARGETIMER 24
								}
							}
							else
							{
								ifvare ENERGYSHIELDMODE 1
								{
									ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 44
									else addvar BIOSHIELDRECHARGETIMER 1
								}
								else
								ifvare ENERGYSHIELDMODE 0
								{
									ifvare CURRENTCELLS 0 addvar BIOSHIELDRECHARGETIMER 88
									else addvar BIOSHIELDRECHARGETIMER 8
								}
							}
							ifvare ESHIELDADVANCEMENT 0 setvar TEMPVAR5 255 else setvar TEMPVAR5 191
							ifvarvarg BIOSHIELDRECHARGETIMER TEMPVAR5
							{
								ifvare CURRENTCELLS 0 { setvar BIOSHIELDRECHARGETIMER 0 } else { ifvare ESHIELDADVANCEMENT 0 subvar BIOSHIELDRECHARGETIMER 256 else subvar BIOSHIELDRECHARGETIMER 192 }
								setvarvar TEMP3 ESHIELDDMGFACTOR
								divvar TEMP3 16
								ifvare ESHIELDADVANCEMENT 1 { mulvar TEMP3 9 divvar TEMP3 8 }
								ifvarl TEMP3 1 setvar TEMP3 1
								ifvarvarl DAMAGEINCELL ESHIELDDMGFACTOR nullop else setvar TEMP3 0
					
								ifvarn player[THISACTOR].over_shoulder_on 0 ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1
								{
									ifvarg TEMP3 0
									{
										setvarvar SHOWDAMAGE TEMP3
										setvar SHOWDAMAGETYPE 5
										setvarvar SHOWDAMAGEACTORID PLAYERID
										state showdamage
									}
								}
					
								ifvarvare DAMAGEINCELL ESHIELDDMGFACTOR nullop
								else
								{
									addvarvar DAMAGEINCELL TEMP3
									ifvarvarg DAMAGEINCELL ESHIELDDMGFACTOR setvarvar DAMAGEINCELL ESHIELDDMGFACTOR
								}
							}
						}
					}
					else setvar BIOSHIELDRECHARGETIMER 0
				}
			}
		}
		
		// Mantling
		ifvare EDGEGRAPPLING 1
		{
			setvar GLIDING? 0
			ifvare player[THISACTOR].ftq 245
			{
				ifvarg player[THISACTOR].fta 0 setplayer[THISACTOR].fta 0
			}
		}
		else
		{
			ifvarg ONAWALL? 0
			{
				setvar GLIDING? 0
				ifvare player[THISACTOR].ftq 245
				{
					ifvarg player[THISACTOR].fta 0 setplayer[THISACTOR].fta 0
				}
			}
		}
		
		// Over the Shoulder Mode
		ifvarg backview 0
		{
			subvar backview 1
			ifvare EDGEGRAPPLING 1 nullop
			else
			{
				ifvarg ONAWALL? 0 nullop
				else
				{
					ifvarg backview 8 setvar backview 8
				}
			}
		}
		ifvarl backview 8
		{
			ifvare player[THISACTOR].ftq 835
			{
				ifvarg player[THISACTOR].fta 0 setplayer[THISACTOR].fta 0
			}
		}
		
		// Money Radar
		setvar MISCARRAYID 68 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // GOT-MONEY-RADAR?
		ifvare MISCARRAYID_AMOUNTTEMP 1 { state moneyfinder state gemfinder }
		
		// Helix Testing
		ifvarl ROTATEZINTERVAL 17
		{
			ifvarg CURRENTHITPOINTS 0 // ifp palive
			{
				addvar ROTATEPOINTTESTTIMER 1
				ifvarg ROTATEPOINTTESTTIMER 0
				{
					state rotatepointtest
					state rotatepointtest2
					subvar ROTATEPOINTTESTTIMER 1
				}
			}
		}
		
		// Knockback Checks
		ifvarg knockback 0
		{
			subvar knockback 1
			cos xvel knockbackang
			sin yvel knockbackang
			mulvarvar xvel knockbackstr mulvarvar yvel knockbackstr
			setplayer[THISACTOR].poszv -1024 // -1536
			setplayer[THISACTOR].posxv xvel
			setplayer[THISACTOR].posyv yvel
			setplayer[THISACTOR].jumping_toggle 1
			setvar multijumpflag 0
		}
		ifvare knockback 0 setvar knockbackstr 1
		
		// Status Checks
		ifvarand PLAYERSTATUS? 2
		{
			setvar TEMPVAR5 0
			ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
			ifvarg TEMPVAR5 0
			{
				setvarvar TEMPVAR4 TIMERRAWFORMAT
				modvar TEMPVAR4 5
				ifvare TEMPVAR4 4 subvar PLAYERHASTETIMER 1
			}
			else
			{
				subvar PLAYERHASTETIMER 1
			}
		
			ifvarl PLAYERHASTETIMER 1
			{
				setvar PLAYERHASTETIMER 0
				state removehaste
			}
		}
		ifvarand PLAYERSTATUS? 4
		{
			setvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
			subvarvar PLAYERSLOWTIMER TEMPVAR5
		
			ifvarl PLAYERSLOWTIMER 1
			{
				setvar PLAYERSLOWTIMER 0
				state removeslow
			}
		}
		ifvarand PLAYERSTATUS? 8
		{
			setvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
			subvarvar PLAYERPOISONTIMER TEMPVAR5
		
			ifvarl PLAYERPOISONTIMER 1
			{
				setvar PLAYERPOISONTIMER 0
				state removepoison
			}
		}
		ifvarand PLAYERSTATUS? 16
		{
			setvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
			subvarvar PLAYERDIMNESSTIMER TEMPVAR5
		
			ifvarl PLAYERDIMNESSTIMER 1
			{
				setvar PLAYERDIMNESSTIMER 0
				state removedimness
			}
		}
		ifvarand PLAYERSTATUS? 128
		{
			setvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
			subvarvar PLAYERCONFUSIONTIMER TEMPVAR5
		
			ifvarl PLAYERCONFUSIONTIMER 1
			{
				setvar PLAYERCONFUSIONTIMER 0
				state removeconfusion
			}
		}
		ifvarand PLAYERSTATUS? 512
		{
			setvar TEMPVAR5 0
			ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
			ifvarg TEMPVAR5 0
			{
				setvarvar TEMPVAR4 TIMERRAWFORMAT
				modvar TEMPVAR4 5
				ifvare TEMPVAR4 4 subvar PLAYERSHELLTIMER 1
			}
			else
			{
				subvar PLAYERSHELLTIMER 1
			}
		
			ifvarl PLAYERSHELLTIMER 1
			{
			setvar PLAYERSHELLTIMER 0
			state removedamageshell
			}
		}
		ifvarand PLAYERSTATUS? 1024 nullop
		else
		{
			ifvarg PLAYERPSISHIELDTIMER 0 addvar PLAYERSTATUS? 1024
		}
		ifvarand PLAYERSTATUS? 4096
		{
			setvar TEMPVAR5 0
			ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
			ifvarg TEMPVAR5 0
			{
				setvarvar TEMPVAR4 TIMERRAWFORMAT
				modvar TEMPVAR4 5
				ifvare TEMPVAR4 4 subvar PLAYERBOOSTERTIMER 1
			}
			else
			{
				subvar PLAYERBOOSTERTIMER 1
			}
		
			ifvarl PLAYERBOOSTERTIMER 1
			{
			setvar PLAYERBOOSTERTIMER 0
			state removebooster
			}
		}
		ifvarand PLAYERSTATUS? 8192
		{
			setvar TEMPVAR5 0
			ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMPVAR5 1
			ifvarg TEMPVAR5 0
			{
				setvarvar TEMPVAR4 TIMERRAWFORMAT
				modvar TEMPVAR4 5
				ifvare TEMPVAR4 4 subvar PLAYERBLOODLUSTTIMER 1
			}
			else
			{
				subvar PLAYERBLOODLUSTTIMER 1
			}
		
			ifvarl PLAYERBLOODLUSTTIMER 1
			{
			setvar PLAYERBLOODLUSTTIMER 0
			state removebloodlusting
			}
		}
		ifvarand PLAYERSTATUS? 16384
		{
			setvar TEMPVAR5 1
			ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR5 5
			ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR5 5
			subvarvar PLAYERCORROSIONTIMER TEMPVAR5
		
			ifvarl PLAYERCORROSIONTIMER 1
			{
				setvar PLAYERCORROSIONTIMER 0
				state removecorrosion
			}
		}
		
		// Portable Medikit Toggle Mode
		ifvare automedikittoggle 1
		{
			ifvare oldskoolmode 0
			{
				setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
				ifvarl MISCARRAYID_AMOUNTTEMP 10
				{
					ifvarg CURRENTHITPOINTS 0
					{
						ifvarvarl CURRENTHITPOINTS MAXHITPOINTS state usemedikit
					}
				}
			}
		}
	}
	
	ifvarn player[THISACTOR].curr_weapon 4
	{
		ifvare player[THISACTOR].ftq 1334 setplayer[THISACTOR].fta 0
	}

	ifvarg DEATHMISSILEACTIVATED 0
	{
		addvar DEATHMISSILETIMERLAPSE 1
		ifvarg DEATHMISSILETIMERLAPSE 1
		{
			setvar DEATHMISSILEACTIVATED 0
			setvar DEATHMISSILETIMERLAPSE 0
		}
	}
	
	ifvare SKILLLEVEL 4 setuserdef[THISACTOR].respawn_monsters 0
	setuserdef[THISACTOR].levelstats 0
	setuserdef[THISACTOR].althud 0
	setuserdef[THISACTOR].lockout 0

	//***********************************************
	//*Check for Twilight Cloaks or Vampire Artifact*
	//***********************************************
	setvar VAMPIREDMGFACTOR 0
	randvar VAMPIREDMGRANDOM 0
	setvar VAMPIREMAXDMGFACTOR 0
	ifvare PUBLICBETA? 0 // Commerical Versions
	{
		ifvarg VAMPIRETIME 0
		{
			setvar VAMPIREDMGFACTOR 250
			randvar VAMPIREDMGRANDOM 50
			ifrnd 128 addvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM else subvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 200
		}
		else
		{
			setvar VAMPIREDMGFACTOR 0
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 100
		}
	
		ifvarg VAMPIRETIME 0
		{
			setvar VAMPIREMAXDMGFACTOR 1250
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 200
		}
		else
		{
			setvar VAMPIREMAXDMGFACTOR 1000
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 100
		}
		ifvarg VAMPIREMAXDMGFACTOR 4000 setvar VAMPIREMAXDMGFACTOR 4000
	}
	else // Public Beta
	{
		ifvarg VAMPIRETIME 0
		{
			setvar VAMPIREDMGFACTOR 500
			randvar VAMPIREDMGRANDOM 100
			ifrnd 128 addvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM else subvarvar VAMPIREDMGFACTOR VAMPIREDMGRANDOM
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 200
		}
		else
		{
			setvar VAMPIREDMGFACTOR 0
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREDMGFACTOR 100
		}
	
		ifvarg VAMPIRETIME 0
		{
			setvar VAMPIREMAXDMGFACTOR 1500
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 200
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 200
		}
		else
		{
			setvar VAMPIREMAXDMGFACTOR 1000
			ifvare PLAYEREQUIPSLOTITEM1 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM2 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM3 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM4 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM5 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM6 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM7 22 addvar VAMPIREMAXDMGFACTOR 100
			ifvare PLAYEREQUIPSLOTITEM8 22 addvar VAMPIREMAXDMGFACTOR 100
		}
		ifvarg VAMPIREMAXDMGFACTOR 4000 setvar VAMPIREMAXDMGFACTOR 4000
	}

	state refreshhealthvalues
	
	ifvarg SPRITEDAMAGETYPE? 0 setvar SPRITEDAMAGETYPE? 0

	ifvare oldskoolmode 0
	{
		redefinequote 12 ^19USED VITAMIN X
		redefinequote 90 ^20VITAMIN X
		
		setvar WEAPON1_SHOOTS 6136
		setvar WEAPON1_TOTALTIME 6
		setvar WEAPON2_RELOAD 10 // 10
		setvar WEAPON2_FIREDELAY 3 // 3
		setvar WEAPON2_TOTALTIME 21 // 21
		setvar WEAPON2_SHOOTS 6140
		
		ifvare CHAINGUNMODE 0
		{
			setvar WEAPON3_SHOOTS CHAINGUN // SHOTSPARK1
			setvar WEAPON3_SHOTSPERBURST 3
			setvar WEAPON3_FIRESOUND CAPT_ATTACK
			setvar WEAPON3_FLAGS 73748 // 4+16+8192+65536
		}
		else
		ifvare CHAINGUNMODE 1
		{
			setvar WEAPON3_SHOOTS 2605
			setvar WEAPON3_SHOTSPERBURST 2
			setvar WEAPON3_FIRESOUND 6
			setvar WEAPON3_FLAGS 73748 // 4+16+8192+65536
		}
		/*
		else
		ifvare CHAINGUNMODE 2
		{
			setvar WEAPON3_SHOOTS FIRELASER
			setvar WEAPON3_SHOTSPERBURST 1
			setvar WEAPON3_FIRESOUND PRED_ATTACK
			setvar WEAPON3_FLAGS 73748 // 4+16+8192+65536
		}

		ifvare CHARACTERSELECTED? 8
		{
			setvar WEAPON3_SHOOTS 6071
			setvar WEAPON3_FIRESOUND 575
		}
		else
		{
			setvar WEAPON3_SHOOTS 2605
			setvar WEAPON3_FIRESOUND 6
		}
		*/
		ifvare DEATHMISSILESUSABLE? 1
		{  
			ifvare DEATHMISSILEMODE 0
			{
				setvar WEAPON4_SHOOTS GATEMISSILE_MAIN // Deathgate
				setvar WEAPON4_SHOTSPERBURST 1
				setvar WEAPON4_FIRESOUND 0
			}
			else
			ifvare DEATHMISSILEMODE 1
			{
				setvar WEAPON4_SHOOTS STROKEMISSILE_MAIN // Deathstroke
				setvar WEAPON4_SHOTSPERBURST 1
				setvar WEAPON4_FIRESOUND 0
			}
		}
		else
		{
			setvar WEAPON4_SHOOTS 6140
			setvar WEAPON4_SHOTSPERBURST 56
			setvar WEAPON4_FIRESOUND 109
		}
		setvar WEAPON11_SHOTSPERBURST 7
	}
	else
	{
		setvar WEAPON1_SHOOTS 2595
		setvar WEAPON1_TOTALTIME 5
		setvar WEAPON2_RELOAD 13
		setvar WEAPON2_FIREDELAY 4
		setvar WEAPON2_TOTALTIME 31
		setvar WEAPON2_SHOOTS 2613
		setvar WEAPON3_SHOOTS 2536
		setvar WEAPON4_SHOOTS 2605
		setvar WEAPON4_SHOTSPERBURST 1
		setvar WEAPON4_FIRESOUND 0
		setvar WEAPON11_SHOTSPERBURST 1
	}
	
	ifvare oldskoolmode 0 state globaltimer

	//getplayer[THISACTOR].wackedbyactor temp
	
	ifvarg CURRENTHITPOINTS 0
	{
		ifvarn player[THISACTOR].wackedbyactor -1 setplayer[THISACTOR].wackedbyactor -1
		ifvarn player[THISACTOR].dead_flag 0 setplayer[THISACTOR].dead_flag 0
	}

	ifp pjetpack
	{
		ifvarn sector[PLAYERSECTOR].lotag 2
		{
			ifvarand bits 1
			{
				ifvare mainmenu 0 addvar JETPACKSMOKEVAR 1
				ifvarg JETPACKSMOKEVAR 7
				{
					state jetpacksmoke
					setvar JETPACKSMOKEVAR 0
				}
			}
			
			ifvarand bits 2
			{
				ifvare mainmenu 0 addvar JETPACKSMOKEVAR 1
					ifvarg JETPACKSMOKEVAR 7
				{
					state jetpacksmoke
					setvar JETPACKSMOKEVAR 0
				}
			}
			
			ifvarand bits 3 nullop
			else
			{
				ifvare mainmenu 0 addvar JETPACKSMOKEVAR 1
				ifvarg JETPACKSMOKEVAR 15
				{
					state jetpacksmoke
					setvar JETPACKSMOKEVAR 0
				}
			}
		}
		
		// Jetpack Rise Heights
		//getplayer[THISACTOR].posz TEMPVAR2
		//getplayer[THISACTOR].oposz TEMPVAR3
		
		ifvarand bits 1
		{
			ifvarvarl player[THISACTOR].posz player[THISACTOR].oposz
			{
				setvarvar TEMPVAR4 player[THISACTOR].oposz
				subvarvar TEMPVAR4 player[THISACTOR].posz
				ifvare CHARACTERSELECTED? 1 mulvar TEMPVAR4 0
				ifvare CHARACTERSELECTED? 2 mulvar TEMPVAR4 534
				ifvare CHARACTERSELECTED? 3
				{
					setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
					ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar TEMPVAR4 541 else mulvar TEMPVAR4 635
				}
				ifvare CHARACTERSELECTED? 4 mulvar TEMPVAR4 821
				ifvare CHARACTERSELECTED? 5 mulvar TEMPVAR4 198
				ifvare CHARACTERSELECTED? 6
				{
					setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 0 mulvar TEMPVAR4 -783 else mulvar TEMPVAR4 -627 
				}
				ifvare CHARACTERSELECTED? 7 mulvar TEMPVAR4 211
				ifvare CHARACTERSELECTED? 8 mulvar TEMPVAR4 723
				ifvare CHARACTERSELECTED? 9 mulvar TEMPVAR4 -811
				ifvare CHARACTERSELECTED? 10 mulvar TEMPVAR4 623
				ifvare CHARACTERSELECTED? 11 mulvar TEMPVAR4 851
				ifvare CHARACTERSELECTED? 12 mulvar TEMPVAR4 647
				ifvare CHARACTERSELECTED? 13 mulvar TEMPVAR4 778
				ifvare CHARACTERSELECTED? 14 mulvar TEMPVAR4 556
				ifvare CHARACTERSELECTED? 15 mulvar TEMPVAR4 806
				divvar TEMPVAR4 1000
				ifvare CHARACTERSELECTED? 1 { ifvarg TEMPVAR4 0 setvar TEMPVAR4 0 }
				ifvare CHARACTERSELECTED? 2 { ifvarg TEMPVAR4 1094 setvar TEMPVAR4 1094 }
				ifvare CHARACTERSELECTED? 3
				{
					setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
					ifvare MISCARRAYID_AMOUNTTEMP 1 { ifvarg TEMPVAR4 1102 setvar TEMPVAR4 1102 }
						else { ifvarg TEMPVAR4 1301 setvar TEMPVAR4 1301 }
				}
				ifvare CHARACTERSELECTED? 4 { ifvarg TEMPVAR4 1682 setvar TEMPVAR4 1682 }
				ifvare CHARACTERSELECTED? 5 { ifvarg TEMPVAR4 405 setvar TEMPVAR4 405 }
				ifvare CHARACTERSELECTED? 6 
				{ 
					setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { ifvarg TEMPVAR4 -1603 setvar TEMPVAR4 -1603 } else { ifvarg TEMPVAR4 -1283 setvar TEMPVAR4 -1283 } 
				}
				ifvare CHARACTERSELECTED? 7 { ifvarg TEMPVAR4 432 setvar TEMPVAR4 432 }
				ifvare CHARACTERSELECTED? 8 { ifvarg TEMPVAR4 1481 setvar TEMPVAR4 1481 }
				ifvare CHARACTERSELECTED? 9 { ifvarg TEMPVAR4 -1661 setvar TEMPVAR4 -1661 }
				ifvare CHARACTERSELECTED? 10 { ifvarg TEMPVAR4 1276 setvar TEMPVAR4 1276 }
				ifvare CHARACTERSELECTED? 11 { ifvarg TEMPVAR4 1743 setvar TEMPVAR4 1743 }
				ifvare CHARACTERSELECTED? 12 { ifvarg TEMPVAR4 1325 setvar TEMPVAR4 1325 }
				ifvare CHARACTERSELECTED? 13 { ifvarg TEMPVAR4 1593 setvar TEMPVAR4 1593 }
				ifvare CHARACTERSELECTED? 14 { ifvarg TEMPVAR4 1138 setvar TEMPVAR4 1138 }
				ifvare CHARACTERSELECTED? 15 { ifvarg TEMPVAR4 1652 setvar TEMPVAR4 1652 }
				setvarvar TEMPVAR5 player[THISACTOR].posz
				subvarvar TEMPVAR5 TEMPVAR4
				setplayer[THISACTOR].posz TEMPVAR5
			}
		}
		ifvarand bits 2
		{
			ifvarvarg player[THISACTOR].posz player[THISACTOR].oposz
			{
				setvarvar TEMPVAR4 player[THISACTOR].oposz
				subvarvar TEMPVAR4 player[THISACTOR].posz
				ifvare CHARACTERSELECTED? 1 mulvar TEMPVAR4 0
				ifvare CHARACTERSELECTED? 2 mulvar TEMPVAR4 348
				ifvare CHARACTERSELECTED? 3
				{
					setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
					ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar TEMPVAR4 355 else mulvar TEMPVAR4 388
				}
				ifvare CHARACTERSELECTED? 4 mulvar TEMPVAR4 451
				ifvare CHARACTERSELECTED? 5 mulvar TEMPVAR4 165
				ifvare CHARACTERSELECTED? 6
				{
					setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 0 mulvar TEMPVAR4 -3607 else mulvar TEMPVAR4 -2525 
				}
				ifvare CHARACTERSELECTED? 7 mulvar TEMPVAR4 174
				ifvare CHARACTERSELECTED? 8 mulvar TEMPVAR4 420
				ifvare CHARACTERSELECTED? 9 mulvar TEMPVAR4 -4295
				ifvare CHARACTERSELECTED? 10 mulvar TEMPVAR4 384
				ifvare CHARACTERSELECTED? 11 mulvar TEMPVAR4 460
				ifvare CHARACTERSELECTED? 12 mulvar TEMPVAR4 393
				ifvare CHARACTERSELECTED? 13 mulvar TEMPVAR4 438
				ifvare CHARACTERSELECTED? 14 mulvar TEMPVAR4 357
				ifvare CHARACTERSELECTED? 15 mulvar TEMPVAR4 446
				divvar TEMPVAR4 1000
				setvarvar TEMPVAR5 player[THISACTOR].posz
				addvarvar TEMPVAR5 TEMPVAR4
				setplayer[THISACTOR].posz TEMPVAR5
			}
		}
		
		ifvarn ONAWALL? 0 setvar ONAWALL? 0
	}


	ifvarg fpress 0 subvar fpress 1
	ifvarg bpress 0 subvar bpress 1
	ifvarl ONAWALL? 0 { setvar WALLTYPE 0 addvar ONAWALL? 1 }
	
	ifvarg ONAWALL? 0 state wallclimbcode
	ifvare ONAWALL? 0 { setvar WALLTYPE 0 setvar WALLCLIMBSNDTIMER 0 }
	
	ifvarg ONAWALL? 0 
	{  
		getactor[THISACTOR].xvel temp
		divvar temp 128
		setactor[THISACTOR].xvel temp
		getactor[THISACTOR].yvel temp
		divvar temp 128
		setactor[THISACTOR].yvel temp
		setvar fallingresistance 0
		setvar fallcounter2 0
		setvar totalfallcounter 0
		setvar falldamageratio 0
		setvar FALLSOUND? 0
		getplayer[THISACTOR].weapon_pos temp
		ifvarl temp 9
		{
			addvar temp 3
			setplayer[THISACTOR].weapon_pos temp
		}
	}
	
	ifvarg dodge 0
	{
		cos xvel dodgeang
		sin yvel dodgeang 
		mulvar xvel 352
		mulvar yvel 352
		setplayer[THISACTOR].poszv -1536
		setplayer[THISACTOR].posxv xvel
		setplayer[THISACTOR].posyv yvel
		subvar dodge 1
	}

	ifp ponground ifvare INTHEAIR? 1 setvar INTHEAIR? 0

	ifvarn sector[PLAYERSECTOR].lotag 2
	{
		ifvare oldskoolmode 0 // Mantling shouldn't be usable in the Prolouge :P
		{
			ifvarg MANTLINGTIMER 0
			{
				ifvare ONAWALL? 0 
				{
					ifp pjetpack setvar EDGEGRAPPLING 0
					else
					{
						ifvare SPRITEID-HOLDING -1
						{
							ifvare automantletoggle 0
							{
								ifvarand bits 1 state edgegrabbing
								else setvar EDGEGRAPPLING 0
							}
							else state edgegrabbing
						}
						else setvar EDGEGRAPPLING 0
					}
				}
				else setvar EDGEGRAPPLING 0
			}
			else setvar EDGEGRAPPLING 0
		}
		else setvar EDGEGRAPPLING 0
	}
	
	ifvarg EDGEGRAPPLING 0
	{
		setvar GLIDING? 0
		setvar fallingresistance 0
		setvar fallcounter2 0
		setvar totalfallcounter 0
		setvar falldamageratio 0
		setvar FALLSOUND? 0
		getplayer[THISACTOR].weapon_pos temp
		ifvarl temp 9
		{
			addvar temp 3
			setplayer[THISACTOR].weapon_pos temp
		}
	}
	else
	{
		ifvarn SPRITEID-HOLDING -1
		{
			ifvarvare SPRITEID-HOLDING SPRITEID-TELEKENESIS_P
			{
				ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
				else
				ifvarg MANTLINGTIMER -1
				ifvarvarl MANTLINGTIMER MANTLINGTIMERMAX
				{
					setvarvar TEMPVAR MANTLINGTIMERMAX
					divvar TEMPVAR 130
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
					ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvarvar MANTLINGTIMER TEMPVAR }
				}
				else
				{
					setvarvar MANTLINGTIMER MANTLINGTIMERMAX
					setvar MANTLINGTIMEREXTRA 1000
				} 
			}
		}
		else
		ifvare SPRITEID-HOLDING -1
		{
			ifvarn PLAYERPUSHINGTIMER 0 nullop
			else
			{
				ifvarl MANTLINGTIMER 0
				{
					setvar MANTLINGTIMER 0
				}
				else
				ifvarg MANTLINGTIMER -1
				ifvarvarl MANTLINGTIMER MANTLINGTIMERMAX
				{
					setvarvar TEMPVAR MANTLINGTIMERMAX
					divvar TEMPVAR 130
					ifvarl TEMPVAR 1 setvar TEMPVAR 1
					ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvarvar MANTLINGTIMER TEMPVAR }
				}
				else
				{
					setvarvar MANTLINGTIMER MANTLINGTIMERMAX
					setvar MANTLINGTIMEREXTRA 1000
				} 
			}
		}
	}

	ifvarl INVULNTIME 1 setvar DEFLECTDAMAGESTATE 0
	ifvarn CHARACTERSELECTED? 12 setvar REFRACTORSTATE 0
	
	state difficulty
	ifvare SKILLSET? 0 
	{
		state initializer
		setvar SKILLSET? 1 
	}
	
	state rankstarplayer
	state getplayerid
	state canceldeadactions

	ifvarl CURRENTHITPOINTS 1
	{
		ifvarn FROZEN? 1 setactor[PLAYERID].extra 0
	} 
	else 
	{
		setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
		ifvarg MISCARRAYID_AMOUNTTEMP 0 setactor[PLAYERID].extra 16384
		
		ifsquished setvar CURRENTHITPOINTS 0
		getactor[PLAYERID].extra TEMPVAR
		ifvarl TEMPVAR 1 setvar CURRENTHITPOINTS 0
	}

	// Deals with Protozoid [GREENSLIME] damage
	ifvarn player[THISACTOR].somethingonplayer -1
	{
		ifvare INVULNTIME 0
		{
			ifvarn VEHICLEID -1
			{
				setplayer[THISACTOR].quick_kick 1
				setplayer[THISACTOR].fta 0
			}
			else
			{
				addvar GREENSLIMETIMER 1
				ifvarg GREENSLIMETIMER 4
				{
					setvarvar TEMP MAXHITPOINTS
					ifvare CHARACTERSELECTED? 14
					{
						ifvare PUBLICBETA? 0
						{
							randvar temp 1
							addvar temp 1
						}
						else
						{
							randvar temp 5
							addvar temp 5
						}
					}
					else
					{
						randvar temp 5
						addvar temp 5
					}
					mulvarvar TEMP temp
					divvar TEMP 1000
			
					ifvare CHARACTERSELECTED? 14
					{
						ifvare PUBLICBETA? 0
						{
							randvar tempe 1
							addvar tempe 2
						}
						else
						{
							randvar tempe 3
							addvar tempe 5
						}
					}
					else
					{
						randvar tempe 3
						addvar tempe 5
					}
					addvarvar tempe TEMP
			
					setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
					ifvare MISCARRAYID_AMOUNTTEMP 0 ifvare mainmenu 0
					{
						//*********************
						//*Check Malakian Gems*
						//*********************
						setvarvar TEMP7 tempe
						state malakiangemcheck 
						setvarvar tempe TEMP7
				
						ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarl TEMPVAR 1 setvar TEMPVAR 1 state cheatersound }
				
						setvarvar TEMPDAMAGEVAR tempe
						state lisashield_misc
						setvarvar tempe TEMPDAMAGEVAR
				
						setvarvar tempb CURRENTHITPOINTS
						subvarvar tempb tempe
						ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
						else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
						ifvarl tempb 0 setvar tempb 0
						ifvarvarg tempb MAXHITPOINTSATOMIC setvarvar tempb MAXHITPOINTSATOMIC
						setactor[PLAYERID].htpicnum -1
						setvarvar CURRENTHITPOINTS tempb
						state checkbuddhamode
				
						ifvarn player[THISACTOR].over_shoulder_on 0
						{
							ifvarg CELLDAMAGETEMP 0
							{
							setvarvar SHOWDAMAGE CELLDAMAGETEMP
							setvar SHOWDAMAGETYPE 2
							setvarvar SHOWDAMAGEACTORID THISACTOR
							state showdamage
							}
						}
						ifvarg FULLSHIELDDAMAGE 0
						{
							setvarvar ATTACKINGACTORPICNUM 2375
							setvar ATTACKINGACTORPAL 0
							setvar ACTORCRITICAL? 0
							setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
							ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
						}
						
						ifvarn player[THISACTOR].over_shoulder_on 0
						{
							ifvarg tempe 0
							{
							setvarvar SHOWDAMAGE tempe
							setvar SHOWDAMAGETYPE 0
							setvarvar SHOWDAMAGEACTORID THISACTOR
							state showdamage
							}
						}
						ifvarg tempe 0
						{
							setvarvar PAINSOUNDFACTOR tempe
							state checkpainfactor
				
							ifrnd 72 state characterpainsounds
							setvarvar DAMAGEHUEFACTOR tempe
							state playerdamagehues-acidtype
				
							setvarvar ATTACKINGACTORPICNUM 2375
							setvar ATTACKINGACTORPAL 0
							setvar ACTORCRITICAL? 0
							setvarvar PLAYERDAMAGETEMP tempe
							setactor[THISACTOR].htpicnum -1
							setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
							setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
							ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
						}
					}
					setactor[THISACTOR].extra 16384
					setvar GREENSLIMETIMER 0
				}
			}
		}
		else
		{
			setplayer[THISACTOR].quick_kick 1
			setplayer[THISACTOR].fta 0
			sound INVULNITEM3
		}
		
		ifvarand CHEATBITFIELD? 32
		{
			setplayer[THISACTOR].quick_kick 1
			setplayer[THISACTOR].fta 0
		}
		
		ifvarl CURRENTHITPOINTS 1
		{
			setplayer[THISACTOR].quick_kick 1
			setplayer[THISACTOR].fta 0
		}
	}
	else
	{
		setvar GREENSLIMETIMER 0
	}

	ifvarg com_pause 0 subvar com_pause 1 // For Keypad Entry Delays
	
	// Keeps Stats from being set to 0 for the current character-in-play through some random act of buggy fate :P
	ifvarl MAXHITPOINTS 1 setvar MAXHITPOINTS 1
	ifvarl MAXARMORPOINTS 1 setvar MAXARMORPOINTS 1
	ifvarl MAXENERGYPOINTS 1 setvar MAXENERGYPOINTS 1
	ifvarl PLAYERATTACK 1 setvar PLAYERATTACK 1
	ifvarl PLAYERDEFENSE 1 setvar PLAYERDEFENSE 1

	ifvarg MAXHITPOINTS 0 
	{ 
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		setvarvar MISCARRAYID_AMOUNTTEMP CURRENTHITPOINTS
		mulvar MISCARRAYID_AMOUNTTEMP 1000
		divvarvar MISCARRAYID_AMOUNTTEMP MAXHITPOINTS 
		setvar MISCARRAYID 94 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR

		setvar MISCARRAYID 97 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FA-FACTOR
		setvarvar MISCARRAYID_AMOUNTTEMP FIRSTAIDCURRENT
		mulvar MISCARRAYID_AMOUNTTEMP 1000
		divvarvar MISCARRAYID_AMOUNTTEMP MAXHITPOINTS 
		setvar MISCARRAYID 97 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FA-FACTOR
	}
	ifvarg MAXARMORPOINTS 0 
	{
		setvar MISCARRAYID 95 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AP-FACTOR
		setvarvar MISCARRAYID_AMOUNTTEMP CURRENTARMORPOINTS
		mulvar MISCARRAYID_AMOUNTTEMP 1000
		divvarvar MISCARRAYID_AMOUNTTEMP MAXARMORPOINTS 
		setvar MISCARRAYID 95 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AP-FACTOR
	}
	ifvarg MAXENERGYPOINTS 0 
	{
		setvar MISCARRAYID 96 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // EP-FACTOR
		setvarvar MISCARRAYID_AMOUNTTEMP CURRENTENERGYPOINTS
		mulvar MISCARRAYID_AMOUNTTEMP 1000
		divvarvar MISCARRAYID_AMOUNTTEMP MAXENERGYPOINTS 
		setvar MISCARRAYID 96 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // EP-FACTOR
	}
	ifvarg MAXBIOSHIELDPOWER 0 
	{
		setvar MISCARRAYID 98 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ES-FACTOR
		setvarvar MISCARRAYID_AMOUNTTEMP CURRENTBIOSHIELDPOWER
		mulvar MISCARRAYID_AMOUNTTEMP 1000
		divvarvar MISCARRAYID_AMOUNTTEMP MAXBIOSHIELDPOWER
		setvar MISCARRAYID 98 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ES-FACTOR
	}
	ifvarg PLAYERMAXAIRJUMPS 0
	{
		setvarvar AIRJUMPRATIO PLAYERMAXAIRJUMPS
		subvarvar AIRJUMPRATIO multijumpflag
		mulvar AIRJUMPRATIO 1000
		divvarvar AIRJUMPRATIO PLAYERMAXAIRJUMPS
	}

setplayer[THISACTOR].airleft 16384 // For Overriding the original oxygen system for the customized one.

getplayer[THISACTOR].got_access ACCESSCARDS?

	ifvarvarg PLAYERATTACK STATLIMIT setvarvar PLAYERATTACK STATLIMIT
	ifvarvarg PLAYERDEFENSE STATLIMIT setvarvar PLAYERDEFENSE STATLIMIT
	
	// Knuckle Cracking Stuff
	ifvare CHARACTERSELECTED? 1 nullop
	else ifvare CHARACTERSELECTED? 8 nullop
	else ifvare CHARACTERSELECTED? 9 nullop
	else ifvare CHARACTERSELECTED? 15 nullop
	else setplayer[THISACTOR].knuckle_incs 0
	
	ifvare mainmenu 1 setplayer[THISACTOR].knuckle_incs 0
	ifvarn shop_id -1 setplayer[THISACTOR].knuckle_incs 0
	ifvarn atm_id -1 setplayer[THISACTOR].knuckle_incs 0
	
	ifvare FULLPOWER 1
	{ 
		state fullpower
		setvar FULLPOWER 0
	}
	state neardeath
	ifvare INSTANTDEATH 1 
	{ 
		state checkcontinues setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount
		ifvarn VEHICLEID -1 setactorvar[VEHICLEID].ACTORHP 0
		state killallcharacters
	}
	ifvarg CURRENTHITPOINTS 0 { setvar gameover? 0 ifvarand PLAYERSTATUS? 1 subvar PLAYERSTATUS? 1 }
	
	state getcharactergender

	setvar MISCARRAYID 28 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // THROWBACK-DELAY
	ifvarg MISCARRAYID_AMOUNTTEMP 0 
	{ 
		divvar posxv 2 
		setplayer[THISACTOR].posxv posxv
		divvar posyv 2 
		setplayer[THISACTOR].posyv posyv
		
		subvar MISCARRAYID_AMOUNTTEMP 1
		setvar MISCARRAYID 28 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // THROWBACK-DELAY
	}
	
	setvar MISCARRAYID 27 // ADD-DELAY
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	ifvarg MISCARRAYID_AMOUNTTEMP 0 subvar MISCARRAYID_AMOUNTTEMP 1
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP

	setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
	ifvarg MISCARRAYID_AMOUNTTEMP 0 // Prevents potentially-fatal knockback when a death-switch occurs
	{
		getplayer[THISACTOR].player_par TEMPVAR4
		modvar TEMPVAR4 6
		getactor[THISACTOR].cstat TEMPVAR3
		ifvarand TEMPVAR3 2 subvar TEMPVAR3 2
		ifvarand TEMPVAR3 512 subvar TEMPVAR3 512
		ifvarand TEMPVAR3 32768 subvar TEMPVAR3 32768
		ifvare TEMPVAR4 0 addvar TEMPVAR3 2
		ifvare TEMPVAR4 1 addvar TEMPVAR3 2
		ifvare TEMPVAR4 2 addvar TEMPVAR3 514
		ifvare TEMPVAR4 3 addvar TEMPVAR3 514
		ifvare TEMPVAR4 4 addvar TEMPVAR3 33282
		ifvare TEMPVAR4 5 addvar TEMPVAR3 33282
		setactor[THISACTOR].cstat TEMPVAR3
	
		setvar MISCARRAYID 26 // DEATHSWITCH-DELAY
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		subvar MISCARRAYID_AMOUNTTEMP 1
		//addlogvar MISCARRAYID_AMOUNTTEMP
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setplayer[THISACTOR].falling_counter 0
	}
	else
	{
		getactor[THISACTOR].cstat TEMPVAR3
		ifvarand TEMPVAR3 2 subvar TEMPVAR3 2
		ifvarand TEMPVAR3 512 subvar TEMPVAR3 512
		ifvarand TEMPVAR3 32768 subvar TEMPVAR3 32768
		setactor[THISACTOR].cstat TEMPVAR3
	}

	setvar MISCARRAYID 25 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SWITCHOVER-DELAY
	ifvarg MISCARRAYID_AMOUNTTEMP 0 subvar MISCARRAYID_AMOUNTTEMP 1
	setvar MISCARRAYID 25 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SWITCHOVER-DELAY
	ifvare MISCARRAYID_AMOUNTTEMP 0 
	{
		// Prevents Player from Exceeding 200% HP
		ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
		// Prevents Player from Exceeding 200% AP
		ifvarvarg CURRENTARMORPOINTS MAXARMORPOINTSATOMIC setvarvar CURRENTARMORPOINTS MAXARMORPOINTSATOMIC 
		// Prevents Player from Exceeding 200% EP
		ifvarvarg CURRENTENERGYPOINTS MAXENERGYPOINTSATOMIC setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTSATOMIC 
		// Prevents Player from Exceeding 200% FA
		ifvarvarg FIRSTAIDCURRENT MAXHITPOINTSATOMIC setvarvar FIRSTAIDCURRENT MAXHITPOINTSATOMIC 
		
		ifvare mainmenu 0
		{
			ifvare player[THISACTOR].steroids_amount 400 setvar STEROIDSTICS 7
			else
			{
				ifvarg STEROIDSTIME 0
				{
					subvar STEROIDSTIME 1
					subvar STEROIDSTICS 1
					ifvarl STEROIDSTICS 1
					{
					sound DUKE_HARTBEAT
					addvar STEROIDSTICS 7
					}
					setplayer[THISACTOR].steroids_amount 399
				}
				else
				{
					setvar STEROIDSTICS 7
					setplayer[THISACTOR].steroids_amount 0
				}
			}
		}
		else
		{ 
			stopsound DUKE_HARTBEAT 
			stopsound DUKE_HARTBEAT 
			stopsound DUKE_HARTBEAT 
			state stoppainsounds
			setplayer[THISACTOR].boot_amount BOOTSTIME 
			setplayer[THISACTOR].holoduke_amount HOLOFORMTIME 
			setplayer[THISACTOR].heat_amount NIGHTVISIONTIME 
			setplayer[THISACTOR].jetpack_amount JETPACKTIME 
		}
	}

	setplayer[THISACTOR].hard_landing 0

	ifvare oldskoolmode 0 
	{ 
		setplayer[THISACTOR].inven_icon 0 
		setplayer[THISACTOR].invdisptime 0 
	}
	
	setplayer[THISACTOR].last_pissed_time 600
	
	setvarvar TEMPVAR3 FIRSTAIDCURRENT
	mulvar TEMPVAR3 100
	ifvarn MAXHITPOINTS 0 divvarvar TEMPVAR3 MAXHITPOINTS
	setplayer[THISACTOR].firstaid_amount TEMPVAR3


	//*******************************************************************
	state iscurrentcharalive
	state checkcharacters // EXTREMELY IMPORTANT: DO NOT DELETE THIS!!!!
	state checkpartysize
	ifvare CURRENTHITPOINTS 0 // ifp pdead 
	{ 
		ifwasweapon FREEZEBLAST
		{
			ifvarn FROZEN? 1
			{
				state freezeup
				state frosty 
				spritepal 1
				move 0
				action PFROZEN
				break
			}
		}
		
		ifvare FROZEN? 1 nullop // If the character is frozen by the freeze-thrower, they are not fully 'dead' and can still thaw back to life
		else // All other attacks will kill/try-to-kill the character
		{ 
			ifvarn PLAYERSTATUS? 1
			ifvarg PARTYALIVE 0 // More than one character alive on character death
			{ 
				ifvare CURRENTHITPOINTS 0 setvarvar DEATHCHARACTERVAR CHARACTERSELECTED? else setvar DEATHCHARACTERVAR 0
			
				ifvare CHARACTERSELECTED? 3 // Character is Bubsy
				{
					getactor[PLAYERID].htpicnum TEMPVAR
					ifvare gameover? 0 { ifvare TEMPVAR -1 setvar SURVIVALCHECK 10001 else randvar SURVIVALCHECK 10000 } else { setvar SURVIVALCHECK 10001 break }   
					ifvarvarl SURVIVALCHECK SURVIVALVALUE
					{
						ifvare CURRENTHITPOINTS 0
						{
							setactor[PLAYERID].extra 16384
							setvar CURRENTHITPOINTS 1
							state canceldeadactions
							stopsound DUKE_GRUNT
							redefinequote 321 ^23SURVIVED A MORTAL BLOW!!   
							setvar DEATHCHARACTERVAR 0
							setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
							setvarvar fta fta_normal setvar ftq 321
							break 
						}
					}
					else
					{
						setactor[PLAYERID].htpicnum -1
						setvar TEMPVAR -1
					}
			
					state checkbubsylives
					ifvarg ITEMARRAYID_AMOUNTTEMP 0 // If Bubsy has 'extra lives' left, revive him automatically to 100% HP and Airtime and don't switch him over, but decrement his 'lives' counter by 1
					{ 
						state death-checkbubsylives2
						state canceldeadactions
					}
					else
					{
						setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
						ifvarl MISCARRAYID_AMOUNTTEMP 26 
						{ 
							ifmove PSHRINKING
							{
								sizeat 42 36
								setvar SHRUNK? 0
							}
							state switchtolivingcharacter 
							state canceldeadactions
						} 
					}
				}
				else
				{
					setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
					ifvarl MISCARRAYID_AMOUNTTEMP 26 
					{ 
						ifmove PSHRINKING
						{
							sizeat 42 36
							setvar SHRUNK? 0
						}
						state switchtolivingcharacter 
						state canceldeadactions
					} 
				}
			} 
			else // Last character dies X_x;
			{
				ifvare CURRENTHITPOINTS 0 setvarvar DEATHCHARACTERVAR CHARACTERSELECTED? else setvar DEATHCHARACTERVAR 0
				
				ifvare CHARACTERSELECTED? 3 // Last Character is Bubsy
				{
					getactor[PLAYERID].htpicnum TEMPVAR     
					ifvare gameover? 0 { ifvare TEMPVAR -1 setvar SURVIVALCHECK 10001 else randvar SURVIVALCHECK 10000 } else { setvar SURVIVALCHECK 10001 }
					ifvarvarl SURVIVALCHECK SURVIVALVALUE
					{
						ifvare CURRENTHITPOINTS 0
						{
							setactor[PLAYERID].extra 16384
							setvar CURRENTHITPOINTS 1
							state canceldeadactions
							stopsound DUKE_GRUNT
							redefinequote 321 ^23SURVIVED A MORTAL BLOW!!   
							setvar DEATHCHARACTERVAR 0
							setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
							setvarvar fta fta_normal setvar ftq 321
							break 
						}
					}
					else
					{
						setactor[PLAYERID].htpicnum -1
						setvar TEMPVAR -1
					}
				
					state checkbubsylives
					ifvarg ITEMARRAYID_AMOUNTTEMP 0 // If Bubsy has 'extra lives' left, revive him automatically to 100% HP and Airtime and don't switch him over, but decrement his 'lives' counter by 1
					{ 
						state death-checkbubsylives2
						state canceldeadactions
					} 
					else
					{
						ifmove PSHRINKING
						{
							sizeat 42 36
							setvar SHRUNK? 0
						}
						state checkforcontinues
						state canceldeadactions
					}
				}
				else // Character is not Bubsy
				{
					ifmove PSHRINKING
					{
						sizeat 42 36
						setvar SHRUNK? 0
					}
					state checkforcontinues 
					state canceldeadactions
				}
			}
		} 
	}
	
	ifaction PFROZEN move 0
	ifvarg CURRENTHITPOINTS 0 
	{
		setvar MISCARRAYID 79 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // AUTO-SWITCH-ATTEMPTS
		setactor[THISACTOR].cstat 257 
	}
	ifvarn CHARACTERSELECTED? 3
	{
		state checkbubsylives
		ifvarg ITEMARRAYID_AMOUNTTEMP 0 state death-checkbubsylives
	}

	/*
	// For the future when there's actual graphics of the characters :P
	ifaction PFROZEN spritepal 1
	else
	{
		ifvare CHARACTERSELECTED? 6 spritepal 24
		else ifvare CHARACTERSELECTED? 9 spritepal 24
		else ifvare CHARACTERSELECTED? 10 
		{
			setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 0 spritepal 20 else spritepal 0 
		}
		else spritepal 0
	}
	*/

	setvar CHARACTERARRAY 14
	ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { setvar MISCARRAYID 30 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 } else { ifvare mainmenu 0 { setvar MISCARRAYID 30 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP addvar MISCARRAYID_AMOUNTTEMP 1 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP } } // MYSTERY1-DEADTIMER
	
	setvar MISCARRAYID 30 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MYSTERY1-DEADTIMER
	ifvarg MISCARRAYID_AMOUNTTEMP 7799 // 15599
	{
		palfrom 32 64 64 64
		setvar CHARACTERARRAY 14
		getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMPVAR
		setactorvar[CHARACTERARRAY].CHARACTERHP TEMPVAR
		globalsound RESURRECTED_ALLY 
		redefinequote 335 ^20??????? CAME BACK TO LIFE ON HER OWN!
		setvarvar fta fta_normal setvar ftq 335
		setvar MISCARRAYID 30 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MYSTERY1-DEADTIMER
	}
	//*******************************************************************

	ifvare SKILLSET? 1
	{
		ifvarg PARTYSIZE 0 state calculateaveragelevel else state killallcharacters
	}
	
	ifvarg CURRENTARMORPOINTS 0
	{
		ifvarl ARMORPERCENT 100 setvar ARMORPERCENT 100
	}
	else
	{
		ifvarg ARMORPERCENT 0 setvar ARMORPERCENT 0
	}
	
	ifvarl CHARACTERSPEEDTRUE 46500 setvarvar CHARACTERSPEEDTRUE 46500 // Prevents people from having 'Negative' speed


	ifinwater
	{
		setvar WATER? 2
	}
	else 
	setvar WATER? 0
	
	getplayer[THISACTOR].posz TEMPVAR2
	getsector[THISACTOR].floorz TEMPVAR3
	getsector[THISACTOR].floorz TEMPVAR4
	addvar TEMPVAR4 -8960 //-17920
	ifvarvarg TEMPVAR2 TEMPVAR4 ifvarvarl TEMPVAR2 TEMPVAR3 ifvare sector[PLAYERSECTOR].lotag 1
	{
		setvar WATER? 1
	}

	getplayer[THISACTOR].boot_amount BOOTSTIME
	ifvarg SCUBATIME 0 setplayer[THISACTOR].scuba_amount 96 else setplayer[THISACTOR].scuba_amount 0
	getplayer[THISACTOR].holoduke_amount HOLOFORMTIME
	getplayer[THISACTOR].heat_amount NIGHTVISIONTIME
	getplayer[THISACTOR].jetpack_amount JETPACKTIME
	
	ifvare mainmenu 1
	{
		setplayer[THISACTOR].movement_lock 127 // 31
		setplayer[THISACTOR].ang PLAYERANGLE
		setplayer[THISACTOR].horiz PLAYERHORIZ
	}
	else
	{
		ifvarn shop_id -1
		{
			setplayer[THISACTOR].movement_lock 127 // 31
			setplayer[THISACTOR].ang PLAYERANGLE
			setplayer[THISACTOR].horiz PLAYERHORIZ
		}
		else
		ifvarn atm_id -1
		{
			setplayer[THISACTOR].movement_lock 127 // 31
			setplayer[THISACTOR].ang PLAYERANGLE
			setplayer[THISACTOR].horiz PLAYERHORIZ
		}
		else
		{
			ifvarn VEHICLEID -1
			{
				setuserdef[THISACTOR].auto_run 0
		
				ifvare PUBLICBETA? 0
				{
					ifvarand bits 4 setplayer[THISACTOR].movement_lock 127 // No Strafing w/ Vehicles
					else ifvarand bits 4194304 setplayer[THISACTOR].movement_lock 127 // No Strafing w/ Vehicles
					else setplayer[THISACTOR].movement_lock 60 // No Strafing w/ Vehicles
				}
				else setplayer[THISACTOR].movement_lock 60
				
				setplayer[THISACTOR].horiz 100 // PLAYERHORIZ
				getplayer[THISACTOR].ang PLAYERANGLE
				ifvarand extbits 16 subvar PLAYERANGLE -14
				ifvarand extbits 32 addvar PLAYERANGLE -14
				setplayer[THISACTOR].ang PLAYERANGLE
		
				ifvarand bits 4 // trying to attack
				{
					ifvarand PLAYERSTATUS? 2 { setvar TEMPVAR 1 setvar TEMPVAR2 1 }
					else ifvarand PLAYERSTATUS? 4 { setvar TEMPVAR 2 setvar TEMPVAR2 4 }
					else { setvar TEMPVAR 1 setvar TEMPVAR2 2 }
					addvar VEHICLEATTACKTIMER 1
					ifvarvare VEHICLEATTACKTIMER TEMPVAR
					{
						ifvare VEHICLEHUDFRAME 0 setvar VEHICLEHUDFRAME 1
						else ifvare VEHICLEHUDFRAME 1 setvar VEHICLEHUDFRAME 2
						else ifvare VEHICLEHUDFRAME 2 setvar VEHICLEHUDFRAME 1
			
						ifvare VEHICLETYPE 0 
						{
							shoot NEWSHOTSPARK1
							shoot NEWSHOTSPARK1
							sound PISTOL_FIRE
						}
						ifvare VEHICLETYPE 1 
						{
							shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN
							shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN shoot NEWSHOTGUN
							sound SHOTGUN_FIRE 
						}
						ifvare VEHICLETYPE 2
						{
							eshoot RPG
							ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
							ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
							ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
							setactor[RETURN].extra 140
							getplayer[THISACTOR].posz TEMPVAR5
							subvar TEMPVAR5 2048
							setactor[RETURN].z TEMPVAR5
				
							sound RPG_SHOOT
						}
						ifvarg actorvar[VEHICLEID].ACTORQUADTIME 0 sound QUADDAMAGE3
						ifvarg actorvar[VEHICLEID].ACTORVAMPIRETIME 0 sound SHOOT_VAMPIREITEM
					}
					ifvarvarg VEHICLEATTACKTIMER TEMPVAR2 setvar VEHICLEATTACKTIMER 0
				}
				else
				{
					ifvarand bits 4194304 // Alt-Fire
					{
						ifvarand PLAYERSTATUS? 2 { setvar TEMPVAR 1 setvar TEMPVAR2 1 }
						else ifvarand PLAYERSTATUS? 4 { setvar TEMPVAR 2 setvar TEMPVAR2 4 }
						else { setvar TEMPVAR 1 setvar TEMPVAR2 2 }
						addvar VEHICLEATTACKTIMER 1
						ifvarvare VEHICLEATTACKTIMER TEMPVAR
						{
							ifvare VEHICLEHUDFRAME 0 setvar VEHICLEHUDFRAME 1
							else ifvare VEHICLEHUDFRAME 1 setvar VEHICLEHUDFRAME 2
							else ifvare VEHICLEHUDFRAME 2 setvar VEHICLEHUDFRAME 1
					
							ifvare VEHICLETYPE 0 
							{
								eshoot FIRELASER
								ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
								ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
								ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
								setactor[RETURN].extra 30
								getplayer[THISACTOR].posz TEMPVAR5
								subvar TEMPVAR5 4096
								setactor[RETURN].z TEMPVAR5
				
								eshoot FIRELASER
								ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
								ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
								ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
								setactor[RETURN].extra 30
				
								sound PRED_ATTACK
							}
							ifvare VEHICLETYPE 1 
							{
								shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK
								shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK shoot GROWSPARK
								sound EXPANDERSHOOT
							}
							ifvare VEHICLETYPE 2
							{
								eshoot RPG
								ifvare VEHICLEHUDFRAME 0 state rotateprojectilestraight
								ifvare VEHICLEHUDFRAME 1 state rotateprojectileleft
								ifvare VEHICLEHUDFRAME 2 state rotateprojectileright
								setactor[RETURN].extra 140
								getplayer[THISACTOR].posz TEMPVAR5
								subvar TEMPVAR5 2048
								setactor[RETURN].z TEMPVAR5
				
								sound RPG_SHOOT
							}
							ifvarg actorvar[VEHICLEID].ACTORQUADTIME 0 sound QUADDAMAGE3
							ifvarg actorvar[VEHICLEID].ACTORVAMPIRETIME 0 sound SHOOT_VAMPIREITEM
						}
						ifvarvarg VEHICLEATTACKTIMER TEMPVAR2 setvar VEHICLEATTACKTIMER 0
					}
					else
					{
						setvar VEHICLEATTACKTIMER 0
						setvar VEHICLEHUDFRAME 0
					}
				}
			}
			else
			{
				setplayer[THISACTOR].movement_lock 0
				getplayer[THISACTOR].ang PLAYERANGLE
				getplayer[THISACTOR].horiz PLAYERHORIZ
			}
		}
	}

	ifvare player[THISACTOR].heat_on 1 // if the goggles are on, visibility is set to 0 (full) 
	{
		ifvare mainmenu 0
		{
			ifvare CHARACTERSELECTED? 4 
			{ 
				setvar MISCARRAYID 99 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // VISOR-ON-SOUND
				ifvare MISCARRAYID_AMOUNTTEMP 0 
				{ 
				stopsound NITEVISION_ONOFF
				sound VRVISOR_ON
				setvar MISCARRAYID 99 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // VISOR-ON-SOUND
				setvar MISCARRAYID 100 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // VISOR-OFF-SOUND
				} 
			}
			ifvare CHARACTERSELECTED? 1 setvar TEMPVAR4 256
			ifvare CHARACTERSELECTED? 2 setvar TEMPVAR4 256 
			ifvare CHARACTERSELECTED? 3 setvar TEMPVAR4 160  
			ifvare CHARACTERSELECTED? 4 setvar TEMPVAR4 120   // VR Goggles increase visibility by 4 times instead of NV Goggles' 2
			ifvare CHARACTERSELECTED? 5 setvar TEMPVAR4 272
			ifvare CHARACTERSELECTED? 6 setvar TEMPVAR4 192 
			ifvare CHARACTERSELECTED? 7 setvar TEMPVAR4 240  
			ifvare CHARACTERSELECTED? 8
			{
				setvar MISCARRAYID 77 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-HACKERVISION?
				ifvare MISCARRAYID_AMOUNTTEMP 1 setvar TEMPVAR4 132 else setvar TEMPVAR4 264 
			}
			ifvare CHARACTERSELECTED? 9 setvar TEMPVAR4 320
			ifvare CHARACTERSELECTED? 10 setvar TEMPVAR4 128 
			ifvare CHARACTERSELECTED? 11 setvar TEMPVAR4 240  
			ifvare CHARACTERSELECTED? 12 setvar TEMPVAR4 224
			ifvare CHARACTERSELECTED? 13 setvar TEMPVAR4 240  
			ifvare CHARACTERSELECTED? 14 setvar TEMPVAR4 80
			ifvare CHARACTERSELECTED? 15 setvar TEMPVAR4 248
		}
		else
		{
			ifvare DEBUG_NOMENUOVERLAY 0 { ifvarg mainmenutransitiontimer 6 setvar TEMPVAR4 16384 } else setvar TEMPVAR4 0
		}
	} 
	else
	{
		ifvare mainmenu 0
		{
			ifvare CHARACTERSELECTED? 4 
			{ 
				setvar MISCARRAYID 100 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // VISOR-OFF-SOUND
				ifvare MISCARRAYID_AMOUNTTEMP 0 
				{ 
				stopsound NITEVISION_ONOFF 
				sound VRVISOR_OFF 
				setvar MISCARRAYID 100 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // VISOR-OFF-SOUND
				setvar MISCARRAYID 99 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // VISOR-ON-SOUND
				} 
			}
			ifvare CHARACTERSELECTED? 1 setvar TEMPVAR4 512
			ifvare CHARACTERSELECTED? 2 setvar TEMPVAR4 512
			ifvare CHARACTERSELECTED? 3 setvar TEMPVAR4 320
			ifvare CHARACTERSELECTED? 4 setvar TEMPVAR4 480
			ifvare CHARACTERSELECTED? 5 setvar TEMPVAR4 544
			ifvare CHARACTERSELECTED? 6 setvar TEMPVAR4 384
			ifvare CHARACTERSELECTED? 7 setvar TEMPVAR4 480
			ifvare CHARACTERSELECTED? 8 setvar TEMPVAR4 528
			ifvare CHARACTERSELECTED? 9 setvar TEMPVAR4 640
			ifvare CHARACTERSELECTED? 10 setvar TEMPVAR4 256
			ifvare CHARACTERSELECTED? 11 setvar TEMPVAR4 480
			ifvare CHARACTERSELECTED? 12 setvar TEMPVAR4 448
			ifvare CHARACTERSELECTED? 13 setvar TEMPVAR4 480
			ifvare CHARACTERSELECTED? 14 setvar TEMPVAR4 160
			ifvare CHARACTERSELECTED? 15 setvar TEMPVAR4 496
		}
		else
		{
			ifvare DEBUG_NOMENUOVERLAY 0 { ifvarg mainmenutransitiontimer 6 setvar TEMPVAR4 16384 } else setvar TEMPVAR4 0
		}
	}
	setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
	ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar TEMPVAR4 140 divvar TEMPVAR4 100 }
	else ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar TEMPVAR4 120 divvar TEMPVAR4 100 }

	ifp ponsteroids
	{
		ifvare SKILLLEVEL 0 mulvar TEMPVAR4 50
		ifvare SKILLLEVEL 1 mulvar TEMPVAR4 55
		ifvare SKILLLEVEL 2 mulvar TEMPVAR4 60
		ifvare SKILLLEVEL 3 mulvar TEMPVAR4 65
		ifvare SKILLLEVEL 4 mulvar TEMPVAR4 70
		ifvare SKILLLEVEL 5 mulvar TEMPVAR4 75
		ifvare SKILLLEVEL 6 mulvar TEMPVAR4 80
		ifvare SKILLLEVEL 7 mulvar TEMPVAR4 85
		ifvare SKILLLEVEL 8 mulvar TEMPVAR4 90
		ifvare SKILLLEVEL 9 mulvar TEMPVAR4 95
		divvar TEMPVAR4 100
	}
	/*
	ifvare gameover? 1
	{
		ifvarg gameovertransitiontimer 13
		{
			addvar gameoverblacknessfade 1
		
			setvar TEMPVAR6 -26
			ifvarg gameoverblacknessfade 26
			{
				addvarvar TEMPVAR6 gameoverblacknessfade 
				mulvar TEMPVAR6 4
				divvar TEMPVAR6 5
			}
			ifvarl TEMPVAR6 0 setvar TEMPVAR6 0
			ifvarg TEMPVAR6 64 setvar TEMPVAR6 64
			setplayer[THISACTOR].pals_time TEMPVAR6
			setplayer[THISACTOR].pals 0 0
			setplayer[THISACTOR].pals 1 0
			setplayer[THISACTOR].pals 2 0
		}
	}
	else
	{
		setvar gameoverblacknessfade 0
	}
	*/
	setuserdef[THISACTOR].const_visibility TEMPVAR4
	
	// Critical Hit Settings
	setvarvar CRITICALHITCHANCE2 CRITICALHITCHANCE
	//********************************
	//*Hockey Masks [Equippable Item]*
	//********************************
	ifvare PLAYEREQUIPSLOTITEM1 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM2 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM3 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM4 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM5 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM6 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM7 19 state player-hockeymask
	ifvare PLAYEREQUIPSLOTITEM8 19 state player-hockeymask

	//*****************************
	//*Critical-Hit Support [Lisa]*
	//*****************************
	setvar DAMAGEMODIFIER 1000
	state support-criticalhit  
	state damagemod-enemy-critical

	//*************************************
	//*Bloodlusting "Buff" - Cybanis Skill*
	//*************************************
	ifvarand PLAYERSTATUS? 8192
	{
		// Step1: +1/4 Rate
		setvarvar TEMPVAR4 CRITICALHITCHANCE2
		divvar TEMPVAR4 4
		addvarvar CRITICALHITCHANCE2 TEMPVAR4
	
		// Step2: Add the level-specfic extra bonus
		setvar TEMPVAR2 2000 // 20.00% [base amount]
		setvar TEMPVAR3 25 // 0.25% [base increase]
	
		// Character's Level / 2 = Addition to Base increase
		setvarvar TEMPVAR4 PLAYERLEVEL
		divvar TEMPVAR4 2 
	
		addvarvar TEMPVAR3 TEMPVAR4
	
		// Cybanis's Level * Base Increase = Extra Increase
		setvar CHARACTERARRAY 9
		getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR4
		mulvarvar TEMPVAR4 TEMPVAR3
	
		// 20% + Extra Increase = Full Increase Bonus
		addvarvar TEMPVAR2 TEMPVAR4
	
		// Step3: Final Calculations
		addvarvar CRITICALHITCHANCE2 TEMPVAR2
	}

	//*****************************
	//*****************************
	//*****************************
	ifp ponsteroids mulvar CRITICALHITCHANCE2 2
	setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
	ifvarl MISCARRAYID_AMOUNTTEMP 251 mulvar CRITICALHITCHANCE2 2
	
	ifvare PLAYEREQUIPSLOTITEM1 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM2 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM3 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM4 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM5 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM6 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM7 28 mulvar CRITICALHITCHANCE2 10
	ifvare PLAYEREQUIPSLOTITEM8 28 mulvar CRITICALHITCHANCE2 10
	
	// Iron Rune [Equippable Item] (Lowers Final Critical % in trade for resistance to damage)
	setvar DAMAGEMODIFIER 1000
	ifvare PLAYEREQUIPSLOTITEM1 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM2 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM3 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM4 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM5 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM6 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM7 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM8 21 subvar DAMAGEMODIFIER 250
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	mulvarvar CRITICALHITCHANCE2 DAMAGEMODIFIER
	divvar CRITICALHITCHANCE2 1000
	addvar CRITICALHITCHANCE2 1
	
	
	smaxammo 1 MAXPISTOL
	smaxammo 2 MAXSHOTGUN
	smaxammo 3 MAXCHAINGUN
	smaxammo 4 MAXRPG
	smaxammo 5 MAXPIPEBOMB
	smaxammo 6 MAXSHRINKER
	smaxammo 11 MAXEXPANDER
	smaxammo 7 MAXDEVASTATOR
	smaxammo 8 MAXTRIPBOMB
	smaxammo 9 MAXFREEZER

	ifvare player[THISACTOR].curr_weapon 0
	{
		setvar CURRENTAMMOA 0
		setvar MAXIMUMAMMO 0
		redefinequote 214 AMMO1
	}
	ifvare player[THISACTOR].curr_weapon 1
	{
		getplayer[THISACTOR].ammo_amount 1 CURRENTAMMOA
		gmaxammo 1 MAXIMUMAMMO
		redefinequote 214 AMMO2
	}
	ifvare player[THISACTOR].curr_weapon 2
	{
		getplayer[THISACTOR].ammo_amount 2 CURRENTAMMOA
		gmaxammo 2 MAXIMUMAMMO
		redefinequote 214 AMMO3
	}
	ifvare player[THISACTOR].curr_weapon 3
	{
		getplayer[THISACTOR].ammo_amount 3 CURRENTAMMOA
		gmaxammo 3 MAXIMUMAMMO
		redefinequote 214 AMMO4
	}
	ifvare player[THISACTOR].curr_weapon 4 
	{
		getplayer[THISACTOR].ammo_amount 4 CURRENTAMMOA
		gmaxammo 4 MAXIMUMAMMO
		redefinequote 214 AMMO5
	}
	ifvare player[THISACTOR].curr_weapon 5
	{
		getplayer[THISACTOR].ammo_amount 5 CURRENTAMMOA
		gmaxammo 5 MAXIMUMAMMO
		redefinequote 214 AMMO6
	}
	ifvare player[THISACTOR].curr_weapon 6
	{
		getplayer[THISACTOR].ammo_amount 6 CURRENTAMMOA
		gmaxammo 6 MAXIMUMAMMO
		redefinequote 214 AMMO7
	}
	ifvare player[THISACTOR].curr_weapon 7
	{
		getplayer[THISACTOR].ammo_amount 7 CURRENTAMMOA
		gmaxammo 7 MAXIMUMAMMO
		redefinequote 214 AMMO8
	}
	ifvare player[THISACTOR].curr_weapon 8
	{
		getplayer[THISACTOR].ammo_amount 8 CURRENTAMMOA
		gmaxammo 8 MAXIMUMAMMO
		redefinequote 214 AMMO9
	}
	ifvare player[THISACTOR].curr_weapon 9
	{
		getplayer[THISACTOR].ammo_amount 9 CURRENTAMMOA
		gmaxammo 9 MAXIMUMAMMO
		redefinequote 214 AMMO10
	}
	ifvare player[THISACTOR].curr_weapon 11
	{
		getplayer[THISACTOR].ammo_amount 11 CURRENTAMMOA 
		gmaxammo 11 MAXIMUMAMMO 
		redefinequote 214 AMMO11
	}
	
	setvarvar DAMAGEPERCENT 1000
	subvarvar DAMAGEPERCENT ARMORPERCENT

	ifvare mainmenu 0
	{
		ifvarg PLAYERDISPLAYTOTALDAMAGE 0
		{
			ifvarg PLAYERDISPLAYDAMAGE 0 ifvare NULLDAMAGE 0 addvar HEALTHDAMAGETIMER 1
			ifvare PLAYERDISPLAYDAMAGE 0 ifvarg NULLDAMAGE 0 addvar HEALTHDAMAGETIMER 1
			ifvarg PLAYERDISPLAYARMORDAMAGE 0 ifvare ARMORNULLDAMAGE 0 addvar ARMORDAMAGETIMER 1
			ifvare PLAYERDISPLAYARMORDAMAGE 0 ifvarg ARMORNULLDAMAGE 0 addvar ARMORDAMAGETIMER 1
			ifvarg PLAYERDISPLAYCELLDAMAGE 0 ifvare BIOSHIELDNULLDAMAGE 0 addvar CELLDAMAGETIMER 1
			ifvare PLAYERDISPLAYCELLDAMAGE 0 ifvarg BIOSHIELDNULLDAMAGE 0 addvar CELLDAMAGETIMER 1
		}
		
		addvar ATTACKERDISPLAYTIMER 1
		ifvarg TARGETDISPLAYDAMAGE 0 addvar DEFENDERDISPLAYTIMER 1
		ifvarg ACTORNULLDAMAGE 0 addvar DEFENDERDISPLAYTIMER 1
		ifvarg ACTORDISPLAYARMORDAMAGE 0 addvar ACTORARMORDISPLAYTIMER 1
		ifvarg ACTORARMORNULLDAMAGE 0 addvar ACTORARMORDISPLAYTIMER 1
		ifvarn DISPLAYRANKPOINTS 0 addvar RANKDISPLAYTIMER 1
		ifvarg DISPLAYEXPPOINTS 0 addvar EXPDISPLAYTIMER 1
		
		setvar MISCARRAYID 70 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FORTUNE-COOKIE-TIMER
		ifvarg MISCARRAYID_AMOUNTTEMP 0 
		{
			subvar MISCARRAYID_AMOUNTTEMP 1 
			setvar MISCARRAYID 70 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		}
		
		ifvarg DAMAGEHUETIMER 0 subvar DAMAGEHUETIMER 1
		ifvarg PKSHIELDHIT_TIMER 0 subvar PKSHIELDHIT_TIMER 1
		ifvare shop_id -1 ifvare atm_id -1
		{
			ifvarn DISPLAYDOLLARS 0 addvar DISPLAYMONEYTIMER 1
			ifvarn DISPLAYCENTS 0 ifvare DISPLAYDOLLARS 0 addvar DISPLAYMONEYTIMER 1
			ifvarg HPINCREASED 0 addvar HPLUPDISPLAY 1
			ifvarg APINCREASED 0 addvar APLUPDISPLAY 1
			ifvarg EPINCREASED 0 addvar EPLUPDISPLAY 1
			ifvarg ATKINCREASED 0 addvar ATKLUPDISPLAY 1
			ifvarg DEFINCREASED 0 addvar DEFLUPDISPLAY 1
			ifvarg SPDINCREASED 0 addvar SPDLUPDISPLAY 1
			ifvarg AIRINCREASED 0 addvar AIRLUPDISPLAY 1
			ifvarg MNTINCREASED 0 addvar MNTLUPDISPLAY 1
			ifvarg JUMINCREASED 0 addvar JUMLUPDISPLAY 1
		}
		
		
		setvar MISCARRAYID 31 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button1timer
		setvar MISCARRAYID 32 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button2timer
		setvar MISCARRAYID 33 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button3timer
		setvar MISCARRAYID 34 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button4timer
		setvar MISCARRAYID 35 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button5timer
		setvar MISCARRAYID 36 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button6timer
		setvar MISCARRAYID 37 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button7timer
		setvar MISCARRAYID 38 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // atm-button8timer
		setvar MISCARRAYID 41 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button1timer
		setvar MISCARRAYID 42 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button2timer
		setvar MISCARRAYID 43 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button3timer
		setvar MISCARRAYID 44 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button4timer
		setvar MISCARRAYID 45 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button5timer
		setvar MISCARRAYID 46 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button6timer
		setvar MISCARRAYID 47 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button7timer
		setvar MISCARRAYID 48 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button8timer
		setvar MISCARRAYID 49 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button9timer
		setvar MISCARRAYID 50 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button10timer
		setvar MISCARRAYID 51 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button11timer
		setvar MISCARRAYID 52 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP ifvarg MISCARRAYID_AMOUNTTEMP 0 { subvar MISCARRAYID_AMOUNTTEMP 1 } setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // pad-button12timer
	}
	ifvarg fta 0 { getuserdef[THISACTOR].pause_on temp ifvare temp 0 subvar fta 1 }
	
	getplayer[THISACTOR].posz posz
	getplayer[THISACTOR].poszv poszv

	// Sets up Lisa's "Lady Luck" ability [to make money drop more often]
	setvar CHARACTERARRAY 8
	getactorvar[CHARACTERARRAY].CHARACTERLEVEL templevel1
	ifvarg templevel1 0 ifvarl templevel1 11 setvar LISAMONEYTURNS2 0
	else ifvarg templevel1 10 ifvarl templevel1 31 setvar LISAMONEYTURNS2 1
	else ifvarg templevel1 30 ifvarl templevel1 61 setvar LISAMONEYTURNS2 2
	else ifvarg templevel1 60 setvar LISAMONEYTURNS2 3
	ifvare templevel1 100 setvar LISAMONEYMAXLEVEL 1 else setvar LISAMONEYMAXLEVEL 0
	
	// Bio-Shield Stuff
	ifvarg ESHIELDDMGFACTOR 1024 setvar ESHIELDDMGFACTOR 1024
	ifvarg MAXCELLS 2050 setvar MAXCELLS 2050
	ifvarvarg CURRENTCELLS MAXCELLS setvarvar CURRENTCELLS MAXCELLS
	
	setvarvar CURRENTBIOSHIELDPOWER CURRENTCELLS
	mulvarvar CURRENTBIOSHIELDPOWER ESHIELDDMGFACTOR
	addvarvar CURRENTBIOSHIELDPOWER DAMAGEINCELL
	setvarvar MAXBIOSHIELDPOWER MAXCELLS
	mulvarvar MAXBIOSHIELDPOWER ESHIELDDMGFACTOR
	addvarvar MAXBIOSHIELDPOWER ESHIELDDMGFACTOR
	
	setvarvar ESHIELDCOMPARISON MAXBIOSHIELDPOWER
	ifvare CHARACTERSELECTED? 8 divvarvar ESHIELDCOMPARISON MAXHITPOINTS
	else
	{
		setvar CHARACTERARRAY 8
		divvarvar ESHIELDCOMPARISON actorvar[CHARACTERARRAY].CHARACTERMAXHP
	}
	
	ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1 ifvare ENERGYSHIELDMODE 1 ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
	{
		setvar BIOSHIELDFLASHPULSE? 1
		setplayer[THISACTOR].hurt_delay 12 // Constantly sets to 12 to prevent Forcefields and Cacti from damaging Lisa when she has the Bio-Shield turned on
		ifvare mainmenu 0
		{
			// old increments of 4
			addvar SHIELDPULSETIMER 1
			ifvare SHIELDPULSETIMER 1  palfrom  2 0 0 64
			ifvare SHIELDPULSETIMER 2  palfrom  4 0 0 64
			ifvare SHIELDPULSETIMER 3  palfrom  6 0 0 64
			ifvare SHIELDPULSETIMER 4  palfrom  8 0 0 64
			ifvare SHIELDPULSETIMER 5  palfrom 10 0 0 64
			ifvare SHIELDPULSETIMER 6  palfrom 12 0 0 64
			ifvare SHIELDPULSETIMER 7  palfrom 14 0 0 64
			ifvare SHIELDPULSETIMER 8  palfrom 16 0 0 64
			ifvare SHIELDPULSETIMER 9  palfrom 14 0 0 64
			ifvare SHIELDPULSETIMER 10 palfrom 12 0 0 64
			ifvare SHIELDPULSETIMER 11 palfrom 10 0 0 64
			ifvare SHIELDPULSETIMER 12 palfrom  8 0 0 64
			ifvare SHIELDPULSETIMER 13 palfrom  6 0 0 64
			ifvare SHIELDPULSETIMER 14 palfrom  4 0 0 64
			ifvare SHIELDPULSETIMER 15
			{
				palfrom 2 0 0 64 
				setvar SHIELDPULSETIMER 1
			
				ifvarl ESHIELDCOMPARISON 16 { stopsound BIOSHIELD_HUM_QUIETEST sound BIOSHIELD_HUM_QUIETEST }
				ifvarg ESHIELDCOMPARISON 15 ifvarl ESHIELDCOMPARISON 64 { stopsound BIOSHIELD_HUM_QUIET sound BIOSHIELD_HUM_QUIET }
				ifvarg ESHIELDCOMPARISON 63 ifvarl ESHIELDCOMPARISON 256 { stopsound BIOSHIELD_HUM_NORMAL  sound BIOSHIELD_HUM_NORMAL }
				ifvarg ESHIELDCOMPARISON 255 ifvarl ESHIELDCOMPARISON 1024 { stopsound BIOSHIELD_HUM_LOUD sound BIOSHIELD_HUM_LOUD }
				ifvarg ESHIELDCOMPARISON 1023 { stopsound BIOSHIELD_HUM_LOUDEST sound BIOSHIELD_HUM_LOUDEST }
			}
		}
	}
	else setvar BIOSHIELDFLASHPULSE? 0

	// Night Vision
	ifvare CHARACTERSELECTED? 4 
	{
		setplayer[THISACTOR].heat_amount HEAT_AMOUNT // Ami has infinite NV Goggles :P
		redefinequote 101 ^20MERCURY VR VISOR
		redefinequote 106 ^19MERCURY VR VISOR ON
		redefinequote 107 ^19MERCURY VR VISOR OFF
		ifvare player[THISACTOR].heat_on 1 
		{ 
			// old intensity 16
			setvar VRVISORHUE? 1 palfrom 12 0 0 64
		}
		else setvar VRVISORHUE? 0
	}
	else
	ifvare CHARACTERSELECTED? 8
	{
		setvar VRVISORHUE? 0
		setvar MISCARRAYID 77 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-HACKERVISION?
		ifvare MISCARRAYID_AMOUNTTEMP 1
		{
			setplayer[THISACTOR].heat_amount HEAT_AMOUNT  // Lisa will have infinite NV with the Hacker Vision Upgrade
			redefinequote 101 ^20HACKER NIGHT-VISION UPGRADE
			redefinequote 106 ^19HACKER NIGHT-VISION ON
			redefinequote 107 ^19HACKER NIGHT-VISION OFF
		}
		else
		{
			redefinequote 101 ^20NIGHT VISION GOGGLES
			redefinequote 106 ^19NIGHT VISION ON
			redefinequote 107 ^19NIGHT VISION OFF
		}
	}
	else
	{
		setvar VRVISORHUE? 0
		redefinequote 101 ^20NIGHT VISION GOGGLES
		redefinequote 106 ^19NIGHT VISION ON
		redefinequote 107 ^19NIGHT VISION OFF
	}

	// Damage Screen Pulses [low Health]
	ifvare gameover? 0 ifvarn oldskoolmode 1 ifvare DAMAGEVISION? 1
	{
		addvar DAMAGEVISIONTIMER 1
		
		setvarvar TEMPVAR5 CURRENTHITPOINTS
		mulvar TEMPVAR5 1000
		divvarvar TEMPVAR5 MAXHITPOINTS
		
		ifvarg TEMPVAR5 250 setvar DAMAGEVISIONTIMER 0
		else
		ifvarg TEMPVAR5 100 ifvarl TEMPVAR5 251
		{
			ifvare DAMAGEVISIONTIMER 0  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 1  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  2 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 10 16 0 48 else palfrom  1 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 2  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  4 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 12 16 0 48 else palfrom  2 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 3  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  3 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 4  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  8 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 16 16 0 48 else palfrom  4 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 5  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 10 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 18 16 0 48 else palfrom  5 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 6  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom  6 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 7  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 14 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 22 16 0 48 else palfrom  7 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 8  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 16 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 24 16 0 48 else palfrom  8 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 9  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom  9 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 10 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 20 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 28 16 0 48 else palfrom 10 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 11 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 22 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 30 16 0 48 else palfrom 11 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 12 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 12 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 13 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 26 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 34 16 0 48 else palfrom 13 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 14 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 28 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 36 16 0 48 else palfrom 14 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 15 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 15 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 16 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 32 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 40 16 0 48 else palfrom 16 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 17 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 15 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 18 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 28 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 36 16 0 48 else palfrom 14 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 19 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 26 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 34 16 0 48 else palfrom 13 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 20 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 12 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 21 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 22 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 30 16 0 48 else palfrom 11 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 22 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 20 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 28 16 0 48 else palfrom 10 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 23 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom  9 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 24 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 16 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 24 16 0 48 else palfrom  8 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 25 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 14 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 22 16 0 48 else palfrom  7 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 26 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom  6 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 27 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 10 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 18 16 0 48 else palfrom  5 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 28 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  8 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 16 16 0 48 else palfrom  4 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 29 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  3 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 30 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  4 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 12 16 0 48 else palfrom  2 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 31 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  2 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 10 16 0 48 else palfrom  1 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 32 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
		}
		else
		ifvarl TEMPVAR5 101
		{
			ifvare DAMAGEVISIONTIMER 0  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 1  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  3 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 11 16 0 48 else palfrom  3 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 2  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  6 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 3  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  9 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 17 16 0 48 else palfrom  9 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 4  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom 12 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 5  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 15 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 23 16 0 48 else palfrom 15 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 6  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom 18 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 7  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 21 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 29 16 0 48 else palfrom 21 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 8  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 24 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 9  { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 27 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 35 16 0 48 else palfrom 27 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 10 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 30 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 11 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 33 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 41 16 0 48 else palfrom 33 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 12 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 36 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 44 16 0 48 else palfrom 36 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 13 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 39 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 47 16 0 48 else palfrom 39 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 14 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 42 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 50 16 0 48 else palfrom 42 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 15 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 45 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 53 16 0 48 else palfrom 45 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 16 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 48 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 56 16 0 48 else palfrom 48 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 17 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 45 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 53 16 0 48 else palfrom 45 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 18 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 42 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 50 16 0 48 else palfrom 42 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 19 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 39 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 47 16 0 48 else palfrom 39 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 20 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 36 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 44 16 0 48 else palfrom 36 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 21 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 33 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 41 16 0 48 else palfrom 33 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 22 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 30 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 38 16 0 48 else palfrom 30 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 23 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 27 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 35 16 0 48 else palfrom 27 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 24 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 24 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 32 16 0 48 else palfrom 24 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 25 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 21 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 29 16 0 48 else palfrom 21 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 26 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 18 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 26 16 0 48 else palfrom 18 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 27 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 15 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 23 16 0 48 else palfrom 15 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 28 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom 12 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 20 16 0 48 else palfrom 12 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 29 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  9 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 17 16 0 48 else palfrom  9 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 30 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  6 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 14 16 0 48 else palfrom  6 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 31 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  3 16 0 48 else { ifvare VRVISORHUE? 1 palfrom 11 16 0 48 else palfrom  3 32 0 0 } }
			ifvare DAMAGEVISIONTIMER 32 { ifvare BIOSHIELDFLASHPULSE? 1 palfrom  0 16 0 48 else { ifvare VRVISORHUE? 1 palfrom  8 16 0 48 else palfrom  0 32 0 0 } }
		}
		ifvarg DAMAGEVISIONTIMER 31 setvar DAMAGEVISIONTIMER 0
	}

	// Quad Damage Powerup
	ifvarg QUADTIME 0
	{
		ifvarand POWERUPBITFIELD 1 nullop else addvar POWERUPBITFIELD 1
		ifvare QUADTIME 104 soundonce QUADDAMAGE2
	
		ifvarg QUADTIME 130 palfrom 16 0 0 64
		ifvarl QUADTIME 131 ifvarg QUADTIME 104 palfrom 6 0 0 64
		ifvarl QUADTIME 105 ifvarg QUADTIME 78 palfrom 5 0 0 64
		ifvarl QUADTIME 79 ifvarg QUADTIME 52 palfrom 3 0 0 64
		ifvarl QUADTIME 53 ifvarg QUADTIME 26 palfrom 2 0 0 64
		ifvarl QUADTIME 27 ifvarg QUADTIME 0 palfrom 1 0 0 64
		ifvare QUADTIME 1 { setvarvar fta fta_normal setvar ftq 163 }
	
		ifvare mainmenu 0
		{
			ifvarg CURRENTHITPOINTS 0
			{
				ifvarand POWERUPCHEATFLAGS? 1 nullop else subvar QUADTIME 1
				//state itemfullbright
			}
		}
	}
	else
	{
		ifvarand POWERUPBITFIELD 1 subvar POWERUPBITFIELD 1
	}

	// Health Regen Powerup
	ifvarg REGENTIME 0
	{
		ifvarand POWERUPBITFIELD 4 nullop else addvar POWERUPBITFIELD 4
		state removepoison
		ifvarg REGENTIME 130 palfrom 16 64
		ifvarl REGENTIME 131 ifvarg REGENTIME 104 palfrom 6 64
		ifvarl REGENTIME 105 ifvarg REGENTIME 78 palfrom 5 64
		ifvarl REGENTIME 79 ifvarg REGENTIME 52 palfrom 3 64
		ifvarl REGENTIME 53 ifvarg REGENTIME 26 palfrom 2 64
		ifvarl REGENTIME 27 ifvarg REGENTIME 0 palfrom 1 64
		ifvare REGENTIME 1 { setvarvar fta fta_normal setvar ftq 228 setvar PLAYERREGENCOUNTER 0 }
	
		ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvar PLAYERREGENCOUNTER 1 }
	
		ifvarg PLAYERREGENCOUNTER 25
		{
			setvarvar PLAYERREGENAMOUNT1 MAXHITPOINTS
			ifvare PUBLICBETA? 1 mulvar PLAYERREGENAMOUNT1 150 else mulvar PLAYERREGENAMOUNT1 50
			setvar TEMPMOD 0
			ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
			ifvarl TEMPMOD 2 setvar TEMPMOD 2
			mulvarvar PLAYERREGENAMOUNT1 TEMPMOD
			divvar PLAYERREGENAMOUNT1 2
			divvar PLAYERREGENAMOUNT1 1000
	
			setvarvar PLAYERREGENAMOUNT2 MAXHITPOINTS
			ifvare PUBLICBETA? 1 mulvar PLAYERREGENAMOUNT2 50 else mulvar PLAYERREGENAMOUNT2 16
			setvar TEMPMOD 0
			ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
			ifvarl TEMPMOD 2 setvar TEMPMOD 2
			mulvarvar PLAYERREGENAMOUNT2 TEMPMOD
			divvar PLAYERREGENAMOUNT2 2
			divvar PLAYERREGENAMOUNT2 1000
	
			ifvarvarl CURRENTHITPOINTS MAXHITPOINTSATOMIC ifvarvarg CURRENTHITPOINTS MAXHITPOINTS state playerregen5percenthp
			else ifvarvare CURRENTHITPOINTS MAXHITPOINTS state playerregen5percenthp
			else ifvarvarl CURRENTHITPOINTS MAXHITPOINTS ifvarg CURRENTHITPOINTS 0
			{
				addvarvar CURRENTHITPOINTS PLAYERREGENAMOUNT1
				ifvarn player[THISACTOR].over_shoulder_on 0
				{
					ifvarg PLAYERREGENAMOUNT1 0
					{
					setvarvar SHOWDAMAGE PLAYERREGENAMOUNT1
					setvar SHOWDAMAGETYPE 3
					setvarvar SHOWDAMAGEACTORID THISACTOR
					state showdamage
					}
				}
				ifvarvarg CURRENTHITPOINTS STATLIMITATOMIC setvarvar CURRENTHITPOINTS STATLIMITATOMIC
				ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
				ifvarvarl CURRENTHITPOINTS STATLIMITATOMIC sound REGEN_HEALTH15 setvar PLAYERHPDAMAGED? -1
			}
			setvar PLAYERREGENCOUNTER 0
		}
		ifvare mainmenu 0
		{
			ifvarg CURRENTHITPOINTS 0
			{
				ifvarand POWERUPCHEATFLAGS? 4 nullop else subvar REGENTIME 1
				//state itemfullbright
			}
		}
	}
	else
	{
		ifvarand POWERUPBITFIELD 4 subvar POWERUPBITFIELD 4
	}

	// Armor Regen Powerup
	ifvarg APREGENTIME 0
	{
		ifvarand POWERUPBITFIELD 8 nullop else addvar POWERUPBITFIELD 8
		state removecorrosion
		// Sets AB%
		// setvar ARMORPERCENT 1000 // nerf the old super Armor angle
		setvar TEMPMOD 125
		ifvare SKILLLEVEL 0 setvar TEMPMOD 666
		ifvare SKILLLEVEL 1 setvar TEMPMOD 633
		ifvare SKILLLEVEL 2 setvar TEMPMOD 600
		ifvare SKILLLEVEL 3 setvar TEMPMOD 555
		ifvare SKILLLEVEL 4 setvar TEMPMOD 527
		ifvare SKILLLEVEL 5 setvar TEMPMOD 500
		ifvare SKILLLEVEL 6 setvar TEMPMOD 444
		ifvare SKILLLEVEL 7 setvar TEMPMOD 422
		ifvare SKILLLEVEL 8 setvar TEMPMOD 400
		ifvare SKILLLEVEL 9 setvar TEMPMOD 333
		ifvarvarl ARMORPERCENT TEMPMOD setvarvar ARMORPERCENT TEMPMOD
	
		// Hue Fading Timer
		ifvarg APREGENTIME 130 palfrom 16 0 64
		ifvarl APREGENTIME 131 ifvarg APREGENTIME 104 palfrom 6 0 64
		ifvarl APREGENTIME 105 ifvarg APREGENTIME 78 palfrom 5 0 64
		ifvarl APREGENTIME 79 ifvarg APREGENTIME 52 palfrom 3 0 64
		ifvarl APREGENTIME 53 ifvarg APREGENTIME 26 palfrom 2 0 64
		ifvarl APREGENTIME 27 ifvarg APREGENTIME 0 palfrom 1 0 64
		ifvare APREGENTIME 1 { setvarvar fta fta_normal setvar ftq 232 setvar PLAYERAPREGENCOUNTER 0 }
	
		ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvar PLAYERAPREGENCOUNTER 1 }
	
		ifvarg PLAYERAPREGENCOUNTER 25
		{
			setvarvar PLAYERAPREGENAMOUNT CURRENTARMORPOINTS
			setvarvar PLAYERAPREGENAMOUNT1 MAXARMORPOINTS
			ifvare PUBLICBETA? 1 mulvar PLAYERAPREGENAMOUNT1 150 else mulvar PLAYERAPREGENAMOUNT1 50
			setvar TEMPMOD 0
			ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
			ifvarl TEMPMOD 2 setvar TEMPMOD 2
			mulvarvar PLAYERAPREGENAMOUNT1 TEMPMOD
			divvar PLAYERAPREGENAMOUNT1 2
			divvar PLAYERAPREGENAMOUNT1 1000
		
			setvarvar PLAYERAPREGENAMOUNT2 MAXARMORPOINTS
			ifvare PUBLICBETA? 1 mulvar PLAYERAPREGENAMOUNT2 50 else mulvar PLAYERAPREGENAMOUNT2 16
			setvar TEMPMOD 0
			ifvare PLAYEREQUIPSLOTITEM1 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM2 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM3 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM4 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM5 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM6 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM7 5 addvar TEMPMOD 3
			ifvare PLAYEREQUIPSLOTITEM8 5 addvar TEMPMOD 3
			ifvarl TEMPMOD 2 setvar TEMPMOD 2
			mulvarvar PLAYERAPREGENAMOUNT2 TEMPMOD
			divvar PLAYERAPREGENAMOUNT2 2
			divvar PLAYERAPREGENAMOUNT2 1000
		
			ifvarvarl PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC ifvarvarg PLAYERAPREGENAMOUNT MAXARMORPOINTS state playerregen5percentap
			else ifvarvare PLAYERAPREGENAMOUNT MAXARMORPOINTS state playerregen5percentap
			else ifvarvarl PLAYERAPREGENAMOUNT MAXARMORPOINTS ifvarg PLAYERAPREGENAMOUNT -1
			{
				addvarvar PLAYERAPREGENAMOUNT PLAYERAPREGENAMOUNT1
				ifvarn player[THISACTOR].over_shoulder_on 0
				{
					ifvarg PLAYERAPREGENAMOUNT1 0
					{
						setvarvar SHOWDAMAGE PLAYERAPREGENAMOUNT1
						setvar SHOWDAMAGETYPE 4
						setvarvar SHOWDAMAGEACTORID THISACTOR
						state showdamage
					}
				}
				ifvarvarg PLAYERAPREGENAMOUNT STATLIMITATOMIC setvarvar PLAYERAPREGENAMOUNT STATLIMITATOMIC
				ifvarvarg PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC setvarvar PLAYERAPREGENAMOUNT MAXARMORPOINTSATOMIC
				ifvarvarl PLAYERAPREGENAMOUNT STATLIMITATOMIC sound REGEN_ARMOR15 setvar PLAYERAPDAMAGED? -1
				setvarvar CURRENTARMORPOINTS PLAYERAPREGENAMOUNT
			}
			setvar PLAYERAPREGENCOUNTER 0
		}
		ifvare mainmenu 0 
		{
			ifvarg CURRENTHITPOINTS 0
			{
				ifvarand POWERUPCHEATFLAGS? 8 nullop else subvar APREGENTIME 1
				//state itemfullbright
			}
		}
	} 
	else
	{
		ifvarand POWERUPBITFIELD 8 subvar POWERUPBITFIELD 8
	}

	// Vampire Powerup
	ifvarg VAMPIRETIME 0
	{
		ifvarand POWERUPBITFIELD 16 nullop else addvar POWERUPBITFIELD 16
		ifvarg VAMPIRETIME 130 palfrom 16 8 64
		ifvarl VAMPIRETIME 131 ifvarg VAMPIRETIME 104 palfrom 6 5 64
		ifvarl VAMPIRETIME 105 ifvarg VAMPIRETIME 78 palfrom 5 4 64
		ifvarl VAMPIRETIME 79 ifvarg VAMPIRETIME 52 palfrom 3 2 64
		ifvarl VAMPIRETIME 53 ifvarg VAMPIRETIME 26 palfrom 2 1 64
		ifvarl VAMPIRETIME 27 ifvarg VAMPIRETIME 0 palfrom 1 1 64
		ifvare VAMPIRETIME 1 { setvarvar fta fta_normal setvar ftq 234 }
	
		ifvare mainmenu 0
		{
			ifvarg CURRENTHITPOINTS 0 
			{
				ifvarand POWERUPCHEATFLAGS? 16 nullop else subvar VAMPIRETIME 1
				//state itemfullbright
			}
		}
	}
	else
	{
		ifvarand POWERUPBITFIELD 16 subvar POWERUPBITFIELD 16
	}

	// Invulnerability Powerup
	state invulnicon-player
	ifvarg INVULNTIME 0
	{
		ifvarand POWERUPBITFIELD 2 nullop else addvar POWERUPBITFIELD 2
		state removeslow
		state removepoison
		state removedimness
		state removeconfusion
		state removecorrosion
		setplayer[THISACTOR].hurt_delay 12
		ifvare INVULNTIME 104 soundonce INVULNITEM2
		ifvarg INVULNTIME 130 palfrom 16 64 64
		ifvarl INVULNTIME 131 ifvarg INVULNTIME 104 palfrom 6 64 64
		ifvarl INVULNTIME 105 ifvarg INVULNTIME 78 palfrom 5 64 64
		ifvarl INVULNTIME 79 ifvarg INVULNTIME 52 palfrom 3 64 64
		ifvarl INVULNTIME 53 ifvarg INVULNTIME 26 palfrom 2 64 64
		ifvarl INVULNTIME 27 ifvarg INVULNTIME 0 palfrom 1 64 64
		ifvare INVULNTIME 1 { setvarvar fta fta_normal setvar ftq 155 }
	
		ifvare mainmenu 0 { ifvarg CURRENTHITPOINTS 0 addvar PLAYERINVULNCOUNTER 1 }
		ifvarg PLAYERINVULNCOUNTER 38 { sound INVULN_PULSE setvar PLAYERINVULNCOUNTER 0 }
		setplayer[THISACTOR].falling_counter 0
		ifvare mainmenu 0
		{
			ifvarg CURRENTHITPOINTS 0
			{
			ifvarand POWERUPCHEATFLAGS? 2 nullop else subvar INVULNTIME 1
			//state itemfullbright
			}
		}
	}
	else
	{
		ifvarand POWERUPBITFIELD 2 subvar POWERUPBITFIELD 2
	}

	//*******************************
	//*JUMPING/FALLING-RELATED STUFF*
	//*******************************
	ifvare mainmenu 0
	{
		ifvarn VEHICLEID -1 // When driving vehicles
		{
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
			{
				getinput[THISACTOR].avel TEMPVAR3
				ifvarn TEMPVAR3 0 setvar TEMPVAR3 0
				setinput[THISACTOR].avel TEMPVAR3
			
				setvar PLAYERMOVEPLUSVEL 524288
				ifvare sector[PLAYERSECTOR].lotag 1 { ifp ponground { mulvar PLAYERMOVEPLUSVEL 75 divvar PLAYERMOVEPLUSVEL 100 } }
			
				ifvarg PLAYERMOVEPLUSVEL 1048576 setvar PLAYERMOVEPLUSVEL 1048576 // Sets Riot Tank speed to a slow point purposely
				// Set the Negative Speed Limit to an inverse of the positive speed limit
				setvarvar PLAYERMOVEMINUSVEL PLAYERMOVEPLUSVEL mulvar PLAYERMOVEMINUSVEL -1
			
				getplayer[THISACTOR].posxv posxv
				ifvarn posxv 0
				{
					getinput[THISACTOR].fvel TEMPVAR4
					mulvar posxv 67
					divvar posxv 100
				}
				setplayer[THISACTOR].posxv posxv
			
				getplayer[THISACTOR].posyv posyv
				ifvarn posyv 0
				{
					getinput[THISACTOR].svel TEMPVAR4
					mulvar posyv 67
					divvar posyv 100
				}
				setplayer[THISACTOR].posyv posyv
			
				state enforcespeedlimits
			}
		}
		else // When not driving vehicles
		{
			// Get Speed Caps for Characters & Vehicles Based on Speed Stat
			setvarvar PLAYERMOVEPLUSVEL CHARACTERSPEEDTRUE
			subvar PLAYERMOVEPLUSVEL 46500
			ifvare sector[PLAYERSECTOR].lotag 1 { ifp ponground { mulvar PLAYERMOVEPLUSVEL 75 divvar PLAYERMOVEPLUSVEL 100 } }
			ifvare sector[PLAYERSECTOR].lotag 2 { mulvar PLAYERMOVEPLUSVEL 50 divvar PLAYERMOVEPLUSVEL 100 }
			mulvar PLAYERMOVEPLUSVEL 552
		
			getuserdef[THISACTOR].auto_run TEMPVAR3
			ifvare TEMPVAR3 0
			{
				ifvarand bits 32 nullop else divvar PLAYERMOVEPLUSVEL 2
			}
		
			ifp pshrunk divvar PLAYERMOVEPLUSVEL 16
		
			ifvarand PLAYERSTATUS? 2 { mulvar PLAYERMOVEPLUSVEL 125 divvar PLAYERMOVEPLUSVEL 100 }
			else ifvarand PLAYERSTATUS? 4 { mulvar PLAYERMOVEPLUSVEL 75 divvar PLAYERMOVEPLUSVEL 100 }
		
			ifvare CHARACTERSELECTED? 3 
			{
				setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
			}
			ifvare CHARACTERSELECTED? 4
			{
				setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 2 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
			}
			ifvare CHARACTERSELECTED? 6
			{
				setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar PLAYERMOVEPLUSVEL 80 divvar PLAYERMOVEPLUSVEL 100 } 
			}
			ifvare CHARACTERSELECTED? 10
			{
				setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
			}
			ifvare CHARACTERSELECTED? 13 
			{ 
				setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 2 { mulvar PLAYERMOVEPLUSVEL 110 divvar PLAYERMOVEPLUSVEL 100 } 
			}
		
			ifvarg PLAYERMOVEPLUSVEL 10405200 setvar PLAYERMOVEPLUSVEL 10405200
			// Set the Negative Speed Limit to an inverse of the positive speed limit
			setvarvar PLAYERMOVEMINUSVEL PLAYERMOVEPLUSVEL mulvar PLAYERMOVEMINUSVEL -1
		
			getplayer[THISACTOR].posxv posxv
			ifvarn posxv 0
			{
				state getaccelerationlimits
				getinput[THISACTOR].fvel TEMPVAR3
				ifvare TEMPVAR3 0 { addvar ACCELFACTOR -6 ifvarand PLAYERSTATUS? 2 addvar ACCELFACTOR -6 }
			
				state liftaccelcap
				state moveaccelcap
				state healthaccelcap
				state weaponaccelcap
				state winterclothesaccelcap
			
				mulvarvar posxv ACCELFACTOR
				divvar posxv 100
			}
			setplayer[THISACTOR].posxv posxv
		
			getplayer[THISACTOR].posyv posyv
			ifvarn posyv 0
			{
				state getaccelerationlimits
				getinput[THISACTOR].svel TEMPVAR4
				ifvare TEMPVAR4 0 { addvar ACCELFACTOR -6 ifvarand PLAYERSTATUS? 2 addvar ACCELFACTOR -6 }
			
				state liftaccelcap
				state moveaccelcap
				state healthaccelcap
				state weaponaccelcap
				state winterclothesaccelcap
			
				mulvarvar posyv ACCELFACTOR
				divvar posyv 100
			}
			setplayer[THISACTOR].posyv posyv
		
			ifp ponsteroids mulvar PLAYERMOVEPLUSVEL 2
			ifvarg PLAYERMOVEPLUSVEL 20810400 setvar PLAYERMOVEPLUSVEL 20810400
			ifp ponsteroids mulvar PLAYERMOVEMINUSVEL 2
			ifvarl PLAYERMOVEMINUSVEL -20810400 setvar PLAYERMOVEMINUSVEL -20810400
		
			state enforcespeedlimits
		}
	}
	
	// Get Player's move/xvel into sprite/actor terms
	getactor[THISACTOR].xvel ACTORXVEL
	
	ifvarn multijumpflag 0
	{
		ifvare sector[PLAYERSECTOR].lotag 2 setvar multijumpflag 0
		ifp ponground setvar multijumpflag 0
	}

	//***************************
	//*START OF JUMP HEIGHT CODE*
	//***************************
	
	setvarvar PLAYERJUMPSTRENGTHTEMP PLAYERJUMPSTRENGTH
	
	// Check for Jump Boots
	setvar DAMAGEMODIFIER 1000
	ifvare PLAYEREQUIPSLOTITEM1 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM2 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM3 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM4 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM5 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM6 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM7 13 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM8 13 addvar DAMAGEMODIFIER 250
	mulvarvar PLAYERJUMPSTRENGTHTEMP DAMAGEMODIFIER
	divvar PLAYERJUMPSTRENGTHTEMP 1000
	
	// Check for Jewel of Four Souls
	setvar DAMAGEMODIFIER 0
	ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 5
	ifvarl DAMAGEMODIFIER 2 setvar DAMAGEMODIFIER 2
	mulvarvar PLAYERJUMPSTRENGTHTEMP DAMAGEMODIFIER
	divvar PLAYERJUMPSTRENGTHTEMP 2

	// Check Health Levels
	ifvarn oldskoolmode 1
	{
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		ifvarl MISCARRAYID_AMOUNTTEMP 101 { mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 5 }
		else ifvarg MISCARRAYID_AMOUNTTEMP 100 ifvarl MISCARRAYID_AMOUNTTEMP 251 { mulvar PLAYERJUMPSTRENGTHTEMP 4 divvar PLAYERJUMPSTRENGTHTEMP 5 }
	}
	
	// Check Steroids
	ifp ponsteroids { mulvar PLAYERJUMPSTRENGTHTEMP 7 divvar PLAYERJUMPSTRENGTHTEMP 5 }

	// Check Character Forms
	ifvare CHARACTERSELECTED? 3
	{
		setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 1 addvar PLAYERJUMPSTRENGTHTEMP 2
	
		setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
		ifvare MISCARRAYID_AMOUNTTEMP 1 divvar PLAYERJUMPSTRENGTHTEMP 2
	}
	ifvare CHARACTERSELECTED? 4
	{
		setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 2
		{
			mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 2
		}
	}
	ifvare CHARACTERSELECTED? 6
	{
		setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 0 subvar PLAYERJUMPSTRENGTHTEMP 6
	}
	ifvare CHARACTERSELECTED? 10
	{
		setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarg PLAYERLEVEL 49 ifvarl PLAYERLEVEL 100 addvar PLAYERJUMPSTRENGTHTEMP 1
			ifvarg PLAYERLEVEL 99 addvar PLAYERJUMPSTRENGTHTEMP 2
		}
		else
		ifvare MISCARRAYID_AMOUNTTEMP 1
		{
			ifvarg PLAYERLEVEL 0 ifvarl PLAYERLEVEL 25 subvar PLAYERJUMPSTRENGTHTEMP 4
			ifvarg PLAYERLEVEL 24 ifvarl PLAYERLEVEL 50 subvar PLAYERJUMPSTRENGTHTEMP 3
			ifvarg PLAYERLEVEL 49 ifvarl PLAYERLEVEL 75 subvar PLAYERJUMPSTRENGTHTEMP 2
			ifvarg PLAYERLEVEL 74 ifvarl PLAYERLEVEL 100 subvar PLAYERJUMPSTRENGTHTEMP 1
		}
	}
	ifvare CHARACTERSELECTED? 13
	{
		setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 2
		{
			mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 2
		}
	}
	ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
	ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80
 
	// Check Character Weight Encumberment from Carrying Objects
	ifvarn SPRITEID-HOLDING -1 ifvare SPRITEID-TELEKENESIS_P -1
	{
		setvarvar STRENGTHRATIO PLAYERLIFTSTRENGTHTEMP
		mulvar STRENGTHRATIO 100
		divvarvar STRENGTHRATIO actorvar[SPRITEID-HOLDING].ACTORWEIGHT
	
		// limit player jump
		ifvarvarg STRENGTHRATIO GRABRATIO
		{
			setvarvar PHYSICSTEMPC STRENGTHRATIO
			subvarvar PHYSICSTEMPC GRABRATIO
			addvar PHYSICSTEMPC 1
		
			setvarvar PHYSICSTEMPB LIFTRATIO
			subvarvar PHYSICSTEMPB GRABRATIO
			addvar PHYSICSTEMPB 1
		
			mulvar PHYSICSTEMPC 60 // 100
			divvarvar PHYSICSTEMPC PHYSICSTEMPB
		
			setvar PHYSICSTEMP 20
			addvarvar PHYSICSTEMP PHYSICSTEMPC
			ifvarl PHYSICSTEMP 20 setvar PHYSICSTEMP 20
			ifvarg PHYSICSTEMP 100 setvar PHYSICSTEMP 100
				
			mulvarvar PLAYERJUMPSTRENGTHTEMP PHYSICSTEMP
			divvar PLAYERJUMPSTRENGTHTEMP 100
		
			ifp pwalking { mulvar PLAYERJUMPSTRENGTHTEMP 4 divvar PLAYERJUMPSTRENGTHTEMP 5 }
			else ifp pducking { mulvar PLAYERJUMPSTRENGTHTEMP 3 divvar PLAYERJUMPSTRENGTHTEMP 5 }
		}
		ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
		ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80
	}

	// Check Weapons
	setvar TEMPVAR4 0
	ifvare CHARACTERSELECTED? 6 addvar TEMPVAR4 1
	ifvare CHARACTERSELECTED? 9 addvar TEMPVAR4 1
	ifvare CHARACTERSELECTED? 14 addvar TEMPVAR4 1
	ifvare TEMPVAR4 0
	{
		ifvare SPRITEID-HOLDING -1
		{ 
			ifp ponsteroids 
			{
				ifvare player[THISACTOR].curr_weapon 0 { mulvar PLAYERJUMPSTRENGTHTEMP 3000 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 1 { mulvar PLAYERJUMPSTRENGTHTEMP 2996 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 2 { mulvar PLAYERJUMPSTRENGTHTEMP 2992 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 3 { mulvar PLAYERJUMPSTRENGTHTEMP 2988 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 4 { mulvar PLAYERJUMPSTRENGTHTEMP 2968 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 5 { mulvar PLAYERJUMPSTRENGTHTEMP 2994 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 6 { mulvar PLAYERJUMPSTRENGTHTEMP 2984 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 7 { mulvar PLAYERJUMPSTRENGTHTEMP 2976 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 8 { mulvar PLAYERJUMPSTRENGTHTEMP 2993 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 9 { mulvar PLAYERJUMPSTRENGTHTEMP 2988 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 10 { mulvar PLAYERJUMPSTRENGTHTEMP 3000 divvar PLAYERJUMPSTRENGTHTEMP 3000 }
				else ifvare player[THISACTOR].curr_weapon 11 { mulvar PLAYERJUMPSTRENGTHTEMP 2984 divvar PLAYERJUMPSTRENGTHTEMP 3000 }		
			}
			else
			{ 
				ifvare player[THISACTOR].curr_weapon 0 { mulvar PLAYERJUMPSTRENGTHTEMP 300 divvar PLAYERJUMPSTRENGTHTEMP 300 } 
				else ifvare player[THISACTOR].curr_weapon 1 { mulvar PLAYERJUMPSTRENGTHTEMP 296 divvar PLAYERJUMPSTRENGTHTEMP 300 } 
				else ifvare player[THISACTOR].curr_weapon 2 { mulvar PLAYERJUMPSTRENGTHTEMP 292 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 3 { mulvar PLAYERJUMPSTRENGTHTEMP 288 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 4 { mulvar PLAYERJUMPSTRENGTHTEMP 268 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 5 { mulvar PLAYERJUMPSTRENGTHTEMP 294 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 6 { mulvar PLAYERJUMPSTRENGTHTEMP 284 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 7 { mulvar PLAYERJUMPSTRENGTHTEMP 276 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 8 { mulvar PLAYERJUMPSTRENGTHTEMP 293 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 9 { mulvar PLAYERJUMPSTRENGTHTEMP 288 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 10 { mulvar PLAYERJUMPSTRENGTHTEMP 300 divvar PLAYERJUMPSTRENGTHTEMP 300 }
				else ifvare player[THISACTOR].curr_weapon 11 { mulvar PLAYERJUMPSTRENGTHTEMP 284 divvar PLAYERJUMPSTRENGTHTEMP 300 }		
			}
		}
	}
	ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
	ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80

 
	// Check Winter Clothing Levels
	ifvarg winterclothes 0
	{
		setvar tempc 8
		mulvarvar tempc winterclothes
		divvar tempc 100
	
		setvar tempb 80
		subvarvar tempb tempc
	
		mulvarvar PLAYERJUMPSTRENGTHTEMP tempb
		divvar PLAYERJUMPSTRENGTHTEMP 80
	}
	
	
	ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
	ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80

	// Check Character Jump-Strength Support Levels
	setvar DAMAGEMODIFIER 1000
	ifvare CHARACTERSELECTED? 14
	{
		// Duke
		ifvarg PLAYERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Jack
		ifvarg PLAYERSUPPORTJACK 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTJACK 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Bubsy
		ifvarg PLAYERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Ami
		ifvarg PLAYERSUPPORTAMI 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTAMI 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Lo Wang
		ifvarg PLAYERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// ESSence
		ifvarg PLAYERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Ted
		ifvarg PLAYERSUPPORTTED 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTTED 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Lisa
		ifvarg PLAYERSUPPORTLISA 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTLISA 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Cybanis
		ifvarg PLAYERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Nethra
		ifvarg PLAYERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Paula
		ifvarg PLAYERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Lori
		ifvarg PLAYERSUPPORTLORI 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTLORI 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Minako
		ifvarg PLAYERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 350 // "*" Support
		// Maken
		ifvarg PLAYERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 350 // "*" Support
	}
	else
	{
		ifvarg PLAYERSUPPORTMYSTERY1 0 addvar DAMAGEMODIFIER 50 // "C" Support
		ifvarg PLAYERSUPPORTMYSTERY1 1 addvar DAMAGEMODIFIER 75 // "B" Support
		ifvarg PLAYERSUPPORTMYSTERY1 2 addvar DAMAGEMODIFIER 100 // "A" Support
		ifvarg PLAYERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 125 // "S" Support
		ifvarg PLAYERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 350 // "*" Support
	}
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	ifvarg DAMAGEMODIFIER 1700 setvar DAMAGEMODIFIER 1700
	mulvarvar PLAYERJUMPSTRENGTHTEMP DAMAGEMODIFIER
	divvar PLAYERJUMPSTRENGTHTEMP 1000

	// Check Player's Levels
	ifvarg PLAYERLEVEL 25 ifvarl PLAYERLEVEL 51 { mulvar PLAYERJUMPSTRENGTHTEMP 108 divvar PLAYERJUMPSTRENGTHTEMP 100 }
	ifvarg PLAYERLEVEL 50 ifvarl PLAYERLEVEL 76 { mulvar PLAYERJUMPSTRENGTHTEMP 116 divvar PLAYERJUMPSTRENGTHTEMP 100 }
	ifvarg PLAYERLEVEL 75 { mulvar PLAYERJUMPSTRENGTHTEMP 125 divvar PLAYERJUMPSTRENGTHTEMP 100 }
	
	// Finalize Jump Height Minimums and Maximums
	ifvarl PLAYERJUMPSTRENGTHTEMP 0 setvar PLAYERJUMPSTRENGTHTEMP 0
	ifvarg PLAYERJUMPSTRENGTHTEMP 80 setvar PLAYERJUMPSTRENGTHTEMP 80
	
	// Stop Characters from Jumping if they're Pushing/Pulling Objects
	ifvarn PLAYERPUSHINGTIMER 0 setvar PLAYERJUMPSTRENGTHTEMP 0
	// addlogvar PLAYERJUMPSTRENGTHTEMP

	getplayer[THISACTOR].jumping_counter jumpcounter
	ifvarg jumpcounter 0
	{
		ifvare PLAYERJUMPSTRENGTHTEMP 0 setplayer[THISACTOR].poszv 0
		else
		{
			getplayer[THISACTOR].poszv tempb
			ifvarl tempb -4096 
			{
				setvar tempb -4096
				setplayer[THISACTOR].poszv tempb
			}
		}
	}
	
	state getjumpheights
	
	//*************************
	//*END OF JUMP HEIGHT CODE*
	//*************************


	//***************
	//***FALL CODE***
	//***************
	
	// Check Characters Resistances and alter based on different values
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 setvarvar PLAYERFALLRESISTTEMP 15
	}
	else
	{
		setvarvar PLAYERFALLRESISTTEMP PLAYERFALLRESIST
	
		// Check Character Forms
		ifvare CHARACTERSELECTED? 3
		{
			setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 1
			{
				ifvarl PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 7 divvar PLAYERFALLRESISTTEMP 8 // 87.5% [-12.5%]
				}
				else
				ifvarg PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 5 divvar PLAYERFALLRESISTTEMP 4 // 125% [+25%]
				}
			}
			setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
			ifvare MISCARRAYID_AMOUNTTEMP 1
			{
				ifvarl PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 7 divvar PLAYERFALLRESISTTEMP 4 // 175% [+75%]
				}
				else
				ifvarg PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 1 divvar PLAYERFALLRESISTTEMP 3 // 33% [-67%]
				}
			}
		}
		ifvare CHARACTERSELECTED? 4
		{
			setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 2
			{
				ifvarl PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 2 divvar PLAYERFALLRESISTTEMP 4 // 50% [-50%]
				}
				else
				ifvarg PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 8 divvar PLAYERFALLRESISTTEMP 4 // 200% [+100%]
				}
			}
		}
		ifvare CHARACTERSELECTED? 6
		{
			setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 0 
			{
				ifvarl PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 8 divvar PLAYERFALLRESISTTEMP 4 // 200% [+100%]
				}
				else
				ifvarg PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 2 divvar PLAYERFALLRESISTTEMP 4 // 50% [-50%]
				}
			}
		}
		ifvare CHARACTERSELECTED? 10
		{
			setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 1
			{
				ifvarl PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 9 divvar PLAYERFALLRESISTTEMP 8 // 112.5% [+12.5%]
				}
				else
				ifvarg PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 3 divvar PLAYERFALLRESISTTEMP 4 // 75% [-25%]
				}
			}
		}
		ifvare CHARACTERSELECTED? 13
		{
			setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 2
			{
				ifvarl PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 2 divvar PLAYERFALLRESISTTEMP 4 // 50% [-50%]
				}
				else
				ifvarg PLAYERFALLRESISTTEMP 0
				{
					mulvar PLAYERFALLRESISTTEMP 8 divvar PLAYERFALLRESISTTEMP 4 // 200% [+100%]
				}
			}
		}
	
		// Check Support Bonuses
		setvar DAMAGEMODIFIER 0
		ifvare CHARACTERSELECTED? 3 // Bubsy
		{
			// Duke
			ifvarg PLAYERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Jack
			ifvarg PLAYERSUPPORTJACK 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTJACK 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Ami
			ifvarg PLAYERSUPPORTAMI 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTAMI 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Lo Wang
			ifvarg PLAYERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// ESSence
			ifvarg PLAYERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Ted
			ifvarg PLAYERSUPPORTTED 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTTED 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Lisa
			ifvarg PLAYERSUPPORTLISA 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTLISA 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Cybanis
			ifvarg PLAYERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Nethra
			ifvarg PLAYERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Paula
			ifvarg PLAYERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Lori
			ifvarg PLAYERSUPPORTLORI 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTLORI 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Minako
			ifvarg PLAYERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// "Mystery Lady"
			ifvarg PLAYERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 350 // "*" Support
			// Maken
			ifvarg PLAYERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 350 // "*" Support
		}
		else
		{
			// Bubsy
			ifvarg PLAYERSUPPORTBUBSY 0 addvar DAMAGEMODIFIER 50 // "C" Support
			ifvarg PLAYERSUPPORTBUBSY 1 addvar DAMAGEMODIFIER 75 // "B" Support
			ifvarg PLAYERSUPPORTBUBSY 2 addvar DAMAGEMODIFIER 100 // "A" Support
			ifvarg PLAYERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 125 // "S" Support
			ifvarg PLAYERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 350 // "*" Support
		}
		ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
		ifvarg DAMAGEMODIFIER 700 setvar DAMAGEMODIFIER 700
		setvarvar TEMPVAR5 PLAYERFALLRESISTTEMP
		mulvarvar TEMPVAR5 DAMAGEMODIFIER
		divvar TEMPVAR5 1000
		ifvarl PLAYERFALLRESISTTEMP 0
		{
			subvarvar PLAYERFALLRESISTTEMP TEMPVAR5
		}
		else
		ifvarg PLAYERFALLRESISTTEMP 0
		{
			addvarvar PLAYERFALLRESISTTEMP TEMPVAR5
		}
	}

	// Increases Fall Resistance as You Level Up
	setvarvar TEMPVAR5 PLAYERTEMPLEVEL
	ifvarl SKILLLEVEL 1 divvar TEMPVAR5 14
	ifvare SKILLLEVEL 1 divvar TEMPVAR5 15
	ifvare SKILLLEVEL 2 divvar TEMPVAR5 16
	ifvare SKILLLEVEL 3 divvar TEMPVAR5 17
	ifvare SKILLLEVEL 4 divvar TEMPVAR5 18
	ifvare SKILLLEVEL 5 divvar TEMPVAR5 19
	ifvare SKILLLEVEL 6 divvar TEMPVAR5 20
	ifvare SKILLLEVEL 7 divvar TEMPVAR5 21
	ifvare SKILLLEVEL 8 divvar TEMPVAR5 22
	ifvarg SKILLLEVEL 8 divvar TEMPVAR5 23
	addvarvar PLAYERFALLRESISTTEMP TEMPVAR5
	
	// Check for Jewel of Four Souls
	ifvarl PLAYERFALLRESISTTEMP 0 { setvarvar TEMPMOD PLAYERFALLRESISTTEMP mulvar TEMPMOD -1 } // saves the pre-jewel value for negative fall resistance into abs
	setvar DAMAGEMODIFIER 0
	ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 5
	ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 5
	ifvarl DAMAGEMODIFIER 2 setvar DAMAGEMODIFIER 2
	ifvarl PLAYERFALLRESISTTEMP 0
	{
		ifvarg DAMAGEMODIFIER 2
		{
		mulvarvar TEMPMOD DAMAGEMODIFIER
		divvarvar TEMPMOD 2
		addvarvar PLAYERFALLRESISTTEMP TEMPMOD
		}
	}
	else
	{
		mulvarvar PLAYERFALLRESISTTEMP DAMAGEMODIFIER
		divvar PLAYERFALLRESISTTEMP 2 
	}
 
	// Check Steroids
	ifp ponsteroids 
	{
		ifvarl PLAYERFALLRESISTTEMP 0
		{
			mulvar PLAYERFALLRESISTTEMP 4 divvar PLAYERFALLRESISTTEMP 5 // 80% [-20%]
		}
		else
		ifvarg PLAYERFALLRESISTTEMP 0
		{
			mulvar PLAYERFALLRESISTTEMP 7 divvar PLAYERFALLRESISTTEMP 5 // 140% [+40%]
		}
	}

	// Allows a Character to crouch in midair to try to soften their fall [increases fall resistance temporarily]
	getinput[THISACTOR].bits TEMP3
	ifvarand TEMP3 2
	{
		setvarvar TEMPVAR5 PLAYERFALLRESISTTEMP
		randvar TEMPVAR4 6
		addvar TEMPVAR4 -3
		
		ifvare CHARACTERSELECTED? 5 { addvar TEMPVAR4 75 } // +72-78%
		else ifvare CHARACTERSELECTED? 14 { addvar TEMPVAR4 45 } // +42-48%
		else ifvare CHARACTERSELECTED? 15 { addvar TEMPVAR4 54 }  // +51-57%
		else { addvar TEMPVAR4 24 } // +21-27%
	
		mulvarvar TEMPVAR5 TEMPVAR4 
		divvar TEMPVAR5 100
		ifvarg PLAYERFALLRESISTTEMP 0 addvarvar PLAYERFALLRESISTTEMP TEMPVAR5
		ifvarl PLAYERFALLRESISTTEMP 0 subvarvar PLAYERFALLRESISTTEMP TEMPVAR5
	}
 
	// Check Falling Counters/Resistances
	getplayer[THISACTOR].falling_counter fallcounter
	ifvarvarl fallingresistance PLAYERFALLRESISTTEMP // For Positive Resistances
	{
		ifvarg fallcounter 0
		{
			subvar fallcounter 1
			setplayer[THISACTOR].falling_counter fallcounter
			addvar fallingresistance 1
		}
	}
	else
	ifvarvarg fallingresistance PLAYERFALLRESISTTEMP // For Negative Resistances
	{
		ifvarg fallcounter 0
		{
			addvar fallcounter 1
			setplayer[THISACTOR].falling_counter fallcounter
			subvar fallingresistance 1
		}
	}


	ifp pjetpack
	{
		setvar fallcounts 0
		setvar fallcounter2 0
		setvar totalfallcounter 0
		setvar fallingresistance 0 
		state stopfallscreams
		setvar FALLSOUND? 0
	}
	
	ifp ponground
	{
		setvar fallingresistance 0 
		ifvarg ONGROUNDTIMER 1
		{  
			setvar fallcounts 0
			setvar fallcounter2 0
			setvar totalfallcounter 0
			state stopfallscreams
			redefinequote 245
			setvar GLIDING? 0
		}
	}

	ifvare GLIDING? 1
	{
		redefinequote 245 ^23GLIDING MODE ACTIVE!
		setvarvar fta 50 setvar ftq 245
	}
	else
	{
		ifvare ftq 245
		{
			setvarvar fta 0 setvar ftq 0
		}
	}

	ifp pfalling
	{
		ifvare GLIDING? 1
		{
			redefinequote 245 
			setvar GLIDING? 0
		}
	}
	
	state falling

	//**********************
	//***END OF FALL CODE***
	//**********************

	state checkhitscan
	ifvarand CHEATBITFIELD? 32 nullop else
	{
		ifvare mainmenu 0
		{
			getactor[THISACTOR].htextra TEMP 
			ifvarg TEMP -1 state player_defense
		}
		else
		{
			getactor[THISACTOR].htextra TEMP 
			ifvarn TEMP -1 setactor[THISACTOR].htextra -1
		}
	}

	ifvarg CURRENTCELLS -1
	{
		ifvare DAMAGEINCELL 0
		{
			ifvare CURRENTCELLS 0 setvar DAMAGEINCELL 0
			else
			{
				subvar CURRENTCELLS 1
				addvarvar DAMAGEINCELL ESHIELDDMGFACTOR
			}
		}
		else
		ifvarl DAMAGEINCELL 0 setvar DAMAGEINCELL 0
	}
	else setvar CURRENTCELLS 0

	ifvarvarg DAMAGEINCELL ESHIELDDMGFACTOR
	{
		addvar CURRENTCELLS 1
		subvarvar DAMAGEINCELL ESHIELDDMGFACTOR
	}

	// Checks for level ups for Active and Non-Active Characters
	ifvarg PARTYALIVE 0
	{
		ifvare DUKE? 1 { setvar CHARACTERARRAY 1 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 1 state nonactivecharstatcalc } }
		ifvare JACK? 1 { setvar CHARACTERARRAY 2 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 2 state nonactivecharstatcalc } }
		ifvare BUBSY? 1 { setvar CHARACTERARRAY 3 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 3 state nonactivecharstatcalc } }
		ifvare AMI? 1 { setvar CHARACTERARRAY 4 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 4 state nonactivecharstatcalc } }
		ifvare LOWANG? 1 { setvar CHARACTERARRAY 5 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 5 state nonactivecharstatcalc } }
		ifvare ESSENCE? 1 { setvar CHARACTERARRAY 6 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 6 state nonactivecharstatcalc } }
		ifvare TED? 1 { setvar CHARACTERARRAY 7 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 7 state nonactivecharstatcalc } }
		ifvare LISA? 1 { setvar CHARACTERARRAY 8 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 8 state nonactivecharstatcalc } }
		ifvare CYBANIS? 1 { setvar CHARACTERARRAY 9 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 9 state nonactivecharstatcalc } }
		ifvare NETHRA? 1 { setvar CHARACTERARRAY 10 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 10 state nonactivecharstatcalc } }
		ifvare PAULA? 1 { setvar CHARACTERARRAY 11 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 11 state nonactivecharstatcalc } }
		ifvare LORI? 1 { setvar CHARACTERARRAY 12 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 12 state nonactivecharstatcalc } }
		ifvare MINAKO? 1 { setvar CHARACTERARRAY 13 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 13 state nonactivecharstatcalc } }
		ifvare MYSTERY1? 1 { setvar CHARACTERARRAY 14 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 14 state nonactivecharstatcalc } }
		ifvare MAKEN? 1 { setvar CHARACTERARRAY 15 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 { ifvarn CHARACTERSELECTED? 15 state nonactivecharstatcalc } }
		state playerstatcalculation
	}

	setvar MISCARRAYID 63 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // SOMEONE-LEVELS?
	ifvarg MISCARRAYID_AMOUNTTEMP 0 
	{
		state refreshenemystatsonlevel
		setvar MISCARRAYID 63 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // SOMEONE-LEVELS?
	}

	setvar MISCARRAYID 64 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // PLAYER-LEVELSUP?
	ifvarg MISCARRAYID_AMOUNTTEMP 0
	{
		ifvare CHARACTERSELECTED? 8
		{
			randvar RNDVOICE 3
			ifvare RNDVOICE 0
			{
				globalsound LISA_LEVELUP1 
				redefinequote 340 ^7Lisa: All right! Now I'm refreshed, and ready to continue!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 1
			{
				globalsound LISA_LEVELUP2 
				redefinequote 340 ^7Lisa: I smell your fear, and boy does it reek!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 2
			{
				globalsound LISA_LEVELUP3 
				redefinequote 340 ^7Lisa: Why do I suddenly feel months younger?!?!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 3
			{
				globalsound LISA_LEVELUP4 
				redefinequote 340 ^7Lisa: Looks like you guys will be yesterday's news soon enough!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
		ifvare CHARACTERSELECTED? 15
		{
			randvar RNDVOICE 3
			ifvare RNDVOICE 0
			{
				globalsound MAKEN_LEVELUP1 
				redefinequote 340 ^10Maken: Surgin' to power like a storm!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 1
			{
				globalsound MAKEN_LEVELUP2 
				redefinequote 340 ^10Maken: Time to rock like an earthquake!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 2
			{
				globalsound MAKEN_LEVELUP3 
				redefinequote 340 ^10Maken: Limits?! WHAT limits?!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 3
			{
				globalsound MAKEN_LEVELUP4 
				redefinequote 340 ^10Maken: My inner power swells over!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
		setvar MISCARRAYID 64 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // PLAYER-LEVELSUP?
	}
	
	state moneycalc


	getplayer[THISACTOR].on_ground PLAYERONGROUND
	getactor[PLAYERID].sectnum PLAYERSECTOR
	getsector[PLAYERSECTOR].floorpicnum SECTORFLOORPICNUM
	//getsector[PLAYERSECTOR].hitag SECTORHITAG
	//getsector[PLAYERSECTOR].lotag SECTORLOTAG
	getuserdef[THISACTOR].god TEMPVAR
	ifvare TEMPVAR 1
	{
		ifvarand CHEATBITFIELD? 32 nullop else addvar CHEATBITFIELD? 32
	}
	else
	{
		ifvarand CHEATBITFIELD? 32 subvar CHEATBITFIELD? 32
	}
	
	// getuserdef[THISACTOR].cashman CHEATCASH
	// getuserdef[THISACTOR].showallmap CHEATCLIP

	/*
	// Allows Bubsy to use Fanned Floors to glide upwards like in Bubsy 3D [Needs Work to Fix]
	ifvare SECTORFLOORPICNUM 407
	{
		ifvare mainmenu 0
		{
			ifvare CHARACTERSELECTED? 3
			{
				ifvare GLIDING? 1
				{
					getsector[PLAYERSECTOR].floorz TEMPVAR3
					getplayer[THISACTOR].posz TEMPVAR4
					ifvarvarl TEMPVAR4 TEMPVAR3
					{
						setvarvar TEMPVAR2 TEMPVAR4
						subvarvar TEMPVAR2 TEMPVAR3
						mulvar TEMPVAR2 -1
				
						setvarvar TEMPVAR5 TEMPVAR2
						divvarvar TEMPVAR5 58
						ifvarg TEMPVAR5 2240 setvar TEMPVAR5 2240
						subvar TEMPVAR5 2240
						getplayer[THISACTOR].poszv poszv
						addvarvar poszv TEMPVAR5
						ifvarl poszv -1344 setvar poszv -1344
						setplayer[THISACTOR].poszv poszv
					}
				}
			}
		}
	}
	*/
	
	ifvare sector[PLAYERSECTOR].lotag 19997 setvar CHARACTERCHEAT? 2

	// Special Lotag for setting difficulty level [Lotag = 20001, Hitag = 100X, X = Difficulty Number (0 to 9)]
	ifvare sector[PLAYERSECTOR].lotag 20001
	{
		ifvare sector[PLAYERSECTOR].hitag 1000 redefinequote 270 SKILL 0: ^20EAT IT BOY EAT IT!
		ifvare sector[PLAYERSECTOR].hitag 1001 redefinequote 270 SKILL 1: ^13MANY PIECES OF CAKE!
		ifvare sector[PLAYERSECTOR].hitag 1002 redefinequote 270 SKILL 2: ^0LET'S ROCK THE HOUSE!
		ifvare sector[PLAYERSECTOR].hitag 1003 redefinequote 270 SKILL 3: ^16COME GET SOME MORE!
		ifvare sector[PLAYERSECTOR].hitag 1004 redefinequote 270 SKILL 4: ^21DAMN I'M VERY GOOD!
		ifvare sector[PLAYERSECTOR].hitag 1005 redefinequote 270 SKILL 5: ^10YOU A BAD ENOUGH DUDE?!
		ifvare sector[PLAYERSECTOR].hitag 1006 redefinequote 270 SKILL 6: ^7U R MASOCHIST INCARNATE!
		ifvare sector[PLAYERSECTOR].hitag 1007 redefinequote 270 SKILL 7: ^11I WILL EAT YOUR SOUL!
		ifvare sector[PLAYERSECTOR].hitag 1008 redefinequote 270 SKILL 8: ^14YOU ARE DEATH'S BITCH!!
		ifvare sector[PLAYERSECTOR].hitag 1009 redefinequote 270 SKILL 9: ^6THE END OF YOUR DESTINY!!!
	
		ifvarg sector[PLAYERSECTOR].hitag 999 ifvarl sector[PLAYERSECTOR].hitag 1010
		{
			setvarvar tempc sector[PLAYERSECTOR].hitag
			subvar tempc 1000
			setuserdef[THISACTOR].player_skill tempc
			setvar fta 6 setvar ftq 270
		}
	}

	// Special Level Warping Sectors [set Lotag to 20000, and then Hitag to XYY. X = Episode Number (1 to 7) YY = Level Number (01 to 64)]
	ifvarg sector[PLAYERSECTOR].lotag 19998 ifvarl sector[PLAYERSECTOR].lotag 20001
	{
		ifvare sector[PLAYERSECTOR].lotag 19999 // 19999 will reset all global tallies upon use
		{
			setvar MISCARRAYID 0 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // ENEMIES-KILLED-LEVEL
			setvar MISCARRAYID 2 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-ENEMIES-KILLED-LEVEL
			setvar MISCARRAYID 1 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // ENEMIES-KILLED-GAME
			setvar MISCARRAYID 3 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-ENEMIES-KILLED-GAME
			setvar MISCARRAYID 4 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // SECRETSFOUND-LEVEL
			setvar MISCARRAYID 6 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-SECRETSFOUND-LEVEL
			setvar MISCARRAYID 5 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // SECRETSFOUND-GAME
			setvar MISCARRAYID 7 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-SECRETSFOUND-GAME
			setvar MISCARRAYID 8 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // RANKITEMSFOUND-LEVEL
			setvar MISCARRAYID 10 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-RANKITEMSFOUND-LEVEL
			setvar MISCARRAYID 9 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // RANKITEMSFOUND-GAME
			setvar MISCARRAYID 11 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-RANKITEMSFOUND-GAME
			setvar MISCARRAYID 12 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSSAVED-LEVEL
			setvar MISCARRAYID 14 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSSAVED-LEVEL
			setvar MISCARRAYID 13 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSSAVED-GAME
			setvar MISCARRAYID 15 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSSAVED-GAME
			setvar MISCARRAYID 16 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSKILLED-LEVEL
			setvar MISCARRAYID 18 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSKILLED-LEVEL
			setvar MISCARRAYID 17 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // CIVILIANSKILLED-GAME
			setvar MISCARRAYID 19 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-CIVILIANSKILLED-GAME
			setvar MISCARRAYID 20 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILESFOUND-LEVEL
			setvar MISCARRAYID 21 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // MAX-WORLDTILESFOUND-LEVEL
			setvar TIMERRAWFORMAT 0
			setvar TIMERRAWFORMAT_LEVEL 0
		}
	
		ifvarg sector[PLAYERSECTOR].hitag 100
		{
			setvarvar TEMPVAR7 sector[PLAYERSECTOR].hitag
			divvar TEMPVAR7 100
			subvarvar TEMPVAR7 1
		
			setvarvar TEMP sector[PLAYERSECTOR].hitag
			divvar TEMP 100
			mulvar TEMP 100
			setvarvar TEMPVAR8 sector[PLAYERSECTOR].hitag
			subvarvar TEMPVAR8 TEMP
			subvarvar TEMPVAR8 1
		
			startlevel TEMPVAR7 TEMPVAR8
		}
	}

	ifvare sector[PLAYERSECTOR].lotag 20002 // Cheat Sector [Gives 1hr of Artifacts and Level 100 to the current character]
	{
		setvar EXPPTS 10000000
		setvar QUADTIME 93600
		setvar INVULNTIME 93600
		setvar REGENTIME 93600
		setvar APREGENTIME 93600
		setvar VAMPIRETIME 93600
		redefinequote 301 ^10CHEATING SECTOR!
		setvar fta 6 setvar ftq 301
	}

	ifvare sector[PLAYERSECTOR].lotag 20003
	{
		setvar MISCARRAYID 27 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ADD-DELAY
		ifvare MISCARRAYID_AMOUNTTEMP 0
		{
			ifvare sector[PLAYERSECTOR].hitag 1 
			{ 
				ifvare DUKE? 0
				{
					setvar DUKE? 1
					redefinequote 334 DUKE ADDED TO GROUP! 
					setvar fta 6 setvar ftq 334
				}
				else
				{
					ifvarg PARTYSIZE 1
					{
						setvar DUKE? 0
						redefinequote 334 DUKE REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				}
			}
			ifvare sector[PLAYERSECTOR].hitag 2
			{ 
				ifvare JACK? 0
				{
					setvar JACK? 1 
					redefinequote 334 JACK ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				}
				else
				{
					ifvarg PARTYSIZE 1
					{
						setvar JACK? 0 
						redefinequote 334 JACK REMOVED FROM GROUP! 
						setvar fta 6 setvar ftq 334
					}
				}
			}
			ifvare sector[PLAYERSECTOR].hitag 3
			{ 
				ifvare BUBSY? 0 
				{
					setvar BUBSY? 1
					redefinequote 334 BUBSY ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				}
				else
				{
					ifvarg PARTYSIZE 1
					{
						setvar BUBSY? 0
						redefinequote 334 BUBSY REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				}
			}
			ifvare sector[PLAYERSECTOR].hitag 4
			{ 
				ifvare AMI? 0 
				{
					setvar AMI? 1
					redefinequote 334 AMI ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				}
				else
				{
					ifvarg PARTYSIZE 1
					{
						setvar AMI? 0
						redefinequote 334 AMI REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				}
			}
			ifvare sector[PLAYERSECTOR].hitag 5
			{ 
				ifvare LOWANG? 0 
				{
					setvar LOWANG? 1 
					redefinequote 334 HIGA ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				}
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar LOWANG? 0 
						redefinequote 334 HIGA REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				}
			}
			ifvare sector[PLAYERSECTOR].hitag 6
			{ 
				ifvare ESSENCE? 0 
				{ 
					setvar ESSENCE? 1 
					redefinequote 334 ESSENCE ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar ESSENCE? 0 
						redefinequote 334 ESSENCE REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 7
			{ 
				ifvare TED? 0 
				{ 
					setvar TED? 1 
					redefinequote 334 TED ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar TED? 0 
						redefinequote 334 TED REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 8
			{ 
				ifvare LISA? 0 
				{ 
					setvar LISA? 1 
					redefinequote 334 LISA ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar LISA? 0 
						redefinequote 334 LISA REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 9
			{ 
				ifvare CYBANIS? 0 
				{ 
					setvar CYBANIS? 1 
					redefinequote 334 CYBANIS ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar CYBANIS? 0 
						redefinequote 334 CYBANIS REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 10
			{ 
				ifvare NETHRA? 0 
				{ 
					setvar NETHRA? 1 
					redefinequote 334 NETHRA ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar NETHRA? 0 
						redefinequote 334 NETHRA REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 11
			{ 
				ifvare PAULA? 0 
				{ 
					setvar PAULA? 1 
					redefinequote 334 PAULA ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar PAULA? 0 
						redefinequote 334 PAULA REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 12
			{ 
				ifvare LORI? 0 
				{ 
					setvar LORI? 1 
					redefinequote 334 LORI ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar LORI? 0 
						redefinequote 334 LORI REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 13
			{ 
				ifvare MINAKO? 0 
				{ 
					setvar MINAKO? 1 
					redefinequote 334 MINAKO ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar MINAKO? 0 
						redefinequote 334 MINAKO REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 14
			{ 
				ifvare MYSTERY1? 0 
				{ 
					setvar MYSTERY1? 1 
					redefinequote 334 ??????? ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar MYSTERY1? 0 
						redefinequote 334 ??????? REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			ifvare sector[PLAYERSECTOR].hitag 15
			{ 
				ifvare MAKEN? 0 
				{ 
					setvar MAKEN? 1 
					redefinequote 334 MAKEN ADDED TO GROUP!
					setvar fta 6 setvar ftq 334
				} 
				else 
				{ 
					ifvarg PARTYSIZE 1
					{
						setvar MAKEN? 0 
						redefinequote 334 MAKEN REMOVED FROM GROUP!
						setvar fta 6 setvar ftq 334
					}
				} 
			}
			setvar MISCARRAYID 27 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 26 // ADD-DELAY
		}
	}

	setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // Secrets Found [level]
	setplayer[THISACTOR].secret_rooms MISCARRAYID_AMOUNTTEMP
	
	setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // Max Secrets Found [level]
	setplayer[THISACTOR].max_secret_rooms MISCARRAYID_AMOUNTTEMP2
	
	// Award Rank Points for Discovering Secrets
	getplayer[THISACTOR].cursectnum SECTORSECRETCHECK
	getactorvar[SECTORSECRETCHECK].SECTORISASECRET? SECRETCHECKFLAG
	ifvare SECRETCHECKFLAG 32767
	{
		setvar MISCARRAYID 4 // Secrets Found [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 5 // Secrets Found [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar RANKPOINTSTEMP 8
		setvar MISCARRAYID 5 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // Secrets Found [Game]
		setvarvar tempc MISCARRAYID_AMOUNTTEMP
		setvar tempd 0
		whilevarvarn tempd tempc
		{
			addvar tempd 1
			mulvar RANKPOINTSTEMP 5
			divvar RANKPOINTSTEMP 4
			ifvarvare tempd tempc
			{
				setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
				setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
				ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
				{
				mulvar RANKPOINTSTEMP 21
				divvar RANKPOINTSTEMP 4
				}    
			}
		
			setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
			setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
			ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
			{
				ifvarl RANKPOINTSTEMP 1 { setvar RANKPOINTSTEMP 1 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
				ifvarg RANKPOINTSTEMP 95887 { setvar RANKPOINTSTEMP 95887 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
			}
			else
			{
				ifvarl RANKPOINTSTEMP 1 { setvar RANKPOINTSTEMP 1 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
				ifvarg RANKPOINTSTEMP 26151 { setvar RANKPOINTSTEMP 26151 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
			}
		}
	
		setvarvar tempc RANKPOINTSTEMP
		setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [level]
		setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [level]
		ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2 divvar tempc 10 else divvar tempc 4
		randvarvar tempd tempc
		ifrnd 128 subvarvar RANKPOINTSTEMP tempd else addvarvar RANKPOINTSTEMP tempd
	
		setvar TEMPVAR 1
		setvar MISCARRAYID 85 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // FOUND-A-SECRET
		stopsound FOUND_SECRET
		stopsound FOUND_ALLSECRETS
	
		setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
		setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
		ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2 globalsound FOUND_ALLSECRETS else globalsound FOUND_SECRET
		state expmulti
		ifvarl RANKPOINTSTEMP 1 { setvar RANKPOINTSTEMP 1 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
		ifvarg RANKPOINTSTEMP 2000000 { setvar RANKPOINTSTEMP 2000000 setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP }
		addvarvar RANKPOINTS RANKPOINTSTEMP
	
		setvar RANKPOINTSTEMP 0
	
		randvar TEMPVAR5 3
		setvarvar fta fta_normal setvar ftq 9
		setvar SECRETCHECKFLAG 32766
		setactorvar[SECTORSECRETCHECK].SECTORISASECRET? SECRETCHECKFLAG
	}

 
	setvar MISCARRAYID 4 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // Secrets Found [Level]
	setvar MISCARRAYID 6 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2  // Max Secrets Found [Level]
	ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
	{
		ifvarg MISCARRAYID_AMOUNTTEMP2 0
		{
			setvar MISCARRAYID 84 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP  // FOUND-A-SECRET
			ifvare MISCARRAYID_AMOUNTTEMP 0
			{
				redefinequote 9 ^17YOU FOUND ALL OF THE SECRET PLACES!  
				setvar MISCARRAYID 84 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1  // FOUND-A-SECRET
			}
		}
		else state showsecretmessages
	}
	else state showsecretmessages

	ifvare CHARACTERSELECTED? 1 redefinequote 80 ^17MIGHTY FOOT ENGAGED
	ifvare CHARACTERSELECTED? 2 redefinequote 80 ^17SLEDGE HAMMER ENGAGED
	ifvare CHARACTERSELECTED? 3 redefinequote 80 ^17KILLER KLAWS ENGAGED
	ifvare CHARACTERSELECTED? 4 redefinequote 80 ^17MARTIAL ARTS ENGAGED
	ifvare CHARACTERSELECTED? 5 redefinequote 80 ^17KATANA ENGAGED
	ifvare CHARACTERSELECTED? 6 redefinequote 80 ^17RAZOR CLAWS ENGAGED
	ifvare CHARACTERSELECTED? 7 redefinequote 80 ^17RAPIER SWORD ENGAGED
	ifvare CHARACTERSELECTED? 8 redefinequote 80 ^17NUNCHAKU ENGAGED
	ifvare CHARACTERSELECTED? 9 redefinequote 80 ^17CLAW GRIPPERS ENGAGED
	ifvare CHARACTERSELECTED? 10 
	{
		setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 0 redefinequote 80 ^17SLASHING CLAWS ENGAGED
		else redefinequote 80 ^17MARTIAL ARTS ENGAGED
	}
	ifvare CHARACTERSELECTED? 11 redefinequote 80 ^17FRYING PAN ENGAGED
	ifvare CHARACTERSELECTED? 12 redefinequote 80 ^17ROSHAKUBO ENGAGED
	ifvare CHARACTERSELECTED? 13 redefinequote 80 ^17MARTIAL ARTS ENGAGED
	ifvare CHARACTERSELECTED? 14 redefinequote 80 ^17ENERGY SABRE ENGAGED
	ifvare CHARACTERSELECTED? 15 redefinequote 80 ^17PUNCH-DAGGER ENGAGED
	
	
	ifvare sector[PLAYERSECTOR].lotag 666 state killallcharacters
	
	// This is for the initial changes to the player on each restart
	ifvarn INITPLAYER 1
	{ 
		setactor[PLAYERID].extra 16384
		setplayer[THISACTOR].ammo_amount 1 12 // 1 Ammo Pick Up, opposed to the usual 4 you start with
		setplayer[THISACTOR].ammo_amount 2 10 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 3 50 // +1 Ammo Pick Up 
		setplayer[THISACTOR].ammo_amount 4 5 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 5 5 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 6 5 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 7 15 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 8 1 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 9 25 // +1 Ammo Pick Up
		setplayer[THISACTOR].ammo_amount 11 20 // +1 Ammo Pick Up
		setplayer[THISACTOR].gotweapon 1 1
		setplayer[THISACTOR].gotweapon 2 1
		setplayer[THISACTOR].gotweapon 3 1
		setplayer[THISACTOR].gotweapon 4 1
		setplayer[THISACTOR].gotweapon 5 1
		setplayer[THISACTOR].gotweapon 6 1
		setplayer[THISACTOR].gotweapon 7 1
		setplayer[THISACTOR].gotweapon 8 1
		setplayer[THISACTOR].gotweapon 9 1
		setplayer[THISACTOR].gotweapon 11 1
		// setplayer[THISACTOR].knuckle_incs 21
		setvar MISCARRAYID 25 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // SWITCHOVER-DELAY
		setvar INITPLAYER 1  
	}

	ifvarand CHEATBITFIELD? 32
	{ 
		ifvare mainmenu 0 palfrom 16 64 64 64 // White Hue indicates God Mode
		setplayer[THISACTOR].hurt_delay 12
		setplayer[THISACTOR].falling_counter 0
		setactor[PLAYERID].htextra -1
		ifvarvarl CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
	
		setvar CHARACTERARRAY 1 state checkplayermaxhp
		setvar CHARACTERARRAY 2 state checkplayermaxhp
		setvar CHARACTERARRAY 3 state checkplayermaxhp
		setvar CHARACTERARRAY 4 state checkplayermaxhp
		setvar CHARACTERARRAY 5 state checkplayermaxhp
		setvar CHARACTERARRAY 6 state checkplayermaxhp
		setvar CHARACTERARRAY 7 state checkplayermaxhp
		setvar CHARACTERARRAY 8 state checkplayermaxhp
		setvar CHARACTERARRAY 9 state checkplayermaxhp
		setvar CHARACTERARRAY 10 state checkplayermaxhp
		setvar CHARACTERARRAY 11 state checkplayermaxhp
		setvar CHARACTERARRAY 12 state checkplayermaxhp
		setvar CHARACTERARRAY 13 state checkplayermaxhp
		setvar CHARACTERARRAY 14 state checkplayermaxhp
		setvar CHARACTERARRAY 15 state checkplayermaxhp
	}

	// Forcefield & Cacti Handling
	ifvare player[THISACTOR].hurt_delay 16
	{
		stopsound DUKE_LONGTERM_PAIN // Blargh Blargh Blargh! X_X [keep this here so characters can make their pain sounds, dummy! XD]
		ifvare oldskoolmode 0
		{
			randvar TEMPVAR 5
			addvar TEMPVAR 5
			setvarvar temp SKILLLEVEL
			addvar temp 1
			mulvarvar TEMPVAR temp
			divvar TEMPVAR 2
		}
		else
		{
			randvar TEMPVAR 1
			addvar TEMPVAR 5
			mulvarvar TEMPVAR MAXHITPOINTS
			divvar TEMPVAR 100
		}
		
		//*********************
		//*Check Malakian Gems*
		//*********************
		setvarvar TEMP7 TEMPVAR
		state malakiangemcheck 
		setvarvar TEMPVAR TEMP7
		
		randvar tempc 4
		addvar tempc 4
		subvarvar freezetimer tempc
		ifvarl freezetimer 0 setvar freezetimer 0
		
		ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarl TEMPVAR 1 { setvar TEMPVAR 1 } state cheatersound }
		ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
		else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
		subvarvar CURRENTHITPOINTS TEMPVAR
		state checkbuddhamode
		ifvarn player[THISACTOR].over_shoulder_on 0
		{
			ifvarg TEMPVAR 0
			{
				setvarvar SHOWDAMAGE TEMPVAR
				setvar SHOWDAMAGETYPE 0
				setvarvar SHOWDAMAGEACTORID THISACTOR
				state showdamage
			}
		}
		
		findnearsprite 911 844 tempb // Checks to see if there's a Cactus in close promixity...
		ifvarn tempb -1 // If there is, display the Cactus sprite in the attacker's display with the proper palette
		{
			setvar ATTACKINGACTORPICNUM 911
			setvarvar ATTACKINGACTORPAL wall[tempb].pal
			setvar ACTORCRITICAL? 0
		}
		else // if it's not a cactus, then it can only be a Forcefield
		{
			setvar ATTACKINGACTORPICNUM W_FORCEFIELD
			move 1
			getactor[THISACTOR].htmovflag tempb
			setvarvar ATTACKINGACTORPAL wall[tempb].pal
			setvar ACTORCRITICAL? 0
		}
		
		setactor[THISACTOR].htpicnum -1
		setvarvar PLAYERDAMAGETEMP TEMPVAR
		setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
		setvar ATTACKERDISPLAYTIMER 0
		ifvarg TEMPVAR 0
		{
			setvarvar PAINSOUNDFACTOR TEMPVAR
			state checkpainfactor
			state characterpainsounds
		
			setvarvar DAMAGEHUEFACTOR TEMPVAR
			setvar ACTORCRITICAL? 0
			findnearsprite 911 844 tempb // Checks to see if there's a Cactus in close promixity...
			ifvarn tempb -1 state playerdamagehues-normaltype else state playerdamagehues-electrictype
		
			setvar HEALTHDAMAGETIMER 0
		}
		setvar NULLDAMAGE 0
		
		setactor[PLAYERID].extra 16384
		setplayer[THISACTOR].hurt_delay 15
	}
	ifvare player[THISACTOR].hurt_delay 17 setplayer[THISACTOR].hurt_delay 15
	
	// Custom Oxygen System
	ifvarn sector[PLAYERSECTOR].lotag 2 state playerairrestorecheck
	ifvare sector[PLAYERSECTOR].lotag 2
	{
		setvar MISCARRAYID 25 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SWITCHOVER-DELAY
		ifvare MISCARRAYID_AMOUNTTEMP 0 
		{ 
			ifvare mainmenu 1 nullop
			else
			{
				ifvarl SCUBATIME 1
				{
					ifvare INVULNTIME 0
					{
						ifvarg AIRTIME 0
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								ifvarn VEHICLEID -1 
								{
									ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
									else
									{
										ifvare CHARACTERSELECTED? 8
										{
											ifvare HAVEENERGYSHIELD? 1
											{
												ifvare ENERGYSHIELDMODE 1
												{
													ifvare ESHIELDADVANCEMENT 1
													{
														setvarvar TEMPVAR5 MAXHITPOINTS
														mulvar TEMPVAR5 8
														subvar TEMPVAR5 1
														ifvarvarg CURRENTBIOSHIELDPOWER TEMPVAR5
														{
															setvar TEMPVAR4 334
															state airtimedrain-checkequips
								
															state airtimedrain-checkextratics
														}
														else
														{
															setvar TEMPVAR4 1000
															state airtimedrain-checkequips
								
															state airtimedrain-checkextratics
														}
													}
													else
													{
														setvar TEMPVAR4 1000
														state airtimedrain-checkequips
							
														state airtimedrain-checkextratics
													}
												}
												else
												{
													setvar TEMPVAR4 1000
													state airtimedrain-checkequips
							
													state airtimedrain-checkextratics
												}
											}
											else subvar AIRTIME 1 
											{
												setvar TEMPVAR4 1000
												state airtimedrain-checkequips
						
												state airtimedrain-checkextratics
											}
										}
										else
										{
											// CHARACTER SPECFIC CHECKS :P
											ifvare CHARACTERSELECTED? 3 // Bubsy
											{
												setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
												ifvare MISCARRAYID_AMOUNTTEMP 1 { setplayer[THISACTOR].scuba_on 0 } // Do NOT drain Bubsy's air if he has the Diving Suit on, even if he has no Scuba Tank
												else
												{
													setvar TEMPVAR4 1000
													state airtimedrain-checkequips
							
													state airtimedrain-checkextratics
												}
											}
											else
											{
												setvar TEMPVAR4 1000
												state airtimedrain-checkequips
						
												state airtimedrain-checkextratics
											}
					
										}
									}
								}
								else
								{
									ifvare CHARACTERSELECTED? 8
									{
										ifvare HAVEENERGYSHIELD? 1
										{
											ifvare ENERGYSHIELDMODE 1
											{
												ifvare ESHIELDADVANCEMENT 1
												{
													setvarvar TEMPVAR5 MAXHITPOINTS
													mulvar TEMPVAR5 8
													subvar TEMPVAR5 1
													ifvarvarg CURRENTBIOSHIELDPOWER TEMPVAR5
													{
														setvar TEMPVAR4 334
														state airtimedrain-checkequips
							
														state airtimedrain-checkextratics
													}
													else
													{
														setvar TEMPVAR4 1000
														state airtimedrain-checkequips
							
														state airtimedrain-checkextratics
													}
												}
												else
												{
													setvar TEMPVAR4 1000
													state airtimedrain-checkequips
						
													state airtimedrain-checkextratics
												}
											}
											else
											{
												setvar TEMPVAR4 1000
												state airtimedrain-checkequips
						
												state airtimedrain-checkextratics
											}
										}
										else
										{
											setvar TEMPVAR4 1000
											state airtimedrain-checkequips
					
											state airtimedrain-checkextratics
										}
									}
									else
									{
										// CHARACTER SPECFIC CHECKS :P
										ifvare CHARACTERSELECTED? 3 // Bubsy
										{
											setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
											ifvare MISCARRAYID_AMOUNTTEMP 1 { setplayer[THISACTOR].scuba_on 0 } // Do NOT drain Bubsy's air if he has the Diving Suit on, even if he has no Scuba Tank
											else
											{
												setvar TEMPVAR4 1000
												state airtimedrain-checkequips
						
												state airtimedrain-checkextratics
											}
										}
										else
										{
											setvar TEMPVAR4 1000
											state airtimedrain-checkequips
					
											state airtimedrain-checkextratics
										}
									}
								}
							} 
						}
					}
					else state playerairrestorecheck
					ifvarl AIRTIME 0 setvar AIRTIME 0
				}
				else
				{
					ifvarn VEHICLEID -1 
					{
						ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 setplayer[THISACTOR].scuba_on 0
					}
					else
					{
						ifvare INVULNTIME 0
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								// CHARACTER SPECFIC CHECKS :P
								ifvare CHARACTERSELECTED? 3 // Bubsy
								{
									setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
									ifvare MISCARRAYID_AMOUNTTEMP 1 { setplayer[THISACTOR].scuba_on 0 } // Do NOT drain Bubsy's air if he has the Diving Suit on, even if he has no Scuba Tank
									else
									{
										subvar SCUBATIME 1
										ifvarl SCUBATIME 0 setvar SCUBATIME 0
									}
								}
								else
								{
									subvar SCUBATIME 1
									ifvarl SCUBATIME 0 setvar SCUBATIME 0
								}
							}
						}
					}
				}
			}
		}
	
		// MAKES CHARACTERS RISE/SINK IN WATER SECTORS WHEN IDLE
		ifvare mainmenu 0 
		{
			ifvarand bits 1 nullop
			else ifvarand bits 2 nullop
			else
			{
				ifvarn VEHICLEID -1
				{
					ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
					{
						getsector[THISACTOR].floorz TEMPVAR3
						getactor[THISACTOR].x x
						getactor[THISACTOR].y y
						updatesector x y TEMP
						getflorzofslope TEMP x y TEMPVAR3
						setvarvar TEMPVAR4 TEMPVAR3
						addvar TEMPVAR4 -9800
						getplayer[THISACTOR].posz TEMPVAR5
						ifvarvarl TEMPVAR5 TEMPVAR4 // Above
						{
							ifvare posxv 0 
							{
								ifvare posyv 0 setplayer[THISACTOR].poszv 2688
								else setplayer[THISACTOR].poszv 896
							}
							else setplayer[THISACTOR].poszv 896
						}
						else setplayer[THISACTOR].posz TEMPVAR4 // Below
					}
				}
				else
				{
					ifvare CHARACTERSELECTED? 1 // Duke
					{
						setplayer[THISACTOR].poszv 352
					}
					else
					ifvare CHARACTERSELECTED? 2 // Jack
					{
						setplayer[THISACTOR].poszv -288
					}
					else
					ifvare CHARACTERSELECTED? 3 // Bubsy
					{
						setvar MISCARRAYID 231 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-DIVINGSUIT?
						ifvare MISCARRAYID_AMOUNTTEMP 1 // Makes Bubsy heavy as hell in the water when wearing the Diving Suit.
						{
							setplayer[THISACTOR].poszv 480
						}
						else
						{
							setplayer[THISACTOR].poszv -320
						}
					}
					else
					ifvare CHARACTERSELECTED? 5 // Lo Wang
					{
						setplayer[THISACTOR].poszv 288
					}
					else
					ifvare CHARACTERSELECTED? 6 // ESSence
					{
						setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0 // Makes ESSence heavy with his armor equipped
						{
							setplayer[THISACTOR].poszv 896
						}
						else ifvare MISCARRAYID_AMOUNTTEMP 1 // Makes him less heavy without the armor equipped
						{
							setplayer[THISACTOR].poszv 448
						}
					}
					else
					ifvare CHARACTERSELECTED? 7 // Ted
					{
						setplayer[THISACTOR].poszv -288
					}
					else
					ifvare CHARACTERSELECTED? 8 // Lisa
					{
						setplayer[THISACTOR].poszv -352
					}
					else
					ifvare CHARACTERSELECTED? 9 // Cybanis
					{
						setplayer[THISACTOR].poszv 416
					}
					else
					ifvare CHARACTERSELECTED? 11 // Paula
					{
						setplayer[THISACTOR].poszv -384
					}
					else
					ifvare CHARACTERSELECTED? 12 // Lori
					{
						setplayer[THISACTOR].poszv -352
					}
					else
					ifvare CHARACTERSELECTED? 13 // Minako
					{
						setplayer[THISACTOR].poszv -320
					}
					else
					ifvare CHARACTERSELECTED? 15 // Maken
					{
						setplayer[THISACTOR].poszv -384
					}
					//  Ami has equal buyoncy in the water
					//  Nethra has equal buyoncy in the water
					//  "Mystery Woman" has equal buyoncy in the water
				}
			}
		}
	
		// AIR TIME EFFECTS
	
		// JETPACK Bubble effect
		ifp pjetpack
		{
			ifvarand bits 1
			{
				ifvare mainmenu 0 addvar JETPACKBUBBLEVAR 1
				ifvarg JETPACKBUBBLEVAR 7
				{
					state jetpackbubbles
					setvar JETPACKBUBBLEVAR 0
				}
			}
	
			ifvarand bits 2
			{
				ifvare mainmenu 0 addvar JETPACKBUBBLEVAR 1
				ifvarg JETPACKBUBBLEVAR 7
				{
				state jetpackbubbles
				setvar JETPACKBUBBLEVAR 0
				}
			}
	
			ifvarand bits 3 nullop
			else
			{
				ifvare mainmenu 0 addvar JETPACKBUBBLEVAR 1
				ifvarg JETPACKBUBBLEVAR 15
				{
				state jetpackbubbles
				setvar JETPACKBUBBLEVAR 0
				}
			}
	
		}
	}
	
	// MAIN EFFECT for Underwater Airtime stuff >.>
	ifvare mainmenu 0
	{
		ifvarg SCUBATIME 0
		{
			ifvarvarl AIRTIME MAXAIRTIME
			{
				addvar AIRTICCOUNTER 1
				ifvare AIRTICCOUNTER 1
				{
					setvarvar TEMPVAR5 MAXAIRTIME
					divvar TEMPVAR5 130
					ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
					ifvare mainmenu 0 
					ifvarg CURRENTHITPOINTS 0 // ifp palive 
					{
						ifvarvarl SCUBATIME TEMPVAR5
						{
							addvarvar AIRTIME SCUBATIME
							ifvarvarg AIRTIME MAXAIRTIME 
							{
								setvarvar TEMPVAR AIRTIME 
								subvarvar TEMPVAR MAXAIRTIME 
								addvarvar SCUBATIME TEMPVAR
								setvarvar AIRTIME MAXAIRTIME
								setvar AIRTIMEEXTRA 1000
							}
							else setvar SCUBATIME 0
						}
						else
						{
							ifvarvarg AIRTIME MAXAIRTIME 
							{
								setvarvar TEMPVAR AIRTIME 
								subvarvar TEMPVAR MAXAIRTIME 
								addvarvar SCUBATIME TEMPVAR
								setvarvar AIRTIME MAXAIRTIME
								setvar AIRTIMEEXTRA 1000
							}
							else
							{
								addvarvar AIRTIME TEMPVAR5
								subvarvar SCUBATIME TEMPVAR5
							}
						}
					}
					setvar AIRTICCOUNTER 0
				}
			}
			else ifvarvare AIRTIME MAXAIRTIME nullop
			else
			ifvarvarg AIRTIME MAXAIRTIME 
			{
				setvarvar TEMPVAR AIRTIME 
				subvarvar TEMPVAR MAXAIRTIME 
				addvarvar SCUBATIME TEMPVAR
				setvarvar AIRTIME MAXAIRTIME
				setvar AIRTIMEEXTRA 1000
			}
		}
		else
		{
			ifvarn VEHICLEID -1
			{
				ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 state playerairrestorecheck
			}
		}
	}

	// DROWNING, DUDE.
	ifvare AIRTIME 0
	{
		ifvare mainmenu 0 addvar AIRTICCOUNTER2 1
		ifvare AIRTICCOUNTER2 8
		{
			ifvarg INVULNTIME 0 nullop
			else
			{
				randvar TEMPVAR8 3
				addvarvar DROWNDMGFACTOR TEMPVAR8
				setvarvar TEMPVAR2 MAXHITPOINTS
				mulvarvar TEMPVAR2 DROWNDMGFACTOR
				divvar TEMPVAR2 1000
		
				//*********************
				//*Check Malakian Gems*
				//*********************
				setvarvar TEMP7 TEMPVAR2
				state malakiangemcheck 
				setvarvar TEMPVAR2 TEMP7
		
				state drowndamage-checkequips
		
				ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR2 1000 ifvarl TEMPVAR2 1 setvar TEMPVAR2 1 state cheatersound }
				subvarvar CURRENTHITPOINTS TEMPVAR2
				state checkbuddhamode
				ifvarl TEMPVAR2 0 setvar PLAYERHPDAMAGED? -1
				else ifvarg TEMPVAR2 0 setvar PLAYERHPDAMAGED? 1
		
				ifvarand CHEATBITFIELD? 32 nullop else
				{
					ifvarg CURRENTHITPOINTS 0 
					{
						setvarvar DAMAGEHUEFACTOR TEMPVAR2
						state playerdamagehues-watertype
			
						setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
						ifvare TEMPHITCHARACTERVAR 5 setvarvar ATTACKINGACTORPICNUM 6909
						else setvarvar ATTACKINGACTORPICNUM 6910
						setvar ATTACKINGACTORPAL 0
						setvar ACTORCRITICAL? 0
						setactor[THISACTOR].htpicnum -1
						setvarvar PLAYERDAMAGETEMP TEMPVAR2
						state showdamage_player-drown
						ifvarg TEMPVAR2 0 setvar HEALTHDAMAGETIMER 0
						setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
			
						ifrnd 192
						{
							ifrnd 128
							{ 
								stopsound SOMEONE_DROWNING1 
								stopsound SOMEONE_DROWNING2 
							}
							ifrnd 128 sound SOMEONE_DROWNING1 else sound SOMEONE_DROWNING2
						}
						ifvare CHARACTERSELECTED? 5 // Higa
						{
							ifrnd 4 stopsound WANG_DROWNING1
							globalsound WANG_DROWNING1
						}
						ifvare CHARACTERSELECTED? 8 // Lisa
						{
							ifrnd 16
							{
								stopsound LISA_DROWNING1
								stopsound LISA_DROWNING2
								stopsound LISA_DROWNING3
								stopsound LISA_DROWNING4
							}
							randvar RNDVOICE 3
							ifvare RNDVOICE 0 globalsound LISA_DROWNING1
							ifvare RNDVOICE 1 globalsound LISA_DROWNING2
							ifvare RNDVOICE 2 globalsound LISA_DROWNING3
							ifvare RNDVOICE 3 globalsound LISA_DROWNING4
						}
						ifvare CHARACTERSELECTED? 15 // Maken
						{
							ifrnd 16
							{
								stopsound MAKEN_DROWNING1
								stopsound MAKEN_DROWNING2
								stopsound MAKEN_DROWNING3
								stopsound MAKEN_DROWNING4
							}
							randvar RNDVOICE 3
							ifvare RNDVOICE 0 globalsound MAKEN_DROWNING1
							ifvare RNDVOICE 1 globalsound MAKEN_DROWNING2
							ifvare RNDVOICE 2 globalsound MAKEN_DROWNING3
							ifvare RNDVOICE 3 globalsound MAKEN_DROWNING4
						}
					}
					else 
					{
						stopsound SOMEONE_DROWNING1
						stopsound SOMEONE_DROWNING2
						stopsound SOMEONE_DROWNED1
						stopsound SOMEONE_DROWNED2
						ifrnd 128 globalsound SOMEONE_DROWNED1 else globalsound SOMEONE_DROWNED2
			
						ifvare CHARACTERSELECTED? 8 { ifrnd 128 globalsound LISA_DROWNDEATH1 else globalsound LISA_DROWNDEATH2 }
						ifvare CHARACTERSELECTED? 15 { ifrnd 128 globalsound MAKEN_DROWNDEATH1 else globalsound MAKEN_DROWNDEATH2 }
						setvarvar CURRENTHITPOINTS 0
					} 
				}
		
			}
			state drownbubbles
			state drownbubbles
			setvar AIRTICCOUNTER2 0
		}
	}
	else setvar DROWNDMGFACTOR 10

	/*
	ifvarn hitsector -1 
	{
	}
	*/
	
	ifvarn hitwall -1 
	{
		// x coords
		setvar MISCARRAYID 208 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-x
		setvar MISCARRAYID 203 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-x
		getwall[hitwall].x MISCARRAYID_AMOUNTTEMP2
		setvar MISCARRAYID 203 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-x
		setvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
		
		setvar MISCARRAYID 205 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
		getwall[hitwall].point2 MISCARRAYID_AMOUNTTEMP2
		setvar MISCARRAYID 205 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
		getwall[MISCARRAYID_AMOUNTTEMP2].x MISCARRAYID_AMOUNTTEMP2
		setvar MISCARRAYID 206 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2-x
		addvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
		
		divvar MISCARRAYID_AMOUNTTEMP 2
		setvar MISCARRAYID 208 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-x
		//addlogvar MISCARRAYID_AMOUNTTEMP
		
		// y coords
		setvar MISCARRAYID 209 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-y
		setvar MISCARRAYID 204 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-y
		getwall[hitwall].y MISCARRAYID_AMOUNTTEMP2
		setvar MISCARRAYID 204 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-y
		setvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
		
		setvar MISCARRAYID 205 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
		getwall[hitwall].point2 MISCARRAYID_AMOUNTTEMP2
		setvar MISCARRAYID 205 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2
		getwall[MISCARRAYID_AMOUNTTEMP2].y MISCARRAYID_AMOUNTTEMP2
		setvar MISCARRAYID 207 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // hitwall-point2-y
		addvarvar MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
		
		divvar MISCARRAYID_AMOUNTTEMP 2
		setvar MISCARRAYID 209 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-y
		//addlogvar MISCARRAYID_AMOUNTTEMP
		
		// other vars
		setvar MISCARRAYID 210 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-hitag
		getwall[hitwall].hitag MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 210 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-hitag
		
		setvar MISCARRAYID 211 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
		getwall[hitwall].lotag MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 211 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
		
		setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		getwall[hitwall].extra MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 212 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		
		setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
		getwall[hitwall].picnum MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 213 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
		
		setvar MISCARRAYID 214 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-overpicnum
		getwall[hitwall].overpicnum MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 214 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-overpicnum
		
		setvar MISCARRAYID 215 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextwall
		getwall[hitwall].nextwall MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 215 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextwall
		
		setvar MISCARRAYID 216 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextsector
		getwall[hitwall].nextsector MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 216 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-nextsector
		
		setvar MISCARRAYID 217 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-cstat
		getwall[hitwall].cstat MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 217 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-cstat
		
		setvar MISCARRAYID 218 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-shade
		getwall[hitwall].shade MISCARRAYID_AMOUNTTEMP
		
		setvar MISCARRAYID 219 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-pal
		getwall[hitwall].pal MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 219 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-pal
		
		setvar MISCARRAYID 220 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xrepeat
		getwall[hitwall].xrepeat MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 220 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xrepeat
		
		setvar MISCARRAYID 221 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-yrepeat
		getwall[hitwall].yrepeat MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 221 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-yrepeat
		
		setvar MISCARRAYID 222 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xpanning
		getwall[hitwall].xpanning MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 222 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-xpanning
		
		setvar MISCARRAYID 223 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-ypanning
		getwall[hitwall].ypanning MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 223 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-ypanning
	}

	ifvarn hitsprite -1 
	{ 
		getactor[hitsprite].statnum TARGETTYPE
		getactor[hitsprite].picnum TARGETSPECIES
		getactor[hitsprite].pal TARGETPAL
	}

	ifvare mainmenu 0
	{
		ifvare shop_id -1
		{
			getplayer[THISACTOR].posx posx 
			getplayer[THISACTOR].posy posy 
			getplayer[THISACTOR].posxv posxv
			getplayer[THISACTOR].posyv posyv 
			getplayer[THISACTOR].jumping_counter jumpcountertemp
			getplayer[THISACTOR].falling_counter fallcountertemp
		}
		else
		ifvare atm_id -1
		{
			getplayer[THISACTOR].posx posx 
			getplayer[THISACTOR].posy posy 
			getplayer[THISACTOR].posxv posxv
			getplayer[THISACTOR].posyv posyv 
			getplayer[THISACTOR].jumping_counter jumpcountertemp
			getplayer[THISACTOR].falling_counter fallcountertemp
		}
		else
		{
			setplayer[THISACTOR].posxv 0 // Completely Halts X movement when menu is open
			setplayer[THISACTOR].posyv 0 // Completely Halts Y movement when menu is open
			setplayer[THISACTOR].poszv -256 // -256 is needed to freeze the player in the air when the menu is open
			setplayer[THISACTOR].falling_counter fallcountertemp // Locks the fall counter so players don't abuse the menu to evade fall damage/death
		} 
	}
	else
	ifvare mainmenu 1 
	{
		setplayer[THISACTOR].posxv 0 // Completely Halts X movement when menu is open
		setplayer[THISACTOR].posyv 0 // Completely Halts Y movement when menu is open
		setplayer[THISACTOR].poszv -256 // -256 is needed to freeze the player in the air when the menu is open
		setplayer[THISACTOR].falling_counter fallcountertemp // Locks the fall counter so players don't abuse the menu to evade fall damage/death
	}
	else
	ifvare mainmenu -1 
	{
		setplayer[THISACTOR].posxv 0 // Completely Halts X movement when menu is open
		setplayer[THISACTOR].posyv 0 // Completely Halts Y movement when menu is open
		setplayer[THISACTOR].poszv -256 // -256 is needed to freeze the player in the air when the menu is open
		setplayer[THISACTOR].falling_counter fallcountertemp // Locks the fall counter so players don't abuse the menu to evade fall damage/death
	}

	//********************************************************
	//*Usable Walls (Vending Machines/Cola Machines/ATMs/Etc)*
	//********************************************************

	setvar MISCARRAYID 208 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-x
	setvarvar wallxdist MISCARRAYID_AMOUNTTEMP
	subvarvar wallxdist posx
	
	setvar MISCARRAYID 209 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-center-y
	setvarvar wallydist MISCARRAYID_AMOUNTTEMP
	subvarvar wallydist posy
	
	//addlogvar wallxdist
	//addlogvar wallydist
	
	// Broken ATM Machine [867]
	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	ifvare MISCARRAYID_AMOUNTTEMP 867 
	{
		setvar MISCARRAYID 211 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
		ifvarn MISCARRAYID_AMOUNTTEMP 16384 ifvare oldskoolmode 0
		{
			ifvarg wallxdist ATMMACHINEMINDIST ifvarl wallxdist ATMMACHINEMAXDIST ifvarg wallydist ATMMACHINEMINDIST ifvarl wallydist ATMMACHINEMAXDIST ifvarg CURRENTHITPOINTS 0 // ifp palive
			{
				ifhitspace
				{ 
					state stopsearchsounds
					ifvare com_pause 0
					{
						ifvare atm_id -1
						{
							setvarvar atm_id hitwall
							setvar atm_type 2
							setvar atm_mode 0
							randvar atm_background 47
							randvar atm_wscreen 3
							addvar atm_wscreen 1
							randvar atm_extquote 21
						}
						setvar com_pause 39
					}
				}
			}
		}
	} 

	// Broken ATM Machine [888]
	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	ifvare MISCARRAYID_AMOUNTTEMP 888 
	{
		setvar MISCARRAYID 211 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-lotag
		ifvarn MISCARRAYID_AMOUNTTEMP 16384 ifvare oldskoolmode 0
		{
			ifvarg wallxdist ATMMACHINEMINDIST ifvarl wallxdist ATMMACHINEMAXDIST ifvarg wallydist ATMMACHINEMINDIST ifvarl wallydist ATMMACHINEMAXDIST ifvarg CURRENTHITPOINTS 0 // ifp palive
			{
				ifhitspace
				{ 
					state stopsearchsounds
					ifvare com_pause 0
					{
						ifvare CHARACTERSELECTED? 8
						{
							ifvarg DOLLARS 10499 ifvarg CURRENTENERGYPOINTS 39
							{
								setwall[hitwall].picnum 867 // fix the ATM machine :P
								sound MENU_ENTER
								ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 40
								subvar DOLLARS 10500
								subvar DISPLAYDOLLARS 10500
								state displaymoney
								setvarvar ARRAYPOSITION hitwall state createmusicsfx_atm
								ifvarand CHEATBITFIELD? 128 redefinequote 321 ^20LISA FIXED THE ATM, FOR A COST OF $10500.00!
								else redefinequote 321 ^20LISA FIXED THE ATM, FOR A COST OF $10500.00 AND 40 EP!
								setvarvar fta fta_normal setvar ftq 321
							}
							else
							{
								sound MENU_ERROR
								state atmbroken_dealdamage
								redefinequote 321 ^10THE ATM MACHINE IS BROKEN!
								setvarvar fta fta_normal setvar ftq 321
							}
						}
						else
						{
							sound MENU_ERROR
							state atmbroken_dealdamage
							redefinequote 321 ^10THE ATM MACHINE IS BROKEN!
							setvarvar fta fta_normal setvar ftq 321
						}
						setvar com_pause 39
					}
				}
			}
		}
	}

	// Snack Machines [1212, 7677, 7678]
	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	setvar TEMP6 0
	ifvare MISCARRAYID_AMOUNTTEMP 1212 setvar TEMP6 1
	ifvare MISCARRAYID_AMOUNTTEMP 7677 setvar TEMP6 1
	ifvare MISCARRAYID_AMOUNTTEMP 7678 setvar TEMP6 1
	ifvare TEMP6 1
	{
		setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		ifvare MISCARRAYID_AMOUNTTEMP -1
		{
			state pressonsnackmachine
		}
	}

	// Broken Snack Machine [1214]
	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	ifvare MISCARRAYID_AMOUNTTEMP 1214
	{
		setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		ifvare MISCARRAYID_AMOUNTTEMP -1 ifvare oldskoolmode 0
		{
			ifvarg wallxdist VENDINGMACHINEMINDIST ifvarl wallxdist VENDINGMACHINEMAXDIST ifvarg wallydist VENDINGMACHINEMINDIST ifvarl wallydist VENDINGMACHINEMAXDIST ifvarg CURRENTHITPOINTS 0 // ifp palive
			{
				ifhitspace
				{ 
					state stopsearchsounds
					ifvare com_pause 0
					{
						ifvare CHARACTERSELECTED? 8
						{
							ifvarg DOLLARS 499 ifvarg CURRENTENERGYPOINTS 9
							{
								setwall[hitwall].picnum 1212 // fix the Vending machine :P
								sound MENU_ENTER
								ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 10
								subvar DOLLARS 500
								subvar DISPLAYDOLLARS 500
								state displaymoney
								setvarvar ARRAYPOSITION hitwall state createmusicsfx_snackcola
								ifvarand CHEATBITFIELD? 128 redefinequote 321 ^20LISA FIXED THE VENDING MACHINE, FOR A COST OF $500.00!
								else redefinequote 321 ^20LISA FIXED THE VENDING MACHINE, FOR A COST OF $500.00 AND 10 EP!
								setvarvar fta fta_normal setvar ftq 321
							}
							else
							{
								sound MENU_ERROR
								redefinequote 321 ^10THE VENDING MACHINE IS BROKEN!
								setvarvar fta fta_normal setvar ftq 321
							}
						}
						else
						{
							sound MENU_ERROR
							redefinequote 321 ^10THE VENDING MACHINE IS BROKEN!
							setvarvar fta fta_normal setvar ftq 321
						}
						setvar com_pause 39
					}
				}
			}
		}
	}


	// Cola Machines [1215, 7636-7676, 7679, 7816-7826]
	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	setvar TEMP6 0
	ifvare MISCARRAYID_AMOUNTTEMP 1215 setvar TEMP6 1
	ifvarg MISCARRAYID_AMOUNTTEMP 7635 ifvarl MISCARRAYID_AMOUNTTEMP 7677 setvar TEMP6 1
	ifvare MISCARRAYID_AMOUNTTEMP 7679 setvar TEMP6 1
	ifvarg MISCARRAYID_AMOUNTTEMP 7815 ifvarl MISCARRAYID_AMOUNTTEMP 7835 setvar TEMP6 1
	ifvare TEMP6 1
	{
		setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		ifvare MISCARRAYID_AMOUNTTEMP -1 state pressoncolamachine
	}

	// Broken Cola Machine [1217]
	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	ifvare MISCARRAYID_AMOUNTTEMP 1217
	{
		setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		ifvare MISCARRAYID_AMOUNTTEMP -1
		{
			ifvare oldskoolmode 0
			{
				ifvarg wallxdist VENDINGMACHINEMINDIST ifvarl wallxdist VENDINGMACHINEMAXDIST ifvarg wallydist VENDINGMACHINEMINDIST ifvarl wallydist VENDINGMACHINEMAXDIST ifvarg CURRENTHITPOINTS 0 // ifp palive
				{
					ifhitspace
					{ 
						state stopsearchsounds
						ifvare com_pause 0
						{
							ifvare CHARACTERSELECTED? 8
							{
								ifvarg DOLLARS 499 ifvarg CURRENTENERGYPOINTS 9
								{
									setwall[hitwall].picnum 1215 // fix the Cola machine :P
									sound MENU_ENTER
									subvar DOLLARS 500
									subvar DISPLAYDOLLARS 500
									ifvarand CHEATBITFIELD? 128 nullop else subvar CURRENTENERGYPOINTS 10
									state displaymoney
									setvarvar ARRAYPOSITION hitwall state createmusicsfx_snackcola
									ifvarand CHEATBITFIELD? 128 redefinequote 321 ^20LISA FIXED THE COLA MACHINE, FOR A COST OF $500.00!
									else redefinequote 321 ^20LISA FIXED THE COLA MACHINE, FOR A COST OF $500.00 AND 10 EP!
									setvarvar fta fta_normal setvar ftq 321
								}
								else
								{
									sound MENU_ERROR
									redefinequote 321 ^10THE COLA MACHINE IS BROKEN!
									setvarvar fta fta_normal setvar ftq 321
								}
							}
							else
							{
								sound MENU_ERROR
								redefinequote 321 ^10THE COLA MACHINE IS BROKEN!
								setvarvar fta fta_normal setvar ftq 321
							}
							setvar com_pause 39
						}
					}
				}
			}
		}
	}

	setvar MISCARRAYID 213 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-picnum
	ifvarg MISCARRAYID_AMOUNTTEMP 10495 ifvarl MISCARRAYID_AMOUNTTEMP 10750
	{
		setvar MISCARRAYID 212 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-extra
		ifvare MISCARRAYID_AMOUNTTEMP -1
		{
			ifvare oldskoolmode 0
			{
				ifvarg wallxdist -845 ifvarl wallxdist 845 ifvarg wallydist -845 ifvarl wallydist 845 ifvarg CURRENTHITPOINTS 0 // ifp palive
				{
					ifhitspace
					{ 
						state stopsearchsounds
						state getpartime
						addvar upresstime 1
						ifvarvare temppartime upresstime nullop
						else { sound MENU_SELECTED setvarvar ARRAYPOSITION hitwall state swapscreen1 }
						setvarvar upresstime temppartime
					}
				}
			}
		}
	}

	// Code for Regenerating Player-Character's HP/AP/EP when below 100%
	ifvare oldskoolmode 0
	{
		ifvare mainmenu 0
		{
			state playerregenhealthnormal
			state playerregenarmornormal
			state playerregenenergynormal
		}
	}
	// End Code for Regenerating HP/AP/EP

	ifvare oldskoolmode 1
	{
		redefinequote 12 ^19USED STEROIDS
		redefinequote 90 ^20STEROIDS
		ifvarg CURRENTHITPOINTS 0 setvar PLAYERSTATUS? 0
	}

	ifvarand PLAYERSTATUS? 2 // Haste
	{ 
		ifvare CHARACTERSELECTED? 14
		{
			ifvare PUBLICBETA? 0
			{
				setvar WEAPON0_FIREDELAY 2
				setvar WEAPON0_TOTALTIME 4
			}
			else
			{
				setvar WEAPON0_FIREDELAY 5
				setvar WEAPON0_TOTALTIME 10
			}
		}
		else
		{
			setvar WEAPON0_FIREDELAY 5
			setvar WEAPON0_TOTALTIME 10
		}
		setvar WEAPON1_TOTALTIME 4 // 6
		setvar WEAPON2_TOTALTIME 15 // 21
		ifvare CHAINGUNMODE 0 setvar WEAPON3_TOTALTIME 14 else setvar WEAPON3_TOTALTIME 13
		setvar WEAPON4_TOTALTIME 14 // 20
		setvar WEAPON5_TOTALTIME 14 // 19
		setvar WEAPON6_TOTALTIME 9 // 12
		setvar WEAPON7_TOTALTIME 4 // 5
		setvar WEAPON8_TOTALTIME 29 // 40
		setvar WEAPON9_TOTALTIME 10 // 8
		setvar WEAPON10_TOTALTIME 7 // 10
		setvar WEAPON11_TOTALTIME 4 // 5
	} 
	
	ifvarand PLAYERSTATUS? 4 // Slowed
	{ 
		ifvare CHARACTERSELECTED? 14
		{
			ifvare PUBLICBETA? 0
			{
				setvar WEAPON0_FIREDELAY 4
				setvar WEAPON0_TOTALTIME 8
			}
			else
			{
				setvar WEAPON0_FIREDELAY 9
				setvar WEAPON0_TOTALTIME 18
			}
		}
		else
		{
			setvar WEAPON0_FIREDELAY 9
			setvar WEAPON0_TOTALTIME 18
		}
		setvar WEAPON1_TOTALTIME 8 // 6
		setvar WEAPON2_TOTALTIME 27 // 21
		ifvare CHAINGUNMODE 0 setvar WEAPON3_TOTALTIME 8 else setvar WEAPON3_TOTALTIME 7
		setvar WEAPON4_TOTALTIME 26 // 20
		setvar WEAPON5_TOTALTIME 24 // 19
		setvar WEAPON6_TOTALTIME 15 // 12
		setvar WEAPON7_TOTALTIME 6 // 5
		setvar WEAPON8_TOTALTIME 51 // 40
		setvar WEAPON9_TOTALTIME 6 // 8
		setvar WEAPON10_TOTALTIME 13 // 10
		setvar WEAPON11_TOTALTIME 6 // 5
	}

	ifvarand PLAYERSTATUS? 6 nullop
	else // If neither Haste or Slow is detected, revert to normal shooting times
	{
		ifvare CHARACTERSELECTED? 14
		{
			ifvare PUBLICBETA? 0
			{
				setvar WEAPON0_FIREDELAY 3
				setvar WEAPON0_TOTALTIME 6
			}
			else
			{
				setvar WEAPON0_FIREDELAY 7
				setvar WEAPON0_TOTALTIME 14
			}
		}
		else
		{
			setvar WEAPON0_FIREDELAY 7
			setvar WEAPON0_TOTALTIME 14
		}
		setvar WEAPON1_TOTALTIME 6 // 6 [Pistol]
		setvar WEAPON2_TOTALTIME 21 // 21 [Shotgun]
		setvar WEAPON3_TOTALTIME 10 // 10 [Chaingun] (reverse)
		setvar WEAPON4_TOTALTIME 20 // 20
		setvar WEAPON5_TOTALTIME 19 // 19
		setvar WEAPON6_TOTALTIME 12 // 12
		setvar WEAPON7_TOTALTIME 5 // 5
		setvar WEAPON8_TOTALTIME 40 // 40
		setvar WEAPON9_TOTALTIME 8 // 8
		setvar WEAPON10_TOTALTIME 10 // 10
		setvar WEAPON11_TOTALTIME 5 // 5
	}

	ifvarand PLAYERSTATUS? 16
	{
		// Sets a Dim hue over the player's vision to represent "Dimness" status
		getplayer[THISACTOR].player_par temp
		modvar temp 24
		ifvare temp 0 palfrom 60 0 0 0
		ifvare temp 1 palfrom 60 0 0 0
		ifvare temp 2 palfrom 60 0 0 0
		ifvare temp 3 palfrom 60 0 0 0
		
		ifvare temp 4 palfrom 61 0 0 0
		ifvare temp 5 palfrom 61 0 0 0
		ifvare temp 6 palfrom 61 0 0 0
		ifvare temp 7 palfrom 61 0 0 0
		
		ifvare temp 8 palfrom 62 0 0 0
		ifvare temp 9 palfrom 62 0 0 0
		ifvare temp 10 palfrom 62 0 0 0
		ifvare temp 11 palfrom 62 0 0 0
		
		ifvare temp 12 palfrom 63 0 0 0
		ifvare temp 13 palfrom 63 0 0 0
		ifvare temp 14 palfrom 63 0 0 0
		ifvare temp 15 palfrom 63 0 0 0
		
		ifvare temp 16 palfrom 62 0 0 0
		ifvare temp 17 palfrom 62 0 0 0
		ifvare temp 18 palfrom 62 0 0 0
		ifvare temp 19 palfrom 62 0 0 0
		
		ifvare temp 20 palfrom 61 0 0 0
		ifvare temp 21 palfrom 61 0 0 0
		ifvare temp 22 palfrom 61 0 0 0
		ifvare temp 23 palfrom 61 0 0 0
	}

	ifvarand PLAYERSTATUS? 32 // Checks for the Triad Refractor status
	{
		ifvarn CHARACTERSELECTED? 12 subvar PLAYERSTATUS? 32 // Only Lori can use Traid Refractor
	}
	setvar CHARACTERARRAY 1 state charchecktriadrefractor
	setvar CHARACTERARRAY 2 state charchecktriadrefractor
	setvar CHARACTERARRAY 3 state charchecktriadrefractor
	setvar CHARACTERARRAY 4 state charchecktriadrefractor
	setvar CHARACTERARRAY 5 state charchecktriadrefractor
	setvar CHARACTERARRAY 6 state charchecktriadrefractor
	setvar CHARACTERARRAY 7 state charchecktriadrefractor
	setvar CHARACTERARRAY 8 state charchecktriadrefractor
	setvar CHARACTERARRAY 9 state charchecktriadrefractor
	setvar CHARACTERARRAY 10 state charchecktriadrefractor
	setvar CHARACTERARRAY 11 state charchecktriadrefractor
	setvar CHARACTERARRAY 13 state charchecktriadrefractor
	setvar CHARACTERARRAY 14 state charchecktriadrefractor
	setvar CHARACTERARRAY 15 state charchecktriadrefractor

	ifvarand PLAYERSTATUS? 64 // Checks for the Triad Ragnarok status
	{
		ifvarn CHARACTERSELECTED? 12 subvar PLAYERSTATUS? 64 // Only Lori can use Triad Ragnarok
	}
	setvar CHARACTERARRAY 1 state charchecktriadragnarok
	setvar CHARACTERARRAY 2 state charchecktriadragnarok
	setvar CHARACTERARRAY 3 state charchecktriadragnarok
	setvar CHARACTERARRAY 4 state charchecktriadragnarok
	setvar CHARACTERARRAY 5 state charchecktriadragnarok
	setvar CHARACTERARRAY 6 state charchecktriadragnarok
	setvar CHARACTERARRAY 7 state charchecktriadragnarok
	setvar CHARACTERARRAY 8 state charchecktriadragnarok
	setvar CHARACTERARRAY 9 state charchecktriadragnarok
	setvar CHARACTERARRAY 10 state charchecktriadragnarok
	setvar CHARACTERARRAY 11 state charchecktriadragnarok
	setvar CHARACTERARRAY 13 state charchecktriadragnarok
	setvar CHARACTERARRAY 14 state charchecktriadragnarok
	setvar CHARACTERARRAY 15 state charchecktriadragnarok

	ifvarand PLAYERSTATUS? 128 // For spinning around the player's angle and vangle when confused.
	{ 
		ifvare mainmenu 0 // only mess with the view angles when the menu isn't open
		{
			randvar TEMPVAR4 5 // 7
			ifrnd 128 mulvar TEMPVAR4 -1
			addvar TEMPVAR4 20 // 25
		
			addvar CONFUSESWITCHTIMER 1
			ifvarvarg CONFUSESWITCHTIMER TEMPVAR4 // Will randomly set the direction of spinning while confused every second
			{
				randvar CONFUSEDIRECTION 1
				setvar CONFUSESWITCHTIMER 0
			}
		
			ifvare CONFUSEDIRECTION 0
			{ 
				randvar TEMPVAR 16
				randvar TEMPVAR2 2 addvar TEMPVAR2 1
				mulvarvar TEMPVAR TEMPVAR2
				ifrnd 128 mulvar TEMPVAR -1
				ifrnd 85 addvar PLAYERANGLE 32 else ifrnd 128 addvar PLAYERANGLE 64 else addvar PLAYERANGLE 96
				addvarvar PLAYERANGLE TEMPVAR
			}
			else
			{
				randvar TEMPVAR 16
				randvar TEMPVAR2 2 addvar TEMPVAR2 1
				mulvarvar TEMPVAR TEMPVAR2
				ifrnd 128 mulvar TEMPVAR -1
				ifrnd 85 subvar PLAYERANGLE 32 else ifrnd 128 subvar PLAYERANGLE 64 else subvar PLAYERANGLE 96
				subvarvar PLAYERANGLE TEMPVAR
			}
			setplayer[THISACTOR].ang PLAYERANGLE 
		
			getplayer[THISACTOR].horiz PLAYERHORIZ
			ifvare CONFUSEDVDIRECTION 0 // Moves Angle Up
			{
				ifvarl PLAYERHORIZ 298 
				{ 
					randvar TEMPVAR 6
					randvar TEMPVAR2 2 addvar TEMPVAR2 1
					mulvarvar TEMPVAR TEMPVAR2
					ifrnd 128 mulvar TEMPVAR -1
					ifrnd 85 addvar PLAYERHORIZ 12 else ifrnd 128 addvar PLAYERHORIZ 24 else addvar PLAYERHORIZ 36
					addvarvar PLAYERHORIZ TEMPVAR
				}
				else setvar CONFUSEDVDIRECTION 1
			}
			ifvare CONFUSEDVDIRECTION 1 // Moves Angle Down
			{
				ifvarg PLAYERHORIZ -98
				{
					randvar TEMPVAR 6
					randvar TEMPVAR2 2 addvar TEMPVAR2 1
					mulvarvar TEMPVAR TEMPVAR2
					ifrnd 128 mulvar TEMPVAR -1
					ifrnd 85 subvar PLAYERHORIZ 12 else ifrnd 128 subvar PLAYERHORIZ 24 else subvar PLAYERHORIZ 36
					subvarvar PLAYERHORIZ TEMPVAR
				}
				else setvar CONFUSEDVDIRECTION 0
			}
			setplayer[THISACTOR].horiz PLAYERHORIZ
		}
	} 

	ifvarand PLAYERSTATUS? 256 // Checks for the Aqua Protection status
	{
		ifvarn CHARACTERSELECTED? 4 subvar PLAYERSTATUS? 256 // Only Ami can use Aqua Protection
		// ifvare CHARACTERSELECTED? 4 { ifvarand PLAYERSTATUS? 512 subvar PLAYERSTATUS? 512 } // Ami cannot have the "Damage Shell" status while using Aqua Protection
	}
	setvar CHARACTERARRAY 1 state charcheckaquaprotection
	setvar CHARACTERARRAY 2 state charcheckaquaprotection
	setvar CHARACTERARRAY 3 state charcheckaquaprotection
	setvar CHARACTERARRAY 5 state charcheckaquaprotection
	setvar CHARACTERARRAY 6 state charcheckaquaprotection
	setvar CHARACTERARRAY 7 state charcheckaquaprotection
	setvar CHARACTERARRAY 8 state charcheckaquaprotection
	setvar CHARACTERARRAY 9 state charcheckaquaprotection
	setvar CHARACTERARRAY 10 state charcheckaquaprotection
	setvar CHARACTERARRAY 11 state charcheckaquaprotection
	setvar CHARACTERARRAY 12 state charcheckaquaprotection
	setvar CHARACTERARRAY 13 state charcheckaquaprotection
	setvar CHARACTERARRAY 14 state charcheckaquaprotection
	setvar CHARACTERARRAY 15 state charcheckaquaprotection

	ifvarand PLAYERSTATUS? 2048 // Checks for the Triad Blitzkrieg status
	{
		ifvarn CHARACTERSELECTED? 15 subvar PLAYERSTATUS? 2048 // Only Maken can use Traid Blitzkrieg
	}
	setvar CHARACTERARRAY 1 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 2 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 3 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 4 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 5 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 6 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 7 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 8 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 9 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 10 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 11 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 12 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 13 state charchecktriadblitzkrieg
	setvar CHARACTERARRAY 14 state charchecktriadblitzkrieg

	ifp ponground addvar ONGROUNDTIMER 1 else setvar ONGROUNDTIMER 0

	ifvare FALLSOUND? 1
	{
		ifp ponground
		{
			ifvarg ONGROUNDTIMER 1
			{
				ifvare sector[PLAYERSECTOR].lotag 1 nullop
				else ifvare sector[PLAYERSECTOR].lotag 2 nullop
				else
				{
					setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
					ifvare MISCARRAYID_AMOUNTTEMP 0
					{
						ifvarl INVULNTIME 1
						{
							ifvarand CHEATBITFIELD? 32 nullop else
							{
								stopsound DUKE_LAND_HURT
								ifvare VEHICLEID -1 setvarvar tempd MAXHITPOINTS else getactorvar[VEHICLEID].ACTORMAXHP tempd
					
								ifvarg totalfallcounter 7
								{
									setvar falldamageratio 80
									setvarvar TEMPVAR2 totalfallcounter
									subvar TEMPVAR2 8
									mulvarvar TEMPVAR2 17
									addvarvar falldamageratio TEMPVAR2
								}
					
								randvar TEMPVAR 51
								subvarvar falldamageratio TEMPVAR
					
								// Check for ShockAb Boots [Equippable Item]
								setvar DAMAGEMODIFIER 10000
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM1 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM2 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM3 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM4 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM5 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM6 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM7 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								ifvarg DAMAGEMODIFIER 1 ifvare PLAYEREQUIPSLOTITEM8 14
								{
									randvar TEMPVAR5 250
									ifrnd 128 mulvar TEMPVAR5 -1
									addvar TEMPVAR5 1750
									subvarvar DAMAGEMODIFIER TEMPVAR5
									ifvarl DAMAGEMODIFIER 1 setvar DAMAGEMODIFIER 1
									// addlogvar DAMAGEMODIFIER
								}
								mulvarvar falldamageratio DAMAGEMODIFIER
								divvar falldamageratio 10000
					
								ifvarl falldamageratio 1 setvar falldamageratio 1
								ifvarg falldamageratio 8320 setvar falldamageratio 8320
								// addlogvar falldamageratio
					
								// Up to 244
								mulvarvar tempd falldamageratio
								divvar tempd 1000
								ifvarl tempd 0 setvar tempd 0
								ifvarvarg tempd STATLIMITATOMIC setvarvar tempd STATLIMITATOMIC
								ifvarg tempd 0
								{
									setvarvar tempe tempd
									addvarvar tempe rfallcounter
								}
					
								//*********************
								//*Check Malakian Gems*
								//*********************
								setvarvar TEMP7 tempe
								state malakiangemcheck 
								setvarvar tempe TEMP7
					
								ifvarand CHEATBITFIELD? 16 { divvar tempe 1000 ifvarl tempe 1 setvar tempe 1 state cheatersound }
								ifvare VEHICLEID -1
								{
									ifvare ESHIELDADVANCEMENT 0
									{
										// Level 1 Bio-Shield Support (33.4-66.6% dmg reduction) >.>
										setvarvar BIOSHIELDABSORBSOLID 500 // 500 (lesser means less damage is ignored)
										randvar BIOSHIELDABSORBRANDOM 166 // 166 (lesser means less damage is ignored)
										ifrnd 128 addvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM else subvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM
									}
									else
									{
										// Level 2 Bio-Shield Support (98.1-99.9% dmg reduction) >.>
										setvarvar BIOSHIELDABSORBSOLID 10 // 990 (lesser means less damage is ignored)
										randvar BIOSHIELDABSORBRANDOM 9 // 9 (lesser means less damage is ignored)
										ifrnd 128 addvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM else subvarvar BIOSHIELDABSORBSOLID BIOSHIELDABSORBRANDOM
									}
									setvarvar BIOSHIELDIGNOREDDAMAGE tempe
									mulvarvar BIOSHIELDIGNOREDDAMAGE BIOSHIELDABSORBSOLID
									divvar BIOSHIELDIGNOREDDAMAGE 1000
					
									setvarvar TEMPVAR tempe
									subvarvar TEMPVAR BIOSHIELDIGNOREDDAMAGE // Take out the random Bio-shield damage to prevent full absorbsion
									ifvarl TEMPVAR 1 setvar TEMPVAR 1
									// Main Formula
									ifvare CHARACTERSELECTED? 8
									{
										ifvare HAVEENERGYSHIELD? 1 
										{
											ifvare ENERGYSHIELDMODE 1 
											{
												ifvarg TEMPVAR 0
												{
													ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
													{
														setvarvar CELLDAMAGE TEMPVAR
														setvarvar CELLDAMAGETEMP CELLDAMAGE setvar CELLDAMAGETIMER 0 // For the displays
														ifvarn ESHIELDDMGFACTOR 0 divvarvar CELLDAMAGE ESHIELDDMGFACTOR
														ifvarvarg CELLDAMAGE CURRENTCELLS setvarvar CELLDAMAGE CURRENTCELLS
														setvarvar tempc CELLDAMAGE
														mulvarvar tempc ESHIELDDMGFACTOR
														subvarvar TEMPVAR tempc
														subvarvar CURRENTCELLS CELLDAMAGE
														setvar CELLDAMAGELEFT 0 
														ifvarg TEMPVAR 0 subvarvar CELLDAMAGETEMP TEMPVAR // For the displays 
								
														// Now to Calculate to deal with remaining TEMPVAR
														ifvarg CURRENTCELLS 0 // 1 or more cells left
														{
															ifvarvarg TEMPVAR DAMAGEINCELL // Damage exceeds the remaining power in the current cell
															{
																setvarvar TEMP3 TEMPVAR
																setvar TEMPVAR 0
																addvarvar CELLDAMAGETEMP TEMP3
																subvarvar DAMAGEINCELL TEMP3
																ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
															}
															else // Damage is less than or equal to the remaining power in the current cell
															{
																addvarvar CELLDAMAGETEMP TEMPVAR
																subvarvar DAMAGEINCELL TEMPVAR
																setvar TEMPVAR 0
																ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
															}
														}
														else // 0 cells
														{
															ifvarvarg TEMPVAR DAMAGEINCELL // Damage exceeds the remaining power in the last cell
															{
																addvarvar CELLDAMAGETEMP DAMAGEINCELL
																subvarvar TEMPVAR DAMAGEINCELL
																setvar DAMAGEINCELL 0
															}
															else // Damage is less than the remaining power in the last cell
															{
																addvarvar CELLDAMAGETEMP TEMPVAR
																subvarvar DAMAGEINCELL TEMPVAR
																setvar TEMPVAR 0
															}
														}
								
														stopsound NODAMAGE
														ifvare ENERGYSHIELDMODE 1 { setvar sparkflag 1 state sparkstate }
														state bioshieldhitsounds
														palfrom 32 0 0 64
													}
												}
											}
										}
									}
									setvarvar FULLSHIELDDAMAGE CELLDAMAGE
									mulvarvar FULLSHIELDDAMAGE ESHIELDDMGFACTOR
									addvarvar FULLSHIELDDAMAGE CELLDAMAGELEFT
									// End Main Formula
									setvarvar tempe TEMPVAR
									addvarvar tempe BIOSHIELDIGNOREDDAMAGE // Reinsert the random Bio-shield damage to prevent full absorbsion
									// Bio-Shield Support (33.4-66.6% dmg reduction) >.>
					
									ifvare CHARACTERSELECTED? 8
									{
										ifvare HAVEENERGYSHIELD? 1
										{
											ifvare ENERGYSHIELDMODE 1 
											{
												ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
												{
													ifvarg CELLDAMAGETEMP 0
													{
														ifvarn player[THISACTOR].over_shoulder_on 0
														{
															setvarvar SHOWDAMAGE CELLDAMAGETEMP
															setvar SHOWDAMAGETYPE 2
															setvarvar SHOWDAMAGEACTORID THISACTOR
															state showdamage
														}
													}
												}
											}
										}
									}
									setvarvar tempb CURRENTHITPOINTS
									subvarvar tempb tempe
									ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
									else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
									ifvarn player[THISACTOR].over_shoulder_on 0
									{
										ifvarg tempe 0
										{
											setvarvar SHOWDAMAGE tempe
											setvar SHOWDAMAGETYPE 0
											setvarvar SHOWDAMAGEACTORID THISACTOR
											state showdamage
										}
									}
									ifvarl tempb 0 setvar tempb 0
									setactor[PLAYERID].htpicnum -1
									setvarvar CURRENTHITPOINTS tempb
									state checkbuddhamode
								}
								else
								{
									getactorvar[VEHICLEID].ACTORHP tempb // setvarvar tempb CURRENTHITPOINTS
									subvarvar tempb tempe
									ifvarl tempe 0 setvar VEHICLEHPDAMAGED? -1
									else ifvarg tempe 0 setvar VEHICLEHPDAMAGED? 1
									ifvarn player[THISACTOR].over_shoulder_on 0
									{
										ifvarg tempe 0
										{
											setvarvar SHOWDAMAGE tempe
											setvar SHOWDAMAGETYPE 0
											setvarvar SHOWDAMAGEACTORID THISACTOR
											state showdamage
										}
									}
									ifvarl tempb 0 setvar tempb 0
									setactor[PLAYERID].htpicnum -1
									setactorvar[VEHICLEID].ACTORHP tempb // setvarvar CURRENTHITPOINTS tempb
									state checkbuddhamode
								}
					
								ifvarg FULLSHIELDDAMAGE 0
								{
									setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
									ifvare TEMPHITCHARACTERVAR 5 setvarvar ATTACKINGACTORPICNUM 6911
									else ifvare TEMPHITCHARACTERVAR 6 setvarvar ATTACKINGACTORPICNUM 6911
									else ifvare TEMPHITCHARACTERVAR 9 setvarvar ATTACKINGACTORPICNUM 6911
									else ifvare TEMPHITCHARACTERVAR 10 
									{
										setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
										ifvare MISCARRAYID_AMOUNTTEMP 0 setvarvar ATTACKINGACTORPICNUM 6908 else setvarvar ATTACKINGACTORPICNUM 6911 
									}
									else setvarvar ATTACKINGACTORPICNUM 6911
									setvarvar ATTACKINGACTORPAL 0
									setvar ACTORCRITICAL? 0
									setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
									ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
								}
					
								ifvarg tempe 0
								{
									setvar ATTACKINGACTORPAL 0
									setvar ACTORCRITICAL? 0
									setvarvar PLAYERDAMAGETEMP tempe
									ifvare VEHICLEID -1
									{
										setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
										ifvare TEMPHITCHARACTERVAR 5 setvarvar ATTACKINGACTORPICNUM 6911
										else ifvare TEMPHITCHARACTERVAR 6 setvarvar ATTACKINGACTORPICNUM 6911
										else ifvare TEMPHITCHARACTERVAR 9 setvarvar ATTACKINGACTORPICNUM 6911
										else ifvare TEMPHITCHARACTERVAR 10 
										{
											setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
											ifvare MISCARRAYID_AMOUNTTEMP 0 setvarvar ATTACKINGACTORPICNUM 6908 else setvarvar ATTACKINGACTORPICNUM 6911 
										}
										else setvarvar ATTACKINGACTORPICNUM 6911
									}
									else setvarvar ATTACKINGACTORPICNUM 6911
					
									ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
									setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
								} 
					
								ifvare VEHICLEID -1
								{
									ifvarg tempe 0
									{
										// addlogvar tempe
						
										setvarvar TEMPVAR3 tempe
										mulvar TEMPVAR3 1000
										divvarvar TEMPVAR3 MAXHITPOINTS
						
										setvarvar DAMAGEHUEFACTOR tempe
										state playerdamagehues-normaltype
						
										// addlogvar TEMPVAR3
										ifvare CHARACTERSELECTED? 1
										{
											stopsound DUKE_SCREAM
											globalsound DUKE_LAND_HURT2
										}
										else
										ifvare CHARACTERSELECTED? 2
										{
											stopsound JACK_FALLSCREAM
						
											// addlogvar CHARACTERSELECTED?
											// Insert Fall Damage Sounds Later
										}
										else
										ifvare CHARACTERSELECTED? 5
										{
											stopsound WANG_SCREAM
											globalsound WANG_LONGTERM_PAIN6
										}
										else
										ifvare CHARACTERSELECTED? 6
										{
											stopsound ESSENCE_FALLSCREAM
											// Insert Fall Damage Sounds Later
										}
										else
										ifvare CHARACTERSELECTED? 8 
										{
											stopsound LISA_FALLDAMAGE
											stopsound LISA_FALLDAMAGE2
											stopsound LISA_FALLDAMAGE3
											stopsound LISA_FALLSCREAM
						
											ifvarl TEMPVAR3 100 globalsound LISA_FALLDAMAGE2 // Minor Fall Damage
											else ifvarg TEMPVAR3 99 ifvarl TEMPVAR3 834 globalsound LISA_FALLDAMAGE // Normal Fall Damage
											else globalsound LISA_FALLDAMAGE3 // Major Fall Damage
										}
										else
										ifvare CHARACTERSELECTED? 9
										{
											stopsound CYBANIS_FALLDAMAGE1
											stopsound CYBANIS_FALLDAMAGE2
											stopsound CYBANIS_FALLSCREAM
						
											ifvarl TEMPVAR3 334 globalsound CYBANIS_FALLDAMAGE1
											else globalsound CYBANIS_FALLDAMAGE2
										}
										else
										ifvare CHARACTERSELECTED? 15
										{
											stopsound MAKEN_FALLDAMAGE1
											stopsound MAKEN_FALLDAMAGE2
											stopsound MAKEN_FALLDAMAGE3
											stopsound MAKEN_FALLSCREAM
						
											ifvarl TEMPVAR3 100 globalsound MAKEN_FALLDAMAGE1 // Minor Fall Damage
											else ifvarg TEMPVAR3 99 ifvarl TEMPVAR3 834 globalsound MAKEN_FALLDAMAGE2 // Normal Fall Damage
											else sound MAKEN_FALLDAMAGE3 // Major Fall Damage
										}
									}
								}
								else
								{
									ifvarg tempe 0
									{
										setvarvar DAMAGEHUEFACTOR tempe
										mulvar DAMAGEHUEFACTOR 1000
										divvarvar DAMAGEHUEFACTOR MAXHITPOINTS
										state playerdamagehues_vehicle
									}
									globalsound METALTHUD
								}
							}
						}
					}
				}
				setvar fallcounter2 0
				setvar totalfallcounter 0
				setvar FALLSOUND? 0
			}
		}
	}
	

	// Holoform Displays >_>
	getplayer[THISACTOR].holoduke_on TEMPVAR
	ifvarn TEMPVAR -1
	{
		getactor[TEMPVAR].mdflags TEMP
		orvar TEMP 16
		setactor[TEMPVAR].mdflags TEMP 
	}

	//***************************************************
	//*Damage Ceiling/Sector Control for Invuln/God Mode*
	//***************************************************
	setvar CEILINGDAMAGETYPE? 0
	setvar FLOORDAMAGETYPE? 0
	setvar EMUCEILINGDAMAGETYPE? 0
	setvar EMUFLOORDAMAGETYPE? 0
	
	setvar CANDMGFLOOR? 0
	
	setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
	ifvare MISCARRAYID_AMOUNTTEMP 0 { ifvarg CURRENTHITPOINTS 0 { ifvarand CHEATBITFIELD? 32 nullop else { ifvare mainmenu 0 setvar CANDMGFLOOR? 1 } } } // Checks Conditions for being able to take damage from damagefloors
	
	setvar CANDMGFLOOR2? 0
	ifp ponground { state playergetcorrectz ifvarvarl PLAYERDMGFLRZ tempe { ifvarvarg PLAYERDMGFLRZ tempb setvar CANDMGFLOOR2? 1 } }
	setvar CANDMGFLOOR3? 0
	
	ifvare player[THISACTOR].spritebridge 0 ifvare player[THISACTOR].jetpack_on 0 setvar CANDMGFLOOR3? 1 
	//addlogvar CANDMGFLOOR3?
	
	//

	ifvare sector[PLAYERSECTOR].lotag 2
	{
		getactor[THISACTOR].sectnum temp
		getsector[temp].ceilingpicnum PLAYERCEILINGTILE
		getsector[temp].floorpicnum PLAYERFLOORTILE
		
		ifvare PLAYERCEILINGTILE 84 // BIGORBIT1
		{
			getsector[temp].ceilingstat TEMPVAR
			ifvarand TEMPVAR 1 // if the ceiling is paralaxxed
			{
				ifvarand CHEATBITFIELD? 32 nullop else
				{
					getsector[temp].ceilingpal TEMPVAR
					ifvare TEMPVAR 0 setvar INSTANTDEATH 1
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 84 // BIGORBIT1
		{
			getsector[temp].floorstat TEMPVAR
			ifvarand TEMPVAR 1 // if the ceiling is paralaxxed
			{
				ifvarand CHEATBITFIELD? 32 nullop else
				{
					getsector[temp].floorpal TEMPVAR
					ifvare TEMPVAR 0 setvar INSTANTDEATH 1
				}
			}
		}
		
		ifvare PLAYERCEILINGTILE 5385 // NEWFLOORSLIME
		{
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 1
					state player_do_floorslime_checks1_c
				}
				else
				{
					state player_do_floorslime_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 5388 // NEWHURTRAIL
		{
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 2
					state player_do_hurtrail_checks1_c
				}
				else
				{
					state player_do_hurtrail_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 5389 // NEWFLOORPLASMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 1 addvar tempg 2
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 3
					state player_do_floorplasma_checks1_c
				}
				else
				{
					state player_do_floorplasma_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 5395 // NEWPURPLELAVA
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare player[THISACTOR].spritebridge 0
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						setvar CEILINGDAMAGETYPE? 4
						state player_do_purplelava_checks1_c
					}
					else
					{
						state player_do_purplelava_checks2
					}
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 3780 // HOTLAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 2 addvar tempg 5
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 6
					state player_do_hotlava_checks1_c
				}
				else
				{
					state player_do_hotlava_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 3796 // AMOEBAACID
		{
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 5
					state player_do_amoebaacid_checks1_c
				}
				else
				{
					state player_do_amoebaacid_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 4091 // MEGALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 8 addvar tempg 17
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 7
					state player_do_megalava_checks1_c
				}
				else
				{
					state player_do_megalava_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 5401 // ULTRALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 20 addvar tempg 41
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 8
					state player_do_ultralava_checks1_c
				}
				else
				{
					state player_do_ultralava_checks2
				}
			}
		}
		else
		ifvare PLAYERCEILINGTILE 5443 // HYPERMAGMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 80 addvar tempg 161
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar CEILINGDAMAGETYPE? 8
					state player_do_hypermagma_checks1_c
				}
				else
				{
					state player_do_hypermagma_checks2
				}
			}
		}
	}
	//*************************************************
	//*Damage Floor/Sector Control for Invuln/God Mode*
	//*************************************************
	else
	{
		getactor[THISACTOR].sectnum temp
		getsector[temp].ceilingpicnum PLAYERCEILINGTILE
		getsector[temp].floorpicnum PLAYERFLOORTILE
		
		ifvare PLAYERCEILINGTILE 84 // BIGORBIT1
		{
			ifvarand sector[temp].ceilingstat 1 // if the ceiling is paralaxxed
			{
				ifvarand CHEATBITFIELD? 32 nullop else
				{
					ifvare sector[temp].ceilingpal 0 setvar INSTANTDEATH 1
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 84 // BIGORBIT1
		{
			ifvarand sector[temp].floorstat 1 // if the ceiling is paralaxxed
			{
				ifvarand CHEATBITFIELD? 32 nullop else
				{
					ifvare sector[temp].floorpal 0 setvar INSTANTDEATH 1
				}
			}
		}
		
		ifvare PLAYERFLOORTILE 5385 // NEWFLOORSLIME
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 1
							state player_do_floorslime_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_floorslime_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 5388 // NEWHURTRAIL
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 2
							state player_do_hurtrail_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_hurtrail_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 5389 // NEWFLOORPLASMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 1 addvar tempg 2
					subvarvar freezetimer tempg
					state checkfreezetimer_heatratio
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
			
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 3
							state player_do_floorplasma_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_floorplasma_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 5395 // NEWPURPLELAVA
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare player[THISACTOR].spritebridge 0
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						setvar FLOORDAMAGETYPE? 4
						state player_do_purplelava_checks1_f
					}
					else
					{
						state player_do_purplelava_checks2
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 3780 // HOTLAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 2 addvar tempg 5
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 6
							state player_do_hotlava_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_hotlava_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 3796 // AMOEBAACID
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 5
							state player_do_amoebaacid_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_amoebaacid_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 4091 // MEGALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 8 addvar tempg 17
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 7
							state player_do_megalava_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_megalava_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 5401 // ULTRALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 20 addvar tempg 41
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar FLOORDAMAGETYPE? 8
							state player_do_ultralava_checks1_f
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_ultralava_checks2
						}
					}
				}
			}
		}
		else
		ifvare PLAYERFLOORTILE 5443 // HYPERMAGMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 80 addvar tempg 161
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
					ifvare CANDMGFLOOR2? 1
					{
						setvar FLOORDAMAGETYPE? 8
						state player_do_hypermagma_checks1_f
					}
					}
					else
					{
					ifvare CANDMGFLOOR2? 1
					{
						state player_do_hypermagma_checks2
					}
					}
				}
			}
		}

	}
	

	//**************************************************************************************
	//*Damagefloor Emulation to allow special damage properties without a specfic floortile*
	//**************************************************************************************

	getactor[THISACTOR].sectnum temp
	ifvare sector[PLAYERSECTOR].lotag 2 // Being in water should make the emulation damage throughout the whole vertical plane of the sector
	{
		ifvare actorvar[temp].SECTOREXTRA 5385 // NEWFLOORSLIME
		{
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 1
					state player_do_floorslime_checks1_ec
				}
				else
				{
					state player_do_floorslime_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5388 // NEWHURTRAIL
		{
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 2
					state player_do_hurtrail_checks1_ec
				}
				else
				{
					state player_do_hurtrail_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5389 // NEWFLOORPLASMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 1 addvar tempg 2
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 3
					state player_do_floorplasma_checks1_ec
				}
				else
				{
					state player_do_floorplasma_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5395 // NEWPURPLELAVA
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare player[THISACTOR].spritebridge 0
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						setvar EMUCEILINGDAMAGETYPE? 4
						state player_do_purplelava_checks1_ec
					}
					else
					{
						state player_do_purplelava_checks2
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 3780 // HOTLAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 2 addvar tempg 5
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 6
					state player_do_hotlava_checks1_ec
				}
				else
				{
					state player_do_hotlava_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 3796 // AMOEBAACID
		{
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 5
					state player_do_amoebaacid_checks1_ec
				}
				else
				{
					state player_do_amoebaacid_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 4091 // MEGALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 8 addvar tempg 17
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 7
					state player_do_megalava_checks1_ec
				}
				else
				{
					state player_do_megalava_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5401 // ULTRALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 20 addvar tempg 41
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 8
					state player_do_ultralava_checks1_ec
				}
				else
				{
					state player_do_ultralava_checks2
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5443 // HYPERMAGMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 80 addvar tempg 161
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				state dmgflr-checkinvulntime
				ifvarl tempf 1
				{
					setvar EMUCEILINGDAMAGETYPE? 8
					state player_do_hypermagma_checks1_ec
				}
				else
				{
					state player_do_hypermagma_checks2
				}
			}
		}
	}
	else // If it is not an underwater sector, treat it like a normal damagefloor-type
	{
		ifvare actorvar[temp].SECTOREXTRA 5385 // NEWFLOORSLIME
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 1
							state player_do_floorslime_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_floorslime_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5388 // NEWHURTRAIL
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 2
							state player_do_hurtrail_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_hurtrail_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5389 // NEWFLOORPLASMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 1 addvar tempg 2
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 3
							state player_do_floorplasma_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_floorplasma_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5395 // NEWPURPLELAVA
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare player[THISACTOR].spritebridge 0
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						setvar EMUFLOORDAMAGETYPE? 4
						state player_do_purplelava_checks1_ef
					}
					else
					{
						state player_do_purplelava_checks2
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 3780 // HOTLAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 2 addvar tempg 5
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 6
							state player_do_hotlava_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_hotlava_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 3796 // AMOEBAACID
		{
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 5
							state player_do_amoebaacid_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_amoebaacid_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 4091 // MEGALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 8 addvar tempg 17
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 7
							state player_do_megalava_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_megalava_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5401 // ULTRALAVA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 20 addvar tempg 41
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 8
							state player_do_ultralava_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_ultralava_checks2
						}
					}
				}
			}
		}
		else
		ifvare actorvar[temp].SECTOREXTRA 5443 // HYPERMAGMA
		{
			state dmgflr-checkinvulntime
			ifvarl tempf 1
			{
				ifvare VEHICLEID -1 ifvarg freezetimer 0
				{
					randvar tempg 80 addvar tempg 161
					state checkfreezetimer_heatratio
					subvarvar freezetimer tempg
					ifvarl freezetimer 0 setvar freezetimer 0
				}
			}
		
			ifvare CANDMGFLOOR? 1
			{
				ifvare CANDMGFLOOR3? 1
				{
					state dmgflr-checkinvulntime
					ifvarl tempf 1
					{
						ifvare CANDMGFLOOR2? 1
						{
							setvar EMUFLOORDAMAGETYPE? 8
							state player_do_hypermagma_checks1_ef
						}
					}
					else
					{
						ifvare CANDMGFLOOR2? 1
						{
							state player_do_hypermagma_checks2
						}
					}
				}
			}
		}

	}
	// End of Emulation state

	findnearsprite RPG 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite RPG_NOAIM 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite GENERAL_RPG 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite COMMANDER_RPG 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite LEADER_RPG 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite BAALO_RPG 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite OCTANINE_RPG 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite GATEMISSILE_MAIN 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite GATEMISSILE_SPLIT 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite STROKEMISSILE_MAIN 1536 TEMPVAR5
	ifvare TEMPVAR5 -1 findnearsprite STROKEMISSILE_SPLIT 1536 TEMPVAR5
	ifvarn TEMPVAR5 -1
	{
		getactor[TEMPVAR5].owner temp
		ifvarvarn temp THISACTOR
		{
			state projectilehitscan
			ifvarvarn hitsprite THISACTOR { ifvare mainmenu 0 soundonce WHOOSH }
		}
	}

	ifp pdead nullop else state stepsoundstuff_player

	ifvarl LEVELUPTIMER 65 ifvarg LEVELUPTIMER 56 palfrom 24 64 64
	ifvarl LEVELUPTIMER 57 ifvarg LEVELUPTIMER 48 palfrom 21 64 64
	ifvarl LEVELUPTIMER 49 ifvarg LEVELUPTIMER 40 palfrom 18 64 64
	ifvarl LEVELUPTIMER 41 ifvarg LEVELUPTIMER 32 palfrom 15 64 64
	ifvarl LEVELUPTIMER 33 ifvarg LEVELUPTIMER 24 palfrom 12 64 64
	ifvarl LEVELUPTIMER 25 ifvarg LEVELUPTIMER 16 palfrom 9 64 64
	ifvarl LEVELUPTIMER 17 ifvarg LEVELUPTIMER 8 palfrom 6 64 64
	ifvarl LEVELUPTIMER 9 ifvarg LEVELUPTIMER 0 palfrom 3 64 64
	ifvarg LEVELUPTIMER 0 subvar LEVELUPTIMER 1
	
	setvarvar TEMPVAR2 PLAYERMOVEPLUSVEL
	divvar TEMPVAR2 100
	
	setvarvar TEMPVAR3 PLAYERMOVEMINUSVEL
	divvar TEMPVAR3 100

	ifvarn sector[PLAYERSECTOR].lotag 2
	{
		ifvarvarg posxv TEMPVAR3
		{
			ifvarvarl posxv TEMPVAR2
			{
				ifvarvarg posyv TEMPVAR3
				{
					ifvarvarl posyv TEMPVAR2
					{
						setvar BREATHCAMERAFX 1
					}
					else setvar BREATHCAMERAFX 0
				}
				else setvar BREATHCAMERAFX 0
			}
			else setvar BREATHCAMERAFX 0
		}
		else setvar BREATHCAMERAFX 0
	}
	else setvar BREATHCAMERAFX 0

	ifvare BREATHCAMERAFX 1 ifvarn oldskoolmode 1
	{
		addvar BREATHCAMERATIMER 1
		
		setvarvar TEMPVAR5 CURRENTHITPOINTS
		mulvar TEMPVAR5 1000
		divvarvar TEMPVAR5 MAXHITPOINTS
		
		ifvarg TEMPVAR5 750
		{
			ifvarg BREATHCAMERATIMER 47 setvar BREATHCAMERATIMER 0
		}
		else
		ifvarg TEMPVAR5 500 ifvarl TEMPVAR5 751
		{
			ifvarg BREATHCAMERATIMER 43 setvar BREATHCAMERATIMER 0
		}
		else
		ifvarg TEMPVAR5 250 ifvarl TEMPVAR5 501
		{
			ifvarg BREATHCAMERATIMER 39 setvar BREATHCAMERATIMER 0
		}
		else
		ifvarg TEMPVAR5 100 ifvarl TEMPVAR5 251
		{
			ifvarg BREATHCAMERATIMER 35 setvar BREATHCAMERATIMER 0
		}
		else
		ifvarl TEMPVAR5 101
		{
			ifvarl CURRENTHITPOINTS 1 setvar BREATHCAMERATIMER 0
			else
			{
				ifvarg BREATHCAMERATIMER 31 setvar BREATHCAMERATIMER 0
			}
		}
	}
	else setvar BREATHCAMERATIMER 0
	
	ifvare mainmenu 1 palfrom 0 0 0 0
	
	state slipperycode_players getplayer[THISACTOR].posxv oposxv getplayer[THISACTOR].posyv oposyv
	
	setvar MISCARRAYID 62 // NUMBER-OF-PARTY-DEAD
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	setvarvar MISCARRAYID_AMOUNTTEMP PARTYSIZE
	subvarvar MISCARRAYID_AMOUNTTEMP PARTYALIVE
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
	//***************************************************************
	//*NO EXTRA CODE BEYOND THIS LINE, PUT ALL OF IT ABOVE THIS LINE*
	//***************************************************************

  ifaction 0 state setplayeraction_pstand

	ifaction PFROZEN
	{
		setactor[THISACTOR].htpicnum SHOTSPARK1
		cstat 257
	
		fall
	
		palfrom 16 0 0 24
	
		ifmove 0
		{
			ifhitweapon
			{
				ifwasweapon FREEZEBLAST { state freezeblast_frozen-player break }
				setactor[PLAYERID].htpicnum -1
				lotsofglass 60
				ifrnd 84 { espawn NEWBLOODPOOL setactor[RETURN].cstat 34 setactor[RETURN].pal 1 }
	
				ifvarl PARTYALIVE 1 
				{
					state gameover
					state resetplayeritems 
				}
	
				sound GLASS_BREAKING // Player's Ice-Breaking
				ifvarg PARTYALIVE 0 
				{ 
					ifvare CHARACTERSELECTED? 3
					{
						state checkbubsylives
						ifvarg ITEMARRAYID_AMOUNTTEMP 0
						{
							setactor[PLAYERID].extra 16384
							state setplayeraction_pstand
							state unfreeze
							setvarvar CURRENTHITPOINTS MAXHITPOINTS
							setvarvar AIRTIME MAXAIRTIME
							state checkbubsylives subvar ITEMARRAYID_AMOUNTTEMP 1 state setitemidarrayamount
							setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
							redefinequote 321 ^2BUBSY LOSES ONE LIFE!!
							setvarvar fta fta_normal setvar ftq 321
						}
						else
						{
							setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
							ifvarl MISCARRAYID_AMOUNTTEMP 26 
							{ 
								state switchtolivingcharacter 
								state setplayeraction_pstand
								state unfreeze
								setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
							} 
						}
					}
					else
					{
						setvar MISCARRAYID 79 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AUTO-SWITCH-ATTEMPTS
						ifvarl MISCARRAYID_AMOUNTTEMP 26 
						{ 
							state switchtolivingcharacter 
							state setplayeraction_pstand
							state unfreeze
							setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
						} 
					}
				}
	
				move 1
				break
			}
		}
		else
		{
			ifvarl PARTYALIVE 1
			{
				setvar gameover? 1
				cstat 32768
				setvarvar fta fta_normal setvar ftq 13
				ifhitspace
				{
					ifvarg gameover? 0
					{
						state setplayeraction_pstand
						state gameover
					}
				}
			}
			break
		}
	
		state actorcheck_frozentimer
		ifvarl FROZENTIMER 1 // ifactioncount THAWTIME
		{
			state unfreeze
			move 0
			state setplayeraction_pstand
		}
		else
		{
			ifvarl FROZENTIMER 39 // ifactioncount FROZENDRIPTIME
			{
				ifrnd 32
				spawn WATERDRIP
			}
		}
	
		ifp pfacing   // assumes another other player  (multiplayer)
			ifpdistl FROZENQUICKKICKDIST
				pkick
	
		break
	}
	
	ifdead
	{
		ifaction PGROWING
		{
			ifmove PGROWINGPOP
			{
				ifvarl PARTYALIVE 1
				{
					setvar gameover? 1
					setvarvar fta fta_normal setvar ftq 13
						ifhitspace
						{
						ifvarg gameover? 0
						{
							action 0
							state gameover
						}
					}
				}
				break
			}
			else
			{
				ifcount 32
				{
					sound SQUISHED
					palfrom 48 64
	
					state standard_pjibs
	
					guts JIBS4 20
					guts JIBS6 20
					move PGROWINGPOP
					cstat 32768
					// tossweapon
					hitradius 2048 60 70 80 90
	
				}
				else
					sizeto MAXXSTRETCH MAXYSTRETCH
			}
			break
		}
	
		ifsquished
			palfrom 32 63 63 63
		else
			fall
	
		ifactioncount 7
			move 0
		else
			ifactioncount 6
		{
			ifmultiplayer nullop
			else
			{
				ifrnd 240
				{ 
					state resetplayeritems
					ifcount 20
					{ 
						ifvarl PARTYALIVE 1 
						{ 
							setvar gameover? 1
							state randomdeathtaunt 
						} 
						resetcount 
					}
				}
				else
				{
					ifvare CHARACTERSELECTED? 1
					{
						ifrnd 53
							sound DUKE_KILLED5
						else
							ifrnd 64
								sound DUKE_KILLED3
						else
							ifrnd 85
								sound DUKE_KILLED1
						else
							ifrnd 128
								sound DUKE_KILLED2
					}
				}
			}
		}
	
		ifaction PLYINGDEAD
		{
			ifactioncount 3
				move PSTOPED
			ifvarl PARTYALIVE 1
			{
				setvar gameover? 1

				ifvare gameovertransitiontimer 13 state randomdeathtaunt         
				setvarvar fta fta_normal setvar ftq 13
				ifhitspace
				{
					ifvarg gameover? 0
					{        
						state gameover
						state setplayeraction_pstand
					}
				}
			}
			break
		}
	
		ifaction PTHROWNBACK
		{
			ifactioncount 5
			{
				espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34
				action PLYINGDEAD
			}
			else
				ifactioncount 1
					move 0
			break
		}
	
		ifaction PEXPLODEAD
		{
			ifvarl PARTYALIVE 1
			{
				setvar gameover? 1
				setvarvar fta fta_normal setvar ftq 13
				ifhitspace
				{
					ifvarg gameover? 0
					{
						state gameover
						state setplayeraction_pstand
					}
				}
			}
			break
		}
		ifaction PEXPLODE
		{
			ifactioncount 5
			{
				action PEXPLODEAD
				espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34
			}
			break
		}
	
	
		ifp pshrunk
		{
			state standard_pjibs
			espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34
	
			sound SQUISHED
			ifvare CHARACTERSELECTED? 1 sound DUKE_DEAD
			ifvare CHARACTERSELECTED? 5 sound WANG_SCREAM
	
			cstat 32768         // Hide the sprite
	
			action PLYINGDEAD
		}
		else
		{
			ifinwater
			{
				action PLYINGDEAD
				ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds
				ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds
			}
			else
			{
				action PEXPLODE
				state standard_pjibs
				cstat 32768
				sound SQUISHED
				ifvare CHARACTERSELECTED? 1 sound DUKE_DEAD
				ifvare CHARACTERSELECTED? 5 sound WANG_SCREAM
			}
		}

		// tossweapon
		break
	}
	
	ifsquished
	{
		strength -1
		sound SQUISHED
		state random_ooz
		break
	}

	ifp ponsteroids
	{
		ifp pstanding 
			nullop
		else
			spawn FRAMEEFFECT1
	}

	ifmove PSHRINKING
	{
		ifcount 32
		{
			ifcount SHRUNKDONECOUNT
			{
				move 0
				cstat 257
			}
			else
				ifcount SHRUNKCOUNT
			{
				setvar SHRUNK? 0
				setactor[THISACTOR].htpicnum SHOTSPARK1
				sizeto 42 36
				ifgapzl 24
				{
					strength 0
					sound SQUISHED
					palfrom 48 64
					break
				}
			}
			else
				ifp ponsteroids
					count SHRUNKCOUNT
		}
		else
		{
			ifp ponsteroids
				count SHRUNKCOUNT
			else
			{
				sizeto 8 9
				spawn FRAMEEFFECT1
			}
		}
	}
	else ifhitweapon
	{
		ifdead
		{
			/*
			ifmultiplayer
			{
				ifvare CHARACTERSELECTED? 1 { sound DUKE_KILLED4 }
			}
			*/
			ifwasweapon GROWSPARK
			{
				palfrom 48 48
				action PGROWING
				count 0
	
				move 0
				sound ACTOR_GROWING
				cstat 0
				break
			}
		}
		else
		{
			/*
			ifmultiplayer
			{        
				ifvarg INVULNTIME 0
				{
					stopsound PISTOL_BODYHIT
				}
				else
				ifvarl PLAYERDAMAGE 1
				{
					stopsound PISTOL_BODYHIT
					ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1 ifvare ENERGYSHIELDMODE 1 ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0 nullop else sound NODAMAGE
				}
				else
				{
					setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
					ifvarl MISCARRAYID_AMOUNTTEMP 251
					{
						ifvare CHARACTERSELECTED? 1
						{
							ifrnd 64
								sound DUKE_LONGTERM_PAIN2
							else ifrnd 64
								sound DUKE_LONGTERM_PAIN3
							else ifrnd 64
								sound DUKE_LONGTERM_PAIN4
							else
								sound DUKE_DEAD
						}
						else
						ifvare CHARACTERSELECTED? 5
						{
							ifrnd 64
								sound WANG_LONGTERM_PAIN1
							else ifrnd 64
								sound WANG_LONGTERM_PAIN2
							else ifrnd 64
								sound WANG_LONGTERM_PAIN3
							else
								sound WANG_LONGTERM_PAIN4
						}
					}
					else
					{
						ifvare CHARACTERSELECTED? 1
						{
							ifrnd 64
								sound DUKE_LONGTERM_PAIN5
							else ifrnd 64
								sound DUKE_LONGTERM_PAIN6
							else ifrnd 64
								sound DUKE_LONGTERM_PAIN7
							else
								sound DUKE_LONGTERM_PAIN8
						}
						else
						ifvare CHARACTERSELECTED? 5
						{
							ifrnd 64
								sound WANG_LONGTERM_PAIN5
							else ifrnd 64
								sound WANG_LONGTERM_PAIN6
							else ifrnd 64
								sound WANG_LONGTERM_PAIN7
							else
								sound WANG_LONGTERM_PAIN8
						}
					}
				}
			}
			*/
			ifvarg INVULNTIME 0 stopsound PISTOL_BODYHIT
			else ifvarl PLAYERDAMAGE 1
			{
				stopsound PISTOL_BODYHIT
				ifvare CHARACTERSELECTED? 8 ifvare HAVEENERGYSHIELD? 1 ifvare ENERGYSHIELDMODE 1 ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0 nullop else sound NODAMAGE
			}
			else
			{
				setvarvar PAINSOUNDFACTOR PLAYERDAMAGE
				ifwasweapon SHRINKER setvar PAINSOUNDFACTOR -1
				else ifwasweapon SHRINKSPARK setvar PAINSOUNDFACTOR -1
				state checkpainfactor
	
				ifvarn VEHICLEID -1
				{
					ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
					{
						stopsound PISTOL_BODYHIT
						sound LANDMETAL_HEAVY
					}
				}
				else
				{
					ifvare CHARACTERSELECTED? 1 state dukepainsounds // Duke
					else ifvare CHARACTERSELECTED? 5 state lowangpainsounds // Lo Wang
					else ifvare CHARACTERSELECTED? 8 state lisapainsounds // Lisa
					else ifvare CHARACTERSELECTED? 15 state makenpainsounds // Maken
				}
			}
		}

		ifstrength TOUGH
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				state headhitstate
				ifvare CHARACTERSELECTED? 1 sound DUKE_GRUNT
				ifp pstanding action PFLINTCHING
			}
		}
	
		ifwasweapon RPG
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon RPG_NOAIM
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon OCTANINE_RPG
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon GENERAL_RPG
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon COMMANDER_RPG
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon LEADER_RPG
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon BAALO_RPG
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon GATEMISSILE_MAIN
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon GATEMISSILE_SPLIT
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon STROKEMISSILE_MAIN
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon STROKEMISSILE_SPLIT
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon RADIUSEXPLOSION
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		ifwasweapon FIREEXT
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else
			{
				ifrnd 32
					spawn BLOOD
				ifdead
					state standard_pjibs
				palfrom 48 52
				break
			}
		}

		// Start Customized Weapon hits
		ifwasweapon SHOTGUN
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
		}
		ifwasweapon CHAINGUN
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
		}
		ifwasweapon HEAVYHBOMB
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
		}
		ifwasweapon MORTER
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
		}
		ifwasweapon SPIT
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
		}
		ifwasweapon SEENINE
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
		}
		ifwasweapon ZAPPER1
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else ifvarg PLAYERDAMAGE 0
			{
				sound SHORT_CIRCUIT
				palfrom 32 32 0 0 
			}
		}
		ifwasweapon ZAPPER2
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else ifvarg PLAYERDAMAGE 0
			{
				sound SHORT_CIRCUIT
				palfrom 32 32 0 0 
			}
		}
		ifwasweapon ZAPPER3
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else ifvarg PLAYERDAMAGE 0
			{
				sound SHORT_CIRCUIT
				palfrom 32 32 0 0 
			}
		}
		// End Customized Weapon hits
		ifwasweapon GROWSPARK
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else ifvarg PLAYERDAMAGE 0
			{
				palfrom 48 52
				sound EXPANDERHIT
				break
			}
		}
		ifwasweapon SHRINKSPARK
		{
			ifvarg INVULNTIME 0     
			{
				state invulnflash 
				state deflectshrinker 
			}
			else
			{
				ifvare CHARACTERSELECTED? 8
				{
					ifvare HAVEENERGYSHIELD? 1 
					{
						ifvare ENERGYSHIELDMODE 1 
						{
							ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
							{
								ifvarl CURRENTCELLS 1 setvar DAMAGEINCELL 0 else subvar CURRENTCELLS 1
								state deflectshrinker
							}
							else state playershrink
						}
						else state playershrink
					}
					else state playershrink
				}
				else state playershrink
			}
		}
		ifwasweapon SHRINKER
		{
			ifvarg INVULNTIME 0     
			{
				state invulnflash 
				state deflectshrinker 
			}
			else
			{
				ifvare CHARACTERSELECTED? 8
				{
					ifvare HAVEENERGYSHIELD? 1 
					{
						ifvare ENERGYSHIELDMODE 1 
						{
							ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
							{
								ifvarl CURRENTCELLS 1 setvar DAMAGEINCELL 0 else subvar CURRENTCELLS 1
								state deflectshrinker
							}
							else state playershrink
						}
						else state playershrink
					}
					else state playershrink
				}
				else state playershrink
			}
		}
		ifwasweapon SHOTSPARK1
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else palfrom 24 48
		}
		ifwasweapon FREEZEBLAST
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			// else palfrom 48 0 0 48
	
			ifp pdead // ifp pdead
			{
				state freezeup
				state frosty 
				spritepal 1
				move 0
				action PFROZEN
				break
			}
		}
		ifwasweapon COOLEXPLOSION1
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else palfrom 48 48 0 48
		}
		ifwasweapon KNEE
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else palfrom 16 32
		}
		ifwasweapon FIRELASER
		{
			ifvarg INVULNTIME 0 state invulnflash
			else ifvarl PLAYERDAMAGE 1 state nullflash
			else palfrom 32 32
		}
		ifdead
		{
			action PTHROWNBACK
			// tossweapon
		}
	
		ifvarg INVULNTIME 0 state invulnflash
		else ifvarl PLAYERDAMAGE 1 state nullflash
		else state random_wall_jibs
	
		break
	}
	
	ifaction PFLINTCHING
	{
		ifactioncount 2 state setplayeraction_pstand
		break
	}

	ifinwater
	{
		ifaction PTREDWATER
		{
			ifp pwalking prunning
			{
				state setplayeraction_pswimminggo
			}
		}
		else
		ifp pstanding pwalkingback prunningback
		{
			state setplayeraction_ptredwater
		}
		else
		{
			ifaction PSWIMMING
			{
				ifrnd 4 { ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds }
				ifactioncount 4
				{
					state setplayeraction_pswimmingwait
				}
			}
			else
			ifaction PSWIMMINGWAIT
			{
				ifactioncount 2
				{
					state setplayeraction_pswimminggo
				}
			}
			else
			ifaction PSWIMMINGGO
			{
				ifactioncount 2
				{
					state setplayeraction_pswimming
				}
			}
			else
			{
				state setplayeraction_ptredwater
			}
		}
	
		ifrnd 4 { ifvare VEHICLEID -1 spawn WATERBUBBLE state bubblesounds } // For effect
	
		break
	}
	else ifp pjetpack
	{
		ifaction PJPHOUVER
		{
			ifactioncount 4 resetactioncount
		}
		else
		{
			state setplayeraction_pjphouver
		}
		break
	}
	else
	{
		ifaction PTREDWATER
		{
			state setplayeraction_pstand
		}
		ifaction PSWIMMING
		{
			state setplayeraction_pstand
		}
		ifaction PSWIMMINGWAIT
		{
			state setplayeraction_pstand
		}
		ifaction PSWIMMINGGO
		{
			state setplayeraction_pstand
		}
		ifaction PJPHOUVER
		{
			state setplayeraction_pfalling
		}
	}
	
	ifaction PFALLING
	{
		state STOPSTEPSOUNDS_PLAYER
		ifp ponground
		{
			state setplayeraction_pstand
			state landsounds_player
		}
		else
		{
			ifp pfalling break else state check_pstandard
		}
	}

	ifaction PDUCKING
	{
		state STOPSTEPSOUNDS_PLAYER
		ifgapzl 48
		{
			ifp pwalking pwalkingback prunning prunningback
			{
				state setplayeraction_pcrawling
			}
		}
		else ifp pducking
		{
			ifp pwalking pwalkingback prunning prunningback
			{
				state setplayeraction_pcrawling
			}
		}
		else
		{
			ifp pstanding
			{
				state setplayeraction_pstand
			}
			else
			{
				state check_pstandard
			}
		}
	}
	else ifaction PCRAWLING
	{
		state STOPSTEPSOUNDS_PLAYER
		ifgapzl 48
		{
			ifp pstanding
			{
				state setplayeraction_pcrawling
			}
		}
		else
		ifp pducking
		{
			ifp pstanding
			{
				state setplayeraction_pducking
			}
		}
		else
		{
			ifp pstanding
			{
				state setplayeraction_pstand
			}
			else
			{
				state check_pstandard
			}
		}
	}
	else
	ifgapzl 48
	{
		state setplayeraction_pducking
	}
	else
	ifaction PJUMPING
	{
		state STOPSTEPSOUNDS_PLAYER
		ifp ponground
		{
			state setplayeraction_pstand
		}
		else
		ifactioncount 4
		{
			ifp pfalling
			{
				state setplayeraction_pfalling
			}
		}
	}

	ifp pfalling
	{
		state setplayeraction_pfalling
	}
	else
	ifaction PSTAND
	{
		state check_pstandard
	}
	else
	ifaction PAKICKING
	{
		ifactioncount 2
		{
			state setplayeraction_pstand
		}
		break
	}
	else
	ifaction PWALK
	{
		ifp pfalling
		{
			state setplayeraction_pfalling
		}
		else
		ifp pstanding
		{
			state setplayeraction_pstand
		}
		else
		ifp prunning
		{
			state setplayeraction_prun
		}
		else
		ifp pwalkingback
		{
			state setplayeraction_pwalkback
		}
		else
		ifp prunningback
		{
			state setplayeraction_prunback
		}
		else
		ifp pjumping
		{
			state setplayeraction_pjumping
		}
		else
		ifp pducking
		{
			state setplayeraction_pducking
		}
	}
	else
	ifaction PRUN
	{
		ifp pstanding
		{
			state setplayeraction_pstand
		}
		else
		ifp pwalking
		{
			state setplayeraction_pwalk
		}
		else
		ifp pwalkingback
		{
			state setplayeraction_pwalkback
		}
		else
		ifp prunningback
		{
			state setplayeraction_prunback
		}
		else
		ifp pjumping
		{
			state setplayeraction_pjumping
		}
		else
		ifp pducking
		{
			state setplayeraction_pducking
		}
	}
	else
	ifaction PWALKBACK
	{
		ifp pstanding
		{
			state setplayeraction_pstand
		}
		else
		ifp pwalking
		{
			state setplayeraction_pwalk
		}
		else
		ifp prunning
		{
			state setplayeraction_prun
		}
		else
		ifp prunningback
		{
			state setplayeraction_prunback
		}
		else
		ifp pjumping
		{
			state setplayeraction_pjumping
		}
		else
		ifp pducking
		{
			state setplayeraction_pducking
		}
	}
	else
	ifaction PRUNBACK
	{
		ifp pstanding
		{
			state setplayeraction_pstand
		}
		else
		ifp pwalking
		{
			state setplayeraction_pwalk
		}
		else
		ifp prunning
		{
			state setplayeraction_prun
		}
		else
		ifp pwalkingback
		{
			state setplayeraction_pwalkback
		}
		else
		ifp pjumping
		{
			state setplayeraction_pjumping
		}
		else
		ifp pducking
		{
			state setplayeraction_pducking
		}
	}
	// Riot Tank
	else
	ifaction PTANKWAIT
	{
		ifvare VEHICLEID -1
		{
			ifp pstanding
			{
			state setplayeraction_pstand
			}
			else
			ifp pwalking
			{
			state setplayeraction_pwalk
			}
			else
			ifp prunning
			{
			state setplayeraction_prun
			}
			else
			ifp pwalkingback
			{
			state setplayeraction_pwalkback
			}
			else
			ifp pjumping
			{
			state setplayeraction_pjumping
			}
			else
			ifp pducking
			{
			state setplayeraction_pducking
			}
		}
	}

enda

