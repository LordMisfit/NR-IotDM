//************************************
//************************************
//**DamageHazard Formulas and States**
//************************************
//************************************

//***************************
//*ENEMY SIDE TILEEMUL stuff*
//***************************
state enemyfloordamagesounds
	ifvarg ACTORHP 0 state monsterpainsounds2
ends

state enemybootscheck
	subvarvar ACTORBOOTSAMOUNT TEMPVAR
	ifvarl ACTORBOOTSAMOUNT 1
	{
		debris SCRAP1 1
		debris SCRAP2 1
		debris SCRAP3 1
		setvar ACTORBOOTSAMOUNT 0
	}
ends

state enemycheckhealthdmgflr
	setvarvar TEMPFLRDMG ACTORHP
ends

state enemycheckdamagefloor
	ifvarl TEMP6 1 state showdamage_actor-dmgflrhp
	setvar FLOORDAMAGETEMP 0
	ifvarg TEMPFLRDMG -1
	{
		setvarvar ACTORHP TEMPFLRDMG
		setvarvar tempb ACTORHP
		ifvarl TEMPFLRDMG 0
		{
			setvarvar ACTORHP 0
			setactor[THISACTOR].extra 0
			state checkactorsurvivalvalue
			setactor[THISACTOR].htpicnum RPG
			setvarvar tempe THISACTOR 
			ifvarl THISACTOR 16383 addvar tempe 1 else subvar tempe 1
			setactor[THISACTOR].htowner THISACTOR // tempe
			setactor[THISACTOR].htextra 1
			setvarvar tempc ACTORHP
		}
	}
	else
	{
		setvarvar ACTORHP 0
		setactor[THISACTOR].extra 0
		state checkactorsurvivalvalue
		setactor[THISACTOR].htpicnum RPG
		setvarvar tempe THISACTOR 
		ifvarl THISACTOR 16383 addvar tempe 1 else subvar tempe 1
		setactor[THISACTOR].htowner THISACTOR // tempe
		setactor[THISACTOR].htextra 1
		setvarvar tempc ACTORHP
	}
ends

state check-heatratio-enemy
	getactor[THISACTOR].sectnum tempf
	getactorvar[tempf].FLOORHEATRATIO tempg
	mulvarvar FLOORDAMAGETEMP tempg
	divvar FLOORDAMAGETEMP 100
ends

state enemyelitecheckdmgflr
	ifvarand ACTORFLAGS 512 // Elite Monsters Suffer 6.3% to 12.5% Sector-Based Damage
	{
		randvar TEMP 62
		addvar TEMP 63
		mulvarvar FLOORDAMAGETEMP TEMP
		divvar FLOORDAMAGETEMP 1000
		ifvarl FLOORDAMAGETEMP 1 { ifrnd 128 setvar FLOORDAMAGETEMP 0 else setvar FLOORDAMAGETEMP 1 }
	}
	
	ifvarn ENEMYHASSHIKON? 0
	{
		divvar FLOORDAMAGETEMP 10
		ifvarl FLOORDAMAGETEMP 1 { ifrnd 231 setvar FLOORDAMAGETEMP 0 else setvar FLOORDAMAGETEMP 1 }
	}
	
	getactor[THISACTOR].sectnum tempf
	getsector[tempf].floorpicnum tempg
	ifvare tempg NEWFLOORPLASMA state check-heatratio-enemy
	ifvare tempg HOTLAVA state check-heatratio-enemy
	ifvare tempg MEGALAVA state check-heatratio-enemy
	ifvare tempg ULTRALAVA state check-heatratio-enemy
	ifvare tempg HYPERMAGMA state check-heatratio-enemy
ends

state enemydealflrdmg
	ifvare SHRUNK? 1
	{
		ifrnd 128 mulvar FLOORDAMAGETEMP 5 else mulvar FLOORDAMAGETEMP 4
	}
	subvarvar TEMPFLRDMG FLOORDAMAGETEMP 
	ifvarg FLOORDAMAGETEMP 0 setvar ACTORHPDAMAGED? 1
	state enemyfloordamagesounds
	state enemycheckdamagefloor
ends

state enemydmgflr_hpmaxcalcend
	ifvarl tempe 1 setvar tempe 1
	addvarvar FLOORDAMAGETEMP tempe
	state enemyelitecheckdmgflr
	state enemydealflrdmg
ends

state enemynewfloorslime_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 setvar tempd 0
		ifvare SKILLLEVEL 8 setvar tempd 0
		ifvare SKILLLEVEL 7 setvar tempd 0
		ifvare SKILLLEVEL 6 setvar tempd 0
		ifvare SKILLLEVEL 5 setvar tempd 0
		ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 1 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
	}
	else setvar tempd 1 // 0.1%
	mulvarvar tempe tempd
ends

state enemy-newfloorslime
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}

		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
			case EMPTYTANK
			case TANK
			case SCORPIONTANK
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 4
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 2 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewfloorslime_hpmaxcalc
							divvar tempe 1500
							state enemydmgflr_hpmaxcalcend
						}
					}
				}
				else ifrnd 4 sound INVULNITEM3
				break

			case BOSS1
			case BOSS2
			case BOSS3
			case BOSS4
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 2
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 1
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 0
							state enemynewfloorslime_hpmaxcalc
							divvar tempe 2250
							state enemydmgflr_hpmaxcalcend
							ifrnd 4 state addpoison_actor
							ifrnd 4 state addcorrosion_actor
						}
					}
				}
				else ifrnd 2 sound INVULNITEM3
				break

			case OCTABRAIN
				ifspritepal 14 nullop
				else
				{
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 16
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								subvar ACTORBOOTSAMOUNT 1 
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3 
								mulvar FLOORDAMAGETEMP 1 
								addvar FLOORDAMAGETEMP 1
								state enemynewfloorslime_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
								ifrnd 4 state addpoison_actor
								ifrnd 4 state addcorrosion_actor
							}
						}
					}
					else
					{
						ifrnd 16 sound INVULNITEM3
					}
				}
				break

			case BOOTS
				ifrnd 16
				{
					setvar FLOORDAMAGETEMP 1
					subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
					// addlogvar POWERUPBENEFIT
				}
				break

			// Drones and Turrents are machines and therefore poisoning cannot be done to them.
			case DRONE
			case ROTATEGUN
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 16
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 3 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewfloorslime_hpmaxcalc
							divvar tempe 1000
							state enemydmgflr_hpmaxcalcend
						}
					}
				}
				else ifrnd 16 sound INVULNITEM3
				break

			default
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 16
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 3 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewfloorslime_hpmaxcalc
							divvar tempe 1000
							state enemydmgflr_hpmaxcalcend
							ifrnd 4 state addpoison_actor
							ifrnd 4 state addcorrosion_actor
						}
					}
				}
				else ifrnd 16 sound INVULNITEM3
				break
			endswitch 

			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}

ends

state enemynewhurtrail_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 setvar tempd 0
		ifvare SKILLLEVEL 8 setvar tempd 0
		ifvare SKILLLEVEL 7 setvar tempd 0
		ifvare SKILLLEVEL 6 setvar tempd 0
		ifvare SKILLLEVEL 5 setvar tempd 0
		ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 1 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
	}
	else setvar tempd 1 // 0.1%
	mulvarvar tempe tempd
ends

state enemy-newhurtrail
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
			case EMPTYTANK
			case TANK
			case SCORPIONTANK
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 8
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 2 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewhurtrail_hpmaxcalc
							divvar tempe 1500
							state enemydmgflr_hpmaxcalcend
							sound SHORT_CIRCUIT
						}
					}
				}
				else ifrnd 8 sound INVULNITEM3
			break
	
			case BOSS1
			case BOSS2
			case BOSS3
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 4
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 1
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 0
							state enemynewhurtrail_hpmaxcalc
							divvar tempe 2250
							state enemydmgflr_hpmaxcalcend
							sound SHORT_CIRCUIT
						}
					}
				}
				else ifrnd 4 sound INVULNITEM3
			break
	
			case BOSS4
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 4
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 12
							mulvar FLOORDAMAGETEMP 4
							addvar FLOORDAMAGETEMP 4

							setvarvar tempe ACTORMAXHP
							ifvare DMGFLRTYPE 0
							{
								ifvare SKILLLEVEL 9 setvar tempd 0
								ifvare SKILLLEVEL 8 setvar tempd 0
								ifvare SKILLLEVEL 7 setvar tempd 0
								ifvare SKILLLEVEL 6 setvar tempd 0
								ifvare SKILLLEVEL 5 setvar tempd 0
								ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 0 }
								ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
								ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
								ifvare SKILLLEVEL 1 { randvar tempd 1 addvar tempd 1 }
								ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
							}
							else setvar tempd 1 // 0.1%
							mulvarvar tempe tempd
							divvar tempe 2250

							ifvare SHRUNK? 1
							{
								ifrnd 128 mulvar FLOORDAMAGETEMP 5 else mulvar FLOORDAMAGETEMP 4
							}
							addvarvar TEMPFLRDMG FLOORDAMAGETEMP 
							ifvarg FLOORDAMAGETEMP 0 soundonce ABSORB_DAMAGE
			
							setvarvar ITEMSEEK THISACTOR
							setvarvar ITEMSEEKC FLOORDAMAGETEMP
							state showhealing_actorhp
							setvarvar TEMP6 FLOORDAMAGETEMP
			
							setvar ACTORHPDAMAGED? -1
							state enemycheckdamagefloor
							sound SHORT_CIRCUIT
						}
					}
				}
				else ifrnd 4 sound INVULNITEM3
			break
	
			case NEWBEAST
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 32
					{
						state enemycheckhealthdmgflr 
						randvar FLOORDAMAGETEMP 3 
						mulvar FLOORDAMAGETEMP 1 
						addvar FLOORDAMAGETEMP 1

						setvarvar tempe ACTORMAXHP
						ifvare DMGFLRTYPE 0
						{
							ifvare SKILLLEVEL 9 setvar tempd 0
							ifvare SKILLLEVEL 8 setvar tempd 0
							ifvare SKILLLEVEL 7 setvar tempd 0
							ifvare SKILLLEVEL 6 setvar tempd 0
							ifvare SKILLLEVEL 5 setvar tempd 0
							ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 0 }
							ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
							ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
							ifvare SKILLLEVEL 1 { randvar tempd 1 addvar tempd 1 }
							ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
						}
						else setvar tempd 1 // 0.1%
						mulvarvar tempe tempd
						divvar tempe 1000

						ifspritepal 17 { mulvar FLOORDAMAGETEMP 5 divvar FLOORDAMAGETEMP 2 }
						else ifspritepal 20 mulvar FLOORDAMAGETEMP 4
						getactor[THISACTOR].extra temp
						ifvarg temp -1 
						{
							ifvare SHRUNK? 1
							{
								ifrnd 128 mulvar FLOORDAMAGETEMP 5 else mulvar FLOORDAMAGETEMP 4
							}
							addvarvar TEMPFLRDMG FLOORDAMAGETEMP
							ifvarg FLOORDAMAGETEMP 0 soundonce ABSORB_DAMAGE
			
							setvarvar ITEMSEEK THISACTOR
							setvarvar ITEMSEEKC FLOORDAMAGETEMP
							state showhealing_actorhp
							setvarvar TEMP6 FLOORDAMAGETEMP
			
							setvar ACTORHPDAMAGED? -1
							state enemycheckdamagefloor
							sound SHORT_CIRCUIT
						}      
					}
				}
				else ifrnd 32 sound INVULNITEM3
			break
	
			case OCTABRAIN
				ifspritepal 14 nullop
				else
				{
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 32
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								subvar ACTORBOOTSAMOUNT 1 
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3 
								mulvar FLOORDAMAGETEMP 1 
								addvar FLOORDAMAGETEMP 1
								state enemynewhurtrail_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
								sound SHORT_CIRCUIT
							}
						}
					}
					else ifrnd 32 sound INVULNITEM3
				}
			break
	
			case DRONE
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 32
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 3 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							ifspritepal 25 { mulvar FLOORDAMAGETEMP 5 divvar FLOORDAMAGETEMP 4 } else mulvar FLOORDAMAGETEMP 2
							state enemynewhurtrail_hpmaxcalc
							divvar tempe 1000
							state enemydmgflr_hpmaxcalcend
							sound SHORT_CIRCUIT
						}
					}
				}
				else ifrnd 32 sound INVULNITEM3
			break
	
			case BOOTS
				ifrnd 32
				{
					setvar FLOORDAMAGETEMP 1
					subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
				}
			break
	
			default
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 32
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 3 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewhurtrail_hpmaxcalc
							divvar tempe 1000
							state enemydmgflr_hpmaxcalcend
							sound SHORT_CIRCUIT
						}
					}
				}
				else ifrnd 32 sound INVULNITEM3
				break
			endswitch 
	
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state enemynewfloorplasma_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 setvar tempd 0
		ifvare SKILLLEVEL 8 setvar tempd 0
		ifvare SKILLLEVEL 7 setvar tempd 0
		ifvare SKILLLEVEL 6 setvar tempd 0
		ifvare SKILLLEVEL 5 setvar tempd 0
		ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 1 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
	}
	else setvar tempd 1 // 0.1%
	mulvarvar tempe tempd
ends

state enemy-newfloorplasma
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
			case EMPTYTANK
			case TANK
			case SCORPIONTANK
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 8
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 2 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewfloorplasma_hpmaxcalc
							divvar tempe 1500
							state enemydmgflr_hpmaxcalcend
						}
					}
				}
				else ifrnd 8 sound INVULNITEM3
				break
	
			case BOSS1
			case BOSS2
			case BOSS3
			case BOSS4
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 4
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 1
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 0
							state enemynewfloorplasma_hpmaxcalc
							divvar tempe 2250
							state enemydmgflr_hpmaxcalcend
						}
					}
				}
				else ifrnd 4 sound INVULNITEM3
				break
	
			case OCTABRAIN
				ifspritepal 14 nullop
				else
				{
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 32
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								subvar ACTORBOOTSAMOUNT 1 
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3 
								mulvar FLOORDAMAGETEMP 1 
								addvar FLOORDAMAGETEMP 1
								state enemynewfloorplasma_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 32 sound INVULNITEM3
				}
				break
	
			case BOOTS
				ifrnd 32
				{
					setvar FLOORDAMAGETEMP 1
					subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
				}
				break
	
			default
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 32
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{ 
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							randvar FLOORDAMAGETEMP 3 
							mulvar FLOORDAMAGETEMP 1 
							addvar FLOORDAMAGETEMP 1
							state enemynewfloorplasma_hpmaxcalc
							divvar tempe 1000
							state enemydmgflr_hpmaxcalcend
						}
					}
				}
				else ifrnd 32 sound INVULNITEM3
				break
			endswitch 
	
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state enemynewpurplelava_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 setvar tempd 0
		ifvare SKILLLEVEL 8 setvar tempd 0
		ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
		ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 2 }
		ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 2 }
		ifvare SKILLLEVEL 1 { randvar tempd 2 addvar tempd 2 }
		ifvare SKILLLEVEL 0 { randvar tempd 2 addvar tempd 2 }
	}
	else setvar tempd 2 // 0.1%
	mulvarvar tempe tempd
ends

state enemy-newpurplelava
  ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
  {
		getactor[THISACTOR].picnum TEMPVAR4
		ifvare TEMPVAR4 BOOTS
		{
			ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
		}
		else
		{
			ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
		}
  }

	ifvare ACTORDAMAGEFLOORTIMER 1
	{
		ifvarl ACTORBOOTSAMOUNT 1 setvar FLOORDAMAGETEMP 1
		getactor[THISACTOR].picnum TEMPVAR4
		switch TEMPVAR4
			case EMPTYTANK
			case TANK
			case SCORPIONTANK
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 64
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{  
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							setvar FLOORDAMAGETEMP 1
							state enemynewpurplelava_hpmaxcalc
							divvar tempe 1500
							state enemydmgflr_hpmaxcalcend
						}
					}
				}
				else ifrnd 64 sound INVULNITEM3
				break
	
			case BOSS1
			case BOSS2
			case BOSS3
			case BOSS4
				ifvarl ACTORINVULNTIME 1
				{
					ifrnd 32
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{  
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							setvar FLOORDAMAGETEMP 1
							state enemynewpurplelava_hpmaxcalc
							divvar tempe 2250
							state enemydmgflr_hpmaxcalcend
							ifrnd 12 state addpoison_actor
							ifrnd 12 state addcorrosion_actor
						}
					}
				}
				else ifrnd 32 sound INVULNITEM3
				break
	
			case OCTABRAIN
				ifspritepal 14 nullop
				else
				{ 
					ifvarl ACTORINVULNTIME 1
					{
						ifvarg ACTORBOOTSAMOUNT 0 
						{  
							subvar ACTORBOOTSAMOUNT 1 
							state enemybootscheck
						} 
						else 
						{ 
							state enemycheckhealthdmgflr 
							setvar FLOORDAMAGETEMP 1
							state enemynewpurplelava_hpmaxcalc
							divvar tempe 1000
							state enemydmgflr_hpmaxcalcend
							ifrnd 12 state addpoison_actor
							ifrnd 12 state addcorrosion_actor
						}
					}
					else sound INVULNITEM3
				}
			break
	
			case BOOTS
				setvar FLOORDAMAGETEMP 1
				subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
				break
	
			// Drones and Turrents are machines and therefore poisoning cannot be done to them.
			case DRONE
			case ROTATEGUN
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg ACTORBOOTSAMOUNT 0 
					{  
						subvar ACTORBOOTSAMOUNT 1 
						state enemybootscheck
					} 
					else 
					{ 
						state enemycheckhealthdmgflr 
						setvar FLOORDAMAGETEMP 1
						state enemynewpurplelava_hpmaxcalc
						divvar tempe 1000
						state enemydmgflr_hpmaxcalcend
					}
				}
				else sound INVULNITEM3
				break
	
			default
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg ACTORBOOTSAMOUNT 0 
					{  
						subvar ACTORBOOTSAMOUNT 1 
						state enemybootscheck
					} 
					else 
					{ 
						state enemycheckhealthdmgflr 
						setvar FLOORDAMAGETEMP 1
						state enemynewpurplelava_hpmaxcalc
						divvar tempe 1000
						state enemydmgflr_hpmaxcalcend
						ifrnd 12 state addpoison_actor
						ifrnd 12 state addcorrosion_actor
					}
				}
				else sound INVULNITEM3
				break
		endswitch 
	
		setvar ACTORDAMAGEFLOORTIMER 0
	}
ends

state enemyhotlava_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 randvar tempd 1
		ifvare SKILLLEVEL 8 randvar tempd 1
		ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 2 }
		ifvare SKILLLEVEL 6 { randvar tempd 2 addvar tempd 1 }
		ifvare SKILLLEVEL 5 { randvar tempd 2 addvar tempd 2 }
		ifvare SKILLLEVEL 4 { randvar tempd 3 addvar tempd 3 }
		ifvare SKILLLEVEL 3 { randvar tempd 4 addvar tempd 4 }
		ifvare SKILLLEVEL 2 { randvar tempd 6 addvar tempd 6 }
		ifvare SKILLLEVEL 1 { randvar tempd 9 addvar tempd 9 }
		ifvare SKILLLEVEL 0 { randvar tempd 14 addvar tempd 13 }
	}
	else setvar tempd 13 // 1.3%
	mulvarvar tempe tempd
ends

state enemy-hotlava
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
				case EMPTYTANK
				case TANK
				case SCORPIONTANK
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 16
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 1
								addvar TEMPVAR 5
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3
								mulvar FLOORDAMAGETEMP 6
								addvar FLOORDAMAGETEMP 5
								state enemyhotlava_hpmaxcalc
								divvar tempe 1500
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 16 sound INVULNITEM3
					break
		
				case BOSS1
				case BOSS2
				case BOSS3
				case BOSS4
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 8
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 1
								addvar TEMPVAR 5
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 1
								mulvar FLOORDAMAGETEMP 5
								addvar FLOORDAMAGETEMP 2
								state enemyhotlava_hpmaxcalc
								divvar tempe 2250
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 8 sound INVULNITEM3
					break
		
				case OCTABRAIN
					ifspritepal 14 nullop
					else
					{
						ifvarl ACTORINVULNTIME 1
						{
							ifrnd 64
							{
								ifvarg ACTORBOOTSAMOUNT 0 
								{ 
									randvar TEMPVAR 1
									addvar TEMPVAR 5
									state enemybootscheck
								} 
								else 
								{ 
									state enemycheckhealthdmgflr 
									randvar FLOORDAMAGETEMP 4 
									mulvar FLOORDAMAGETEMP 9 
									addvar FLOORDAMAGETEMP 9
									state enemyhotlava_hpmaxcalc
									divvar tempe 1000
									state enemydmgflr_hpmaxcalcend
								}
							}
						}
						else ifrnd 64 sound INVULNITEM3
					}
					break
		
				case BOOTS
					ifrnd 64
					{
						randvar FLOORDAMAGETEMP 1
						addvar FLOORDAMAGETEMP 5
						subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
					}
					break
		
				default
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 64
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 1
								addvar TEMPVAR 5
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 4 
								mulvar FLOORDAMAGETEMP 9 
								addvar FLOORDAMAGETEMP 9
								state enemyhotlava_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 64 sound INVULNITEM3
					break
			endswitch 
		
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state enemyamoebaacid_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 setvar tempd 0
		ifvare SKILLLEVEL 8 setvar tempd 0
		ifvare SKILLLEVEL 7 randvar tempd 1
		ifvare SKILLLEVEL 6 randvar tempd 1
		ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 4 { randvar tempd 2 addvar tempd 1 }
		ifvare SKILLLEVEL 3 { randvar tempd 2 addvar tempd 2 }
		ifvare SKILLLEVEL 2 { randvar tempd 3 addvar tempd 3 }
		ifvare SKILLLEVEL 1 { randvar tempd 5 addvar tempd 4 }
		ifvare SKILLLEVEL 0 { randvar tempd 7 addvar tempd 6 }
	}
	else { randvar tempd 1 addvar tempd 6 } // 0.6% to 0.7%
	mulvarvar tempe tempd
ends

state enemy-amoebaacid
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
				case EMPTYTANK
				case TANK
				case SCORPIONTANK
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 10
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 1
								addvar TEMPVAR 2
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3
								mulvar FLOORDAMAGETEMP 3
								addvar FLOORDAMAGETEMP 2
								state enemyamoebaacid_hpmaxcalc
								divvar tempe 1500
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 10 sound INVULNITEM3
					break
		
				case BOSS1
				case BOSS2
				case BOSS3
				case BOSS4
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 5
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 1
								addvar TEMPVAR 2
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 1
								mulvar FLOORDAMAGETEMP 2
								addvar FLOORDAMAGETEMP 1
								state enemyamoebaacid_hpmaxcalc
								divvar tempe 2250
								state enemydmgflr_hpmaxcalcend
								ifrnd 40 state addpoison_actor
								ifrnd 40 state addcorrosion_actor
							}
						}
					}
					else ifrnd 5 sound INVULNITEM3
					break
		
				case OCTABRAIN
					ifspritepal 14 nullop
					else
					{
						ifvarl ACTORINVULNTIME 1
						{
							ifrnd 40
							{
								ifvarg ACTORBOOTSAMOUNT 0 
								{ 
									randvar TEMPVAR 1
									addvar TEMPVAR 2
									state enemybootscheck
								} 
								else 
								{ 
									state enemycheckhealthdmgflr 
									randvar FLOORDAMAGETEMP 4
									mulvar FLOORDAMAGETEMP 4
									addvar FLOORDAMAGETEMP 4
									state enemyamoebaacid_hpmaxcalc
									divvar tempe 1000
									state enemydmgflr_hpmaxcalcend
									ifrnd 40 state addpoison_actor
									ifrnd 40 state addcorrosion_actor
								}
							}
						}
						else ifrnd 40 sound INVULNITEM3
					}
					break
		
				case BOOTS
					ifrnd 40
					{
						randvar FLOORDAMAGETEMP 1
						addvar FLOORDAMAGETEMP 2
						subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
					}
					break
		
				default
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 40
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 1
								addvar TEMPVAR 2
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 4
								mulvar FLOORDAMAGETEMP 4
								addvar FLOORDAMAGETEMP 4
								state enemyamoebaacid_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
								ifrnd 40 state addpoison_actor
								ifrnd 40 state addcorrosion_actor
							}
						}
					}
					else ifrnd 40 sound INVULNITEM3
					break
			endswitch 
		
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state enemymegalava_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
		ifvare SKILLLEVEL 8 { randvar tempd 2 addvar tempd 1 }
		ifvare SKILLLEVEL 7 { randvar tempd 3 addvar tempd 2 }
		ifvare SKILLLEVEL 6 { randvar tempd 4 addvar tempd 3 }
		ifvare SKILLLEVEL 5 { randvar tempd 5 addvar tempd 5 }
		ifvare SKILLLEVEL 4 { randvar tempd 8 addvar tempd 7 }
		ifvare SKILLLEVEL 3 { randvar tempd 10 addvar tempd 10 }
		ifvare SKILLLEVEL 2 { randvar tempd 15 addvar tempd 15 }
		ifvare SKILLLEVEL 1 { randvar tempd 23 addvar tempd 22 }
		ifvare SKILLLEVEL 0 { randvar tempd 34 addvar tempd 33 }
	}
	else { randvar tempd 1 addvar tempd 33 } // 3.3% to 3.4%
	mulvarvar tempe tempd
ends

state enemy-megalava
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
				case EMPTYTANK
				case TANK
				case SCORPIONTANK
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 24
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 2
								addvar TEMPVAR 7
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3
								mulvar FLOORDAMAGETEMP 50
								addvar FLOORDAMAGETEMP 42
								state enemymegalava_hpmaxcalc
								divvar tempe 1500
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 24 sound INVULNITEM3
					break
		
				case BOSS1
				case BOSS2
				case BOSS3
				case BOSS4
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 12
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 2
								addvar TEMPVAR 7
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 2
								mulvar FLOORDAMAGETEMP 38
								addvar FLOORDAMAGETEMP 20
								state enemymegalava_hpmaxcalc
								divvar tempe 2250
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 12 sound INVULNITEM3
					break
		
				case OCTABRAIN
					ifspritepal 14 nullop
					else
					{
						ifvarl ACTORINVULNTIME 1
						{
							ifrnd 96
							{
								ifvarg ACTORBOOTSAMOUNT 0 
								{ 
									randvar TEMPVAR 2
									addvar TEMPVAR 7
									state enemybootscheck
								} 
								else 
								{ 
									state enemycheckhealthdmgflr 
									randvar FLOORDAMAGETEMP 5
									mulvar FLOORDAMAGETEMP 75
									addvar FLOORDAMAGETEMP 75
									state enemymegalava_hpmaxcalc
									divvar tempe 1000
									state enemydmgflr_hpmaxcalcend
								}
							}
						}
						else ifrnd 96 sound INVULNITEM3
					}
					break
		
				case BOOTS
					ifrnd 96
					{
						randvar FLOORDAMAGETEMP 2
						addvar FLOORDAMAGETEMP 7
						subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
					}
					break
		
				default
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 96
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 2
								addvar TEMPVAR 7
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 5
								mulvar FLOORDAMAGETEMP 75
								addvar FLOORDAMAGETEMP 75
								state enemymegalava_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 96 sound INVULNITEM3
					break
			endswitch 
		
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state enemyultramagma_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 { randvar tempd 5 addvar tempd 5 }
		ifvare SKILLLEVEL 8 { randvar tempd 8 addvar tempd 7 }
		ifvare SKILLLEVEL 7 { randvar tempd 10 addvar tempd 10 }
		ifvare SKILLLEVEL 6 { randvar tempd 15 addvar tempd 15 }
		ifvare SKILLLEVEL 5 { randvar tempd 20 addvar tempd 20 }
		ifvare SKILLLEVEL 4 { randvar tempd 30 addvar tempd 30 }
		ifvare SKILLLEVEL 3 { randvar tempd 40 addvar tempd 40 }
		ifvare SKILLLEVEL 2 { randvar tempd 60 addvar tempd 60 }
		ifvare SKILLLEVEL 1 { randvar tempd 90 addvar tempd 90 }
		ifvare SKILLLEVEL 0 { randvar tempd 135 addvar tempd 135 }
	}
	else setvar tempd 135 // 13.5%
	mulvarvar tempe tempd
ends

state enemy-ultramagma
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
				case EMPTYTANK
				case TANK
				case SCORPIONTANK
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 32
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 3
								addvar TEMPVAR 12
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3
								mulvar FLOORDAMAGETEMP 160
								addvar FLOORDAMAGETEMP 133
								state enemyultramagma_hpmaxcalc
								divvar tempe 1500
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 32 sound INVULNITEM3
					break
		
				case BOSS1
				case BOSS2
				case BOSS3
				case BOSS4
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 16
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 3
								addvar TEMPVAR 12
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 2
								mulvar FLOORDAMAGETEMP 120
								addvar FLOORDAMAGETEMP 64
								state enemyultramagma_hpmaxcalc
								divvar tempe 2250
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 16 sound INVULNITEM3
					break
		
				case OCTABRAIN
					ifspritepal 14 nullop
					else
					{
						ifvarl ACTORINVULNTIME 1
						{
							ifrnd 128
							{
								ifvarg ACTORBOOTSAMOUNT 0 
								{ 
									randvar TEMPVAR 3
									addvar TEMPVAR 12
									state enemybootscheck
								} 
								else 
								{ 
									state enemycheckhealthdmgflr 
									randvar FLOORDAMAGETEMP 5
									mulvar FLOORDAMAGETEMP 240
									addvar FLOORDAMAGETEMP 240
									state enemyultramagma_hpmaxcalc
									divvar tempe 1000
									state enemydmgflr_hpmaxcalcend
								}
							}
						}
						else ifrnd 128 sound INVULNITEM3
					}
					break
		
				case BOOTS
					ifrnd 128
					{
						randvar FLOORDAMAGETEMP 3
						addvar FLOORDAMAGETEMP 12
						subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
					}
					break
		
				default
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 128
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 3
								addvar TEMPVAR 12
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 5
								mulvar FLOORDAMAGETEMP 240
								addvar FLOORDAMAGETEMP 240
								state enemyultramagma_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 128 sound INVULNITEM3
					break
			endswitch 
		
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state enemyhypermagma_hpmaxcalc
	setvarvar tempe ACTORMAXHP
	ifvare DMGFLRTYPE 0
	{
		ifvare SKILLLEVEL 9 { randvar tempd 20 addvar tempd 20 }
		ifvare SKILLLEVEL 8 { randvar tempd 32 addvar tempd 32 }
		ifvare SKILLLEVEL 7 { randvar tempd 40 addvar tempd 40 }
		ifvare SKILLLEVEL 6 { randvar tempd 60 addvar tempd 60 }
		ifvare SKILLLEVEL 5 { randvar tempd 80 addvar tempd 80 }
		ifvare SKILLLEVEL 4 { randvar tempd 120 addvar tempd 120 }
		ifvare SKILLLEVEL 3 { randvar tempd 160 addvar tempd 160 }
		ifvare SKILLLEVEL 2 { randvar tempd 240 addvar tempd 240 }
		ifvare SKILLLEVEL 1 { randvar tempd 360 addvar tempd 360 }
		ifvare SKILLLEVEL 0 { randvar tempd 540 addvar tempd 540 }
	}
	else setvar tempd 540 // 54.0%
	mulvarvar tempe tempd
ends

state enemy-hypermagma
	iffloordistl 16
	{
		ifvare mainmenu 0 ifvare ACTORDEATHSWITCHDELAY 0 
		{
			getactor[THISACTOR].picnum TEMPVAR4
			ifvare TEMPVAR4 BOOTS
			{
				ifvarl ITEMDROPPEDTIME 1 addvar ACTORDAMAGEFLOORTIMER 1
			}
			else
			{
				ifvarg ACTORHP 0 addvar ACTORDAMAGEFLOORTIMER 1
			}
		}
		
		ifvare ACTORDAMAGEFLOORTIMER 1
		{
			getactor[THISACTOR].picnum TEMPVAR4
			switch TEMPVAR4
				case EMPTYTANK
				case TANK
				case SCORPIONTANK
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 56
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 6
								addvar TEMPVAR 28
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 4
								mulvar FLOORDAMAGETEMP 533
								addvar FLOORDAMAGETEMP 443
								state enemyhypermagma_hpmaxcalc
								divvar tempe 1500
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 56 sound INVULNITEM3
					break
		
				case BOSS1
				case BOSS2
				case BOSS3
				case BOSS4
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 28
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 6
								addvar TEMPVAR 28
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 3
								mulvar FLOORDAMAGETEMP 400
								addvar FLOORDAMAGETEMP 214
								state enemyhypermagma_hpmaxcalc
								divvar tempe 2250
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 28 sound INVULNITEM3
					break
		
				case OCTABRAIN
					ifspritepal 14
					{ 
						ifvarl ACTORINVULNTIME 1
						{
							ifrnd 28
							{
								ifvarg ACTORBOOTSAMOUNT 0 
								{ 
									randvar TEMPVAR 6
									addvar TEMPVAR 28
									state enemybootscheck
								} 
								else 
								{ 
									state enemycheckhealthdmgflr 
									randvar FLOORDAMAGETEMP 3
									mulvar FLOORDAMAGETEMP 400
									addvar FLOORDAMAGETEMP 400
									state enemyhypermagma_hpmaxcalc
									divvar tempe 4000
									state enemydmgflr_hpmaxcalcend
								}
							}
						}
						else ifrnd 28 sound INVULNITEM3
					}
					else
					{
						ifvarl ACTORINVULNTIME 1
						{
							ifrnd 224
							{
								ifvarg ACTORBOOTSAMOUNT 0 
								{ 
									randvar TEMPVAR 6
									addvar TEMPVAR 28
									state enemybootscheck
								} 
								else 
								{ 
									state enemycheckhealthdmgflr 
									randvar FLOORDAMAGETEMP 6
									mulvar FLOORDAMAGETEMP 800
									addvar FLOORDAMAGETEMP 800
									state enemyhypermagma_hpmaxcalc
									divvar tempe 1000
									state enemydmgflr_hpmaxcalcend
								}
							}
						}
						else ifrnd 224 sound INVULNITEM3
					}
					break
		
				case BOOTS
					ifrnd 224
					{
						randvar FLOORDAMAGETEMP 6
						addvar FLOORDAMAGETEMP 28
						subvarvar POWERUPBENEFIT FLOORDAMAGETEMP 
					}
					break
		
				default
					ifvarl ACTORINVULNTIME 1
					{
						ifrnd 224
						{
							ifvarg ACTORBOOTSAMOUNT 0 
							{ 
								randvar TEMPVAR 6
								addvar TEMPVAR 28
								state enemybootscheck
							} 
							else 
							{ 
								state enemycheckhealthdmgflr 
								randvar FLOORDAMAGETEMP 6
								mulvar FLOORDAMAGETEMP 800
								addvar FLOORDAMAGETEMP 800
								state enemyhypermagma_hpmaxcalc
								divvar tempe 1000
								state enemydmgflr_hpmaxcalcend
							}
						}
					}
					else ifrnd 224 sound INVULNITEM3
					break
			endswitch 
		
			setvar ACTORDAMAGEFLOORTIMER 0
		}
	}
ends

state checkfreezetimer_heatratio2
	getactor[THISACTOR].sectnum TEMPVAR getactorvar[TEMPVAR].FLOORHEATRATIO temph
	mulvarvar tempg temph divvar tempg 100
ends

state enemytileemulationhurt
	getactor[THISACTOR].sectnum TEMPVAR
	//getactorvar[TEMPVAR].SECTOREXTRA ENEMYTILEEMUL
	
	ifvare sector[THISACTOR].lotag 2
	{
		ifvare CLOAKED? 0
		{
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5389 // NEWFLOORPLASMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 1 addvar tempg 2
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 3780 // HOTLAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 2 addvar tempg 5
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 4091 // MEGALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 8 addvar tempg 17
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5401 // ULTRALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 20 addvar tempg 41
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5443 // HYPERMAGMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 80 addvar tempg 161
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
		
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5385 state enemy-newfloorslime // NEWFLOORSLIME [Slime]
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 5388 state enemy-newhurtrail // NEWHURTRAIL [Electric Chair/Electrified Floors]
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 5389 state enemy-newfloorplasma // NEWFLOORPLASMA [Lava]   
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 5395 state enemy-newpurplelava // NEWPURPLELAVA [Superlava]
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 3780 state enemy-hotlava // HOTLAVA
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 3796 state enemy-amoebaacid // AMOEBAACID
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 4091 state enemy-megalava // MEGALAVA
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 5401 state enemy-ultramagma // ULTRALAVA
			else ifvare actorvar[TEMPVAR].SECTOREXTRA 5443 state enemy-hypermagma // HYPERMAGMA
			else // non-damagefloor
			{
				setvar ACTORDAMAGEFLOORTIMER 0
				setvar FLOORDAMAGETEMP 0
			} 
		}
	}
	else // Out of Water
	{
		ifvare CLOAKED? 0
		{
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5389 // NEWFLOORPLASMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 1 addvar tempg 2
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 3780 // HOTLAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 2 addvar tempg 5
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 4091 // MEGALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 8 addvar tempg 17
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5401 // ULTRALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 20 addvar tempg 41
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5443 // HYPERMAGMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 80 addvar tempg 161
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
		}
	
		getactor[THISACTOR].x x
		getactor[THISACTOR].y y
		updatesector x y TEMP
		getflorzofslope TEMP x y tempb
		getactor[THISACTOR].z tempc
		addvar tempc 256
		setvarvar tempe tempb
		addvar tempe -8
		addvar tempb 8
		getsector[THISACTOR].lotag temp
		ifvare temp 1 addvar tempb 6144
	
		ifvare CLOAKED? 0
		{
			ifvare actorvar[TEMPVAR].SECTOREXTRA 5395 state enemy-newpurplelava
			else ifvarvarl tempc tempb ifvarvarg tempc tempe 
			{
				ifvare actorvar[TEMPVAR].SECTOREXTRA 5385 state enemy-newfloorslime // NEWFLOORSLIME [Slime]
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 5388 state enemy-newhurtrail // NEWHURTRAIL [Electric Chair/Electrified Floors]
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 5389 state enemy-newfloorplasma // NEWFLOORPLASMA [Lava]
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 3780 state enemy-hotlava // HOTLAVA
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 3796 state enemy-amoebaacid // AMOEBAACID
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 4091 state enemy-megalava // MEGALAVA
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 5401 state enemy-ultramagma // ULTRALAVA
				else ifvare actorvar[TEMPVAR].SECTOREXTRA 5443 state enemy-hypermagma // HYPERMAGMA
				else // non-damagefloor
				{
					setvar ACTORDAMAGEFLOORTIMER 0
					setvar FLOORDAMAGETEMP 0
				}
			} // ifvarvarl tempc tempd ifvarvarg tempc tempe 
		} // ifvare CLOAKED? 0
	}
ends

state enemyceilinghurt
	ifvare sector[THISACTOR].lotag 2
	{
		ifvare CLOAKED? 0
		{
			ifvare sector[THISACTOR].ceilingpicnum 5389 // NEWFLOORPLASMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 1 addvar tempg 2
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].ceilingpicnum 3780 // HOTLAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 2 addvar tempg 5
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].ceilingpicnum 4091 // MEGALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 8 addvar tempg 17
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].ceilingpicnum 5401 // ULTRALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 20 addvar tempg 41
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].ceilingpicnum 5443 // HYPERMAGMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 80 addvar tempg 161
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
		
			ifvare sector[THISACTOR].ceilingpicnum 5385 state enemy-newfloorslime // NEWFLOORSLIME [Slime]
			else ifvare sector[THISACTOR].ceilingpicnum 5388 state enemy-newhurtrail // NEWHURTRAIL [Electric Chair/Electrified Floors]
			else ifvare sector[THISACTOR].ceilingpicnum 5389 state enemy-newfloorplasma // NEWFLOORPLASMA [Lava]
			else ifvare sector[THISACTOR].ceilingpicnum 5395 state enemy-newpurplelava // NEWPURPLELAVA [Superlava]
			else ifvare sector[THISACTOR].ceilingpicnum 3780 state enemy-hotlava // HOTLAVA
			else ifvare sector[THISACTOR].ceilingpicnum 3796 state enemy-amoebaacid // AMOEBAACID
			else ifvare sector[THISACTOR].ceilingpicnum 4091 state enemy-megalava // MEGALAVA
			else ifvare sector[THISACTOR].ceilingpicnum 5401 state enemy-ultramagma // ULTRALAVA
			else ifvare sector[THISACTOR].ceilingpicnum 5443 state enemy-hypermagma // HYPERMAGMA
			else // non-damagefloor
			{
				setvar ACTORDAMAGEFLOORTIMER 0
				setvar FLOORDAMAGETEMP 0
			} 
		}
	}
ends

state enemyfloorhurt // State for allowing monsters/actors to take damage from damagefloors[lava/floorslime/purplelava/hurtrail/etc]
	ifvare ACTORDEATHSWITCHDELAY 0
	{
		ifvare CLOAKED? 0
		{
			ifvare sector[THISACTOR].floorpicnum 5389 // NEWFLOORPLASMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 1 addvar tempg 2
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].floorpicnum 3780 // HOTLAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 2 addvar tempg 5
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].floorpicnum 4091 // MEGALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 8 addvar tempg 17
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].floorpicnum 5401 // ULTRALAVA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 20 addvar tempg 41
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
			else
			ifvare sector[THISACTOR].floorpicnum 5443 // HYPERMAGMA
			{
				ifvarl ACTORINVULNTIME 1
				{
					ifvarg freezetimer 0
					{
						randvar tempg 80 addvar tempg 161
						state checkfreezetimer_heatratio2
						subvarvar freezetimer tempg
						ifvarl freezetimer 0 setvar freezetimer 0
					}
				}
			}
		}
		
		getactor[THISACTOR].x x
		getactor[THISACTOR].y y
		updatesector x y TEMP
		getflorzofslope TEMP x y tempb
		getactor[THISACTOR].z tempc
		addvar tempc 256
		setvarvar tempe tempb
		addvar tempe -8
		addvar tempb 8
		getsector[THISACTOR].lotag temp
		ifvare temp 1 addvar tempb 6144
		
		ifvare CLOAKED? 0
		{
			ifvare sector[THISACTOR].floorpicnum 5395 state enemy-newpurplelava // NEWPURPLELAVA [Superlava]
			else ifvarvarl tempc tempb ifvarvarg tempc tempe 
			{
				ifvare sector[THISACTOR].floorpicnum 5385 state enemy-newfloorslime // NEWFLOORSLIME [Slime]
				else ifvare sector[THISACTOR].floorpicnum 5388 state enemy-newhurtrail // NEWHURTRAIL [Electric Chair/Electrified Floors]
				else ifvare sector[THISACTOR].floorpicnum 5389 state enemy-newfloorplasma // NEWFLOORPLASMA [Lava]
				else ifvare sector[THISACTOR].floorpicnum 3780 state enemy-hotlava // HOTLAVA
				else ifvare sector[THISACTOR].floorpicnum 3796 state enemy-amoebaacid // AMOEBAACID
				else ifvare sector[THISACTOR].floorpicnum 4091 state enemy-megalava // MEGALAVA
				else ifvare sector[THISACTOR].floorpicnum 5401 state enemy-ultramagma // ULTRALAVA
				else ifvare sector[THISACTOR].floorpicnum 5443 state enemy-hypermagma // HYPERMAGMA
				else // non-damagefloor
				{
					setvar ACTORDAMAGEFLOORTIMER 0
					setvar FLOORDAMAGETEMP 0
				}
			} // ifvarvarl tempc tempd ifvarvarg tempc tempe 
		} // ifvare CLOAKED? 0
		
		state enemyceilinghurt
		state enemytileemulationhurt
	}
	
ends

//****************************
//*PLAYER SIDE TILEEMUL stuff*
//****************************

state playercheckboots
	ifvare VEHICLEID -1
	{
		ifvarl BOOTSTIME 1
		{
			debris SCRAP1 1
			debris SCRAP2 1
			debris SCRAP3 1
			setvar BOOTSTIME 0
		}
	}
	else
	{
		ifvarl TEMPVAR2 1
		{
			debris SCRAP1 1
			debris SCRAP2 1
			debris SCRAP3 1
			setvar TEMPVAR2 0
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

state getplayerhealthondmgflr
	// addlogvar CURRENTHITPOINTS
	ifvare VEHICLEID -1 setvarvar temp CURRENTHITPOINTS else getactorvar[VEHICLEID].ACTORHP temp
	// addlogvar temp
ends

state setplayerhealthondmgflr
	setactor[THISACTOR].htpicnum -1
	// addlogvar VEHICLEID
	ifvare VEHICLEID -1 setvarvar CURRENTHITPOINTS temp else setactorvar[VEHICLEID].ACTORHP temp
	state checkbuddhamode
ends

state dmgflr-defensecheat
	ifvarand CHEATBITFIELD? 16 { divvar TEMPVAR 1000 ifvarl TEMPVAR 1 setvar TEMPVAR 1 state cheatersound }
ends

state checkplayerstatus_dmgfloor
	ifvarand PLAYERSTATUS? 512 // Damage Shell
	{
		randvar CALCVAR2 33
		setvar CALCVAR1 333               
		ifrnd 128 addvarvar CALCVAR1 CALCVAR2 else addvarvar CALCVAR1 CALCVAR2
		ifvarg CALCVAR1 1000 setvar CALCVAR1 1000
		setvar CALCVAR3 1000
		subvarvar CALCVAR3 CALCVAR1
	
		mulvarvar TEMPVAR CALCVAR3
		divvar TEMPVAR 1000
	}
	ifvarand PLAYERSTATUS? 4096 // Triad Booster
	{
		randvar CALCVAR2 25
		setvar CALCVAR1 250               
		ifrnd 128 addvarvar CALCVAR1 CALCVAR2 else addvarvar CALCVAR1 CALCVAR2
		ifvarg CALCVAR1 1000 setvar CALCVAR1 1000
		setvar CALCVAR3 1000
		subvarvar CALCVAR3 CALCVAR1
	
		mulvarvar TEMPVAR CALCVAR3
		divvar TEMPVAR 1000
	}
ends

state damagemod-tempvar
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	mulvarvar tempe DAMAGEMODIFIER
	divvar tempe 1000
	ifvarl tempe 1 setvar tempe 1
	ifvarvarg tempe STATLIMITMAXIMUM setvarvar tempe STATLIMITMAXIMUM
ends

state damagemod-dmgflr-general
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	mulvarvar TEMPVAR DAMAGEMODIFIER
	divvar TEMPVAR 1000
	ifvarl TEMPVAR 1 setvar TEMPVAR 1
	ifvarvarg TEMPVAR STATLIMITMAXIMUM setvarvar TEMPVAR STATLIMITMAXIMUM
ends

state dmgflr-steroids
	ifp ponsteroids
	{
		ifvare SKILLLEVEL 0 setvar TEMP3 99
		else
		{
			setvar TEMP3 10
			mulvarvar TEMP3 SKILLLEVEL
			mulvarvar TEMPVAR TEMP3
		}
		divvar TEMPVAR 100
		ifvarl TEMPVAR 1 setvar TEMPVAR 1
	}
ends

state check-heatratio-player2
	getactorvar[temph].FLOORHEATRATIO tempg
	mulvarvar TEMPVAR tempg
	divvar TEMPVAR 100
ends

state check-heatratio-player
	getactor[THISACTOR].sectnum temph
	getsector[temph].floorpicnum tempf
	ifvare tempf NEWFLOORPLASMA state check-heatratio-player2
	else ifvare tempf HOTLAVA state check-heatratio-player2
	else ifvare tempf MEGALAVA state check-heatratio-player2
	else ifvare tempf ULTRALAVA state check-heatratio-player2
	else ifvare tempf HYPERMAGMA state check-heatratio-player2
ends

state dmgfloor-pnulldamage
	ifvare CHARACTERSELECTED? 11
	{
		ifrnd 56
		{
			redefinequote 321 ^20NULLED THE DAMAGE!!
			ifrnd 128 { setvar TEMPVAR 0 sound NODAMAGE setvarvar fta fta_normal setvar ftq 321 } else { setvar TEMPVAR 1 }
		}
	}
ends

state dmgfloor-vehicleusage
	ifvarn VEHICLEID -1
	{
		ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3
		{
			divvar TEMPVAR 5
			ifvarg TEMPVAR 0
			{
				getactor[VEHICLEID].extra TEMPVAR2
				subvar TEMPVAR2 1 
				ifvarl TEMPVAR2 0 setvar TEMPVAR2 0
				setactor[VEHICLEID].extra TEMPVAR2
				ifvarl TEMPVAR2 1 setactor[VEHICLEID].htextra 10
			}
		}
	}
ends


// NEWFLOORSLIME (Boots)
state player-newfloorslime_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			subvar BOOTSTIME 1
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 4
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			subvar TEMPVAR2 1
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// NEWFLOORSLIME (Main)
state player-newfloorslime_dmg   // NEWFLOORSLIME [Atomic / Poison Elemental]
	ifvare VEHICLEID -1 // Not in a Vehicle...
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 1 mulvar TEMPVAR 1 addvar TEMPVAR 0 } // 1 dmg per tic (0.78125% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 3 mulvar TEMPVAR 1 addvar TEMPVAR 1 } // 1 to 4 dmg per tic (6.25% chance) [all other Characters]
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
					ifvare SKILLLEVEL 0 setvar tempd 0
					ifvare SKILLLEVEL 1 setvar tempd 0
					ifvare SKILLLEVEL 2 setvar tempd 0
					ifvare SKILLLEVEL 3 setvar tempd 0
					ifvare SKILLLEVEL 4 setvar tempd 0
					ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 0 }
					ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
					ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
					ifvare SKILLLEVEL 8 { randvar tempd 1 addvar tempd 1 }
					ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
			}
			else setvar tempd 1
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			ifvare CHARACTERSELECTED? 2 subvar TEMPVAR 2
			else ifvare CHARACTERSELECTED? 3
			{
				setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 1 divvar TEMPVAR 4
			}
			else
			ifvare CHARACTERSELECTED? 4
			{
				ifvare sector[PLAYERSECTOR].lotag 2 ifvare WATER? 2 divvar TEMPVAR 6
				ifvare sector[PLAYERSECTOR].lotag 1 ifvare WATER? 1 { mulvar TEMPVAR 2 divvar TEMPVAR 7 }
	
				setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar TEMPVAR 4 divvar TEMPVAR 3 } // 133% Damage
				else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar TEMPVAR 2 // 50% Damage
				else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar TEMPVAR 3 // 33% Damage
				ifvarand PLAYERSTATUS? 256
				{
					ifp pducking divvar TEMPVAR 25 else divvar TEMPVAR 5
				}
			}
			else ifvare CHARACTERSELECTED? 12 subvar TEMPVAR 1
			else ifvare CHARACTERSELECTED? 14 divvar TEMPVAR 10
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
	
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Atomic Support / Duke**
				state support-atomicresist
	    
				//**Poison Support / Jack**
				state support-poisonresist
	    
				state damagemod-dmgflr-general
			}
	
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-dmgflr-general         
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//
				state damagemod-dmgflr-general
			}
	
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			ifvarg TEMPVAR 0 
			{
				ifvare CHARACTERSELECTED? 2 // Jack
				{
					// Jack cannot incur poison, but he can still incur corrosion from nukage. :P
					ifrnd 4 state addcorrosion
				}
				else
				ifvare CHARACTERSELECTED? 3 // Bubsy
				{
					setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 1
					{
						ifrnd 1 state addpoison
						ifrnd 1 state addcorrosion
					}
					else
					{
						ifrnd 4 state addpoison
						ifrnd 4 state addcorrosion
					}
				}
				else
				ifvare CHARACTERSELECTED? 8 // Lisa
				{
					ifvare HAVEENERGYSHIELD? 1 // If she has the bio-shield...
					{
						ifvare ENERGYSHIELDMODE 1 // ...and it's turned on...
						{
							ifvarg DAMAGEINCELL 0 nullop // ...and if it has power of any amount in it...
							else // ...else she can incur poison and corrosion...
							{
								ifrnd 4 state addpoison
								ifrnd 4 state addcorrosion
							}
						}
						else // ...else she can incur poison and corrosion...
						{
							ifrnd 4 state addpoison
							ifrnd 4 state addcorrosion
						}
					}
					else // ...else she can incur poison and corrosion...
					{
						ifrnd 4 state addpoison
						ifrnd 4 state addcorrosion
					}
				}
				else
				ifvare CHARACTERSELECTED? 12 // Lori
				{
					ifrnd 1 { ifrnd 128 state addpoison }
					ifrnd 1 { ifrnd 128 state addcorrosion }
				}
				else
				ifvare CHARACTERSELECTED? 14 // Mystery1
				{
					ifrnd 2 state addpoison
					ifrnd 2 state addcorrosion
				}
				else
				ifvare CHARACTERSELECTED? 15 // Maken
				{
					ifrnd 2 state addpoison
					ifrnd 2 state addcorrosion
				}
				else // Anyone else
				{
					ifrnd 4 state addpoison
					ifrnd 4 state addcorrosion
				}	    
			}
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-acidtype
			}              
		}
	}
	else // In a Vehicle...
	{
		ifrnd 4
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 2
			addvar TEMPVAR 1
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 setvar tempd 0
				ifvare SKILLLEVEL 3 setvar tempd 0
				ifvare SKILLLEVEL 4 setvar tempd 0
				ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 8 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
			}
			else setvar tempd 1
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// 1 to 3 dmg per tic (1.5625% chance)
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 16 0 8 0
		}
	}
ends

// NEWHURTRAIL (Boots [Nethra only])
state player-newhurtrail_boots-nethra
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			subvar BOOTSTIME 1
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 8
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			subvar TEMPVAR2 1
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// NEWHURTRAIL (Main [Nethra only])
state player-newhurtrail_dmg-nethra
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			randvar TEMPVAR 3
			mulvar TEMPVAR 1
			addvar TEMPVAR 1
			mulvar TEMPVAR -11
			divvar TEMPVAR 2
			subvarvar temp TEMPVAR
			ifvarvarg temp MAXHITPOINTSATOMIC setvarvar temp MAXHITPOINTSATOMIC
			ifvarvarg temp STATLIMITATOMIC setvarvar temp STATLIMITATOMIC
			// addlogvar temp
			state setplayerhealthondmgflr
			ifvarg TEMPVAR 0 palfrom 32 64 64 64
			setvar PLAYERHPDAMAGED? -1
		
			setvarvar TEMPHEALTH TEMPVAR
			mulvar TEMPHEALTH -1
			state showhealing_playerhp
		
			sound ABSORB_DAMAGE
			sound SHORT_CIRCUIT
		}
	}
	else
	{
		ifrnd 8
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			subvar TEMPVAR2 1
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// NEWHURTRAIL (Boots)
state player-newhurtrail_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			subvar BOOTSTIME 1
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 8
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			subvar TEMPVAR2 1
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// NEWHURTRAIL (Main)
state player-newhurtrail_dmg   // NEWHURTRAIL [Atomic / Electric Elemental]
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 1 mulvar TEMPVAR 1 addvar TEMPVAR 0 } // 1 dmg per tic (1.5625% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 3 mulvar TEMPVAR 1 addvar TEMPVAR 1 } // 1 to 4 dmg per tic (12.5% chance) [all other Characters]
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 setvar tempd 0
				ifvare SKILLLEVEL 3 setvar tempd 0
				ifvare SKILLLEVEL 4 setvar tempd 0
				ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 8 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
			}
			else setvar tempd 1
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Character Modifiers*
			//*********************
			// 1 to 4 dmg per tic (12.5% chance)
			ifvare CHARACTERSELECTED? 10 
			{
				setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0 // Nethra in Protector Drone form will absorb Electricity and heal :P
					{
					mulvar TEMPVAR -11
					divvar TEMPVAR 2
					// addlogvar TEMPVAR
					subvarvar temp TEMPVAR
					ifvarvarg temp MAXHITPOINTSATOMIC setvarvar temp MAXHITPOINTSATOMIC
					ifvarvarg temp STATLIMITATOMIC setvarvar temp STATLIMITATOMIC
					// addlogvar temp
					state setplayerhealthondmgflr
					ifvarg TEMPVAR 0 palfrom 32 64 64 64
					setvar PLAYERHPDAMAGED? -1
				
					setvarvar TEMPHEALTH TEMPVAR
					mulvar TEMPHEALTH -1
					state showhealing_playerhp
				
					sound ABSORB_DAMAGE
					sound SHORT_CIRCUIT
				} 
				else // This is specfically for Nethra in Human form [Christina]. This code does not affect other characters or Nethra in Alien Form.
				{
					setvarvar TEMPDAMAGEVAR TEMPVAR
					ifvarn VEHICLEID -1 state char_elecdamage_misc
					setvarvar TEMPVAR TEMPDAMAGEVAR
					ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
				
					//*********************
					//*Check Malakian Gems*
					//*********************
					setvarvar TEMP7 TEMPVAR
					state malakiangemcheck 
					setvarvar TEMPVAR TEMP7
				
					//********
					//*Others*
					//********
					state checkplayerstatus_dmgfloor
					ifvare SHRUNK? 1
					{
						ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
					}
				
					//****************
					//*Support System*
					//****************
					ifvarg TEMPVAR 0
					{
						setvar DAMAGEMODIFIER 1000
				
						//**Atomic Support / Duke**
						state support-atomicresist
				
						//**Electric Support / Nethra**
						state support-electricresist
				
						state damagemod-dmgflr-general
					}
				
					//**********************************
					//*Support System [ESSence Support]*
					//**********************************
					ifvarg TEMPVAR 0
					{
						setvar DAMAGEMODIFIER 1000
						//**Overall Support / ESSence**
						state support-overallresist
						state damagemod-dmgflr-general         
					}
				
					//******************
					//*Equipment System*
					//******************
					ifvarg TEMPVAR 0
					{
						setvar DAMAGEMODIFIER 1000
						ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #1
						ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #2
						ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #3
						ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #4
						ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #5
						ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #6
						ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #7
						ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #8
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
						state damagemod-dmgflr-general
					}
				
					state dmgflr-defensecheat
					state dmgflr-steroids
				
					setvarvar TEMPDAMAGEVAR TEMPVAR
					state lisashield_misc
					setvarvar TEMPVAR TEMPDAMAGEVAR
				
					subvarvar temp TEMPVAR
				} 
			} 
			else // This is for damage to anyone who's not Nethra in her Human form [Christina]. This code will not affect Christina or Nethra
			{
				setvarvar TEMPDAMAGEVAR TEMPVAR
				ifvarn VEHICLEID -1 state char_elecdamage_misc
				setvarvar TEMPVAR TEMPDAMAGEVAR
	    
				//*********************
				//*Check Malakian Gems*
				//*********************
				setvarvar TEMP7 TEMPVAR
				state malakiangemcheck 
				setvarvar TEMPVAR TEMP7
	    
				ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
				//********
				//*Others*
				//********
				state checkplayerstatus_dmgfloor
				ifvare SHRUNK? 1
				{
					ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
				}
	    
				//****************
				//*Support System*
				//****************
				ifvarg TEMPVAR 0
				{
					setvar DAMAGEMODIFIER 1000
				
					//**Atomic Support / Duke**
					state support-atomicresist
				
					//**Electric Support / Nethra**
					state support-electricresist
				
					state damagemod-dmgflr-general
				}
	    
				//******************
				//*Equipment System*
				//******************
				ifvarg TEMPVAR 0
				{
					setvar DAMAGEMODIFIER 1000
					ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #1
					ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #2
					ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #3
					ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #4
					ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #5
					ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #6
					ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #7
					ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #8
					ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
					state damagemod-dmgflr-general
				}
	    
				state dmgflr-defensecheat
				state dmgflr-steroids
	    
				setvarvar TEMPDAMAGEVAR TEMPVAR
				state lisashield_misc
				setvarvar TEMPVAR TEMPDAMAGEVAR
	    
				state dmgfloor-pnulldamage
				subvarvar temp TEMPVAR
			}
	    
			setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
			ifvare CHARACTERSELECTED? 10 ifvare MISCARRAYID_AMOUNTTEMP 0 nullop
			else
			{
				state setplayerhealthondmgflr
				ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
				else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
				state showdamage_player-dmgflr_bs
				state showdamage_player-dmgflr
			}
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				ifvare CHARACTERSELECTED? 10
				{
					setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 0
					{
						/*
						palfrom 32 64 64 64
						sound ABSORB_DAMAGE
						*/
					}
					else
					{
						setvarvar DAMAGEHUEFACTOR TEMPVAR
						state playerdamagehues-electrictype
					}
				}
				else
				{
					setvarvar DAMAGEHUEFACTOR TEMPVAR
					state playerdamagehues-electrictype
				}
				ifvare CHARACTERSELECTED? 10 ifvare MISCARRAYID_AMOUNTTEMP 0 nullop else sound SHORT_CIRCUIT
			}
		}
	}
	else
	{
		ifrnd 8
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 2
			addvar TEMPVAR 1
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 setvar tempd 0
				ifvare SKILLLEVEL 3 setvar tempd 0
				ifvare SKILLLEVEL 4 setvar tempd 0
				ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 8 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
			}
			else setvar tempd 1
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// 1 to 3 dmg per tic (1.5625% chance)
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				sound SHORT_CIRCUIT
				palfrom 16 64 64 64
			}
		}
	}
ends

// NEWFLOORPLASMA (Boots)
state player-newfloorplasma_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			subvar BOOTSTIME 1
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 8
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			subvar TEMPVAR2 1
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// NEWFLOORPLASMA (Main)
state player-newfloorplasma_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 1 mulvar TEMPVAR 1 addvar TEMPVAR 0 } // 1 dmg per tic (1.5625% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 3 mulvar TEMPVAR 1 addvar TEMPVAR 1 } // 1 to 4 dmg per tic (12.5% chance) [all other Characters]
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 setvar tempd 0
				ifvare SKILLLEVEL 3 setvar tempd 0
				ifvare SKILLLEVEL 4 setvar tempd 0
				ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 8 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
			}
			else setvar tempd 1
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state char_firedamage_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
			state check-heatratio-player
	    
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Fire Support / Ted**
				state support-fireresist
	    
				state damagemod-dmgflr-general
			}
	    
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-dmgflr-general         
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				// Equipment Slot #1
				ifvare PLAYEREQUIPSLOTITEM1 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #2
				ifvare PLAYEREQUIPSLOTITEM2 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #3
				ifvare PLAYEREQUIPSLOTITEM3 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #4
				ifvare PLAYEREQUIPSLOTITEM4 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #5
				ifvare PLAYEREQUIPSLOTITEM5 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #6
				ifvare PLAYEREQUIPSLOTITEM6 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #7
				ifvare PLAYEREQUIPSLOTITEM7 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #8
				ifvare PLAYEREQUIPSLOTITEM8 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				state damagemod-dmgflr-general
			}
	    
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-firetype
			}              
		}
	}
	else
	{
		ifrnd 8
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 2
			addvar TEMPVAR 1
			setvarvar tempe TEMPVAR
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 setvar tempd 0
				ifvare SKILLLEVEL 3 setvar tempd 0
				ifvare SKILLLEVEL 4 setvar tempd 0
				ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 8 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 9 { randvar tempd 1 addvar tempd 1 }
			}
			else setvar tempd 1
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// 1 to 3 dmg per tic (3.125% chance)
			state check-heatratio-player
	    
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 16 8 0 0
		}
	}
ends

// NEWPURPLELAVA (Boots)
state player-newpurplelava_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 0 // ifrnd 256 = (256 - 256 = 0)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 192 // ifrnd 256 = (256 - 64 = 192)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			subvar BOOTSTIME 1
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 64
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			subvar TEMPVAR2 1
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// NEWPURPLELAVA (Main)
state player-newpurplelava_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 0 // ifrnd 256 = (256 - 256 = 0)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 192 // ifrnd 256 = (256 - 64 = 192)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			setvar DAMAGEMODIFIER 1000
			//**Overall Support / ESSence**
			state support-overallresist
	
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
		
				//****************
				//*Support System*
				//****************
				setvar DAMAGEMODIFIER 1000
		
				//**Atomic Support / Duke**
				state support-atomicresist
		
				//**Poison Support / Jack**
				state support-poisonresist
		
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				randvar TEMPMOD 1000
				ifvarvarl TEMPMOD DAMAGEMODIFIER
				{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
		
					state getplayerhealthondmgflr
		
					//*********************
					//*Character Modifiers*
					//*********************
					ifvare CHARACTERSELECTED? 14 
					{
						ifrnd 25
						{
							ifrnd 153 
							{
								setvar TEMPVAR 0
								addvar TEMPVAR 1
								setvarvar tempe MAXHITPOINTS
								ifvare DMGFLRTYPE 0
								{
									ifvare SKILLLEVEL 0 setvar tempd 0
									ifvare SKILLLEVEL 1 setvar tempd 0
									ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
									ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
									ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 1 }
									ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 1 }
									ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 2 }
									ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 2 }
									ifvare SKILLLEVEL 8 { randvar tempd 2 addvar tempd 2 }
									ifvare SKILLLEVEL 9 { randvar tempd 2 addvar tempd 2 }
								}
								else setvar tempd 2
								mulvarvar tempe tempd
								ifvare TEMPVAR5 1 divvar tempe 2250
								else divvar tempe 1000
								ifvarl tempe 1 setvar tempe 1
								addvarvar TEMPVAR tempe
				
								//*********************
								//*Check Malakian Gems*
								//*********************
								setvarvar TEMP7 TEMPVAR
								state malakiangemcheck 
								setvarvar TEMPVAR TEMP7
				
								ifrnd 6 state addpoison
								ifrnd 6 state addcorrosion
				
								//********
								//*Others*
								//********
								state checkplayerstatus_dmgfloor
								ifvare SHRUNK? 1
								{
									ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
								}
				
								state dmgflr-defensecheat
								state dmgflr-steroids
				
								setvarvar TEMPDAMAGEVAR TEMPVAR
								state lisashield_misc
								setvarvar TEMPVAR TEMPDAMAGEVAR
				
								subvarvar temp TEMPVAR
								state setplayerhealthondmgflr
								// 1 dmg per tic (100% chance)
								ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
								else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
								ifvarg TEMPVAR 0 
								{
									setvarvar PAINSOUNDFACTOR TEMPVAR
									state checkpainfactor
									state characterpainsounds
				
									setvarvar DAMAGEHUEFACTOR TEMPVAR
									state playerdamagehues-acidtype
								}
							} 
						}
					}
					else
					{
						setvar TEMPVAR 0
						addvar TEMPVAR 1         
						setvarvar tempe MAXHITPOINTS
						ifvare DMGFLRTYPE 0
						{
							ifvare SKILLLEVEL 0 setvar tempd 0
							ifvare SKILLLEVEL 1 setvar tempd 0
							ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
							ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
							ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 1 }
							ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 1 }
							ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 2 }
							ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 2 }
							ifvare SKILLLEVEL 8 { randvar tempd 2 addvar tempd 2 }
							ifvare SKILLLEVEL 9 { randvar tempd 2 addvar tempd 2 }
						}
						else setvar tempd 2
						mulvarvar tempe tempd
						ifvare TEMPVAR5 1 divvar tempe 2250
						else divvar tempe 1000
						ifvarl tempe 1 setvar tempe 1
						addvarvar TEMPVAR tempe
			
						//*********************
						//*Check Malakian Gems*
						//*********************
						setvarvar TEMP7 TEMPVAR
						state malakiangemcheck 
						setvarvar TEMPVAR TEMP7
			
						ifvarg TEMPVAR 0 
						{
							ifvare CHARACTERSELECTED? 2
							{
								ifrnd 12 state addcorrosion
							}
							else ifvare CHARACTERSELECTED? 3
							{
								setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
								ifvare MISCARRAYID_AMOUNTTEMP 1
								{
									ifrnd 64 setvar TEMPVAR 1 else setvar TEMPVAR 0
									ifrnd 3 state addpoison
									ifrnd 3 state addcorrosion
								}
								else
								{
									ifrnd 12 state addpoison
									ifrnd 12 state addcorrosion
								}
							}
							else ifvare CHARACTERSELECTED? 4
							{
								ifvare sector[PLAYERSECTOR].lotag 2 ifvare WATER? 2 divvar TEMPVAR 6
								ifvare sector[PLAYERSECTOR].lotag 1 ifvare WATER? 1 { mulvar TEMPVAR 2 divvar TEMPVAR 7 }
				
								setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
								ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar TEMPVAR 4 divvar TEMPVAR 3 } // 133% Damage
								else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar TEMPVAR 2 // 50% Damage
								else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar TEMPVAR 3 // 33% Damage
								ifvarand PLAYERSTATUS? 256
								{
									ifp pducking divvar TEMPVAR 25 else divvar TEMPVAR 5
									ifvarl TEMPVAR 1 { ifrnd 26 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
								}
								ifrnd 12 state addpoison
								ifrnd 12 state addcorrosion
							}
							else ifvare CHARACTERSELECTED? 8
							{
								ifvare HAVEENERGYSHIELD? 1
								{
									ifvare ENERGYSHIELDMODE 1 
									{
										ifvarg DAMAGEINCELL 0 nullop // CURRENTCELLS
										else
										{
											ifrnd 12 state addpoison
											ifrnd 12 state addcorrosion
										}
									}
									else
									{
										ifrnd 12 state addpoison
										ifrnd 12 state addcorrosion
									}
								}
								else
								{
									ifrnd 12 state addpoison
									ifrnd 12 state addcorrosion
								}
							}
							else ifvare CHARACTERSELECTED? 12
							{
								ifrnd 4 { ifrnd 128 state addpoison }
								ifrnd 4 { ifrnd 128 state addcorrosion }
							}
							else ifvare CHARACTERSELECTED? 14 nullop
							else ifvare CHARACTERSELECTED? 15
							{
								ifrnd 6 state addpoison
								ifrnd 6 state addcorrosion
							}
							else // Anyone else
							{
								ifrnd 12 state addpoison
								ifrnd 12 state addcorrosion
							}
			
							//********
							//*Others*
							//********
							state checkplayerstatus_dmgfloor
							ifvare SHRUNK? 1
							{
								ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
							}
						}
			
						state dmgflr-defensecheat
						state dmgflr-steroids
			
						setvarvar TEMPDAMAGEVAR TEMPVAR
						state lisashield_misc
						setvarvar TEMPVAR TEMPDAMAGEVAR
			
						state dmgfloor-pnulldamage
						subvarvar temp TEMPVAR
			
						state setplayerhealthondmgflr
						// 1 dmg per tic (100% chance)
						ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
						else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
						state showdamage_player-dmgflr_bs
						state showdamage_player-dmgflr
			
						ifvarg TEMPVAR 0 
						{
							setvarvar PAINSOUNDFACTOR TEMPVAR
							state checkpainfactor
			
							state characterpainsounds
			
							setvarvar DAMAGEHUEFACTOR TEMPVAR
							state playerdamagehues-acidtype
						}
					}
				} // ifvarvarl TEMPMOD DAMAGEMODIFIER
			} // ifvarvarl TEMPMOD DAMAGEMODIFIER
		}
	}
	else
	{
		ifrnd 64
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			setvar TEMPVAR 0
			addvar TEMPVAR 1
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 3 { randvar tempd 1 addvar tempd 0 }
				ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 5 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 6 { randvar tempd 1 addvar tempd 2 }
				ifvare SKILLLEVEL 7 { randvar tempd 1 addvar tempd 2 }
				ifvare SKILLLEVEL 8 { randvar tempd 2 addvar tempd 2 }
				ifvare SKILLLEVEL 9 { randvar tempd 2 addvar tempd 2 }
			}
			else setvar tempd 2
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
			state setplayerhealthondmgflr
	    
			// 1 dmg per tic (25% chance)
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 16 0 8 0 
		}
	}
ends

// HOTLAVA (Boots)
state player-hotlava_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 192 // ifrnd 64 = (256 - 64 = 192)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 248 // ifrnd 8 = (256 - 8 = 248)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 1
			addvar TEMPVAR 5
			subvarvar BOOTSTIME TEMPVAR
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 16
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 1
			addvar TEMPVAR 5
			subvarvar TEMPVAR2 TEMPVAR
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// HOTLAVA (Main)
state player-hotlava_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 192 // ifrnd 64 = (256 - 64 = 192)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 248 // ifrnd 8 = (256 - 8 = 248)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 1 mulvar TEMPVAR 5 addvar TEMPVAR 2 } // (0.044~-1.2% + 2 to 7) dmg per tic (3.125% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 4 mulvar TEMPVAR 9 addvar TEMPVAR 9 } // (0.1-2.7% + 9 to 45) dmg per tic (25% chance) [all other Characters]
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 randvar tempd 1
				ifvare SKILLLEVEL 1 randvar tempd 1
				ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 2 }
				ifvare SKILLLEVEL 3 { randvar tempd 2 addvar tempd 1 }
				ifvare SKILLLEVEL 4 { randvar tempd 2 addvar tempd 2 }
				ifvare SKILLLEVEL 5 { randvar tempd 3 addvar tempd 3 }
				ifvare SKILLLEVEL 6 { randvar tempd 4 addvar tempd 4 }
				ifvare SKILLLEVEL 7 { randvar tempd 6 addvar tempd 6 }
				ifvare SKILLLEVEL 8 { randvar tempd 9 addvar tempd 9 }
				ifvare SKILLLEVEL 9 { randvar tempd 14 addvar tempd 13 }
			} else { randvar tempd 1 addvar tempd 13 }
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe             
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state char_firedamage_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
			state check-heatratio-player
	    
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Atomic Support / Duke**
				state support-atomicresist
	    
				//**Fire Support / Ted**
				state support-fireresist
	    
				state damagemod-dmgflr-general
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				// Equipment Slot #1
				ifvare PLAYEREQUIPSLOTITEM1 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #2
				ifvare PLAYEREQUIPSLOTITEM2 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #3
				ifvare PLAYEREQUIPSLOTITEM3 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #4
				ifvare PLAYEREQUIPSLOTITEM4 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #5
				ifvare PLAYEREQUIPSLOTITEM5 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #6
				ifvare PLAYEREQUIPSLOTITEM6 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #7
				ifvare PLAYEREQUIPSLOTITEM7 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #8
				ifvare PLAYEREQUIPSLOTITEM8 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				state damagemod-dmgflr-general
			}
	    
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-firetype
			} 
		}
	}
	else
	{
		ifrnd 16
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 3
			mulvar TEMPVAR 6
			addvar TEMPVAR 5
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 randvar tempd 1
				ifvare SKILLLEVEL 1 randvar tempd 1
				ifvare SKILLLEVEL 2 { randvar tempd 1 addvar tempd 2 }
				ifvare SKILLLEVEL 3 { randvar tempd 2 addvar tempd 1 }
				ifvare SKILLLEVEL 4 { randvar tempd 2 addvar tempd 2 }
				ifvare SKILLLEVEL 5 { randvar tempd 3 addvar tempd 3 }
				ifvare SKILLLEVEL 6 { randvar tempd 4 addvar tempd 4 }
				ifvare SKILLLEVEL 7 { randvar tempd 6 addvar tempd 6 }
				ifvare SKILLLEVEL 8 { randvar tempd 9 addvar tempd 9 }
				ifvare SKILLLEVEL 9 { randvar tempd 14 addvar tempd 13 }
			} else { randvar tempd 1 addvar tempd 13 }
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	
			// 6 to 23+ dmg per tic (6.25% chance)
			state check-heatratio-player
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
	
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	
			ifvarg TEMPVAR 0 palfrom 16 24 0 0 
		}
	}
ends

// AMOEBAACID (Boots)
state player-amoebaacid_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 216 // ifrnd 40 = (256 - 40 = 216)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 251 // ifrnd 5 = (256 - 5 = 251)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 1
			addvar TEMPVAR 2
			subvarvar BOOTSTIME TEMPVAR
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 10
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 1
			addvar TEMPVAR 2
			subvarvar TEMPVAR2 TEMPVAR
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// AMOEBAACID (Main)
state player-amoebaacid_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 216 // ifrnd 40 = (256 - 40 = 216)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 251 // ifrnd 5 = (256 - 5 = 251)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 1 mulvar TEMPVAR 2 addvar TEMPVAR 1 } // (0-0.057777~% + 1 to 3) dmg per tic (1.953125% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 4 mulvar TEMPVAR 4 addvar TEMPVAR 4 } // (0-0.13% + 4 to 20) Dmg per tic (15.625% chance)
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 randvar tempd 1
				ifvare SKILLLEVEL 3 randvar tempd 1
				ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 5 { randvar tempd 2 addvar tempd 1 }
				ifvare SKILLLEVEL 6 { randvar tempd 2 addvar tempd 2 }
				ifvare SKILLLEVEL 7 { randvar tempd 3 addvar tempd 3 }
				ifvare SKILLLEVEL 8 { randvar tempd 5 addvar tempd 4 }
				ifvare SKILLLEVEL 9 { randvar tempd 7 addvar tempd 6 }
			} else { randvar tempd 1 addvar tempd 6 }
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			//addlogvar CHARACTERSELECTED?
			ifvare CHARACTERSELECTED? 2
			{
				ifrnd 40 state addcorrosion
			}
			else
			ifvare CHARACTERSELECTED? 3
			{
				setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 1
				{
					divvar TEMPVAR 4
					ifrnd 10 state addpoison
					ifrnd 10 state addcorrosion
				}
				else
				{
					ifrnd 40 state addpoison
					ifrnd 40 state addcorrosion
				}
			}
			else
			ifvare CHARACTERSELECTED? 4
			{
				ifvare sector[PLAYERSECTOR].lotag 2 ifvare WATER? 2 divvar TEMPVAR 6
				ifvare sector[PLAYERSECTOR].lotag 1 ifvare WATER? 1 { mulvar TEMPVAR 2 divvar TEMPVAR 7 }
	    
				setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar TEMPVAR 4 divvar TEMPVAR 3 } // 133% Damage
				else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar TEMPVAR 2 // 50% Damage
				else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar TEMPVAR 3 // 33% Damage
				ifvarand PLAYERSTATUS? 256
				{
					ifp pducking divvar TEMPVAR 25 else divvar TEMPVAR 5
				}
				ifrnd 40 state addpoison
				ifrnd 40 state addcorrosion
			}
			else ifvare CHARACTERSELECTED? 8
			{
				ifvare HAVEENERGYSHIELD? 1
				{
					ifvare ENERGYSHIELDMODE 1 
					{
						ifvarg DAMAGEINCELL 0 nullop // CURRENTCELLS
						else
						{
							ifrnd 40 state addpoison
							ifrnd 40 state addcorrosion
						}
					}
					else
					{
						ifrnd 40 state addpoison
						ifrnd 40 state addcorrosion
					}
				}
				else
				{
				ifrnd 40 state addpoison
				ifrnd 40 state addcorrosion
				}
			}
			else ifvare CHARACTERSELECTED? 12
			{
				ifrnd 13 { ifrnd 128 state addpoison }
				ifrnd 13 { ifrnd 128 state addcorrosion }
			}
			ifvare CHARACTERSELECTED? 14
			{
				divvar TEMPVAR 10
				ifrnd 20 state addpoison
				ifrnd 20 state addcorrosion
			}
			else ifvare CHARACTERSELECTED? 15
			{
				ifrnd 20 state addpoison
				ifrnd 20 state addcorrosion
			}
			else
			{
				ifrnd 40 state addpoison
				ifrnd 40 state addcorrosion
			}
	    
	    
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
	    
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Atomic Support / Duke**
				state support-atomicresist
	    
				//**Poison Support / Jack**
				state support-poisonresist
	    
				state damagemod-dmgflr-general
			}
	    
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-dmgflr-general         
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//
				state damagemod-dmgflr-general
			}
	    
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-acidtype
			}              
		}
	}
	else
	{
		ifrnd 10
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 3
			mulvar TEMPVAR 3
			addvar TEMPVAR 2
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 setvar tempd 0
				ifvare SKILLLEVEL 1 setvar tempd 0
				ifvare SKILLLEVEL 2 randvar tempd 1
				ifvare SKILLLEVEL 3 randvar tempd 1
				ifvare SKILLLEVEL 4 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 5 { randvar tempd 2 addvar tempd 1 }
				ifvare SKILLLEVEL 6 { randvar tempd 2 addvar tempd 2 }
				ifvare SKILLLEVEL 7 { randvar tempd 3 addvar tempd 3 }
				ifvare SKILLLEVEL 8 { randvar tempd 5 addvar tempd 4 }
				ifvare SKILLLEVEL 9 { randvar tempd 7 addvar tempd 6 }
			} else { randvar tempd 1 addvar tempd 6 }
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// (0-0.086~% + 3 to 11 Dmg per tic) (3.90625% chance)
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 16 0 24 0
		}
	}
ends

// MEGALAVA (Boots)
state player-megalava_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 160 // ifrnd 96 = (256 - 96 = 160)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 244 // ifrnd 12 = (256 - 12 = 244)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 2
			addvar TEMPVAR 7
			subvarvar BOOTSTIME TEMPVAR
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 24
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 2
			addvar TEMPVAR 7
			subvarvar TEMPVAR2 TEMPVAR
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// MEGALAVA (Boots)
state player-megalava_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 160 // ifrnd 96 = (256 - 96 = 160)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 244 // ifrnd 12 = (256 - 12 = 244)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 2 mulvar TEMPVAR 38 addvar TEMPVAR 20 } // (0-0.057777~% + 20 to 76) dmg per tic (1.953125% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 5 mulvar TEMPVAR 75 addvar TEMPVAR 75 } // (0.01-0.67% + 75 to 450) dmg per tic (37.5% chance)
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 1 { randvar tempd 2 addvar tempd 1 }
				ifvare SKILLLEVEL 2 { randvar tempd 3 addvar tempd 2 }
				ifvare SKILLLEVEL 3 { randvar tempd 4 addvar tempd 3 }
				ifvare SKILLLEVEL 4 { randvar tempd 5 addvar tempd 5 }
				ifvare SKILLLEVEL 5 { randvar tempd 8 addvar tempd 7 }
				ifvare SKILLLEVEL 6 { randvar tempd 10 addvar tempd 10 }
				ifvare SKILLLEVEL 7 { randvar tempd 15 addvar tempd 15 }
				ifvare SKILLLEVEL 8 { randvar tempd 23 addvar tempd 22 }
				ifvare SKILLLEVEL 9 { randvar tempd 34 addvar tempd 33 }
			} else { randvar tempd 1 addvar tempd 33 }
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state char_firedamage_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
			state check-heatratio-player
	    
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Atomic Support / Duke**
				state support-atomicresist
	    
				//**Fire Support / Ted**
				state support-fireresist
	    
				state damagemod-dmgflr-general
			}
	    
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-dmgflr-general         
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				// Equipment Slot #1
				ifvare PLAYEREQUIPSLOTITEM1 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #2
				ifvare PLAYEREQUIPSLOTITEM2 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #3
				ifvare PLAYEREQUIPSLOTITEM3 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #4
				ifvare PLAYEREQUIPSLOTITEM4 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #5
				ifvare PLAYEREQUIPSLOTITEM5 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #6
				ifvare PLAYEREQUIPSLOTITEM6 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #7
				ifvare PLAYEREQUIPSLOTITEM7 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #8
				ifvare PLAYEREQUIPSLOTITEM8 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				state damagemod-dmgflr-general
			}
	    
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-firetype
			} 
		}
	}
	else
	{
		ifrnd 24
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 3
			mulvar TEMPVAR 50
			addvar TEMPVAR 42
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 { randvar tempd 1 addvar tempd 1 }
				ifvare SKILLLEVEL 1 { randvar tempd 2 addvar tempd 1 }
				ifvare SKILLLEVEL 2 { randvar tempd 3 addvar tempd 2 }
				ifvare SKILLLEVEL 3 { randvar tempd 4 addvar tempd 3 }
				ifvare SKILLLEVEL 4 { randvar tempd 5 addvar tempd 5 }
				ifvare SKILLLEVEL 5 { randvar tempd 8 addvar tempd 7 }
				ifvare SKILLLEVEL 6 { randvar tempd 10 addvar tempd 10 }
				ifvare SKILLLEVEL 7 { randvar tempd 15 addvar tempd 15 }
				ifvare SKILLLEVEL 8 { randvar tempd 23 addvar tempd 22 }
				ifvare SKILLLEVEL 9 { randvar tempd 34 addvar tempd 33 }
			} else { randvar tempd 1 addvar tempd 33 }
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// (0.006~-0.4466~% + 50 to 192) dmg per tic (9.375% chance)
			state check-heatratio-player
			state dmgflr-defensecheat
	    
			subvarvar temp TEMPVAR
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 16 36 0 0 
		}
	}
ends

// ULTRALAVA (Boots)
state player-ultralava_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 128 // ifrnd 128 = (256 - 128 = 128)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 3
			addvar TEMPVAR 12
			subvarvar BOOTSTIME TEMPVAR
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 32
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 3
			addvar TEMPVAR 12
			subvarvar TEMPVAR2 TEMPVAR
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// ULTRALAVA (Main)
state player-ultralava_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 128 // ifrnd 128 = (256 - 128 = 128)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 2 mulvar TEMPVAR 120 addvar TEMPVAR 64 } // (? + 64 to 304) dmg per tic (6.25% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 5 mulvar TEMPVAR 240 addvar TEMPVAR 240 } // (0.5-27.0% + 240 to 1440) dmg per tic (50% chance)
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 { randvar tempd 5 addvar tempd 5 } // 0.5%-1.0%
				ifvare SKILLLEVEL 1 { randvar tempd 8 addvar tempd 7 } // 0.8%-1.5%
				ifvare SKILLLEVEL 2 { randvar tempd 10 addvar tempd 10 } // 1.0%-2.0%
				ifvare SKILLLEVEL 3 { randvar tempd 15 addvar tempd 15 } // 1.5%-3.0%
				ifvare SKILLLEVEL 4 { randvar tempd 20 addvar tempd 20 } // 2.0%-4.0%
				ifvare SKILLLEVEL 5 { randvar tempd 30 addvar tempd 30 } // 3.0%-6.0%
				ifvare SKILLLEVEL 6 { randvar tempd 40 addvar tempd 40 } // 4.0%-8.0%
				ifvare SKILLLEVEL 7 { randvar tempd 60 addvar tempd 60 } // 6.0%-12.0%
				ifvare SKILLLEVEL 8 { randvar tempd 90 addvar tempd 90 } // 9.0%-18.0%
				ifvare SKILLLEVEL 9 { randvar tempd 135 addvar tempd 135 } // 13.5%-27.0%
			} else setvar tempd 135
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state char_firedamage_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
			state check-heatratio-player
	    
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Atomic Support / Duke**
				state support-atomicresist
	    
				//**Fire Support / Ted**
				state support-fireresist
	    
				state damagemod-dmgflr-general
			}
	    
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-dmgflr-general         
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				// Equipment Slot #1
				ifvare PLAYEREQUIPSLOTITEM1 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #2
				ifvare PLAYEREQUIPSLOTITEM2 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #3
				ifvare PLAYEREQUIPSLOTITEM3 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #4
				ifvare PLAYEREQUIPSLOTITEM4 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #5
				ifvare PLAYEREQUIPSLOTITEM5 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #6
				ifvare PLAYEREQUIPSLOTITEM6 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #7
				ifvare PLAYEREQUIPSLOTITEM7 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #8
				ifvare PLAYEREQUIPSLOTITEM8 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				state damagemod-dmgflr-general
			}
	    
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-firetype
			}
		}
	}
	else
	{
		ifrnd 32
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 3
			mulvar TEMPVAR 160
			addvar TEMPVAR 133
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 { randvar tempd 5 addvar tempd 5 } // 0.5%-1.0%
				ifvare SKILLLEVEL 1 { randvar tempd 8 addvar tempd 7 } // 0.8%-1.5%
				ifvare SKILLLEVEL 2 { randvar tempd 10 addvar tempd 10 } // 1.0%-2.0%
				ifvare SKILLLEVEL 3 { randvar tempd 15 addvar tempd 15 } // 1.5%-3.0%
				ifvare SKILLLEVEL 4 { randvar tempd 20 addvar tempd 20 } // 2.0%-4.0%
				ifvare SKILLLEVEL 5 { randvar tempd 30 addvar tempd 30 } // 3.0%-6.0%
				ifvare SKILLLEVEL 6 { randvar tempd 40 addvar tempd 40 } // 4.0%-8.0%
				ifvare SKILLLEVEL 7 { randvar tempd 60 addvar tempd 60 } // 6.0%-12.0%
				ifvare SKILLLEVEL 8 { randvar tempd 90 addvar tempd 90 } // 9.0%-18.0%
				ifvare SKILLLEVEL 9 { randvar tempd 135 addvar tempd 135 } // 13.5%-27.0%
			} else setvar tempd 135
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// (0.333~-18.0% + 160 to 613) dmg per tic (12.5% chance)
			state check-heatratio-player
			state dmgflr-defensecheat
	    
			subvarvar temp TEMPVAR
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 16 48 0 0 
		}
	}
ends

// HYPERMAGMA (Boots)
state player-hypermagma_boots
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 32 // ifrnd 224 = (256 - 224 = 32)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 228 // ifrnd 28 = (256 - 28 = 228)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 6
			addvar TEMPVAR 28
			subvarvar BOOTSTIME TEMPVAR
			state playercheckboots
			setplayer[THISACTOR].boot_amount BOOTSTIME
		}
	}
	else
	{
		ifrnd 56
		{
			getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
			setvarvar fta fta_normal setvar ftq 75
			randvar TEMPVAR 6
			addvar TEMPVAR 28
			subvarvar TEMPVAR2 TEMPVAR
			state playercheckboots
			setactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
		}
	}
ends

// HYPERMAGMA (Main)
state player-hypermagma_dmg
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 32 // ifrnd 224 = (256 - 224 = 32)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 228 // ifrnd 28 = (256 - 28 = 228)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			state getplayerhealthondmgflr
			ifvare TEMPVAR5 1 { randvar TEMPVAR 3 mulvar TEMPVAR 400 addvar TEMPVAR 214 } // (? + 214 to 1414) dmg per tic (6.25% chance) [for ESSence/Cybanis]
			else { randvar TEMPVAR 6 mulvar TEMPVAR 800 addvar TEMPVAR 800 } // (2.0-108.0% + 800 to 5600) dmg per tic (87.5% chance)
			setvarvar tempe MAXHITPOINTS
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 { randvar tempd 20 addvar tempd 20 } // 2.0%-4.0%
				ifvare SKILLLEVEL 1 { randvar tempd 32 addvar tempd 32 } // 3.2%-6.4%
				ifvare SKILLLEVEL 2 { randvar tempd 40 addvar tempd 40 } // 4.0%-8.0%
				ifvare SKILLLEVEL 3 { randvar tempd 60 addvar tempd 60 } // 6.0%-12.0%
				ifvare SKILLLEVEL 4 { randvar tempd 80 addvar tempd 80 } // 8.0%-16.0%
				ifvare SKILLLEVEL 5 { randvar tempd 120 addvar tempd 120 } // 12.0%-24.0%
				ifvare SKILLLEVEL 6 { randvar tempd 160 addvar tempd 160 } // 16.0%-32.0%
				ifvare SKILLLEVEL 7 { randvar tempd 240 addvar tempd 240 } // 24.0%-48.0%
				ifvare SKILLLEVEL 8 { randvar tempd 360 addvar tempd 360 } // 36.0%-72.0%
				ifvare SKILLLEVEL 9 { randvar tempd 540 addvar tempd 540 } // 54.0%-108.0%
			} else setvar tempd 540
			mulvarvar tempe tempd
			ifvare TEMPVAR5 1 divvar tempe 2250
			else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			//*********************
			//*Character Modifiers*
			//*********************
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state char_firedamage_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
			ifvarl TEMPVAR 1 { ifrnd 128 setvar TEMPVAR 1 else setvar TEMPVAR 0 }
	    
			//********
			//*Others*
			//********
			state checkplayerstatus_dmgfloor
			ifvare SHRUNK? 1
			{
				ifrnd 128 mulvar TEMPVAR 5 else mulvar TEMPVAR 4
			}
			state check-heatratio-player
	    
			//****************
			//*Support System*
			//****************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
	    
				//**Atomic Support / Duke**
				state support-atomicresist
	    
				//**Fire Support / Ted**
				state support-fireresist
	    
				state damagemod-dmgflr-general
			}
	    
			//**********************************
			//*Support System [ESSence Support]*
			//**********************************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-dmgflr-general         
			}
	    
			//******************
			//*Equipment System*
			//******************
			ifvarg TEMPVAR 0
			{
				setvar DAMAGEMODIFIER 1000
				// Equipment Slot #1
				ifvare PLAYEREQUIPSLOTITEM1 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #2
				ifvare PLAYEREQUIPSLOTITEM2 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #3
				ifvare PLAYEREQUIPSLOTITEM3 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #4
				ifvare PLAYEREQUIPSLOTITEM4 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #5
				ifvare PLAYEREQUIPSLOTITEM5 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #6
				ifvare PLAYEREQUIPSLOTITEM6 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #7
				ifvare PLAYEREQUIPSLOTITEM7 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				// Equipment Slot #8
				ifvare PLAYEREQUIPSLOTITEM8 1 addvar DAMAGEMODIFIER -225 // Sun Ring
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				state damagemod-dmgflr-general
			}
	    
			state dmgflr-defensecheat
			state dmgflr-steroids
	    
			setvarvar TEMPDAMAGEVAR TEMPVAR
			state lisashield_misc
			setvarvar TEMPVAR TEMPDAMAGEVAR
	    
			state dmgfloor-pnulldamage
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar PLAYERHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar PLAYERHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 
			{
				setvarvar PAINSOUNDFACTOR TEMPVAR
				state checkpainfactor
				state characterpainsounds
	    
				setvarvar DAMAGEHUEFACTOR TEMPVAR
				state playerdamagehues-firetype
			}
		}
	}
	else
	{
		ifrnd 56
		{
			getactorvar[VEHICLEID].ACTORMAXHP TEMPVAR4
			state getplayerhealthondmgflr
			randvar TEMPVAR 4
			mulvar TEMPVAR 533
			addvar TEMPVAR 443
			setvarvar tempe TEMPVAR4
			ifvare DMGFLRTYPE 0
			{
				ifvare SKILLLEVEL 0 { randvar tempd 20 addvar tempd 20 } // 2.0%-4.0%
				ifvare SKILLLEVEL 1 { randvar tempd 32 addvar tempd 32 } // 3.2%-6.4%
				ifvare SKILLLEVEL 2 { randvar tempd 40 addvar tempd 40 } // 4.0%-8.0%
				ifvare SKILLLEVEL 3 { randvar tempd 60 addvar tempd 60 } // 6.0%-12.0%
				ifvare SKILLLEVEL 4 { randvar tempd 80 addvar tempd 80 } // 8.0%-16.0%
				ifvare SKILLLEVEL 5 { randvar tempd 120 addvar tempd 120 } // 12.0%-24.0%
				ifvare SKILLLEVEL 6 { randvar tempd 160 addvar tempd 160 } // 16.0%-32.0%
				ifvare SKILLLEVEL 7 { randvar tempd 240 addvar tempd 240 } // 24.0%-48.0%
				ifvare SKILLLEVEL 8 { randvar tempd 360 addvar tempd 360 } // 36.0%-72.0%
				ifvare SKILLLEVEL 9 { randvar tempd 540 addvar tempd 540 } // 54.0%-108.0%
			} else setvar tempd 540
			mulvarvar tempe tempd
			ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 divvar tempe 1500 else divvar tempe 1000
			ifvarl tempe 1 setvar tempe 1
			addvarvar TEMPVAR tempe
	    
			//*********************
			//*Check Malakian Gems*
			//*********************
			setvarvar TEMP7 TEMPVAR
			state malakiangemcheck 
			setvarvar TEMPVAR TEMP7
	    
			// (1.33~-72.0% + 533 to 2575) dmg per tic (21.875% chance)
			state check-heatratio-player
			state dmgflr-defensecheat
			subvarvar temp TEMPVAR
	    
			state setplayerhealthondmgflr
			ifvarl TEMPVAR 0 setvar VEHICLEHPDAMAGED? -1
			else ifvarg TEMPVAR 0 setvar VEHICLEHPDAMAGED? 1
			state showdamage_player-dmgflr_bs
			state showdamage_player-dmgflr
	    
			ifvarg TEMPVAR 0 palfrom 32 48 0 0 
		}
	}
ends

state player-dmgdisplaypart1
	setvar ATTACKINGACTORPAL 0
	setvar ACTORCRITICAL? 0
	setvarvar PLAYERDAMAGETEMP TEMPVAR
	setactor[THISACTOR].htpicnum -1
	ifvare VEHICLEID -1 setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
	ifvarg TEMPVAR 0 setvar HEALTHDAMAGETIMER 0
	setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
ends

state player-dmgdisplayceiling
	ifvarg TEMPVAR 0
	{
		setvarvar ATTACKINGACTORPICNUM PLAYERCEILINGTILE
		state player-dmgdisplaypart1
	}
	else
	ifvarg CELLDAMAGETEMP 0
	{
		setvarvar ATTACKINGACTORPICNUM PLAYERCEILINGTILE
		state player-dmgdisplaypart1
	}
ends

state player-dmgdisplayfloor
	ifvarg TEMPVAR 0
	{
		setvarvar ATTACKINGACTORPICNUM PLAYERFLOORTILE
		state player-dmgdisplaypart1
	}
	else
	ifvarg CELLDAMAGETEMP 0
	{
		setvarvar ATTACKINGACTORPICNUM PLAYERFLOORTILE
		state player-dmgdisplaypart1
	}
ends

state player-dmgdisplaytileemul
	ifvarg TEMPVAR 0
	{
		getactor[THISACTOR].sectnum temp
		setvarvar ATTACKINGACTORPICNUM actorvar[temp].SECTOREXTRA
		state player-dmgdisplaypart1
	}
	else
	ifvarg CELLDAMAGETEMP 0
	{
		getactor[THISACTOR].sectnum temp
		setvarvar ATTACKINGACTORPICNUM actorvar[temp].SECTOREXTRA
		state player-dmgdisplaypart1
	}
ends

state player_do_floorslime_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorslime_boots
	else
	{
		state player-newfloorslime_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_floorslime_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorslime_boots
	else
	{
		state player-newfloorslime_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_floorslime_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorslime_boots
	else
	{
		state player-newfloorslime_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_floorslime_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorslime_boots
	else
	{
		state player-newfloorslime_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_floorslime_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 4
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_hurtrail_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0
	{
		ifvare VEHICLEID -1
		{
			ifvare CHARACTERSELECTED? 10
			{
				setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0
				{
					setvar CEILINGDAMAGETYPE? 0
					state player-newhurtrail_dmg-nethra
				}
				else state player-newhurtrail_boots-nethra
			}
			else state player-newhurtrail_boots
		}
		else state player-newhurtrail_boots
	}
	else
	{
		state player-newhurtrail_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_hurtrail_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0
	{
		ifvare VEHICLEID -1
		{
			ifvare CHARACTERSELECTED? 10
			{
				setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0
				{
					setvar FLOORDAMAGETYPE? 0
					state player-newhurtrail_dmg-nethra
				}
				else state player-newhurtrail_boots-nethra
			}
			else state player-newhurtrail_boots
		}
		else state player-newhurtrail_boots
	}
	else
	{
		state player-newhurtrail_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_hurtrail_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0
	{
		ifvare VEHICLEID -1
		{
			ifvare CHARACTERSELECTED? 10
			{
				setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0
				{
					setvar EMUCEILINGDAMAGETYPE? 0
					state player-newhurtrail_dmg-nethra
				}
				else state player-newhurtrail_boots-nethra
			}
			else state player-newhurtrail_boots
		}
		else state player-newhurtrail_boots
	}
	else
	{
		state player-newhurtrail_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_hurtrail_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0
	{
		ifvare VEHICLEID -1
		{
			ifvare CHARACTERSELECTED? 10
			{
				setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
				ifvare MISCARRAYID_AMOUNTTEMP 0
				{
					setvar EMUFLOORDAMAGETYPE? 0
					state player-newhurtrail_dmg-nethra
				}
				else state player-newhurtrail_boots-nethra
			}
			else state player-newhurtrail_boots
		}
		else state player-newhurtrail_boots
	}
	else
	{
		state player-newhurtrail_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_hurtrail_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 8
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_floorplasma_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorplasma_boots
	else
	{
		state player-newfloorplasma_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_floorplasma_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorplasma_boots
	else
	{
		state player-newfloorplasma_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_floorplasma_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorplasma_boots
	else
	{
		state player-newfloorplasma_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_floorplasma_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newfloorplasma_boots
	else
	{
		state player-newfloorplasma_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_floorplasma_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 8
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_purplelava_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newpurplelava_boots
	else
	{
		state player-newpurplelava_dmg
		state player-dmgdisplayceiling
		setvar TEMPVAR 0
	}
ends

state player_do_purplelava_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newpurplelava_boots
	else
	{
		state player-newpurplelava_dmg
		state player-dmgdisplayfloor
		setvar TEMPVAR 0
	}
ends

state player_do_purplelava_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newpurplelava_boots
	else
	{
		state player-newpurplelava_dmg
		state player-dmgdisplaytileemul
		setvar TEMPVAR 0
	}
ends

state player_do_purplelava_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-newpurplelava_boots
	else
	{
		state player-newpurplelava_dmg
		state player-dmgdisplaytileemul
		setvar TEMPVAR 0
	}
ends

state player_do_purplelava_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 0 // ifrnd 256 = (256 - 256 = 0)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 224 // ifrnd 32 = (256 - 32 = 224)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 64
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_hotlava_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hotlava_boots
	else
	{
		state player-hotlava_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_hotlava_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hotlava_boots
	else
	{
		state player-hotlava_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_hotlava_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hotlava_boots
	else
	{
		state player-hotlava_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_hotlava_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hotlava_boots
	else
	{
		state player-hotlava_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_hotlava_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 192 // ifrnd 64 = (256 - 64 = 192)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 248 // ifrnd 8 = (256 - 8 = 248)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 16
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_amoebaacid_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-amoebaacid_boots
	else
	{
		state player-amoebaacid_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_amoebaacid_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-amoebaacid_boots
	else
	{
		state player-amoebaacid_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_amoebaacid_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-amoebaacid_boots
	else
	{
		state player-amoebaacid_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_amoebaacid_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-amoebaacid_boots
	else
	{
		state player-amoebaacid_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_amoebaacid_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 216 // ifrnd 40 = (256 - 40 = 216)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 251 // ifrnd 5 = (256 - 5 = 251)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 10
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_megalava_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-megalava_boots
	else
	{
		state player-megalava_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_megalava_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-megalava_boots
	else
	{
		state player-megalava_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_megalava_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-megalava_boots
	else
	{
		state player-megalava_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_megalava_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-megalava_boots
	else
	{
		state player-megalava_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_megalava_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 160 // ifrnd 96 = (256 - 96 = 160)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 244 // ifrnd 12 = (256 - 12 = 244)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 24
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_ultralava_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-ultralava_boots
	else
	{
		state player-ultralava_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_ultralava_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-ultralava_boots
	else
	{
		state player-ultralava_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_ultralava_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-ultralava_boots
	else
	{
		state player-ultralava_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_ultralava_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-ultralava_boots
	else
	{
		state player-ultralava_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_ultralava_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 128 // ifrnd 128 = (256 - 128 = 128)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 32
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends

state player_do_hypermagma_checks1_c
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hypermagma_boots
	else
	{
		state player-hypermagma_dmg
		state player-dmgdisplayceiling
	}
ends

state player_do_hypermagma_checks1_f
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hypermagma_boots
	else
	{
		state player-hypermagma_dmg
		state player-dmgdisplayfloor
	}
ends

state player_do_hypermagma_checks1_ec
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hypermagma_boots
	else
	{
		state player-hypermagma_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_hypermagma_checks1_ef
	ifvare VEHICLEID -1 setvarvar TEMPVAR2 BOOTSTIME else getactorvar[VEHICLEID].ACTORBOOTSAMOUNT TEMPVAR2
	ifvarg TEMPVAR2 0 state player-hypermagma_boots
	else
	{
		state player-hypermagma_dmg
		state player-dmgdisplaytileemul
	}
ends

state player_do_hypermagma_checks2
	ifvare VEHICLEID -1
	{
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR5 1
		else ifvare CHARACTERSELECTED? 9 setvar TEMPVAR5 1
		else setvar TEMPVAR5 0
		ifvare TEMPVAR5 0 setvar RNDMIZERLIMIT 32 // ifrnd 224 = (256 - 224 = 32)
		else ifvare TEMPVAR5 1 setvar RNDMIZERLIMIT 228 // ifrnd 28 = (256 - 28 = 228)
		state rndmizer256
		ifvarvarg RNDMIZER RNDMIZERLIMIT
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
	else
	{
		ifrnd 56
		{
			sound INVULNITEM3
			palfrom 0 0 0 0
		}
	}
ends
//*****************************************
//*End of DamageHazard Formulas and States*
//*****************************************