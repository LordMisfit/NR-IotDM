state calccriticalhits
 ifvare oldskoolmode 0
 {
    setvar CRITICALHITMULTI 1

    randvar TEMPVAR8 9999
    addvar TEMPVAR8 1
    ifvarvarl TEMPVAR8 CRITICALHITCHANCE2
    { 
     randvar TEMPVAR8 39999
     addvar TEMPVAR8 1
     ifvarvarl TEMPVAR8 CRITICALHITCHANCE2
     {
      randvar TEMPVAR8 159999
      addvar TEMPVAR8 1
      ifvarvarl TEMPVAR8 CRITICALHITCHANCE2
      {
       randvar TEMPVAR8 639999
       addvar TEMPVAR8 1
       ifvarvarl TEMPVAR8 CRITICALHITCHANCE2
       {
        setvar CRITICAL? 4
        setvar CRITICALHITMULTI 16
        redefinequote 195 ^6GIGA CRITICAL HIT!!!!!!
        globalsound SMAAASH 
        globalsound SMAAASH 
        globalsound SMAAASH 
        globalsound SMAAASH 
       }
       else
       {
        setvar CRITICAL? 3
        setvar CRITICALHITMULTI 8
        redefinequote 195 ^10MEGA CRITICAL HIT!!!!
        globalsound SMAAASH 
        globalsound SMAAASH 
        globalsound SMAAASH 
       }
      }
      else
      {
       setvar CRITICAL? 2
       setvar CRITICALHITMULTI 4
       redefinequote 195 ^21SUPER CRITICAL HIT!!!
       globalsound SMAAASH 
       globalsound SMAAASH 
      }
     }
     else
     {
      setvar CRITICAL? 1
      setvar CRITICALHITMULTI 2
      redefinequote 195 ^23CRITICAL HIT!!
      globalsound SMAAASH 
     }
     ifp ponsteroids
     {
      mulvar CRITICALHITMULTI 5
      divvar CRITICALHITMULTI 4
     }
    }    
    else setvar CRITICAL? 0
 }
ends

state null_damage
     setactor[THISACTOR].htextra 0 // TODO: Leave This
     setactor[THISACTOR].htpicnum SHOTSPARK1
     break
ends

state prevent_redundantdamage // Prevents damage from being inflicted on "Cloaked Troopers" and also prevents constant damage to already dead monsters (resulting in constant Critical Hits & Sounds)
   ifvare CLOAKED? 1
   {
    ifvarg tempb -1 state null_damage
   }
   ifvare SHRUNK? 1
   {
    ifvarg tempb -1 state null_damage
   }
   ifvarl TEMP -1 state null_damage
ends

// State for EnemyArmor Damage [via reflected damage]
state calcenemyarmor
   setvarvar CURRENTACTORARMORPERCENT ACTORAP
   setvarvar ACTORARMORLIMIT tempd
   mulvarvar ACTORARMORLIMIT ACTORARMORPERCENT // 50
   divvar ACTORARMORLIMIT 1000
   subvar ACTORARMORLIMIT 1

   ifvarg tempd 0
   {
    ifvarvarg CURRENTACTORARMORPERCENT ACTORARMORLIMIT
    {
     setvarvar ACTORARMORDAMAGE tempd
     mulvarvar ACTORARMORDAMAGE ACTORARMORPERCENT // 50
     divvar ACTORARMORDAMAGE 1000

     setvar ACTORDAMAGEPERCENT 1000
     subvarvar ACTORDAMAGEPERCENT ACTORARMORPERCENT

     mulvarvar tempd ACTORDAMAGEPERCENT // 50
     divvar tempd 1000
     subvarvar CURRENTACTORARMORPERCENT ACTORARMORDAMAGE
     setactor[THISACTOR].htextra tempd
     setvarvar ACTORAP CURRENTACTORARMORPERCENT
    }
    else
    {
     subvarvar tempd CURRENTACTORARMORPERCENT
     setvarvar ACTORARMORDAMAGE CURRENTACTORARMORPERCENT
     setvar CURRENTACTORARMORPERCENT 0
     setactor[THISACTOR].htextra tempd
     setvarvar ACTORAP CURRENTACTORARMORPERCENT
    }
   }
   else
   {
    setactor[THISACTOR].htextra tempd
    setvar ACTORARMORDAMAGE 0
   }
   ifvarg ACTORARMORDAMAGE 0 state enemyarmorbitsshrapnel
ends

// State for EnemyArmor Damage
state enemyarmordamage
       // tempd = damage value taken from calling code
       setvarvar CURRENTACTORARMORPERCENT ACTORAP
       setvarvar ACTORARMORLIMIT tempd
       mulvarvar ACTORARMORLIMIT ACTORARMORPERCENT // 50
       divvar ACTORARMORLIMIT 1000
       subvar ACTORARMORLIMIT 1

       ifvarg tempd 0
       {
	    ifvare tempd 1 // if scratch damage is suffered [1 dmg]
		{
         ifvarg ACTORAP 0 // will deal scratch damage to enemy armor 87.5% of the time
		 {
		   ifrnd 224
		   {
		    subvar ACTORAP 1
		    setvar ACTORARMORDAMAGE 1
		    setvar tempd 0
           }
		   else
		   {
		    setvar ACTORARMORDAMAGE 0
		    setvar tempd 0
           }
		 }
		 else
		 {
		  setvar ACTORARMORDAMAGE 0
		 }
		}
        else
		{
         ifvarvarg CURRENTACTORARMORPERCENT ACTORARMORLIMIT
         {
          setvarvar ACTORARMORDAMAGE tempd
          mulvarvar ACTORARMORDAMAGE ACTORARMORPERCENT // 50
          divvar ACTORARMORDAMAGE 1000
 
          setvar ACTORDAMAGEPERCENT 1000
          subvarvar ACTORDAMAGEPERCENT ACTORARMORPERCENT
 
          mulvarvar tempd ACTORDAMAGEPERCENT // 50
          divvar tempd 1000
          subvarvar CURRENTACTORARMORPERCENT ACTORARMORDAMAGE
          setvarvar ACTORAP CURRENTACTORARMORPERCENT
         }
         else
         {
          subvarvar tempd CURRENTACTORARMORPERCENT
          setvarvar ACTORARMORDAMAGE CURRENTACTORARMORPERCENT
          setvar CURRENTACTORARMORPERCENT 0
          setvarvar ACTORAP CURRENTACTORARMORPERCENT
         }
		}
       }
       else
	   {
 		setvar ACTORARMORDAMAGE 0
	   }
	   // addlogvar ACTORARMORDAMAGE

       ifvarg ACTORARMORDAMAGE 0 state enemyarmorbitsshrapnel setvar ACTORAPDAMAGED? 1
ends

state assessactortype
 ifvare temp SHARK setvar HITACTORTYPE? 0
 ifvare temp ROTATEGUN setvar HITACTORTYPE? 0
 ifvare temp LIZTROOP setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPSTAYPUT setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPSHOOT setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPJETPACK setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPRUNNING setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPDUCKING setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPONTOILET setvar HITACTORTYPE? 0
 ifvare temp LIZTROOPJUSTSIT setvar HITACTORTYPE? 0
 ifvare temp LIZMAN setvar HITACTORTYPE? 0
 ifvare temp LIZMANSTAYPUT setvar HITACTORTYPE? 0
 ifvare temp LIZMANSPITTING setvar HITACTORTYPE? 0
 ifvare temp LIZMANJUMP setvar HITACTORTYPE? 0
 ifvare temp DRONE setvar HITACTORTYPE? 0
 ifvare temp OCTABRAIN setvar HITACTORTYPE? 0
 ifvare temp OCTABRAINSTAYPUT setvar HITACTORTYPE? 0
 ifvare temp PIGCOP setvar HITACTORTYPE? 0
 ifvare temp PIGCOPSTAYPUT setvar HITACTORTYPE? 0
 ifvare temp PIGCOPDIVE setvar HITACTORTYPE? 0
 ifvare temp BOSS1 setvar HITACTORTYPE? 0
 ifvare temp BOSS1STAYPUT setvar HITACTORTYPE? 0
 ifvare temp BOSS1SHOOT setvar HITACTORTYPE? 0
 ifvare temp BOSS1LOB setvar HITACTORTYPE? 0
 ifvare temp BOSS2 setvar HITACTORTYPE? 0
 ifvare temp BOSS2STAYPUT setvar HITACTORTYPE? 0
 ifvare temp BOSS2SHOOT setvar HITACTORTYPE? 0
 ifvare temp BOSS2BREATH setvar HITACTORTYPE? 0
 ifvare temp BOSS3 setvar HITACTORTYPE? 0
 ifvare temp BOSS3STAYPUT setvar HITACTORTYPE? 0
 ifvare temp BOSS3LOB setvar HITACTORTYPE? 0
 ifvare temp COMMANDER setvar HITACTORTYPE? 0
 ifvare temp COMMANDERSTAYPUT setvar HITACTORTYPE? 0
 ifvare temp TANK setvar HITACTORTYPE? 0
 ifvare temp BOSS4 setvar HITACTORTYPE? 0
 ifvare temp BOSS4STAYPUT setvar HITACTORTYPE? 0
 ifvare temp NEWBEAST setvar HITACTORTYPE? 0
 ifvare temp NEWBEASTSTAYPUT setvar HITACTORTYPE? 0
 ifvare temp NEWBEASTJUMP setvar HITACTORTYPE? 0
 ifvare temp NEWBEASTHANG setvar HITACTORTYPE? 0
 ifvare temp SCORPIONTANK setvar HITACTORTYPE? 0
//
 ifvare temp DEALER setvar HITACTORTYPE? 1
 ifvare temp STAND1 setvar HITACTORTYPE? 1
 ifvare temp STAND3 setvar HITACTORTYPE? 1
 ifvare temp STAND4 setvar HITACTORTYPE? 1
 ifvare temp DANCE1 setvar HITACTORTYPE? 1
 ifvare temp DANCE2 setvar HITACTORTYPE? 1
 ifvare temp DANCE3 setvar HITACTORTYPE? 1
 ifvare temp DANCE5 setvar HITACTORTYPE? 1
 ifvare temp DANCE6 setvar HITACTORTYPE? 1
 ifvare temp DANCE7 setvar HITACTORTYPE? 1
 ifvare temp DANCE9 setvar HITACTORTYPE? 1
 ifvare temp ROBOTDOG setvar HITACTORTYPE? 1
 ifvare temp ROBOTDOG2 setvar HITACTORTYPE? 1
 ifvare temp PRESIDENTCLINTON setvar HITACTORTYPE? 1
 ifvare temp COP1 setvar HITACTORTYPE? 1
 ifvare temp PUNKDUDE setvar HITACTORTYPE? 1
 ifvare temp COP2 setvar HITACTORTYPE? 1
 ifvare temp SITTINGDUDE setvar HITACTORTYPE? 1
 ifvare temp FEM1 setvar HITACTORTYPE? 1
 ifvare temp FEM2 setvar HITACTORTYPE? 1
 ifvare temp FEM3 setvar HITACTORTYPE? 1
 ifvare temp FEM4 setvar HITACTORTYPE? 1
 ifvare temp FEM5 setvar HITACTORTYPE? 1
 ifvare temp FEM6 setvar HITACTORTYPE? 1
 ifvare temp FEM7 setvar HITACTORTYPE? 1
 ifvare temp FEM9 setvar HITACTORTYPE? 1
 ifvare temp FEM10 setvar HITACTORTYPE? 1
 ifvare temp TOUGHGAL setvar HITACTORTYPE? 1
 ifvare temp WOMAN setvar HITACTORTYPE? 1
 ifvare temp NAKED1 setvar HITACTORTYPE? 1
 ifvare temp PODFEM1 setvar HITACTORTYPE? 1
 ifvare temp ANIMEGIRL1 setvar HITACTORTYPE? 1
 ifvare temp ANIMEGIRL2 setvar HITACTORTYPE? 1
 ifvare temp ANIMEGIRL3 setvar HITACTORTYPE? 1
 ifvare temp ANIMEGIRL4 setvar HITACTORTYPE? 1
//

ends

  state serpenthelmet_check2
      setvar DAMAGEMODIFIER 100
      setvar TEMPVAR3 50
      ifvarand ACTORFLAGS 512 { mulvar TEMPVAR3 2 divvar TEMPVAR3 3 }
      ifvarand ACTORFLAGS 1024 { divvar TEMPVAR3 2 }
      subvarvar DAMAGEMODIFIER TEMPVAR3
      mulvarvar ACTORDEFENSETEMP DAMAGEMODIFIER
      divvar ACTORDEFENSETEMP 100
  ends

state serpenthelmet_check
     // Check for Serpent Helmets
     ifvare PLAYEREQUIPSLOTITEM1 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM2 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM3 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM4 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM5 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM6 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM7 25 state serpenthelmet_check2
     ifvare PLAYEREQUIPSLOTITEM8 25 state serpenthelmet_check2
ends

state snakearmband_check
  // Check for Snake Armband [Equippable Item]
  setvar DAMAGEMODIFIER 0
  ifvare PLAYEREQUIPSLOTITEM1 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM2 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM3 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM4 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM5 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM6 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM7 23 addvar DAMAGEMODIFIER 100
  ifvare PLAYEREQUIPSLOTITEM8 23 addvar DAMAGEMODIFIER 100
  ifvarg DAMAGEMODIFIER 1000 setvar DAMAGEMODIFIER 1000
  randvar TEMP3 999 addvar TEMP3 1

  ifvarvarg TEMP3 DAMAGEMODIFIER nullop
  else
  {
   randvar TEMP2 1000

   ifvarg TEMP2 800 // Slow AND Poison an Enemy
   {
    ifvarand ACTORSTATUS? 4 // Slow
    { 
     randvar TEMP 390
     addvar TEMP 390
     addvarvar ACTORSLOWTIMER TEMP
    } 
    else 
    { 
     addvar ACTORSTATUS? 4
     randvar TEMP 390
     addvar TEMP 390
     addvarvar ACTORSLOWTIMER TEMP
    }   

    ifvarand ACTORSTATUS? 8 // Poison
    { 
     randvar TEMP 390
     addvar TEMP 390
     addvarvar ACTORPOISONTIMER TEMP
    } 
    else 
    { 
     addvar ACTORSTATUS? 8
     randvar TEMP 390
     addvar TEMP 390
     addvarvar ACTORPOISONTIMER TEMP
    }   
    redefinequote 335 ^22YOU HAVE SLOWED DOWN AND POISONED AN ENEMY!
    setvarvar fta fta_normal setvar ftq 335
   }
   else // Choose between Slow or Poison
   {
    ifrnd 128
    {
     ifvarand ACTORSTATUS? 4 // Slow
     {
      randvar TEMP 390
      addvar TEMP 390
      addvarvar ACTORSLOWTIMER TEMP
     }
     else 
     {
      addvar ACTORSTATUS? 4
      randvar TEMP 390
      addvar TEMP 390
      addvarvar ACTORSLOWTIMER TEMP
     }
     redefinequote 335 ^22YOU HAVE SLOWED DOWN AN ENEMY!
     setvarvar fta fta_normal setvar ftq 335
    }
    else
    {
     ifvarand ACTORSTATUS? 8 // Poison
     { 
      randvar TEMP 390
      addvar TEMP 390
      addvarvar ACTORPOISONTIMER TEMP
     } 
     else 
     { 
      addvar ACTORSTATUS? 8
      randvar TEMP 390
      addvar TEMP 390
      addvarvar ACTORPOISONTIMER TEMP
     }   
     redefinequote 335 ^22YOU HAVE POISONED AN ENEMY!
     setvarvar fta fta_normal setvar ftq 335
    }
   }
  }
ends

state watchovermeskill-attack
   ifvare CHARACTERSELECTED? 11 // Paula
   {
    setvar MISCARRAYID 62 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NUMBER-OF-PARTY-DEAD
    ifvarg MISCARRAYID_AMOUNTTEMP 0
    {
     //addlogvar PLAYERATTACKTEMP
     ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar PLAYERATTACKTEMP 140 // +40% [40]
     ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar PLAYERATTACKTEMP 200 // +100% [60]
     ifvare MISCARRAYID_AMOUNTTEMP 3 mulvar PLAYERATTACKTEMP 280 // +180% [80]
     ifvare MISCARRAYID_AMOUNTTEMP 4 mulvar PLAYERATTACKTEMP 380 // +280% [100]
     ifvare MISCARRAYID_AMOUNTTEMP 5 mulvar PLAYERATTACKTEMP 500 // +400% [120]
     ifvare MISCARRAYID_AMOUNTTEMP 6 mulvar PLAYERATTACKTEMP 640 // +540% [140]
     ifvare MISCARRAYID_AMOUNTTEMP 7 mulvar PLAYERATTACKTEMP 800 // +700% [160]
     ifvare MISCARRAYID_AMOUNTTEMP 8 mulvar PLAYERATTACKTEMP 980 // +880% [180]
     ifvare MISCARRAYID_AMOUNTTEMP 9 mulvar PLAYERATTACKTEMP 1180 // +1280% [200]
     ifvare MISCARRAYID_AMOUNTTEMP 10 mulvar PLAYERATTACKTEMP 1400 // +1300% [220]
     ifvare MISCARRAYID_AMOUNTTEMP 11 mulvar PLAYERATTACKTEMP 1640 // +1540% [240]
     ifvare MISCARRAYID_AMOUNTTEMP 12 mulvar PLAYERATTACKTEMP 1900 // +1800% [260]
     ifvare MISCARRAYID_AMOUNTTEMP 13 mulvar PLAYERATTACKTEMP 2180 // +2080% [280]
     ifvare MISCARRAYID_AMOUNTTEMP 14 mulvar PLAYERATTACKTEMP 2480 // +2380% [300]
     ifvarg MISCARRAYID_AMOUNTTEMP 14 mulvar PLAYERATTACKTEMP 2800 // +2700% [320]
     divvar PLAYERATTACKTEMP 100
     ifvarvarg PLAYERATTACKTEMP STATLIMIT setvarvar PLAYERATTACKTEMP STATLIMIT
     //addlogvar PLAYERATTACKTEMP
    }
   }
ends

state checkdamagecaps-knee
  ifvarvarg KNEEDAMAGE STATLIMITATOMIC setvarvar KNEEDAMAGE STATLIMITATOMIC
  ifvarvarg ACTORARMORDAMAGE STATLIMITATOMIC setvarvar ACTORARMORDAMAGE STATLIMITATOMIC
  // addlogvar KNEEDAMAGE
  // addlogvar ACTORARMORDAMAGE
ends

//********************************************************
//*State for Calculating Kick/Melee Damage to non-players*
//********************************************************
state add_playermeleedamage
  setvar ACTORLASTDAMAGE 0
  getactor[THISACTOR].htextra tempb
  setvarvar TEMP ACTORHP
  getactor[THISACTOR].htowner OWNERTEMP 
  getactor[OWNERTEMP].picnum PICNUMTEMP
  ifvare PICNUMTEMP APLAYER getactorvar[PLAYERID].VEHICLEID tempvehicleid

  ifvarg ACTORDEATHSWITCHDELAY 0
  {
   setactor[THISACTOR].htextra -1
   break
  }

  ifvarg oldskoolmode 0
  {
   getactor[THISACTOR].picnum temp
   ifvare temp BOSS1
   {
    getactor[THISACTOR].pal tempc
    ifvare tempc 9 mulvar tempb 4
   }
   ifvare temp BOSS3
   {
    getactor[THISACTOR].pal tempc
    ifvare tempc 9 mulvar tempb 4
   }
   ifvare temp BOSS2
   {
    getactor[THISACTOR].pal tempc
    ifvare tempc 9 mulvar tempb 4
   }
   ifvare temp BOSS4
   {
    getactor[THISACTOR].pal tempc
    ifvare tempc 9 mulvar tempb 4
   }
   setvarvar ACTORLASTDAMAGE tempb
   subvarvar ACTORHP tempb
   break
  }

  state prevent_redundantdamage

  ifvarg tempb 0 // If any actual damage is detected...
  { // ifvarg tempb 0

    ifvare mainmenu 1 // if in the menus, receive no damage and cancel event
    {
     setactor[THISACTOR].htextra -1 // 0
     break
    }

    setvar ACTORARMORDAMAGE 0
    getactor[THISACTOR].htextra KNEEDAMAGE // TODO: Leave this
    setactor[THISACTOR].htextra 1
 
    // Stage 1 of Damage Formula
    ifvarg KNEEDAMAGE 0 
    { // ifvarg KNEEDAMAGE 0 
 
     getactor[THISACTOR].htowner OWNERTEMP 
     getactor[OWNERTEMP].picnum PICNUMTEMP
     state monster_defense_calc

     ifvare PICNUMTEMP APLAYER // If the attacking actor is the Player themself...
     { // ifvare PICNUMTEMP APLAYER
      setvarvar DEFENDINGACTORDEBUG DEFENDINGACTOR

      setvarvar PLAYERATTACKTEMP PLAYERATTACK
      state watchovermeskill-attack

      // Set to [Attack * 2]
      setvarvar KNEEDAMAGE PLAYERATTACKTEMP
      mulvar KNEEDAMAGE 2
      ifp ponsteroids mulvar KNEEDAMAGE 10 // Steroids make damage 10x stronger

      // Add or Remove [Attack / 2]
      randvarvar TEMPVAR6 PLAYERATTACKTEMP
      divvar TEMPVAR6 2 
      ifp ponsteroids mulvar TEMPVAR6 10 // Steroids make damage 5x stronger

      ifrnd 128 addvarvar KNEEDAMAGE TEMPVAR6 else subvarvar KNEEDAMAGE TEMPVAR6 // Gives a Damage Error of 50% of the Physical Attack stat [+- 50% attack]

      // Add Base Damage Depending on Character and their Melee Attack Type
      ifvare CHARACTERSELECTED? 1 addvar KNEEDAMAGE 10
      ifvare CHARACTERSELECTED? 2 { ifrnd 128 addvar KNEEDAMAGE 4 else addvar KNEEDAMAGE 6 }
      ifvare CHARACTERSELECTED? 3 { ifrnd 128 addvar KNEEDAMAGE 12 else addvar KNEEDAMAGE 13 }
      ifvare CHARACTERSELECTED? 4 addvar KNEEDAMAGE 4
      ifvare CHARACTERSELECTED? 5 { addvar KNEEDAMAGE 10 randvar TEMPVAR 30 addvarvar KNEEDAMAGE TEMPVAR }
      // ifvare CHARACTERSELECTED? 6 nullop
      // ifvare CHARACTERSELECTED? 7 nullop
      // ifvare CHARACTERSELECTED? 8 nullop
      // ifvare CHARACTERSELECTED? 9 nullop
      ifvare CHARACTERSELECTED? 10 
      { 
       setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
       ifvare MISCARRAYID_AMOUNTTEMP 0 { addvar KNEEDAMAGE 22 randvar TEMPVAR 5 addvarvar KNEEDAMAGE TEMPVAR sound NEWBEAST_ATTACK } else { addvar KNEEDAMAGE 36 randvar TEMPVAR 8 addvarvar KNEEDAMAGE TEMPVAR } 
      } 
      // ifvare CHARACTERSELECTED? 11 { addvar KNEEDAMAGE 7 randvar TEMPVAR 3 addvarvar KNEEDAMAGE TEMPVAR }
      // ifvare CHARACTERSELECTED? 12 nullop
      // ifvare CHARACTERSELECTED? 13 nullop
      // ifvare CHARACTERSELECTED? 14 nullop
      ifvare CHARACTERSELECTED? 15 { ifrnd 128 { addvar KNEEDAMAGE 5 randvar TEMPVAR 1 addvarvar KNEEDAMAGE TEMPVAR } else { addvar KNEEDAMAGE 9 randvar TEMPVAR 1 addvarvar KNEEDAMAGE TEMPVAR } }

      ifvare PUBLICBETA? 0 
      {
       ifvare CHARACTERSELECTED? 10 
       { 
        setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
        ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar KNEEDAMAGE 3 divvar KNEEDAMAGE 2 } else { mulvar KNEEDAMAGE 3 } 
       } 
      }
      ifvare PUBLICBETA? 0 { ifvare CHARACTERSELECTED? 14 mulvar KNEEDAMAGE 4 }
      state checkdamagecaps-knee

      // Check If Monsters are Aireal
      // End Check

      //*******************************
      //*******************************
      //*******************************

      // Stage 2p of Damage Formula
      //***************************************
      //*Overall Damage Support [Bubsy / Lori]*
      //***************************************
      ifvare tempe APLAYER
      {
       setvar DAMAGEMODIFIER 1000
       state support-monsteroveralleffect-extra
       state damagemod-enemy-knee
      }
      state checkdamagecaps-knee

      //*******************************
      //*******************************
      //*******************************

      // Stage 3p of Damage Formula
      ifvare CHARACTERSELECTED? 1
      {
       // ***************************************************
       // *Setting up Duke's Nukage/Purplelava-Bonus Damage *
       // ***************************************************
       ifvare FLOORDAMAGETYPE? 1 mulvar KNEEDAMAGE 4
       ifvare FLOORDAMAGETYPE? 4 mulvar KNEEDAMAGE 10
       ifvare CEILINGDAMAGETYPE? 1 mulvar KNEEDAMAGE 4
       ifvare CEILINGDAMAGETYPE? 4 mulvar KNEEDAMAGE 10

       ifvare EMUFLOORDAMAGETYPE? 1 mulvar KNEEDAMAGE 4
       ifvare EMUFLOORDAMAGETYPE? 4 mulvar KNEEDAMAGE 10
       ifvare EMUCEILINGDAMAGETYPE? 1 mulvar KNEEDAMAGE 4
       ifvare EMUCEILINGDAMAGETYPE? 4 mulvar KNEEDAMAGE 10
      }

      ifvare CHARACTERSELECTED? 3
      {
       // *****************************************************
       // *Setting Up Bubsy's bonus damage when in "Mask Form*
       // *****************************************************
       setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
       ifvarg MISCARRAYID_AMOUNTTEMP 0 { mulvar KNEEDAMAGE 5 divvar KNEEDAMAGE 2 }
      }

      ifvare CHARACTERSELECTED? 4
      {
       // **************************************
       // *Setting up Ami's Water-Bonus Damage *
       // **************************************
       ifvare sector[PLAYERSECTOR].lotag 2 ifvare WATER? 2 { mulvar KNEEDAMAGE 6 } // 6x Damage
       ifvare sector[PLAYERSECTOR].lotag 1 ifvare WATER? 1 { mulvar KNEEDAMAGE 7 divvar KNEEDAMAGE 2 } // 3.5x Damage
       // *******************************
       // *Setting Up Ami's Form Bonuses*
       // *******************************
       setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
       ifvarl MISCARRAYID_AMOUNTTEMP 1 { mulvar KNEEDAMAGE 2 }
       ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar KNEEDAMAGE 3 divvar KNEEDAMAGE 4 }
       ifvarg MISCARRAYID_AMOUNTTEMP 1 { mulvar KNEEDAMAGE 3 }
       // ********************************
       // *Mercury Aqua Protection (Buff)*
       // ********************************
       setvar CHARACTERARRAY 4
       getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
       ifvarand TEMPVAR 256
       {
         ifp pducking divvar KNEEDAMAGE 20 else divvar KNEEDAMAGE 5
       }
       // ************************
       // *Mercury Super-Computer*
       // ************************
       setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
       ifvare MISCARRAYID_AMOUNTTEMP 1
       {
        ifvare player[THISACTOR].heat_on 1
        {
         mulvar KNEEDAMAGE 7
         divvar KNEEDAMAGE 4
        }
       }
      }

      ifvare CHARACTERSELECTED? 10
      {
       // **********************************
       // *Setting Up Nethra's Form Bonuses*
       // **********************************
       setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
       ifvare MISCARRAYID_AMOUNTTEMP 1
       {
        setvarvar TEMPVAR2 KNEEDAMAGE
        state checkdamage-crisisbooster
        setvarvar KNEEDAMAGE TEMPVAR2
       }
      }

      ifvare CHARACTERSELECTED? 13
      {
       // **********************************
       // *Setting Up Minako's Form Bonuses*
       // **********************************
       setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
       ifvarl MISCARRAYID_AMOUNTTEMP 1 { mulvar KNEEDAMAGE 2 }
       ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar KNEEDAMAGE 3 divvar KNEEDAMAGE 4 }
       ifvarg MISCARRAYID_AMOUNTTEMP 1 { mulvar KNEEDAMAGE 3 }
      }
      state checkdamagecaps-knee

      // Stage 4p of Damage Formula
      // *****************************
      // *Power Wrist[s] (Equippable)*
      // *****************************
      // Check for Power Wrist [equippable item]
      setvar DAMAGEMODIFIER 1000
      ifvare PLAYEREQUIPSLOTITEM1 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM2 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM3 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM4 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM5 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM6 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM7 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      ifvare PLAYEREQUIPSLOTITEM8 18
      {
       randvar TEMPVAR2 25
       ifrnd 128 mulvar TEMPVAR2 -1
       addvar TEMPVAR2 250
       addvarvar DAMAGEMODIFIER TEMPVAR2
       // +22.5%-27.5% 
      }
      mulvarvar KNEEDAMAGE DAMAGEMODIFIER
      divvar KNEEDAMAGE 1000
      state checkdamagecaps-knee


      // Stage 5p of Damage Formula
      // **********************************
      // *Jewel of Four Souls [Equippable]*
      // **********************************
      setvar DAMAGEMODIFIER 1
      ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 10
      ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 10
      ifvarg DAMAGEMODIFIER 1 subvar DAMAGEMODIFIER 1
      mulvarvar KNEEDAMAGE DAMAGEMODIFIER
      state checkdamagecaps-knee

      // Stage 6p of Damage Formula
      //****************
      //*?????? ?? ????*
      //****************
      ifvarn ENEMYHASSHIKON? 0 divvar KNEEDAMAGE 10
      state checkdamagecaps-knee

      // Stage 7p of Damage Formula
      //***********************
      //*Attacker is Poisoned?*
      //***********************
      ifvarand PLAYERSTATUS? 8
      {
       randvar TEMPVAR 125
       ifrnd 128 mulvar TEMPVAR -1
       addvar TEMPVAR 500
       mulvarvar KNEEDAMAGE TEMPVAR
       divvar KNEEDAMAGE 1000
      }
      state checkdamagecaps-knee

      // Stage 8p of Damage Formula
      //***********************
      //*Defender is Poisoned?*
      //***********************
      ifvarand ACTORSTATUS? 8
      {
       randvar TEMPVAR 125
       ifrnd 128 mulvar TEMPVAR -1
       addvar TEMPVAR 1500
       mulvarvar KNEEDAMAGE TEMPVAR
       divvar KNEEDAMAGE 1000
      }
      state checkdamagecaps-knee

      // Stage 9p of Damage Formula
      // **********************
      // *Triad Booster (Buff)*
      // **********************
      ifvarand PLAYERSTATUS? 4096
      {
       randvar temp 25
       setvar tempb 250
       ifrnd 128 addvarvar tempb temp else subvarvar tempb temp
       setvar tempc 1000
       addvarvar tempc tempb
       // 122.5%-127.5% 

       mulvarvar KNEEDAMAGE tempc
       divvar KNEEDAMAGE 1000
      }

      state checkdamagecaps-knee

      // Stage 10p of Damage Formula
      // *****************
      // *Jump Kick Bonus*
      // *****************
      ifvarn sector[PLAYERSECTOR].lotag 2
      {
       getplayer[THISACTOR].jetpack_on TEMPVAR3
       ifvare TEMPVAR3 0
       {
        ifvare INTHEAIR? 1
        {
         randvar temp 166
         setvar tempb 500
         ifrnd 128 addvarvar tempb temp else subvarvar tempb temp
         setvar tempc 1000
         addvarvar tempc tempb
         // 133.4%-166.6% 

         mulvarvar KNEEDAMAGE tempc
         divvar KNEEDAMAGE 1000
        }
       }
      }
      state checkdamagecaps-knee

      // Stage 11p of Damage Formula
      // *********************
      // *Damage Shell (Buff)*
      // *********************
      ifvarand ACTORSTATUS? 512
      {
       sound SHELL_HIT
       randvar temp 33
       setvar tempb 333
       ifrnd 128 addvarvar tempb temp else subvarvar tempb temp
       ifvarg tempb 1000 setvar tempb 1000
       setvar tempc 1000
       subvarvar tempc tempb
       // -30.0%-36.6% 

       mulvarvar KNEEDAMAGE tempc
       divvar KNEEDAMAGE 1000
      }
      state checkdamagecaps-knee

      // Stage 12p of Damage Formula
      // ****************************************
      // *Setting Up Death-based Support Bonuses*
      // ****************************************
      setvar DAMAGEMODIFIER 1000
      state playersupport-deadcharacters
      mulvarvar KNEEDAMAGE DAMAGEMODIFIER
      divvar KNEEDAMAGE 1000
      state checkdamagecaps-knee

      // Stage 13p of Damage Formula
      // **************************************************
      // *Setting up Critical Hits [Norm/Super/Mega/Ultra]*
      // **************************************************
      ifvarg ACTORHP 0
      {
       state calccriticalhits
       mulvarvar KNEEDAMAGE CRITICALHITMULTI 
       ifvarvarg KNEEDAMAGE STATLIMITMAXIMUM setvarvar KNEEDAMAGE STATLIMITMAXIMUM
       // ifvarg CRITICAL? 0 addlogvar PLAYERDAMAGE
      }
      state checkdamagecaps-knee

      // Stage 14p of Damage Formula
      // *************************************************
      // *Setting up Special Formulas for Defense Factors*
      // *************************************************
      getactor[THISACTOR].picnum temp
      state assessactortype
      setvarvar ACTORDEFENSETEMP ACTORDEFENSE
 
      state serpenthelmet_check

      ifvarand CHEATBITFIELD? 8
      {
       ifvare HITACTORTYPE? 1
       {
        ifvare CHARACTERSELECTED? 15
        {
         ifvarand PLAYERSTATUS? 2048 divvar ACTORDEFENSETEMP 4
        }
        else
        ifvare CHARACTERSELECTED? 14
        {
         ifvare PUBLICBETA? 0 divvar ACTORDEFENSETEMP 20 else divvar ACTORDEFENSETEMP 2
        }
        else
        ifvare CHARACTERSELECTED? 10
        {
         setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
         ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar ACTORDEFENSETEMP 13 divvar ACTORDEFENSETEMP 16 }
         else { mulvar ACTORDEFENSETEMP 3 divvar ACTORDEFENSETEMP 16 }
        }
        else
        ifvare CHARACTERSELECTED? 3
        {
         mulvar ACTORDEFENSETEMP 2
         divvar ACTORDEFENSETEMP 5
        }
 
        ifvarl ACTORDEFENSETEMP 0 setvar ACTORDEFENSETEMP 0
        subvarvar KNEEDAMAGE ACTORDEFENSETEMP
       }
       else
       {
        ifvare CHARACTERSELECTED? 15
        {
         ifvarand PLAYERSTATUS? 2048 divvar ACTORDEFENSETEMP 4
        }
        ifvarl ACTORDEFENSETEMP 0 setvar ACTORDEFENSETEMP 0
        subvarvar KNEEDAMAGE ACTORDEFENSETEMP
        state cheatersound
        mulvar KNEEDAMAGE 1000
        ifvarvarg KNEEDAMAGE STATLIMITMAXIMUM setvarvar KNEEDAMAGE STATLIMITMAXIMUM
       }
      }
      else
      { 
       ifvare CHARACTERSELECTED? 15
       {
        ifvarand PLAYERSTATUS? 2048 divvar ACTORDEFENSETEMP 4
       }
       else
       ifvare CHARACTERSELECTED? 14
       {
        ifvare PUBLICBETA? 0 divvar ACTORDEFENSETEMP 20 else divvar ACTORDEFENSETEMP 2
       }
       else
       ifvare CHARACTERSELECTED? 10
       {
        setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
        ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar ACTORDEFENSETEMP 13 divvar ACTORDEFENSETEMP 16 }
        else { mulvar ACTORDEFENSETEMP 3 divvar ACTORDEFENSETEMP 16 }
       }
       else
       ifvare CHARACTERSELECTED? 3
       {
        mulvar ACTORDEFENSETEMP 2 divvar ACTORDEFENSETEMP 5
       }
 
       ifvarl ACTORDEFENSETEMP 0 setvar ACTORDEFENSETEMP 0
       subvarvar KNEEDAMAGE ACTORDEFENSETEMP
      }
      state checkdamagecaps-knee

      // Stage 15p of Damage Formula
      //******************
      //*"Elite" Monsters*
      //******************
      ifvarand ACTORFLAGS 512 // If the monster is an "Elite" they only suffer 25% to 50% damage
      {
       randvar TEMPVAR 25
       addvar TEMPVAR 25
       mulvarvar KNEEDAMAGE TEMPVAR
       divvar KNEEDAMAGE 100
      }
      state checkdamagecaps-knee

      // Stage 16p of Damage Formula
      //*************
      //*Quad Damage*
      //*************
      ifvare tempvehicleid -1
      {
       ifvarg QUADTIME 0 mulvar KNEEDAMAGE 4
      }
      else
      {
       ifvarg actorvar[tempvehicleid].ACTORQUADTIME 0 mulvar KNEEDAMAGE 4
      }
      ifvarl KNEEDAMAGE 1 setvar KNEEDAMAGE 1
      ifvarvarg KNEEDAMAGE STATLIMITMAXIMUM setvarvar KNEEDAMAGE STATLIMITMAXIMUM
      state checkdamagecaps-knee

      // Stage 17p of Damage Formula
      //********************
      //*Check Enemy Invuln*
      //********************
      ifvarg ACTORINVULNTIME 0
      {
       ifvare PICNUMTEMP APLAYER // If the attacking actor is the player
       {
        setvarvar ACTORDEFLECTEDDAMAGE KNEEDAMAGE
        setvar KNEEDAMAGE 0
        setactor[THISACTOR].htextra 0 // TODO: Leave this
        sound INVULNITEM3
       }
       setvar ACTORINVULN? 1
      }
      else
      {
       setvar ACTORINVULN? 0
      }
      state checkdamagecaps-knee

      // Stage 18p of Damage Formula
      //*******************************************
      //*Mystery Lady's Sabre Special Attack Bonus*
      //*******************************************
      ifvare PUBLICBETA? 0
      {
       ifvare CHARACTERSELECTED? 14
       {
        stopsound KICK_HIT
        sound SHORT_CIRCUIT state sparkstate
        sound SHORT_CIRCUIT state sparkstate
        sound SHORT_CIRCUIT state sparkstate
        setactor[THISACTOR].htpicnum RADIUSEXPLOSION
        ifvarg ACTORINVULNTIME 0
        {
         ifvarg CRITICAL? 0
         {
          setvar ACTORINVULNTIME 0
          redefinequote 335 ^22DESTROYED ENEMY'S INVULNERBILITY!!
         }
         else
         {
          setvar TEMP2 10
          randvar TEMP3 5
          ifrnd 128 addvarvar TEMP2 TEMP3 else subvarvar TEMP2 TEMP3
          setvarvar TEMP3 TEMP2
          mulvar TEMP2 26
          subvarvar ACTORINVULNTIME TEMP2
          ifvarl ACTORINVULNTIME 0 setvar ACTORINVULNTIME 0
          redefinequote 335 ^22REDUCED ENEMY'S INVULNERBILITY TIME BY %d SECONDS!
          qsprintf 335 335 TEMP3
         }
         setvarvar fta fta_normal setvar ftq 335
        }
        else
        {
         randvar TEMP3 99 addvar TEMP3 1
         setvar CHARACTERARRAY 14
         getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMP2
         ifvarvarg TEMP3 TEMP2
         {
          setvarvar TEMP3 ACTORHP
          randvar TEMP2 2
          addvar TEMP2 2
          ifvarn TEMP2 0 divvarvar TEMP3 TEMP2
          addvarvar KNEEDAMAGE TEMP3

          setvarvar TEMP3 ACTORAP
          randvar TEMP2 2
          addvar TEMP2 2
          ifvarn TEMP2 0 divvarvar TEMP3 TEMP2
          addvarvar KNEEDAMAGE TEMP3
         }
         else
         {
          setvarvar TEMP3 ACTORMAXHP
          randvar TEMP2 1
          addvar TEMP2 1
          ifvarn TEMP2 0 divvarvar TEMP3 TEMP2
          addvarvar KNEEDAMAGE TEMP3

          setvarvar TEMP3 ACTORMAXAP
          randvar TEMP2 1
          addvar TEMP2 1
          ifvarn TEMP2 0 divvarvar TEMP3 TEMP2
          addvarvar KNEEDAMAGE TEMP3 

          redefinequote 335 ^22CRITICAL STRIKE!!
          setvarvar fta fta_normal setvar ftq 335
         }
        }
       }
      }
      state checkdamagecaps-knee

      // Stage 19p of Damage Formula
      // *************************
      // * IMPORTANT ARMOR START *
      // *************************
      setvarvar tempd KNEEDAMAGE

      ifvarg VAMPIRETIME 0 setvarvar TEMPVAR5 ACTORARMORPERCENT
      state enemyarmordamage
      state showdamage_actor-kneeap
      setvarvar KNEEDAMAGE tempd
      // ***********************
      // * IMPORTANT ARMOR END *
      // ***********************
      state checkdamagecaps-knee

      // Stage 20p of Damage Formula
      // ************************
      // * Check Snake Armbands *
      // ************************
      ifvarg KNEEDAMAGE 0 state snakearmband_check
      state checkdamagecaps-knee

      // Stage 21p of Damage Formula
      // *********************************************
      // * Check Melee Attacks for Confusion Ailment *
      // *********************************************
      // Damage to HP must be >5-10% (20-25% for elites) to have the chance for Blunt hits to confuse them.
      setvarvar TEMP3 ACTORMAXHP
      ifvarand ACTORFLAGS 512 // Elite
      {
       ifvarand ACTORFLAGS 1024 // Elite Boss
       {
        randvar TEMP2 125 addvar TEMP2 250	// 25.0%-37.5%
       }
       else // Only Elite
       {
        randvar TEMP2 50 addvar TEMP2 200	// 20.0%-25.0%
       }
      }
      else
      {
       ifvarand ACTORFLAGS 1024 // Elite Boss
       {
        randvar TEMP2 125 addvar TEMP2 100	// 10.0%-22.5%
       }
       else
       {
        randvar TEMP2 50 addvar TEMP2 50	// 5.0%-10.0%
       }
      }
      mulvarvar TEMP3 TEMP2
      divvar TEMP3 1000

      ifvarvarg KNEEDAMAGE TEMP3
      {
       ifvare CHARACTERSELECTED? 10
       {
        setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
        ifvare MISCARRAYID_AMOUNTTEMP 0
        {
         ifrnd 51
         {
          ifvarand ACTORSTATUS? 16
          {
           randvar TEMP 390
           addvar TEMP 390
           addvarvar ACTORDIMNESSTIMER TEMP
          } 
          else 
          { 
           addvar ACTORSTATUS? 16
           randvar TEMP 390
           addvar TEMP 390
           addvarvar ACTORDIMNESSTIMER TEMP
           redefinequote 335 ^22YOU HAVE DIMMED AN ENEMY!
           setvarvar fta fta_normal setvar ftq 335
          }   
         }   
        }
        else
        {
         ifrnd 51
         {
          ifvarand ACTORSTATUS? 128
          { 
           randvar TEMP 390
           addvar TEMP 390
           addvarvar ACTORCONFUSIONTIMER TEMP
          } 
          else 
          { 
           addvar ACTORSTATUS? 128
           randvar TEMP 390
           addvar TEMP 390
           addvarvar ACTORCONFUSIONTIMER TEMP
           redefinequote 335 ^22YOU HAVE CONFUSED AN ENEMY!
           setvarvar fta fta_normal setvar ftq 335
          }   
         }   
        }
       }
       else
       {
        ifrnd 51
        {
         ifvarand ACTORSTATUS? 128
         { 
          randvar TEMP 390
          addvar TEMP 390
          addvarvar ACTORCONFUSIONTIMER TEMP
         } 
         else 
         { 
          addvar ACTORSTATUS? 128
          randvar TEMP 390
          addvar TEMP 390
          addvarvar ACTORCONFUSIONTIMER TEMP
          redefinequote 335 ^22YOU HAVE CONFUSED AN ENEMY!
          setvarvar fta fta_normal setvar ftq 335
         }   
        }   
       }
      }
      state checkdamagecaps-knee

      // Stage 22p of Damage Formula
      //*********************
      //* Misc Arrangements *
      //*********************
      setvarvar TEMPVAR KNEEDAMAGE
      setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
      setvar DEFENDERDISPLAYTIMER 0
      ifvare TEMPVAR 0 setvar ACTORNULLDAMAGE 1 else setvar ACTORNULLDAMAGE 0
      setvarvar ACTORARMORDAMAGETEMP ACTORARMORDAMAGE
      setvar ACTORARMORDISPLAYTIMER 0

      ifvarg CURRENTACTORARMORPERCENT 0 { ifvare ACTORARMORDAMAGETEMP 0 setvar ACTORARMORNULLDAMAGE 1 else setvar ACTORARMORNULLDAMAGE 0 }
      state checkdamagecaps-knee
      // FINAL DAMAGE COUNT HERE

      // Stage 23p of Damage Formula
      //*********************************************************************************
      //* Drain Artifact and Twilight Cloaks [for players since this is monster damage] *
      //*********************************************************************************
      ifvarg KNEEDAMAGE 0
      {
       ifvarvare OWNERTEMP PLAYERID
       {
        ifvare tempvehicleid -1
        {
         ifvarg VAMPIREMAXDMGFACTOR 1000 // ifvarg VAMPIRETIME 0
         {
          setvarvar TEMP MAXHITPOINTS

          mulvarvar TEMP VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
          divvar TEMP 1000

          ifvarvarl CURRENTHITPOINTS TEMP
          {
           setvarvar TEMP2 KNEEDAMAGE
           ifvarvarg TEMP2 ACTORHP setvarvar TEMP2 ACTORHP
           mulvarvar TEMP2 VAMPIREDMGFACTOR
           divvar TEMP2 1000
           addvarvar CURRENTHITPOINTS TEMP2
        
           setvarvar TEMP3 MAXHITPOINTS
           mulvarvar TEMP3 VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
           divvar TEMP3 1000
  
           ifvarvarg CURRENTHITPOINTS TEMP3 setvarvar CURRENTHITPOINTS TEMP3
           ifvarg TEMP2 0
           {
            setvarvar TEMPHEALTH TEMP2
            state showhealing_playerhp

            setvar PLAYERHPDAMAGED? -1
            sound DRAIN_HP
            sound DRAIN_HP
            sound DRAIN_HP
           }
          }
         }
        }
        else
        {
         getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR6 // getactorvar[tempvehicleid].ACTORVAMPIRETIME TEMPVAR5
         ifvarg TEMPVAR6 1000
         {
          getactorvar[tempvehicleid].ACTORMAXHP TEMP

          getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
          mulvarvar TEMP TEMPVAR3 // Heals up to 125% HP on Public Beta
          divvar TEMP 1000

          getactorvar[tempvehicleid].ACTORHP TEMPVAR4
          ifvarvarl TEMPVAR4 TEMP
          {
           setvarvar TEMP2 KNEEDAMAGE
           ifvarvarg TEMP2 ACTORHP setvarvar TEMP2 ACTORHP
           getactorvar[tempvehicleid].ACTORVAMPIREDMGFACTOR TEMPVAR3
           mulvarvar TEMP2 TEMPVAR3
           divvar TEMP2 1000
           addvarvar TEMPVAR4 TEMP2
      
           getactorvar[tempvehicleid].ACTORMAXHP TEMP3
           getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
           mulvarvar TEMP3 TEMPVAR3 // Heals up to 125% HP on Public Beta
           divvar TEMP3 1000

           ifvarvarg TEMPVAR4 TEMP3 setvarvar TEMPVAR4 TEMP3
           setactorvar[tempvehicleid].ACTORHP TEMPVAR4
           ifvarg TEMP2 0
           {
            setvarvar TEMPHEALTH TEMP2
            state showhealing_playerhp

            setvar VEHICLEHPDAMAGED? -1
            sound DRAIN_HP
            sound DRAIN_HP
            sound DRAIN_HP
           }
          }
         }
        }
       }
      }

      ifvarg ACTORARMORDAMAGE 0
      {
       ifvarvare OWNERTEMP PLAYERID
       {
        ifvare tempvehicleid -1
        {
         ifvarg VAMPIREMAXDMGFACTOR 1000 // ifvarg VAMPIRETIME 0
         {
          setvarvar TEMP MAXARMORPOINTS
 
          mulvarvar TEMP VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
          divvar TEMP 1000

          ifvarvarl CURRENTARMORPOINTS TEMP
          {
           setvarvar TEMP2 ACTORARMORDAMAGE
           mulvarvar TEMP2 VAMPIREDMGFACTOR
           divvar TEMP2 1000
           addvarvar CURRENTARMORPOINTS TEMP2
       
           setvarvar TEMP3 MAXARMORPOINTS
           mulvarvar TEMP3 VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
           divvar TEMP3 1000

           ifvarvarg CURRENTARMORPOINTS TEMP3 setvarvar CURRENTARMORPOINTS TEMP3

           ifvarvarl ARMORPERCENT ACTORARMORPERCENT setvarvar ARMORPERCENT ACTORARMORPERCENT
           ifvarg TEMP2 0
           {
            setvarvar RECEIVEDARMOR TEMP2
            state showhealing_playerap

            setvar PLAYERAPDAMAGED? -1
            sound DRAIN_AP
            sound DRAIN_AP
            sound DRAIN_AP
           }
          }
         }
        }
        else
        {
         getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR6 // getactorvar[tempvehicleid].ACTORVAMPIRETIME TEMPVAR5
         ifvarg TEMPVAR6 1000
         {
          getactorvar[tempvehicleid].ACTORMAXAP TEMP

          getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
          mulvarvar TEMP TEMPVAR3 // Heals up to 125% HP on Public Beta
          divvar TEMP 1000

          getactorvar[tempvehicleid].ACTORAP TEMPVAR4
          ifvarvarl TEMPVAR4 TEMP
          {
           setvarvar TEMP2 ACTORARMORDAMAGE
           getactorvar[tempvehicleid].ACTORVAMPIREDMGFACTOR TEMPVAR3
           mulvarvar TEMP2 TEMPVAR3
           divvar TEMP2 1000
           addvarvar TEMPVAR4 TEMP2
       
           getactorvar[tempvehicleid].ACTORMAXAP TEMP3
           getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
           mulvarvar TEMP3 TEMPVAR3 // Heals up to 125% HP on Public Beta
           divvar TEMP3 1000

           ifvarvarg TEMPVAR4 TEMP3 setvarvar TEMPVAR4 TEMP3
           setactorvar[tempvehicleid].ACTORAP TEMPVAR4

           getactorvar[tempvehicleid].ACTORARMORPERCENT TEMPVAR4
           ifvarvarl TEMPVAR4 ACTORARMORPERCENT { setvarvar TEMPVAR4 ACTORARMORPERCENT setactorvar[tempvehicleid].ACTORARMORPERCENT TEMPVAR4 }
           ifvarg TEMP2 0
           {
            setvarvar RECEIVEDARMOR TEMP2
            state showhealing_playerap

            setvar VEHICLEAPDAMAGED? -1
            sound DRAIN_AP  
            sound DRAIN_AP
            sound DRAIN_AP
           }
          }
         }
        }
       }
      }
      // End Drain Artifact [for players since this is monster damage]
      state checkdamagecaps-knee

      // Stage 24p of Damage Formula
      ifvarg KNEEDAMAGE 0 setvar ACTORHPDAMAGED? 1
      subvarvar ACTORHP KNEEDAMAGE state showdamage_actor-kneehp
      setvarvar ACTORLASTDAMAGE KNEEDAMAGE
      ifvarg ACTORHP 0
      {
       setactor[THISACTOR].extra 8193
       setactor[THISACTOR].htextra 1
      }
      else
      {
       setvar ACTORHP 0
       setactor[THISACTOR].extra 0
       state checkactorsurvivalvalue
       ifvarg KNEEDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra KNEEDAMAGE
      }
      // FINAL DAMAGE COUNT HERE

      setvarvar ACTORHEALTH ACTORHP

      setvarvar DAMAGETEMP KNEEDAMAGE 
      setvarvar TEMPHITACTORVARHP ACTORMAXHP
      setvarvar TEMPHITACTORVARAP ACTORMAXAP
      setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
      setvar DEFENDERDISPLAYTIMER 0
      state checkdamagecaps-knee
     } // ifvare PICNUMTEMP APLAYER
     else // if the attacking actor is not either the player or the same species, damage is divided by half BEFORE defense is factored in
     { // ifvarn PICNUMTEMP APLAYER
      // Stage 2e of Damage Formula
      state calccriticalhits_actor
      mulvarvar KNEEDAMAGE CRITICALHITMULTI
      ifvarvarg KNEEDAMAGE STATLIMITMAXIMUM setvarvar KNEEDAMAGE STATLIMITMAXIMUM
      // ifvarg ACTORCRITICAL? 0 addlogvar PLAYERDAMAGE
      state checkdamagecaps-knee

      // Stage 3e of Damage Formula
      divvar KNEEDAMAGE 2
      subvarvar KNEEDAMAGE ACTORDEFENSE
      state checkdamagecaps-knee

      // Stage 4e of Damage Formula
      // FINAL DAMAGE COUNT HERE
      ifvarg KNEEDAMAGE 0 setvar ACTORHPDAMAGED? 1
      subvarvar ACTORHP KNEEDAMAGE state showdamage_actor-kneehp
      setvarvar ACTORLASTDAMAGE KNEEDAMAGE
      ifvarg ACTORHP 0
      {
       setactor[THISACTOR].htextra 1
       setactor[THISACTOR].extra 8193
      }
      else
      {
       setvar ACTORHP 0
       setactor[THISACTOR].extra 0
       state checkactorsurvivalvalue
       setactor[THISACTOR].htextra KNEEDAMAGE
      }

      state checkdamagecaps-knee
      // FINAL DAMAGE COUNT HERE
     } // ifvarn PICNUMTEMP APLAYER
   
    } // ifvarn KNEEDAMAGE 0 
  } // ifvarg tempb 0
ends 

state enemyabsorbdamage
     addvarvar ACTORHP GENERALDAMAGE
     setvar ACTORLASTDAMAGE 0
     ifvarvarg ACTORHP ACTORMAXHPATOMIC setvarvar ACTORHP ACTORMAXHPATOMIC
     setactor[THISACTOR].htextra -1
     sound ABSORB_DAMAGE

     setvarvar ITEMSEEK THISACTOR
     setvarvar ITEMSEEKC GENERALDAMAGE
     state showhealing_actorhp

     setvar ACTORHPDAMAGED? -1
     setvar GENERALDAMAGE 0 
     break
ends

state freeze-chilleffect_actors
     setvar tempf 45
     ifvare temp BOSS1 { setvar tempf 75 addvar tempf 1 }
     ifvare temp BOSS2 setvar tempf 90 
     ifvare temp BOSS3 { setvar tempf 112 ifrnd 128 addvar tempf 1 }
     ifvare temp BOSS4 setvar tempf 18
     ifvare temp NEWBEAST setvar tempf 36
     ifvare temp DRONE setvar tempf 0
     ifvare temp EMPTYTANK setvar tempf 0
     ifvare temp TANK setvar tempf 0
     ifvare temp SCORPIONTANK setvar tempf 0
     ifvare temp ROTATEGUN setvar tempf 0
     mulvarvar tempf enemywinterclothes
     divvar tempf 100

     setvar temph 50
     ifvare temp BOSS1 setvar temph 75
     ifvare temp BOSS2 setvar temph 100 
     ifvare temp BOSS3 setvar temph 125
     ifvare temp BOSS4 setvar temph 20
     ifvare temp NEWBEAST setvar temph 40
     ifvare temp DRONE setvar temph 0
     ifvare temp EMPTYTANK setvar temph 0
     ifvare temp TANK setvar temph 0
     ifvare temp SCORPIONTANK setvar temph 0
     ifvare temp ROTATEGUN setvar temph 0
     subvarvar temph tempf
ends


state checkdamagecaps-general
  ifvarvarg GENERALDAMAGE STATLIMITATOMIC setvarvar GENERALDAMAGE STATLIMITATOMIC
  ifvarvarg ACTORARMORDAMAGE STATLIMITATOMIC setvarvar ACTORARMORDAMAGE STATLIMITATOMIC
  // addlogvar GENERALDAMAGE
  // addlogvar ACTORARMORDAMAGE
ends

//************************************************************************
//*State for calculating overall non-player damage from non melee-attacks*
//************************************************************************
state add_generaldamage
  setvar ACTORLASTDAMAGE 0
  getactor[THISACTOR].picnum temp
  getactor[THISACTOR].htextra tempb
  getactor[THISACTOR].htpicnum tempc
  // ifvarn tempb -1 addlogvar tempb
  ifvare tempc RPG { ifvarg tempb 0 ifvarl tempb 76 setvar ISDEVASTATOR? 1 else setvar ISDEVASTATOR? 0 } else { setvar ISDEVASTATOR? 0 }
  setvarvar TEMP ACTORHP

  ifvarg ACTORDEATHSWITCHDELAY 0 { setactor[THISACTOR].htextra -1 break }

  //** Formatting Start **
  ifvarg oldskoolmode 0
  {
   getactor[THISACTOR].pal tempd
   ifvare tempd 9
   {
    ifvare temp BOSS1 mulvar tempb 4
    ifvare temp BOSS2 mulvar tempb 4
    ifvare temp BOSS3 mulvar tempb 4
    ifvare temp BOSS4 mulvar tempb 4
   }
   setvarvar ACTORLASTDAMAGE tempb
   subvarvar ACTORHP tempb
   break
  }
  state prevent_redundantdamage

  ifvare tempc INVULNICON
  {
   setvarvar SHOWDAMAGE STATLIMITMAXIMUM
   setvar SHOWDAMAGETYPE 0
   setvarvar SHOWDAMAGEACTORID THISACTOR
   state showdamage

   getactor[THISACTOR].picnum DEFENDINGACTORDEBUG
   getactor[THISACTOR].pal DEFENDINGACTORPAL
   setvarvar GENERALDAMAGE STATLIMITMAXIMUM
   setvarvar ACTORARMORDAMAGE 0
   setvarvar TEMPVAR GENERALDAMAGE 
   setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
   setvar DEFENDERDISPLAYTIMER 0
   ifvare TEMPVAR 0 setvar ACTORNULLDAMAGE 1 else setvar ACTORNULLDAMAGE 0
   setvarvar ACTORARMORDAMAGETEMP ACTORARMORDAMAGE
   setvar ACTORARMORDISPLAYTIMER 54

   setvar CRITICAL? 0
   setvarvar DAMAGETEMP GENERALDAMAGE 
   setvarvar TEMPHITACTORVARHP ACTORMAXHP
   setvarvar TEMPHITACTORVARAP ACTORMAXAP
   setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
   setvar DEFENDERDISPLAYTIMER 0
   setvar CRITICALHITMULTI 0
 
   setvar ACTORHP 0
   setactor[THISACTOR].extra 0
   state checkactorsurvivalvalue
   // setactor[THISACTOR].htowner PLAYERID
   setactor[THISACTOR].htpicnum RPG
   setactor[THISACTOR].htextra 1
   break
  }

ifvarg tempb 0
{ // ifvarg tempb 0
 ifvare mainmenu 1 // if in the menus, receive no damage and cancel event
 { 
  setactor[THISACTOR].htextra -1 // 0 // TODO: LEAVE-THIS
  break 
 }
 setvar ACTORARMORDAMAGE 0
 ifvarg FLOORDAMAGETEMP 0 nullop // Prevents Sector Damage like Lava from being augumented by the damage formula
 else // Else go on to the main formulas
 {
  getactor[THISACTOR].htextra GENERALDAMAGE // TODO: LEAVE-THIS
  setactor[THISACTOR].htextra 1

  // Stage 1 of Damage Formula
  //*******************************************************************************
  //*Special State for Deathgate/Stroke Missiles due to their immense base damages*
  //*******************************************************************************
  ifvare tempc GATEMISSILE_MAIN addvar GENERALDAMAGE 6300
  ifvare tempc GATEMISSILE_SPLIT addvar GENERALDAMAGE 945
  ifvare tempc STROKEMISSILE_MAIN addvar GENERALDAMAGE 25200
  ifvare tempc STROKEMISSILE_SPLIT addvar GENERALDAMAGE 1260
  ifvare tempc BIOMETRICBLAST1
  {
   setvar GENERALDAMAGE 1536
   ifvare ESHIELDADVANCEMENT 0 randvar TEMPVAR5 128 else randvar TEMPVAR5 512
   ifrnd 128 subvarvar GENERALDAMAGE TEMPVAR5 else addvarvar GENERALDAMAGE TEMPVAR5

   setvar TEMPVAR5 1536
   setvarvar TEMPVAR4 SKILLLEVEL
   addvar TEMPVAR4 1
   divvarvar TEMPVAR5 TEMPVAR4
   addvarvar GENERALDAMAGE TEMPVAR5

   ifvare HAVEENERGYSHIELD? 1
   {
    ifvare ESHIELDADVANCEMENT 0 setvar TEMPVAR5 128 else setvar TEMPVAR5 512
    mulvarvar TEMPVAR5 ESHIELDDMGFACTOR
    addvarvar GENERALDAMAGE TEMPVAR5
   }
  }
  getactor[THISACTOR].htowner tempd
  getactorvar[tempd].VEHICLEID tempvehicleid
  getactorvar[tempd].VEHICLETYPE tempvehicletype
  getactor[tempd].picnum tempe
  state checkdamagecaps-general

  // Stage 2 of Damage Formula
  //*****************************************************
  //*Add Support for extra damage from Fire/Steam Actors*
  //*****************************************************
  switch tempe
   case SEENINE
   case OOZFILTER
   case FIRE
   case FIRE2
   case BURNING
   case BURNING2
   case FIREVASE
   case FIREBARREL
   case STEAM
   case CEILINGSTEAM
    getactorvar[tempd].ACTORATTACK TEMP
    mulvar TEMP 3
    divvar TEMP 4
    addvarvar GENERALDAMAGE TEMP
    setvar TEMP 0
   break

   case TRIPBOMB
    getactorvar[tempd].ACTORATTACK TEMP
    mulvar TEMP 3
    divvar TEMP 4
    addvarvar GENERALDAMAGE TEMP
    setvar TEMP 0
    getactorvar[tempd].PLAYERTRIPBOMB? TEMP
    ifvare TEMP 1 setvar tempe APLAYER
   break
  endswitch
  state checkdamagecaps-general


  // Stage 3 of Damage Formula
  //******************************************************************
  //*Check Lori's Triad Refractor, Mirror Shields and Invulnerability*
  //******************************************************************
  ifvare REFRACTORSTATE 1 // Pyramid Refractor [Lori]
  {
   ifvarg ACTORINVULNTIME 0
   {
    setvar CRITICAL? 0
    setvar DEFLECTEDDAMAGE 0
    state nullgendamage
    setactor[THISACTOR].htextra 0 // TODO: LEAVE-THIS
    setvar REFRACTORSTATE 0
   }
   else
   {
    setvar CRITICAL? 0
    addvarvar DEFLECTEDDAMAGE GENERALDAMAGE
    addvarvar DEFLECTEDDAMAGE MELEEDAMAGE

    ifvarand ACTORFLAGS 512 // Elite Monsters will cut reflected damage by 50-75%
    {
     randvar TEMPVAR 25
     addvar TEMPVAR 25
     mulvarvar DEFLECTEDDAMAGE TEMPVAR
     divvar DEFLECTEDDAMAGE 100
    }

    setvarvar TEMPVAR8 PLAYERLEVEL

    setvar tempc 3000
    setvar tempd -250
    mulvarvar tempd SKILLLEVEL
    ifvarg SKILLLEVEL 4 addvar tempd 250
    addvarvar tempc tempd
    mulvarvar TEMPVAR8 tempc

    divvar TEMPVAR8 1000

    addvar TEMPVAR8 100
    mulvarvar DEFLECTEDDAMAGE TEMPVAR8
    divvar DEFLECTEDDAMAGE 100
    ifvarvarg DEFLECTEDDAMAGE STATLIMITMAXIMUM setvarvar DEFLECTEDDAMAGE STATLIMITMAXIMUM

    // Freeze-Chill Effect from Ice-Elemental Attacks
    ifvare tempc FREEZEBLAST
    {
     state freeze-chilleffect_actors

     mulvarvar temph TEMPVAR8
     divvar temph 100

     ifvarand ACTORFLAGS 512 // Elite Monsters will cut reflected damage by 50-75%
     {
      randvar TEMPVAR 25
      addvar TEMPVAR 25
      mulvarvar temph TEMPVAR
      divvar temph 100
     }

     randvarvar tempg temph
     addvarvar tempg temph
     addvarvar freezetimer tempg
     state dealfreezedamage-actor
    }
 
    setvarvar tempd DEFLECTEDDAMAGE
    state calcenemyarmor
    setvarvar DEFLECTEDDAMAGE tempd
    setvarvar ACTORARMORDAMAGETEMP ACTORARMORDAMAGE state showdamage_actor-deflectap
    setvar ACTORARMORDISPLAYTIMER 0
 
    getactor[THISACTOR].picnum DEFENDINGACTORDEBUG
    getactor[THISACTOR].pal DEFENDINGACTORPAL
    globalsound REFRACTOR_SOUND

    setvarvar DAMAGETEMP DEFLECTEDDAMAGE 
    setvarvar TEMPHITACTORVARHP ACTORMAXHP
    setvarvar TEMPHITACTORVARAP ACTORMAXAP
    ifvare DAMAGETEMP 0 setvar ACTORNULLDAMAGE 1 else setvar ACTORNULLDAMAGE 0
    setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
    setvar DEFENDERDISPLAYTIMER 0
    state nullgendamage
    setvar MELEEDAMAGE 0
    subvarvar ACTORHP DEFLECTEDDAMAGE state showdamage_actor-deflecthp
    ifvarg DEFLECTEDDAMAGE 0 setvar ACTORHPDAMAGED? 1
    setvarvar ACTORLASTDAMAGE DEFLECTEDDAMAGE
    ifvarg ACTORHP 0
    {
     ifvarg DEFLECTEDDAMAGE 0 setactor[THISACTOR].htextra 1
     setactor[THISACTOR].extra 8193
     setvar DEFLECTEDDAMAGE 0
     setvar REFRACTORSTATE 0
     break
    }
    else
    {
     setvar ACTORHP 0
     setactor[THISACTOR].extra 0
     state checkactorsurvivalvalue
     ifvarg DEFLECTEDDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra DEFLECTEDDAMAGE
     setvar DEFLECTEDDAMAGE 0
     setvar REFRACTORSTATE 0
     break
    }  
   }
  }
  else
  ifvare MIRRORSHIELDSTATE 1
  {
   ifvarg ACTORINVULNTIME 0
   {
    setvar CRITICAL? 0
    setvar DEFLECTEDDAMAGE 0
    state nullgendamage
    setactor[THISACTOR].htextra 0 // TODO: LEAVE-THIS
    setvar MIRRORSHIELDSTATE 0
   }
   else
   {
    setvar CRITICAL? 0
    addvarvar DEFLECTEDDAMAGE GENERALDAMAGE
    addvarvar DEFLECTEDDAMAGE MELEEDAMAGE

    ifvarand ACTORFLAGS 512 // Elite Monsters will cut reflected damage by 50-75%
    {
     randvar TEMPVAR 25
     addvar TEMPVAR 25
     mulvarvar DEFLECTEDDAMAGE TEMPVAR
     divvar DEFLECTEDDAMAGE 100
    }

    // Freeze-Chill Effect from Ice-Elemental Attacks
    ifvare tempc FREEZEBLAST
    {
     state freeze-chilleffect_actors

     ifvare PLAYEREQUIPSLOTITEM1 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM2 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM3 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM4 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM5 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM6 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM7 2 { mulvar temph 3 divvar temph 2 }
     ifvare PLAYEREQUIPSLOTITEM8 2 { mulvar temph 3 divvar temph 2 }

     ifvarand ACTORFLAGS 512 // Elite Monsters will cut reflected damage by 50-75%
     {
      randvar TEMPVAR 25
      addvar TEMPVAR 25
      mulvarvar temph TEMPVAR
      divvar temph 100
     }

     randvarvar tempg temph
     addvarvar tempg temph
     addvarvar freezetimer tempg
     state dealfreezedamage-actor
    }

    ifvarvarg DEFLECTEDDAMAGE STATLIMITMAXIMUM setvarvar DEFLECTEDDAMAGE STATLIMITMAXIMUM
 
    setvarvar tempd DEFLECTEDDAMAGE
    state calcenemyarmor
    setvarvar DEFLECTEDDAMAGE tempd
    setvarvar ACTORARMORDAMAGETEMP ACTORARMORDAMAGE state showdamage_actor-deflectap
    setvar ACTORARMORDISPLAYTIMER 0
 
    getactor[THISACTOR].picnum DEFENDINGACTORDEBUG
    getactor[THISACTOR].pal DEFENDINGACTORPAL
    globalsound DEFLECT1

    setvarvar DAMAGETEMP DEFLECTEDDAMAGE 
    setvarvar TEMPHITACTORVARHP ACTORMAXHP
    setvarvar TEMPHITACTORVARAP ACTORMAXAP
    ifvare DAMAGETEMP 0 setvar ACTORNULLDAMAGE 1 else setvar ACTORNULLDAMAGE 0
    setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
    setvar DEFENDERDISPLAYTIMER 0
    state nullgendamage
    setvar MELEEDAMAGE 0
    subvarvar ACTORHP DEFLECTEDDAMAGE state showdamage_actor-deflecthp
    ifvarg DEFLECTEDDAMAGE 0 setvar ACTORHPDAMAGED? 1
    setvarvar ACTORLASTDAMAGE DEFLECTEDDAMAGE
    ifvarg ACTORHP 0
    {
     ifvarg DEFLECTEDDAMAGE 0 setactor[THISACTOR].htextra 1
     setactor[THISACTOR].extra 8193
     setvar DEFLECTEDDAMAGE 0
     setvar MIRRORSHIELDSTATE 0
     break
    }
    else
    {
     setvar ACTORHP 0
     setactor[THISACTOR].extra 0
     state checkactorsurvivalvalue
     ifvarg DEFLECTEDDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra DEFLECTEDDAMAGE
     setvar DEFLECTEDDAMAGE 0
     setvar MIRRORSHIELDSTATE 0
     break
    }
    
   }
  }
  else
  ifvare DEFLECTDAMAGESTATE 1 // If the player is in God Mode or under the effect of an Invuln item, they deflect all enemy damage
  {
   // General Damage Reduction or Increase for reflected damage [to sooth the screaming masses of people who hate overwhelming amounts of deflected damage :P]
   //addlogvar DEFLECTEDDAMAGE
   mulvarvar DEFLECTEDDAMAGE INVULNREFLECTRATE
   divvar DEFLECTEDDAMAGE 1000
   //addlogvar DEFLECTEDDAMAGE

   ifvare INVULNREFLECTRATE 0
   {
    setvar CRITICAL? 0
    setvar DEFLECTEDDAMAGE 0
    state nullgendamage
    setactor[THISACTOR].htextra 0 // TODO: LEAVE-THIS
    setvar DEFLECTDAMAGESTATE 0
   }
   else
   {
    ifvarg ACTORINVULNTIME 0
    {
     setvar CRITICAL? 0
     setvar DEFLECTEDDAMAGE 0
     state nullgendamage
     setactor[THISACTOR].htextra 0 // TODO: LEAVE-THIS
     setvar DEFLECTDAMAGESTATE 0
    }
    else
    {
     setvar CRITICAL? 0
     getactor[THISACTOR].picnum DEFENDINGACTORDEBUG
     getactor[THISACTOR].pal DEFENDINGACTORPAL
     addvarvar DEFLECTEDDAMAGE GENERALDAMAGE
     addvarvar DEFLECTEDDAMAGE MELEEDAMAGE
 
     ifvarand ACTORFLAGS 512 // Elite Monsters will cut reflected damage by 50-75%
     {
      randvar TEMPVAR 25
      addvar TEMPVAR 25
      mulvarvar DEFLECTEDDAMAGE TEMPVAR
      divvar DEFLECTEDDAMAGE 100
     }
 
     // Freeze-Chill Effect from Ice-Elemental Attacks
     ifvare tempc FREEZEBLAST
     {
      state freeze-chilleffect_actors
 
      ifvarand ACTORFLAGS 512 // Elite Monsters will cut reflected damage by 50-75%
      {
       randvar TEMPVAR 25
       addvar TEMPVAR 25
       mulvarvar temph TEMPVAR
       divvar temph 100
      }
 
      randvarvar tempg temph
      addvarvar tempg temph
      addvarvar freezetimer tempg
      state dealfreezedamage-actor
     }

     setvarvar DAMAGETEMP DEFLECTEDDAMAGE 
     setvarvar TEMPHITACTORVARHP ACTORMAXHP
     setvarvar TEMPHITACTORVARAP ACTORMAXAP
     setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
     setvar DEFENDERDISPLAYTIMER 0
     state nullgendamage
     setvar MELEEDAMAGE 0
     globalsound DEFLECT1

     subvarvar ACTORHP DEFLECTEDDAMAGE state showdamage_actor-deflecthp
     ifvarg DEFLECTEDDAMAGE 0 setvar ACTORHPDAMAGED? 1
     setvarvar ACTORLASTDAMAGE DEFLECTEDDAMAGE
     ifvarg ACTORHP 0
     {
      ifvarg DEFLECTEDDAMAGE 0 setactor[THISACTOR].htextra 1
      setactor[THISACTOR].extra 8193
      setvar DEFLECTEDDAMAGE 0
      setvar DEFLECTDAMAGESTATE 0
      setvar MIRRORSHIELDSTATE 0
      setvar REFRACTORSTATE 0
      break
     }
     else
     {
      setvar ACTORHP 0
      setactor[THISACTOR].extra 0
      state checkactorsurvivalvalue
      ifvarg DEFLECTEDDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra DEFLECTEDDAMAGE
      setvar DEFLECTEDDAMAGE 0
      setvar DEFLECTDAMAGESTATE 0
      setvar MIRRORSHIELDSTATE 0
      setvar REFRACTORSTATE 0
      break
     }
    }

   }
  }
  else
  ifvarg GENERALDAMAGE 0 
  { 
   getactor[THISACTOR].htowner OWNERTEMP 
   getactor[OWNERTEMP].picnum PICNUMTEMP
   getactor[THISACTOR].pal DEFENDINGPAL
   state monster_defense_calc

   ifvarn tempc RADIUSEXPLOSION
   ifvarn tempc RPG nullop else
   {
    getactor[THISACTOR].xvel TEMP 
    mulvar TEMP -1 
    setactor[THISACTOR].xvel TEMP
    getactor[THISACTOR].yvel TEMP 
    mulvar TEMP -1 
    setactor[THISACTOR].yvel TEMP
   }
   state checkdamagecaps-general


  // Stage 4 of Damage Formula
  //*******************************************************
  //*Monster Vulnerability Section. (tempc = [ATTACKNAME])*
  //*******************************************************
  // Warmth in Cold Environs
  ifvare tempc RPG { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc RPG_NOAIM { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc GENERAL_RPG { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc COMMANDER_RPG { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc LEADER_RPG { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc BAALO_RPG { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc GATEMISSILE_MAIN { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc GATEMISSILE_SPLIT { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc STROKEMISSILE_MAIN { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc STROKEMISSILE_SPLIT { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc MORTER { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc SEENINE { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc OOZFILTER { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc RADIUSEXPLOSION { ifvarg freezetimer 0 { randvar tempg 64 addvar tempg 64 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc GROWSPARK { ifvarg freezetimer 0 { randvar tempg 12 addvar tempg 12 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc OCTANINE_RPG { ifvarg freezetimer 0 { randvar tempg 32 addvar tempg 32 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc FIRELASER { ifvarg freezetimer 0 { randvar tempg 8 addvar tempg 8 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc BIOMETRICBLAST1 { ifvarg freezetimer 0 { randvar tempg 192 addvar tempg 192 subvarvar freezetimer tempg ifvarl freezetimer 0 setvar freezetimer 0 } }
  ifvare tempc FREEZEBLAST
  {
   // Freeze Chilling Effect
   ifvarl ACTORINVULNTIME 1
   {
    state freeze-chilleffect_actors

    randvarvar tempg temph
    addvarvar tempg temph
    addvarvar freezetimer tempg
    state dealfreezedamage-actor    
   }
  }
  state checkdamagecaps-general


  // Stage 5 of Damage Formula
  switch temp
   // Protozoid Slimer Eggs [EGG]
   case EGG
    ifvare DEFENDINGPAL 9 nullop // No Natural Resistances, Weaknesses, Immunities or Absorbancies :P
    else // All other Eggs
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -990 // -99% Expander Damage
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 4000 // +400% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // No Natural Resistance to Overall Damage [XD]
    }
   break

   // Sharks [SHARK]
   case SHARK
    ifvare DEFENDINGPAL 24 // Bloodtooth Shark
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -600 // -60% Expander Damage
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 500 // +50% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(random 0 to 40)% Overall Damage
     randvar TEMPVAR 200
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 800
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop  // No Natural Resistances or Immunities :P
    else // All other Sharks
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -300 // -30% Freezethrower Damage
     // Weaknesses
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER 1500 // +150% Expander Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(random 0 to 10)% Overall Damage
     randvar TEMPVAR 50
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 950
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Mounted Turrets [ROTATEGUN]
   case ROTATEGUN
    ifvare DEFENDINGPAL 19 // Mounted Missile Turret
    { 
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc RPG addvar DAMAGEMODIFIER -250 // -25% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -250 // -25% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Baalo the Colosuss] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -250 // -25% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -250 // -25% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -250 // -25% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -250 // -25% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -250 // -25% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -250 // -25% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -250 // -25% 0oz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -250 // -25% Radius Explosion Damage
     // Weaknesses
     ifvare tempc ZAPPER1 addvar DAMAGEMODIFIER 200 // +20% Zapper 1 Damage
     ifvare tempc ZAPPER2 addvar DAMAGEMODIFIER 200 // +20% Zapper 2 Damage
     ifvare tempc ZAPPER3 addvar DAMAGEMODIFIER 200 // +20% Zapper 3 Damage
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 200 // +20% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -9.375% Overall Damage
     setvar TEMPVAR 906
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else 
    ifvare DEFENDINGPAL 17 // Mounted Shotgun Turret
    { 
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -250 // -25% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -250 // -25% Shotgun Damage
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -250 // -25% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -250 // -25% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -250 // -25% Chaingun Damage
     // Weaknesses
     ifvare tempc ZAPPER1 addvar DAMAGEMODIFIER 200 // +20% Zapper 1 Damage
     ifvare tempc ZAPPER2 addvar DAMAGEMODIFIER 200 // +20% Zapper 2 Damage
     ifvare tempc ZAPPER3 addvar DAMAGEMODIFIER 200 // +20% Zapper 3 Damage
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 200 // +20% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -9.375% Overall Damage
     setvar TEMPVAR 906
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop // No Natural Resistances or Immunities :P
    else // All other Turrets
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -250 // -25% Laser Damage
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -250 // -25% Expander Damage
     // Weaknesses
     ifvare tempc ZAPPER1 addvar DAMAGEMODIFIER 200 // +20% Zapper 1 Damage
     ifvare tempc ZAPPER2 addvar DAMAGEMODIFIER 200 // +20% Zapper 2 Damage
     ifvare tempc ZAPPER3 addvar DAMAGEMODIFIER 200 // +20% Zapper 3 Damage
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 200 // +20% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -6.25% Overall Damage
     setvar TEMPVAR 937
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Predatars, aka "Assault Troopers" [LIZTROOP]
   case LIZTROOP
   case LIZTROOPSTAYPUT
   case LIZTROOPSHOOT
   case LIZTROOPDUCKING
   case LIZTROOPJETPACK
   case LIZTROOPRUNNING
   case LIZTROOPONTOILET
   case LIZTROOPJUSTSIT
    ifvare DEFENDINGPAL 21 // Assault Captain
    {
     // Resistances
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -100 // -10% Laser Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -4% Overall Damage
     setvar TEMPVAR 960
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 19 // Ravager Captain
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -100 // -10% Laser Damage
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -667 // -66% Expander Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -667 // -66% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -667 // -66% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -667 // -66% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -667 // -66% RPG[Baalo the Collosus] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -667 // -66% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -667 // -66% RPG[General] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -667 // -66% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -667 // -66% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -667 // -66% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -667 // -66% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -667 // -66% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -667 // -66% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -667 // -66% Ooz Canister Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -667 // -66% Radius Explosion Damage
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 333 // +33% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 14 // Shrink Trooper
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -200 // -20% Laser Damage
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -800 // -80% Expander Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -16.66% Overall Damage
     setvar TEMPVAR 833
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 17 // Commander Zerman [Species-Specfic BOSS]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -500 // -50% Laser Damage
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -750 // -75% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -750 // -75% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -750 // -75% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -750 // -75% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -750 // -75% Chaingun Damage
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -980 // -98% Freezethrower Damage
     // Weaknesses
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER 200 // +20% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER 200 // +20% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER 200 // +20% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER 200 // +20% RPG[Baalo the Collosus] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER 200 // +20% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER 200 // +20% RPG[General] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER 200 // +20% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER 200 // +20% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER 200 // +20% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER 200 // +20% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER 200 // +20% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER 200 // +20% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER 200 // +20% Ooz Canister Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER 200 // +20% Radius Explosion Damage
     ifvare tempc ZAPPER1 addvar DAMAGEMODIFIER 80 // +8% Electrical Blast #1[Medium] Damage
     ifvare tempc ZAPPER2 addvar DAMAGEMODIFIER 80 // +8% Electrical Blast #2[Small] Damage
     ifvare tempc ZAPPER3 addvar DAMAGEMODIFIER 80 // +8% Electrical Blast #3[Large] Damage     
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     // -50% Overall Damage
     setvar TEMPVAR 500
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else ifvare DEFENDINGPAL 11 nullop // No Natural Resistances, Weaknesses, Immunities or Absorbancies :P
    else ifvare DEFENDINGPAL 10 nullop // No Natural Resistances, Weaknesses, Immunities or Absorbancies :P
    else // All other Predatar/Assault Trooper[LIZTROOP] forms
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -50 // -5% Laser Damage [Natural]
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -1% Overall Damage
     setvar TEMPVAR 990
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Anfarciars, aka "Enforcers" [LIZMAN]
   case LIZMAN
   case LIZMANSTAYPUT
   case LIZMANJUMP
   case LIZMANSPITTING
    ifvare DEFENDINGPAL 19 // Laser Enforcer
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -333 // -33% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -333 // -33% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -333 // -33% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -333 // -33% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -333 // -33% Chaingun Damage
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -750 // -75% Laser Damage
     ifvare tempc SPIT addvar DAMAGEMODIFIER -200 // -20% Spit Damage
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 3000 // +300% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 6 // Bio-Warrior Enforcer
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -600 // -60% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -600 // -60% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -600 // -60% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -600 // -60% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -600 // -60% Chaingun Damage
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -875 // -87.5% Laser Damage
     ifvare tempc SPIT addvar DAMAGEMODIFIER -600 // -80% Spit Damage
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 333 // +33% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -25% Overall Damage
     setvar TEMPVAR 750
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 17 // Commander Fertang [Species-Specfic BOSS]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -800 // -80% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -800 // -80% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -800 // -80% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -800 // -80% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -800 // -80% Chaingun Damage
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -900 // -90% Laser Damage
     ifvare tempc SPIT addvar DAMAGEMODIFIER -888 // -88.8% Spit Damage
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 500 // +50% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -50% Overall Damage
     setvar TEMPVAR 500
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop
    else
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -333 // -33% Laser Damage
     ifvare tempc SPIT addvar DAMAGEMODIFIER -100 // -10% Spit Damage
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -250 // -25% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -2.5% Overall Damage
     setvar TEMPVAR 975
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Sentry Drones [DRONE]
   case DRONE
    ifvare DEFENDINGPAL 25 // Super Drone
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     ifvare tempc ZAPPER1 addvar DAMAGEMODIFIER 250 // +25% Electrical Blast #1[Medium] Damage
     ifvare tempc ZAPPER2 addvar DAMAGEMODIFIER 250 // +25% Electrical Blast #2[Small] Damage
     ifvare tempc ZAPPER3 addvar DAMAGEMODIFIER 250 // +25% Electrical Blast #3[Large] Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(random 0 to 25)% Overall Damage
     randvar TEMPVAR 125
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 875
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop
    else // All other Sentry Drones
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     ifvare tempc ZAPPER1 addvar DAMAGEMODIFIER 1000 // +100% Electrical Blast #1[Medium] Damage
     ifvare tempc ZAPPER2 addvar DAMAGEMODIFIER 1000 // +100% Electrical Blast #2[Small] Damage
     ifvare tempc ZAPPER3 addvar DAMAGEMODIFIER 1000 // +100% Electrical Blast #3[Large] Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(random 0 to 5)% Overall Damage
     randvar TEMPVAR 25
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 975
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Octabrainians aka "Octabrains" [OCTABRAIN]
   case OCTABRAIN
   case OCTABRAINSTAYPUT
    ifvare DEFENDINGPAL 14 // Octanine
    {
     // Absorbancies
     ifvare tempc OCTANINE_RPG { divvar GENERALDAMAGE 10 state enemyabsorbdamage } // Absorbs 10% of RPG[Octanine] damage into healing
     // Immunities
     ifvare tempc COOLEXPLOSION1 setvar GENERALDAMAGE 0 // No Damage from Mindblasts
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -500 // -50% Freezethrower Damage
     // Weaknesses
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER 130 // +13% Laser Damage
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER 50 // +5% Expander Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER 100 // +10% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER 100 // +10% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER 100 // +10% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER 100 // +10% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER 100 // +10% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER 100 // +10% RPG[Baalo the Collosus] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER 100 // +10% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER 100 // +10% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER 100 // +10% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER 100 // +10% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER 100 // +10% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER 100 // +10% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER 100 // +10% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER 100 // +10% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(15 to 20)% Overall Damage
     randvar TEMPVAR 25
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     setvar TEMPVAR 825
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop
    else // All other Octabrains
    {
     // Immunities
     ifvare tempc COOLEXPLOSION1 setvar GENERALDAMAGE 0 // No Damage from Mindblasts
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -750 // -75% Freezethrower Damage
     ifvare tempc OCTANINE_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Octanine] damage
     // Weaknesses
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER 650 // +65% Laser Damage
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER 250 // +25% Expander Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER 500 // +50% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER 500 // +50% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER 500 // +50% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER 500 // +50% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER 500 // +50% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER 500 // +50% RPG[Baalo the Collosus] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER 500 // +50% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER 500 // +50% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER 500 //+50% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER 500 // +50% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER 500 // +50% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER 500 // +50% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER 500 // +50% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER 500 // +50% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(2.5 to 7.5)% Overall Damage
     randvar TEMPVAR 25
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     setvar TEMPVAR 950
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Mutateous Humana Hoggis' aka "Pigcops"
   case PIGCOP
   case PIGCOPSTAYPUT
   case PIGCOPDIVE
    ifvare DEFENDINGPAL 21 // Pigcop Captain
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -100 // -10% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -100 // -10% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -100 // -10% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -100 // -10% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -100 // -10% Chaingun Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -100 // -10% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -100 // -10% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Asaault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Baalo the Collosus] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -100 // -10% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -100 // -10% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -100 // -10% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -100 // -10% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -100 // -10% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -100 // -10% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -100 // -10% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -100 // -10% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 14 // Pigcop Sargeant
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -166 // -16% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -166 // -16% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -166 // -16% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -166 // -16% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -166 // -16% Chaingun Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -250 // -25% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -250 // -25% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Asaault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Baalo the Collosus] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -250 // -25% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -250 // -25% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -250 // -25% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -250 // -25% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -250 // -25% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -250 // -25% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -250 // -25% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -250 // -25% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -25% Overall Damage
     setvar TEMPVAR 750
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 24 // Pigcop Colonel Ramone [Species-Specfic BOSS]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -333 // -33% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -333 // -33% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -333 // -33% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -333 // -33% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -333 // -33% Chaingun Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -333 // -33% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -333 // -33% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -333 // -33% RPG[Asaault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -333 // -33% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -333 // -33% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -333 // -33% RPG[Baalo the Collosus] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -333 // -33% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -333 // -3% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -333 // -33% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -333 // -33% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -333 // -33% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -333 // -33% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -333 // -33% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -333 // -33% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -50% Overall Damage
     setvar TEMPVAR 500
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop
    else // All other Pigcops
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -40 // -4% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -40 // -4% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -40 // -4% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -40 // -4% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -40 // -4% Chaingun Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -40 // -4% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -40 // -4% RPG[Asaault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -40 // -4% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -40 // -4% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -40 // -4% RPG[Baalo the Collosus] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -40 // -4% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -40 // -4% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -40 // -4% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -40 // -4% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -40 // -4% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -40 // -4% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -40 // -4% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -40 // -4% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -2.5% Overall Damage
     setvar TEMPVAR 975
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Medatarions aka "Battlelords" [BOSS1]
   case BOSS1
   case BOSS1STAYPUT
   case BOSS1SHOOT
   case BOSS1LOB
    ifvare DEFENDINGPAL 24 // Elimination Squad Soldier
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 3500 // +350% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -60% Overall Damage
     setvar TEMPVAR 400
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 0 // Boss Battlelord [Ends Game]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 500 // +50% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -35% Overall Damage
     setvar TEMPVAR 650
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 3 // Boss Battlelord [No End-Game]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 500 // +50% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -35% Overall Damage
     setvar TEMPVAR 650
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else ifvare DEFENDINGPAL 9 nullop
    else ifvare DEFENDINGPAL 10 nullop
    else // All other Mini-Battlelords
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 2000 // +200% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Cycloidians aka "Cycloid Emperors" [BOSS2]
   case BOSS2
   case BOSS2STAYPUT
   case BOSS2SHOOT
   case BOSS2BREATH
    ifvare DEFENDINGPAL 24 // Cycloid Void-Annhilator
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 2500 // +250% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -40% Overall Damage
     setvar TEMPVAR 600
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 0 // Cycloid Emperor [Ends Game]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 250 // +25% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -25% Overall Damage
     setvar TEMPVAR 750
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 3 // Cycloid Emperor [Non Endgame]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 250 // +25% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -25% Overall Damage
     setvar TEMPVAR 750
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else ifvare DEFENDINGPAL 9 nullop
    else ifvare DEFENDINGPAL 10 nullop
    else // All other Cycloid Princes
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 1000 // +100% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Kerionars aka "Overlords" [BOSS3]
   case BOSS3
   case BOSS3STAYPUT
   case BOSS3LOB
    ifvare DEFENDINGPAL 24 // Megaton Overlord
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 5000 // +500% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -50% Overall Damage
     setvar TEMPVAR 500
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 0 // Boss Overlord [Ends Game]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 1000 // +100% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -30% Overall Damage
     setvar TEMPVAR 700
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 3 // Boss Overlord [Non Endgame]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 1000 // +100% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -30% Overall Damage
     setvar TEMPVAR 700
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else ifvare DEFENDINGPAL 9 nullop
    else ifvare DEFENDINGPAL 10 nullop
    else // All other Boss Overlords
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Weaknesses
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER 3000 // +300% Freezethrower Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Gultasiamos aka "Assault Commanders" [COMMANDER]
   case COMMANDER
   case COMMANDERSTAYPUT
    ifvare DEFENDINGPAL 14 // Assault General
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -150 // -15% Expander Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -998 // -99.8% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -100 // -10% RPG[Baalo The Collosus] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -100 // -10% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -100 // -10% RPG[General] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -100 // -10% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -100 // -10% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -100 // -10% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -100 // -10% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -100 // -10% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -100 // -10% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -100 // -10% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -100 // -10% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -2.5% Overall Damage
     setvar TEMPVAR 975
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 25 // Assault Leader
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -525 // -52.5% Expander Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -350 // -35% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -350 // -35% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -998 // -99.8% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -350 // -35% RPG[Baalo the Collosus] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -350 // -35% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -350 // -35% RPG[General] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -350 // -35% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -350 // -35% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -350 // -35% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -350 // -35% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -350 // -35% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -350 // -35% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -350 // -35% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -350 // -35% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -25% Overall Damage
     setvar TEMPVAR 750
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 24 // Baalo the Collosus [Species-Specfic BOSS]
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -750 // -75% Expander Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -500 // -50% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -500 // -50% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -500 // -50% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -998 // -99.8% RPG[Baalo the Collosus] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -500 // -50% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -500 // -50% RPG[General] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -500 // -50% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -500 // -50% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -500 // -50% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -500 // -50% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -500 // -50% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -500 // -50% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -500 // -50% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -500 // -50% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -50% Overall Damage
     setvar TEMPVAR 500
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop // "Old-Skool" Assault Commander
    else // All other Assault Commanders
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -300 // -30% Expander Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -200 // -20% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -998 // -99.8% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -200 // -20% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -200 // -20% RPG[Baalo the Collosus] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -200 // -20% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -200 // -20% RPG[General] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -200 // -20% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -200 // -20% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -200 // -20% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -200 // -20% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -200 // -20% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -200 // -20% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -200 // -20% Ooz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -200 // -20% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Pigcop Riot Tanks [TANK] & Empty Riot Tanks [EMPTYTANK]
   case TANK
   case EMPTYTANK
    ifvare DEFENDINGPAL 17 // Shotgun Riot Tank
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc SHOTSPARK1 addvar DAMAGEMODIFIER -250 // -25% Pistol/Bullet Damage
     ifvare tempc SHOTGUN addvar DAMAGEMODIFIER -250 // -25% Shotgun Damage
     ifvare tempc NEWSHOTSPARK1 addvar DAMAGEMODIFIER -250 // -25% Pistol/Bullet Damage
     ifvare tempc NEWSHOTGUN addvar DAMAGEMODIFIER -250 // -25% Shotgun Damage
     ifvare tempc CHAINGUN addvar DAMAGEMODIFIER -250 // -25% Chaingun Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(15 to 20)% Overall Damage
     randvar TEMPVAR 50
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 800
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 19 // Missile Riot Tank
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc OCTANINE_RPG addvar DAMAGEMODIFIER -125 // -12.5% RPG[Octabrain] Damage
     ifvare tempc RPG addvar DAMAGEMODIFIER -250 // -25% RPG[General] Damage
     ifvare tempc RPG_NOAIM addvar DAMAGEMODIFIER -250 // -25% RPG[General] Damage
     ifvare tempc GENERAL_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault General] Damage
     ifvare tempc COMMANDER_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault Commander] Damage
     ifvare tempc LEADER_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Assault Leader] Damage
     ifvare tempc BAALO_RPG addvar DAMAGEMODIFIER -250 // -25% RPG[Baalo the Colosuss] Damage
     ifvare tempc GATEMISSILE_MAIN addvar DAMAGEMODIFIER -250 // -25% Full DeathGate Damage
     ifvare tempc GATEMISSILE_SPLIT addvar DAMAGEMODIFIER -250 // -25% Split DeathGate Damage
     ifvare tempc STROKEMISSILE_MAIN addvar DAMAGEMODIFIER -250 // -25% Full DeathStroke Damage
     ifvare tempc STROKEMISSILE_SPLIT addvar DAMAGEMODIFIER -250 // -25% Split DeathStroke Damage
     ifvare tempc MORTER addvar DAMAGEMODIFIER -250 // -25% Morter Damage
     ifvare tempc SEENINE addvar DAMAGEMODIFIER -250 // -25% C9 Damage
     ifvare tempc OOZFILTER addvar DAMAGEMODIFIER -250 // -25% 0oz Filter Damage
     ifvare tempc RADIUSEXPLOSION addvar DAMAGEMODIFIER -250 // -25% Radius Explosion Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(15 to 20)% Overall Damage
     randvar TEMPVAR 50
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 800
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop // "Old-Skool" Riot Tank
    else // All other Riot Tanks
    {
     //**************************
     //*Attack-Specfic Modifiers*
     //**************************
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FIRELASER addvar DAMAGEMODIFIER -250 // -25% Laser Damage
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER -250 // -25% Expander Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(15 to 20)% Overall Damage
     randvar TEMPVAR 50
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 800
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Naferlings, aka "Alien Queens" [BOSS4]
   case BOSS4
   case BOSS4STAYPUT
    ifvare DEFENDINGPAL 24 // "Naferia?!" Alien Queen [ESS-Spawner]
    {
     // Absorbancies
     ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 175% of Electrical Blast #1[Medium] damage into healing
     ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 175% of Electrical Blast #2[Small] damage into healing
     ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 175% of Electrical Blast #3[Large] damage into healing

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -70% Overall Damage
     setvar TEMPVAR 300
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 0 // Alien Queen [Ends Game]
    {
     // Absorbancies
     ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 125% of Electrical Blast #1[Medium] damage into healing
     ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 125% of Electrical Blast #2[Small] damage into healing
     ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 125% of Electrical Blast #3[Large] damage into healing

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -42.5% Overall Damage
     setvar TEMPVAR 575
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 3 // Alien Queen [Non Endgame]
    {
     // Absorbancies
     ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 125% of Electrical Blast #1[Medium] damage into healing
     ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 125% of Electrical Blast #2[Small] damage into healing
     ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 125% of Electrical Blast #3[Large] damage into healing

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -42.5% Overall Damage
     setvar TEMPVAR 575
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop // No Natural Resistances, Weaknesses, Immunities or Absorbancies :P
    else // All "Alien Princess" types
    {
     // Absorbancies
     ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 75% of Electrical Blast #1[Medium] damage into healing
     ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 75% of Electrical Blast #2[Small] damage into healing
     ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 4 state enemyabsorbdamage } // Absorbs 75% of Electrical Blast #3[Large] damage into healing

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -15% Overall Damage
     setvar TEMPVAR 850
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Naferling Drones, aka "Protector Drones" [NEWBEAST]
   case NEWBEAST
   case NEWBEASTSTAYPUT
   case NEWBEASTJUMP
   case NEWBEASTHANG
    ifvare DEFENDINGPAL 20 // Greater Naferiate
    {
     // Absorbancies
     ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 9 divvar GENERALDAMAGE 2 state enemyabsorbdamage } // Absorbs 450% of Electrical Blast #1[Medium] damage into healing 
     ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 9 divvar GENERALDAMAGE 2 state enemyabsorbdamage } // Absorbs 450% of Electrical Blast #2[Small] damage into healing 
     ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 9 divvar GENERALDAMAGE 2 state enemyabsorbdamage } // Absorbs 450% of Electrical Blast #3[Large] damage into healing 
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -750 // -75% Freezethrower Damage
     // Weaknesses
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER 333 // +33.3% Expander Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -25% Overall Damage
     setvar TEMPVAR 750
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 17 // Lesser Naferiate
    {
     // Absorbancies
     ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 2 state enemyabsorbdamage } // Absorbs 150% of Electrical Blast #1[Medium] damage into healing 
     ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 2 state enemyabsorbdamage } // Absorbs 150% of Electrical Blast #2[Small] damage into healing 
     ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 2 state enemyabsorbdamage } // Absorbs 150% of Electrical Blast #3[Large] damage into healing 
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -500 // -50% Freezethrower Damage
     // Weaknesses
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER 666 // +66.6% Expander Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -10% Overall Damage
     setvar TEMPVAR 900
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else
    ifvare DEFENDINGPAL 9 nullop // No Natural Resistances, Weaknesses, Immunities or Absorbancies :P
    else
    {
     // Absorbancies
     ifvare tempc ZAPPER1 state enemyabsorbdamage // Absorbs 100% of Electrical Blast #1[Medium] damage into healing 
     ifvare tempc ZAPPER2 state enemyabsorbdamage // Absorbs 100% of Electrical Blast #2[Small] damage into healing 
     ifvare tempc ZAPPER3 state enemyabsorbdamage // Absorbs 100% of Electrical Blast #3[Large] damage into healing 
     setvar DAMAGEMODIFIER 1000
     // Resistances
     ifvare tempc FREEZEBLAST addvar DAMAGEMODIFIER -250 // -25% Freezethrower Damage
     // Weaknesses
     ifvare tempc GROWSPARK addvar DAMAGEMODIFIER 1000 // +100.0% Expander Damage
     state damagemod-enemy-general

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -2.5% Overall Damage
     setvar TEMPVAR 975
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break

   // Pigcop Scorpion Tank [SCORPIONTANK]
   case SCORPIONTANK
    ifvare DEFENDINGPAL 24 // Ramone's Scorpion Tank
    {

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(55 to 85)% Overall Damage
     randvar TEMPVAR 150
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 300
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
    else // All other Scorpion Tanks
    {

     //**********************
     //*Support-Based Damage*
     //**********************
     state support-monsterdmgeffect

     //************************
     //*Equipment-Based Damage*
     //************************
     state equipment-monsterdmgeffect

     //***************************
     //*Natural Damage Resistance*
     //***************************
     // -(32.5 to 47.5)% Overall Damage
     randvar TEMPVAR 75
     ifrnd 128 mulvar TEMPVAR 1 else mulvar TEMPVAR -1
     addvar TEMPVAR 600
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 1000
    }
   break
  endswitch
  state checkdamagecaps-general
  //*********************************************************************************
  //*********************************************************************************
  //*********************************************************************************

   // Stage 6 of Damage Formula
   //***************************************
   //*Overall Damage Support [Bubsy / Lori]*
   //***************************************
   ifvare tempe APLAYER
   {
    setvar DAMAGEMODIFIER 1000
    state support-monsteroveralleffect-extra
    state damagemod-enemy-general
   }
   state checkdamagecaps-general

   //*********************************************************************************
   //*********************************************************************************
   //*********************************************************************************
   ifvarvare PICNUMTEMP DEFENDINGACTOR // If the attacking actor is the same species (i.e. Octabrain hits another Octabrain)...
   { 

    ifvare DEFENDINGACTOR APLAYER nullop // Prevents the player from effectively becoming immune/absorbant to his own damage :P
    else
    {
     ifvarl ACTORINVULNTIME 1
     {
      // Stage 7e of Damage Formula
      //***************
      //*Critical Hits*
      //***************
      state calccriticalhits_actor
      mulvarvar GENERALDAMAGE CRITICALHITMULTI
      ifvarvarg GENERALDAMAGE STATLIMITMAXIMUM setvarvar GENERALDAMAGE STATLIMITMAXIMUM
      state checkdamagecaps-general

      // Stage 8e of Damage Formula
      state assessactortype
      ifvare tempc BIOMETRICBLAST1
      {
       setvarvar TEMPVAR5 ACTORDEFENSE
       divvar TEMPVAR5 2
       subvarvar GENERALDAMAGE TEMPVAR5
      }
      else
      {
       subvarvar GENERALDAMAGE ACTORDEFENSE
      }
      state checkdamagecaps-general

      // Stage 9e of Damage Formula
      ifvarl GENERALDAMAGE 1 { ifrnd 224 setvar GENERALDAMAGE 1 else setvar GENERALDAMAGE 0 }
      state checkdamagecaps-general

      // Stage 10e of Damage Formula
      //*************************
      //*Check Difficulty Levels*
      //*************************
      ifvarg SKILLLEVEL 6 // If the Skill level is 7 to 9, a monster of the same species as it's attacker will be healed instead of damaged
      {
       ifvare HITACTORTYPE? 0
       {
        setactor[THISACTOR].htextra 0 // TODO: LEAVE-THIS
        setvarvar TEMPVAR5 ACTORHP
        addvarvar TEMPVAR5 GENERALDAMAGE
        ifvarvarg TEMPVAR5 STATLIMITATOMIC setvarvar TEMPVAR5 STATLIMITATOMIC
        setvarvar ACTORHP TEMPVAR5

        setvarvar ITEMSEEK THISACTOR
        setvarvar ITEMSEEKC GENERALDAMAGE
        state showhealing_actorhp

        soundonce ABSORB_DAMAGE
        setvar ACTORHPDAMAGED? -1
        break
       }
       else
       ifvare HITACTORTYPE? 1
       {
        setvarvar tempd GENERALDAMAGE
        state enemyarmordamage
        state showdamage_actor-generalap
        setvarvar GENERALDAMAGE tempd
       }
      }
      else
      ifvarl SKILLLEVEL 7
      ifvarg SKILLLEVEL 3
      {
       ifvare HITACTORTYPE? 0 state nullgendamage
       else ifvare HITACTORTYPE? 1
       {
        setvarvar tempd GENERALDAMAGE
        state enemyarmordamage
        state showdamage_actor-generalap
        setvarvar GENERALDAMAGE tempd
       }
      }
      else
      ifvarl SKILLLEVEL 4
      ifvarg SKILLLEVEL 0
      {
       ifvare HITACTORTYPE? 0 divvar GENERALDAMAGE 2
       setvarvar tempd GENERALDAMAGE
       state enemyarmordamage
       state showdamage_actor-generalap
       setvarvar GENERALDAMAGE tempd
      }
      else
      {
       ifvare HITACTORTYPE? 0 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 4 }
       setvarvar tempd GENERALDAMAGE
       state enemyarmordamage
       state showdamage_actor-generalap
       setvarvar GENERALDAMAGE tempd
      }
      state checkdamagecaps-general

      // Stage 11e of Damage Formula
      subvarvar ACTORHP GENERALDAMAGE state showdamage_actor-generalhp
      setvarvar ACTORLASTDAMAGE GENERALDAMAGE
      ifvarg ACTORHP 0
      {
       ifvarg GENERALDAMAGE 0 setactor[THISACTOR].htextra 1
       setactor[THISACTOR].extra 8193
       break
      }
      else
      {
       setvar ACTORHP 0
       setactor[THISACTOR].extra 0
       state checkactorsurvivalvalue
       ifvarg GENERALDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra GENERALDAMAGE
       break
      }
      state checkdamagecaps-general

     }
     else
     {
      // Stage 12e of Damage Formula
      setvarvar ACTORDEFLECTEDDAMAGE GENERALDAMAGE
      state nullgendamage
      setactor[THISACTOR].htextra 0 // TODO: Leave this
      sound INVULNITEM3

      /*
      // Deflecting Damage back at monsters of the same species
      setvar ACTORDEFLECTDAMAGESTATE 1 // TO BE FIXED LATER
      setactor[OWNERTEMP].htextra 0
      */
      setvar ACTORINVULN? 1
      state checkdamagecaps-general
     }
    }

   }
   else
   ifvare PICNUMTEMP APLAYER // If the attacking actor is the Player themself...
   {
    setvarvar DEFENDINGACTORDEBUG DEFENDINGACTOR
    {
     // Stage 7p of Damage Formula
     // For Damage Inflicted by the Player directly.
     setvarvar PLAYERATTACKTEMP PLAYERATTACK
     state watchovermeskill-attack
     ifvare tempc BIOMETRICBLAST1
     {
      ifp ponsteroids mulvar PLAYERATTACKTEMP 3 else mulvar PLAYERATTACKTEMP 5
      ifp ponsteroids divvar PLAYERATTACKTEMP 2 else divvar PLAYERATTACKTEMP 6
     }
     else
     {
      ifp ponsteroids mulvar PLAYERATTACKTEMP 4 else mulvar PLAYERATTACKTEMP 3
      ifp ponsteroids divvar PLAYERATTACKTEMP 3 else divvar PLAYERATTACKTEMP 4
     }
     state checkdamagecaps-general

     // Stage 8p of Damage Formula
     ifvarn tempvehicleid -1 { ifvare PUBLICBETA? 0 divvar PLAYERATTACKTEMP 25 else divvar PLAYERATTACKTEMP 10 }
     addvarvar GENERALDAMAGE PLAYERATTACKTEMP
     state checkdamagecaps-general

     // Stage 9p of Damage Formula
     //*********************************************
     //*Get Damage Inflicted by Player Vehicles. :P*
     //*********************************************
     ifvarn tempvehicleid -1
     {
      getactorvar[tempvehicleid].ACTORATTACK TEMPVAR3
      ifp ponsteroids mulvar TEMPVAR3 4 else mulvar TEMPVAR3 3
      ifp ponsteroids divvar TEMPVAR3 3 else divvar TEMPVAR3 4
      addvarvar GENERALDAMAGE TEMPVAR3
     }
    }
    state checkdamagecaps-general

    ifvare DEFENDINGACTOR SPACESHUTTLE state nullgendamage
    else ifvare DEFENDINGACTOR MIKE state nullgendamage
    else ifvare DEFENDINGACTOR BURNING state nullgendamage
    else ifvare DEFENDINGACTOR BURNING2 state nullgendamage
    else
    {
        // Stage 10p of Damage Formula
        //************************************************
        //*Check active character for bonuses/deficancies*
        //************************************************
        ifvare CHARACTERSELECTED? 1 // Duke Nukem
        {
         // ***************************************************
         // *Setting up Duke's Nukage/Purplelava-Bonus Damage *
         // ***************************************************
         ifvare FLOORDAMAGETYPE? 1 mulvar GENERALDAMAGE 4 // +300% Damage if Duke is standing in Toxic Sludge/Green Nukage at the moment of damage
         ifvare FLOORDAMAGETYPE? 4 mulvar GENERALDAMAGE 10 // +900% Damage if Duke is standing in Purpleacid at the moment of damage
         ifvare CEILINGDAMAGETYPE? 1 mulvar GENERALDAMAGE 4 // +300% Damage if Duke is standing in Toxic Sludge/Green Nukage at the moment of damage
         ifvare CEILINGDAMAGETYPE? 4 mulvar GENERALDAMAGE 10 // +900% Damage if Duke is standing in Purpleacid at the moment of damage

         ifvare EMUFLOORDAMAGETYPE? 1 mulvar GENERALDAMAGE 4 // +300% Damage if Duke is standing in Toxic Sludge/Green Nukage at the moment of damage
         ifvare EMUFLOORDAMAGETYPE? 4 mulvar GENERALDAMAGE 10 // +900% Damage if Duke is standing in Purpleacid at the moment of damage
         ifvare EMUCEILINGDAMAGETYPE? 1 mulvar GENERALDAMAGE 4 // +300% Damage if Duke is standing in Toxic Sludge/Green Nukage at the moment of damage
         ifvare EMUCEILINGDAMAGETYPE? 4 mulvar GENERALDAMAGE 10 // +900% Damage if Duke is standing in Purpleacid at the moment of damage
        }

        ifvare CHARACTERSELECTED? 2 // Jack Walker
        {
         // ******************************************
         // *Setting up Jack's 'Skills' Bonus Damage *
         // ******************************************
         setvar CHARACTERARRAY 2
         getactorvar[CHARACTERARRAY].CHARACTERLEVEL TEMPVAR // Get's Jack current level
         setvarvar TEMPVAR2 TEMPVAR
         ifvarl SKILLLEVEL 1 mulvar TEMPVAR2 1000
         ifvare SKILLLEVEL 1 mulvar TEMPVAR2 900
         ifvare SKILLLEVEL 2 mulvar TEMPVAR2 800
         ifvare SKILLLEVEL 3 mulvar TEMPVAR2 700
         ifvare SKILLLEVEL 4 mulvar TEMPVAR2 600
         ifvare SKILLLEVEL 5 mulvar TEMPVAR2 500
         ifvare SKILLLEVEL 6 mulvar TEMPVAR2 400
         ifvare SKILLLEVEL 7 mulvar TEMPVAR2 300
         ifvare SKILLLEVEL 8 mulvar TEMPVAR2 200
         ifvarg SKILLLEVEL 8 mulvar TEMPVAR2 100
         divvar TEMPVAR2 1000

         setvarvar TEMPVAR GENERALDAMAGE
         mulvarvar TEMPVAR TEMPVAR2
         divvar TEMPVAR 100
         addvarvar GENERALDAMAGE TEMPVAR
         setvar TEMPVAR 0
         setvar TEMPVAR2 0
        }

        ifvare CHARACTERSELECTED? 3 // Bubsy Bobcat
        {
         // *****************************************************
         // *Setting Up Bubsy's bonus damage when in "Mask Form*
         // *****************************************************
         setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
         ifvarg MISCARRAYID_AMOUNTTEMP 0 { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 2 } // +150% Damage if Bubsy is in "Loki Mask" form
        }

        ifvare CHARACTERSELECTED? 4 // Ami Mizuno
        {
         // **************************************
         // *Setting up Ami's Water-Bonus Damage *
         // **************************************
         ifvare sector[PLAYERSECTOR].lotag 1 { ifvare WATER? 1 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 2 } } // +250% Damage if Ami is 'in water' at the moment of damage
         ifvare sector[PLAYERSECTOR].lotag 2 { ifvare WATER? 2 { mulvar GENERALDAMAGE 6 } } // +500% Damage if Ami is 'underwater' at the moment of damage
         // *******************************
         // *Setting Up Ami's Form Bonuses*
         // *******************************
         setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
         ifvarl MISCARRAYID_AMOUNTTEMP 1 { mulvar GENERALDAMAGE 2 } // +100% Damage if Ami is in Civilian Form
         ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 4 } // -25% Damage if Ami is in Senshi form
         ifvarg MISCARRAYID_AMOUNTTEMP 1 { mulvar GENERALDAMAGE 3 } // +200% Damage if Ami is in Balanced Form
         // ********************************
         // *Mercury Aqua Protection (Buff)*
         // ********************************
         setvar CHARACTERARRAY 4
         getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
         ifvarand TEMPVAR 256
         {
          ifp pducking divvar GENERALDAMAGE 20 // -95% Damage if Ami is crouching with Aqua Protection active
          else divvar GENERALDAMAGE 5 // -80% Damage if Ami has with Aqua Protection active 
         }
         // ************************
         // *Mercury Super-Computer*
         // ************************
         setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
         ifvare MISCARRAYID_AMOUNTTEMP 1
         {
          ifvare player[THISACTOR].heat_on 1 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // +75% Damage if Ami is has the Mercury Computer and has the VR Goggles turned on
         }
         // *********************
         // *Freezethrower Shots*
         // *********************
         ifvare tempc FREEZEBLAST mulvar GENERALDAMAGE 3 // Ami does +200% Damage for all Ice-elemental damage she inflicts
        }

        // ifvare CHARACTERSELECTED? 5 { } // Lo Wang

        // ifvare CHARACTERSELECTED? 6 { } // ESSence

        ifvare CHARACTERSELECTED? 7 // Ted Maldoras
        {
         // ***********************************
         // *Setting Up Ted's Explosives Bonus*
         // ***********************************
          ifvare tempc RPG { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
          ifvare tempc GATEMISSILE_MAIN { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
          ifvare tempc GATEMISSILE_SPLIT { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
          ifvare tempc STROKEMISSILE_MAIN { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
          ifvare tempc STROKEMISSILE_SPLIT { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
          ifvare tempc MORTER { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
          ifvare tempc RADIUSEXPLOSION { mulvar GENERALDAMAGE 5 divvar GENERALDAMAGE 3 } // Ted does +66% Damage for all Missile and Explosive damage he inflicts
        }

        ifvare CHARACTERSELECTED? 8 // Lisa Bates
        {
         // ***************************************
         // *Setting Up Lisa's Energy-Weapon Bonus*
         // ***************************************
         ifvare tempc FIRELASER { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc SHRINKSPARK { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc SHRINKER { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc GROWSPARK { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc COOLEXPLOSION1 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc FREEZEBLAST { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc ZAPPER1 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc ZAPPER2 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
         ifvare tempc ZAPPER3 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 4 } // Lisa does +75% damage for all Energy damage she inflicts
        }

        // ifvare CHARACTERSELECTED? 9 { } // Cybanis Morgandos

        ifvare CHARACTERSELECTED? 10 // Nethra Maboroshi/Christina Mitchell
        {
         // **********************************
         // *Setting Up Nethra's Form Bonuses*
         // **********************************
         setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
         ifvare MISCARRAYID_AMOUNTTEMP 0 // If Nethra is currently "Nethra"
         {
          ifvare tempc ZAPPER1 mulvar GENERALDAMAGE 2 // Nethra does +100% damage for all Electrical Blast #1[Medium] damage she inflicts in Protector Drone form
          ifvare tempc ZAPPER2 mulvar GENERALDAMAGE 2 // Nethra does +100% damage for all Electrical Blast #2[Small] damage she inflicts in Protector Drone form
          ifvare tempc ZAPPER3 mulvar GENERALDAMAGE 2 // Nethra does +100% damage for all Electrical Blast #3[Large] damage she inflicts in Protector Drone form
         }
         setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
         ifvare MISCARRAYID_AMOUNTTEMP 1 // If Nethra is currently "Christina"
         {
          ifvare tempc FREEZEBLAST mulvar GENERALDAMAGE 2 // Nethra does +100% damage for all Freezethrower damage she inflicts in human form

          setvarvar TEMPVAR2 GENERALDAMAGE
          state checkdamage-crisisbooster
          setvarvar GENERALDAMAGE TEMPVAR2
         }
        }

        // ifvare CHARACTERSELECTED? 11 { } // Paula Polestar

        // ifvare CHARACTERSELECTED? 12 { } // Lori Stevens

        ifvare CHARACTERSELECTED? 13 // Minako Aino
        {
         ifvare tempc SHOTSPARK1 { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 5 } // Minako does +40% Damage with Pistol/Bullet attacks
         ifvare tempc SHOTGUN { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 5 } // Minako does +40% Damage with Shotgun attacks
         ifvare tempc CHAINGUN { mulvar GENERALDAMAGE 7 divvar GENERALDAMAGE 5 } // Minako does +40% Damage with Chaingun attacks

         // **********************************
         // *Setting Up Minako's Form Bonuses*
         // **********************************
         setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
         ifvarl MISCARRAYID_AMOUNTTEMP 1 { mulvar GENERALDAMAGE 2 } // +100% Damage if Minako is in Civilian Form
         ifvare MISCARRAYID_AMOUNTTEMP 1 { mulvar GENERALDAMAGE 3 divvar GENERALDAMAGE 4 } // -25% Damage if Minako is in Senshi form
         ifvarg MISCARRAYID_AMOUNTTEMP 1 { mulvar GENERALDAMAGE 3 } // +200% Damage if Minako is in Balanced Form
        }

        // ifvare CHARACTERSELECTED? 14 { } // Mystery Lady

        // ifvare CHARACTERSELECTED? 15 { } // Maken Shinkara

        state checkdamagecaps-general

        // Stage 11p of Damage Formula
        // *****************************
        // *Power Wrist[s] (Equippable)*
        // *****************************
        // Check for Power Wrist [equippable item]
        setvar DAMAGEMODIFIER 1000
        ifvare PLAYEREQUIPSLOTITEM1 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM2 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM3 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM4 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM5 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM6 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM7 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        ifvare PLAYEREQUIPSLOTITEM8 18
        {
         randvar TEMPVAR2 10
         ifrnd 128 mulvar TEMPVAR2 -1
         addvar TEMPVAR2 100
         addvarvar DAMAGEMODIFIER TEMPVAR2
        }
        mulvarvar GENERALDAMAGE DAMAGEMODIFIER
        divvar GENERALDAMAGE 1000
        state checkdamagecaps-general

        // Stage 12p of Damage Formula
        // **********************************
        // *Jewel of Four Souls [Equippable]*
        // **********************************
        setvar DAMAGEMODIFIER 1
        ifvare PLAYEREQUIPSLOTITEM1 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM2 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM3 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM4 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM5 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM6 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM7 28 addvar DAMAGEMODIFIER 10
        ifvare PLAYEREQUIPSLOTITEM8 28 addvar DAMAGEMODIFIER 10
        ifvarg DAMAGEMODIFIER 1 subvar DAMAGEMODIFIER 1
        mulvarvar GENERALDAMAGE DAMAGEMODIFIER
        state checkdamagecaps-general
 
        // Stage 13p of Damage Formula
        //****************
        //*?????? ?? ????*
        //****************
        ifvarn ENEMYHASSHIKON? 0 divvar GENERALDAMAGE 10
        state checkdamagecaps-general

        // Stage 14p of Damage Formula
        //***********************
        //*Attacker is Poisoned?*
        //***********************
        ifvarand PLAYERSTATUS? 8
         {
         randvar TEMPVAR 125
         ifrnd 128 mulvar TEMPVAR -1
         addvar TEMPVAR 500
         mulvarvar GENERALDAMAGE TEMPVAR
         divvar GENERALDAMAGE 1000
        }
        state checkdamagecaps-general

        // Stage 15p of Damage Formula
        //***********************
        //*Defender is Poisoned?*
        //***********************
        ifvarand ACTORSTATUS? 8
        {
         randvar TEMPVAR 125
         ifrnd 128 mulvar TEMPVAR -1
         addvar TEMPVAR 1500
         mulvarvar GENERALDAMAGE TEMPVAR
         divvar GENERALDAMAGE 1000
        }
        state checkdamagecaps-general

        // Stage 16p of Damage Formula
        // **********************
        // *Triad Booster (Buff)*
        // **********************
        ifvarand PLAYERSTATUS? 4096
        {
         randvar temp 25
         setvar tempb 250
         ifrnd 128 addvarvar tempb temp else subvarvar tempb temp
         setvar tempc 1000
         addvarvar tempc tempb
         // 122.5%-127.5% 

         mulvarvar GENERALDAMAGE tempc
         divvar GENERALDAMAGE 1000
        }
        state checkdamagecaps-general

        // Stage 17p of Damage Formula
        // *********************
        // *Damage Shell (Buff)*
        // *********************
        ifvarand ACTORSTATUS? 512
        {
         sound SHELL_HIT
         randvar temp 33
         setvar tempb 333
         ifrnd 128 addvarvar tempb temp else subvarvar tempb temp
         ifvarg tempb 1000 setvar tempb 1000
         setvar tempc 1000
         subvarvar tempc tempb
         // 30.0%-36.6% 

         mulvarvar GENERALDAMAGE tempc
         divvar GENERALDAMAGE 1000
        }
        state checkdamagecaps-general

        // Stage 18p of Damage Formula
        // ****************************************
        // *Setting Up Death-based Support Bonuses*
        // ****************************************
        setvar DAMAGEMODIFIER 1000
        state playersupport-deadcharacters
        mulvarvar GENERALDAMAGE DAMAGEMODIFIER
        divvar GENERALDAMAGE 1000
        state checkdamagecaps-general

        // Stage 19p of Damage Formula
        // **************************************************
        // *Setting up Critical Hits [Norm/Super/Mega/Ultra]*
        // **************************************************

        ifvarg ACTORHP 0
        {
         state calccriticalhits
         mulvarvar GENERALDAMAGE CRITICALHITMULTI 
         ifvarvarg GENERALDAMAGE STATLIMITMAXIMUM setvarvar GENERALDAMAGE STATLIMITMAXIMUM
        }

    }
    state checkdamagecaps-general

    // Stage 20p of Damage Formula
    // ***************************************************************************
    // *Sets up the Multiplier for Steroids-based damage dependant on skill level*
    // ***************************************************************************

    ifvare PUBLICBETA? 1
    {
     ifp ponsteroids
     {
      ifvarg ACTORHP 0
      {
       ifvarl SKILLLEVEL 4 mulvar GENERALDAMAGE 175
       else ifvarg SKILLLEVEL 3 ifvarl SKILLLEVEL 7 mulvar GENERALDAMAGE 150
       else ifvarg SKILLLEVEL 6 mulvar GENERALDAMAGE 125
       divvar GENERALDAMAGE 100
      }
     }
    }
    state checkdamagecaps-general

    // Stage 21p of Damage Formula
    //******************
    //*"Elite" Monsters*
    //******************
    ifvarand ACTORFLAGS 512 // If the monster is an "Elite" they only suffer 25% to 50% damage
    {
     randvar TEMPVAR 25
     addvar TEMPVAR 25
     mulvarvar GENERALDAMAGE TEMPVAR
     divvar GENERALDAMAGE 100
    }
    state checkdamagecaps-general

    // Stage 22p of Damage Formula
    // ifvare ISDEVASTATOR? 1 divvar GENERALDAMAGE 2
    setvarvar ACTORDEFENSETEMP ACTORDEFENSE
    state checkdamagecaps-general

    // Stage 23p of Damage Formula
    state serpenthelmet_check
    state checkdamagecaps-general

    // Stage 24p of Damage Formula
    ifvare ISDEVASTATOR? 1 divvar ACTORDEFENSETEMP 4
    // addlogvar ISDEVASTATOR?
    ifvare tempc SPIT { mulvar ACTORDEFENSETEMP 2 divvar ACTORDEFENSETEMP 5 }
    ifvare tempc FIRELASER { mulvar ACTORDEFENSETEMP 3 divvar ACTORDEFENSETEMP 5 }
    ifvare tempc GROWSPARK { mulvar ACTORDEFENSETEMP 3 divvar ACTORDEFENSETEMP 5 }
    ifvare tempc FREEZEBLAST { mulvar ACTORDEFENSETEMP 3 divvar ACTORDEFENSETEMP 5 }
    ifvare tempc COOLEXPLOSION1 { mulvar ACTORDEFENSETEMP 2 divvar ACTORDEFENSETEMP 3 }
    ifvare tempc RADIUSEXPLOSION divvar ACTORDEFENSETEMP 2
    ifvare tempc RPG divvar ACTORDEFENSETEMP 2
    ifvare tempc RPG_NOAIM divvar ACTORDEFENSETEMP 2
    ifvare tempc GENERAL_RPG divvar ACTORDEFENSETEMP 2
    ifvare tempc COMMANDER_RPG divvar ACTORDEFENSETEMP 2
    ifvare tempc LEADER_RPG divvar ACTORDEFENSETEMP 2
    ifvare tempc BAALO_RPG divvar ACTORDEFENSETEMP 2
    ifvare tempc GATEMISSILE_MAIN divvar ACTORDEFENSETEMP 2
    ifvare tempc GATEMISSILE_SPLIT divvar ACTORDEFENSETEMP 30
    ifvare tempc STROKEMISSILE_MAIN divvar ACTORDEFENSETEMP 4
    ifvare tempc STROKEMISSILE_SPLIT divvar ACTORDEFENSETEMP 60
    state checkdamagecaps-general

    // Stage 25p of Damage Formula
    ifvarand CHEATBITFIELD? 8
    {
     ifvare HITACTORTYPE? 1
     {
      ifvare CHARACTERSELECTED? 15 { ifvarand PLAYERSTATUS? 2048 divvar ACTORDEFENSETEMP 4 } // If Maken is using "Triad Blitzkreg"
      ifvarl ACTORDEFENSETEMP 0 setvar ACTORDEFENSETEMP 0
      subvarvar GENERALDAMAGE ACTORDEFENSETEMP
     }
     else
     {
      ifvare CHARACTERSELECTED? 15 { ifvarand PLAYERSTATUS? 2048 divvar ACTORDEFENSETEMP 4 } // If Maken is using "Triad Blitzkreg"
      ifvarl ACTORDEFENSETEMP 0 setvar ACTORDEFENSETEMP 0
      subvarvar GENERALDAMAGE ACTORDEFENSETEMP
      state cheatersound
      mulvar GENERALDAMAGE 1000
      ifvarvarg GENERALDAMAGE STATLIMITMAXIMUM setvarvar GENERALDAMAGE STATLIMITMAXIMUM
     }
    }
    else
    {
     ifvare CHARACTERSELECTED? 15 { ifvarand PLAYERSTATUS? 2048 divvar ACTORDEFENSETEMP 4 } // If Maken is using "Triad Blitzkreg"
     ifvarl ACTORDEFENSETEMP 0 setvar ACTORDEFENSETEMP 0
     subvarvar GENERALDAMAGE ACTORDEFENSETEMP
    }

    ifvarl GENERALDAMAGE 0 setvar GENERALDAMAGE 0
    state checkdamagecaps-general


    ifvare DEFENDINGACTOR SPACESHUTTLE state nullgendamage
    else ifvare DEFENDINGACTOR MIKE state nullgendamage
    else ifvare DEFENDINGACTOR BURNING state nullgendamage
    else ifvare DEFENDINGACTOR BURNING2 state nullgendamage
    else
    { 
     // Stage 26p of Damage Formula
     ifvare tempvehicleid -1
     {
      ifvarg QUADTIME 0 mulvar GENERALDAMAGE 4
     }
     else
     {
      ifvarg actorvar[tempvehicleid].ACTORQUADTIME 0 mulvar GENERALDAMAGE 4
     }
     state checkdamagecaps-general
 
     // Stage 27p of Damage Formula
     ifvarg ACTORHP 0 { ifvarl GENERALDAMAGE 1 setvar GENERALDAMAGE 1 }
 
     state checkdamagecaps-general
    }

    ifvarvarg GENERALDAMAGE STATLIMITMAXIMUM setvarvar GENERALDAMAGE STATLIMITMAXIMUM

    ifvarg ACTORINVULNTIME 0
    {
     ifvare tempc BIOMETRICBLAST1
     {
      setvar TEMP2 2
      randvar TEMP3 1
      ifvarg CRITICAL? 0
      {
       mulvar TEMP2 5
       mulvar TEMP3 5
      }
      ifrnd 128 addvarvar TEMP2 TEMP3 else subvarvar TEMP2 TEMP3
      setvarvar TEMP3 TEMP2
      mulvar TEMP2 26
      subvarvar ACTORINVULNTIME TEMP2
      ifvarl ACTORINVULNTIME 0 setvar ACTORINVULNTIME 0
      redefinequote 335 ^22REDUCED ENEMY'S INVULNERBILITY TIME BY %d SECONDS!
      qsprintf 335 335 TEMP3
      setvarvar fta fta_normal setvar ftq 335
     }

     setvarvar ACTORDEFLECTEDDAMAGE GENERALDAMAGE
     state nullgendamage
     setactor[THISACTOR].htextra 0 // TODO: Leave this
     sound INVULNITEM3

     setvarvar DEFLECTATTACKPICNUM tempc
     setvar ACTORDEFLECTDAMAGESTATE 1 // TO BE FIXED LATER
     setactor[PLAYERID].htextra 0

     setvar ACTORINVULN? 1
    }
    else setvar ACTORINVULN? 0

    // Stage 28p of Damage Formula
    // *************************
    // * IMPORTANT ARMOR START *
    // *************************
    setvarvar tempd GENERALDAMAGE
    ifvarg VAMPIRETIME 0 setvarvar TEMPVAR5 ACTORARMORPERCENT
    state enemyarmordamage
    state showdamage_actor-generalap
    setvarvar GENERALDAMAGE tempd

    // ***********************
    // * IMPORTANT ARMOR END *
    // ***********************
    // FINAL DAMAGE COUNT
    setactor[THISACTOR].htextra tempd
    state checkdamagecaps-general

    // Stage 29p of Damage Formula
    ifvarg GENERALDAMAGE 0 state snakearmband_check
    state checkdamagecaps-general

    // Stage 30p of Damage Formula
    setvarvar TEMP3 ACTORMAXHP
    ifvarand ACTORSTATUS? 512
    { 
     ifvarand ACTORSTATUS? 1024
     { 
      randvar TEMP2 150
      addvar TEMP2 200
     }
     else
     {
      randvar TEMP2 125
      addvar TEMP2 125
     }
    }
    else
    {
     ifvarand ACTORSTATUS? 1024
     { 
      randvar TEMP2 70
      addvar TEMP2 105
     }
     else
     {
      randvar TEMP2 50
      addvar TEMP2 50
     }
    }
    mulvarvar TEMP3 TEMP2
    divvar TEMP3 1000
    // Damage to HP must be >5-10% to have the chance for Mindblasts to Confuse or for Spit Loogies to Poison, or for Freezethrower attacks to Slow

    ifvare tempc FREEZEBLAST ifvarvarg GENERALDAMAGE TEMP3 // Freezethrower Shot [Slow Only, Damage is above]
    {
     ifrnd 25
     {
      ifvarand ACTORSTATUS? 4 
      { 
       randvar TEMP 390
       addvar TEMP 390
       addvarvar ACTORSLOWTIMER TEMP
      } 
      else 
      { 
       addvar ACTORSTATUS? 4 
       randvar TEMP 390
       addvar TEMP 390
       addvarvar ACTORSLOWTIMER TEMP
       ifvarand ACTORSTATUS? 2 { subvar ACTORSTATUS? 2 setvar ACTORHASTETIMER 0 } 
       redefinequote 335 ^22YOU HAVE SLOWN DOWN AN ENEMY!
       setvarvar fta fta_normal setvar ftq 335
      }   
     }
    }
    ifvare tempc SPIT ifvarvarg GENERALDAMAGE TEMP3 // Freezethrower Shot [Slow Only, Damage is above]
    {
     ifrnd 25
     {
      ifvarand ACTORSTATUS? 8
      { 
       randvar TEMP 390
       addvar TEMP 390
       addvarvar ACTORPOISONTIMER TEMP
      } 
      else 
      { 
       addvar ACTORSTATUS? 8
       randvar TEMP 390
       addvar TEMP 390
       addvarvar ACTORPOISONTIMER TEMP
       redefinequote 335 ^22YOU HAVE POISONED AN ENEMY!
       setvarvar fta fta_normal setvar ftq 335
      }   
     }
    }
    state checkdamagecaps-general

    // Stage 31p of Damage Formula
    randvar TEMPVAR 1
    ifvarg enemywinterclothes 0 { ifrnd 128 subvarvar enemywinterclothes TEMPVAR }
    state checkdamagecaps-general

    // Stage 32p of Damage Formula
    setvarvar DAMAGEFACTOR GENERALDAMAGE
    mulvar DAMAGEFACTOR 100
    divvarvar DAMAGEFACTOR ACTORMAXHP
    divvar DAMAGEFACTOR 5
    ifvarg enemywinterclothes 0 subvarvar enemywinterclothes DAMAGEFACTOR
    state checkdamagecaps-general

    // Stage 33p of Damage Formula
    setvarvar DAMAGEFACTOR ACTORARMORDAMAGE
    mulvar DAMAGEFACTOR 100
    divvarvar DAMAGEFACTOR ACTORMAXAP
    divvar DAMAGEFACTOR 10
    ifvarg enemywinterclothes 0 subvarvar enemywinterclothes DAMAGEFACTOR
    state checkdamagecaps-general

    // Stage 34p of Damage Formula
    // Drain Artifact [for players since this is monster damage]
    ifvarg GENERALDAMAGE 0
    {
     ifvarvare OWNERTEMP PLAYERID
     {
      ifvare tempvehicleid -1
      {
       ifvarg VAMPIREMAXDMGFACTOR 1000 // ifvarg VAMPIRETIME 0
       {
        setvarvar TEMP MAXHITPOINTS
        mulvarvar TEMP VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
        divvar TEMP 1000
 
        ifvarvarl CURRENTHITPOINTS TEMP
        {
         setvarvar TEMP2 GENERALDAMAGE
         ifvarvarg TEMP2 ACTORHP setvarvar TEMP2 ACTORHP
         mulvarvar TEMP2 VAMPIREDMGFACTOR
         divvar TEMP2 1000
         addvarvar CURRENTHITPOINTS TEMP2
      
         setvarvar TEMP3 MAXHITPOINTS
         mulvarvar TEMP3 VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
         divvar TEMP3 1000

         ifvarvarg CURRENTHITPOINTS TEMP3 setvarvar CURRENTHITPOINTS TEMP3
         ifvarg TEMP2 0
         {
          setvarvar TEMPHEALTH TEMP2
          state showhealing_playerhp

          setvar PLAYERHPDAMAGED? -1
          sound DRAIN_HP
          sound DRAIN_HP
          sound DRAIN_HP
         }
        }
       }
      }
      else
      {
       getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR6 // getactorvar[tempvehicleid].ACTORVAMPIRETIME TEMPVAR5
       ifvarg TEMPVAR6 1000
       {
        getactorvar[tempvehicleid].ACTORMAXHP TEMP
        getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
        mulvarvar TEMP TEMPVAR3 // Heals up to 125% HP on Public Beta
        divvar TEMP 1000
 
        getactorvar[tempvehicleid].ACTORHP TEMPVAR4
        ifvarvarl TEMPVAR4 TEMP
        {
         setvarvar TEMP2 GENERALDAMAGE
         ifvarvarg TEMP2 ACTORHP setvarvar TEMP2 ACTORHP
         getactorvar[tempvehicleid].ACTORVAMPIREDMGFACTOR TEMPVAR3
         mulvarvar TEMP2 TEMPVAR3
         divvar TEMP2 1000
         addvarvar TEMPVAR4 TEMP2
      
         getactorvar[tempvehicleid].ACTORMAXHP TEMP3
         getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
         mulvarvar TEMP3 TEMPVAR3 // Heals up to 125% HP on Public Beta
         divvar TEMP3 1000

         ifvarvarg TEMPVAR4 TEMP3 setvarvar TEMPVAR4 TEMP3
         setactorvar[tempvehicleid].ACTORHP TEMPVAR4
         ifvarg TEMP2 0
         {
          setvarvar TEMPHEALTH TEMP2
          state showhealing_playerhp

          setvar VEHICLEHPDAMAGED? -1
          sound DRAIN_HP
          sound DRAIN_HP
          sound DRAIN_HP
         }
        }
       }
      }
     }
    }

    ifvarg ACTORARMORDAMAGE 0
    {
     ifvarvare OWNERTEMP PLAYERID
     {
      ifvare tempvehicleid -1
      {
       ifvarg VAMPIREMAXDMGFACTOR 1000 // ifvarg VAMPIRETIME 0
       {
        setvarvar TEMP MAXARMORPOINTS
        mulvarvar TEMP VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
        divvar TEMP 1000
 
        ifvarvarl CURRENTARMORPOINTS TEMP
        {
         setvarvar TEMP2 ACTORARMORDAMAGE
         mulvarvar TEMP2 VAMPIREDMGFACTOR
         divvar TEMP2 1000
         addvarvar CURRENTARMORPOINTS TEMP2
      
         setvarvar TEMP3 MAXARMORPOINTS
         mulvarvar TEMP3 VAMPIREMAXDMGFACTOR // Heals up to 125% HP on Public Beta
         divvar TEMP3 1000

         ifvarvarg CURRENTARMORPOINTS TEMP3 setvarvar CURRENTARMORPOINTS TEMP3
         ifvarvarl ARMORPERCENT ACTORARMORPERCENT setvarvar ARMORPERCENT ACTORARMORPERCENT
         ifvarg TEMP2 0
         {
          setvarvar RECEIVEDARMOR TEMP2
          state showhealing_playerap

          setvar PLAYERAPDAMAGED? -1
          sound DRAIN_AP
          sound DRAIN_AP
          sound DRAIN_AP
         }
        }
       }
      }
      else
      {
       getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR6 // getactorvar[tempvehicleid].ACTORVAMPIRETIME TEMPVAR5
       ifvarg TEMPVAR6 1000
       {
        getactorvar[tempvehicleid].ACTORMAXAP TEMP
        getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
        mulvarvar TEMP TEMPVAR3 // Heals up to 125% HP on Public Beta
        divvar TEMP 1000
 
        getactorvar[tempvehicleid].ACTORAP TEMPVAR4
        ifvarvarl TEMPVAR4 TEMP
        {
         setvarvar TEMP2 ACTORARMORDAMAGE
         getactorvar[tempvehicleid].ACTORVAMPIREDMGFACTOR TEMPVAR3
         mulvarvar TEMP2 TEMPVAR3
         divvar TEMP2 1000
         addvarvar TEMPVAR4 TEMP2
      
         getactorvar[tempvehicleid].ACTORMAXAP TEMP3
         getactorvar[tempvehicleid].ACTORVAMPIREMAXDMGFACTOR TEMPVAR3
         mulvarvar TEMP3 TEMPVAR3 // Heals up to 125% HP on Public Beta
         divvar TEMP3 1000

         ifvarvarg TEMPVAR4 TEMP3 setvarvar TEMPVAR4 TEMP3
         setactorvar[tempvehicleid].ACTORAP TEMPVAR4
         getactorvar[tempvehicleid].ACTORARMORPERCENT TEMPVAR4
         ifvarvarl TEMPVAR4 ACTORARMORPERCENT { setvarvar TEMPVAR4 ACTORARMORPERCENT setactorvar[tempvehicleid].ACTORARMORPERCENT TEMPVAR4 }
         ifvarg TEMP2 0
         {
          setvarvar RECEIVEDARMOR TEMP2
          state showhealing_playerap

          setvar VEHICLEAPDAMAGED? -1
          sound DRAIN_AP
          sound DRAIN_AP
          sound DRAIN_AP
         }
        }
       }
      }
     }
    }
    state checkdamagecaps-general
    // End Drain Artifact [for players since this is monster damage]

    // Stage 35p of Damage Formula
    ifvarg GENERALDAMAGE 0 setvar ACTORHPDAMAGED? 1
    subvarvar ACTORHP GENERALDAMAGE state showdamage_actor-generalhp
    setvarvar ACTORLASTDAMAGE GENERALDAMAGE
    ifvarg ACTORHP 0
    {
     setactor[THISACTOR].htextra 1
     setactor[THISACTOR].extra 16384
    }
    else
    {
     setvar ACTORHP 0
     setactor[THISACTOR].extra 0
     state checkactorsurvivalvalue
     ifvarg GENERALDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra GENERALDAMAGE
    }
    state checkdamagecaps-general
    // FINAL DAMAGE COUNT

    // Stage 36p of Damage Formula
    setvarvar TEMPVAR GENERALDAMAGE 
    setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
    setvar DEFENDERDISPLAYTIMER 0
    ifvare TEMPVAR 0 setvar ACTORNULLDAMAGE 1 else setvar ACTORNULLDAMAGE 0
    setvarvar ACTORARMORDAMAGETEMP ACTORARMORDAMAGE
    setvar ACTORARMORDISPLAYTIMER 0

    ifvarg CURRENTACTORARMORPERCENT 0 { ifvare ACTORARMORDAMAGETEMP 0 setvar ACTORARMORNULLDAMAGE 1 else setvar ACTORARMORNULLDAMAGE 0 }

    setvarvar ACTORHEALTH ACTORHP
    setvarvar DAMAGETEMP GENERALDAMAGE 
    setvarvar TEMPHITACTORVARHP ACTORMAXHP
    setvarvar TEMPHITACTORVARAP ACTORMAXAP
    setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
    setvar DEFENDERDISPLAYTIMER 0
    setvar CRITICALHITMULTI 0
    state checkdamagecaps-general
   } 
   else // Monsters are of the same species
   {
    ifvarl ACTORINVULNTIME 1
    {
     // Stage 7s of Damage Formula
     state calccriticalhits_actor
     mulvarvar GENERALDAMAGE CRITICALHITMULTI
     ifvarvarg GENERALDAMAGE STATLIMITMAXIMUM setvarvar GENERALDAMAGE STATLIMITMAXIMUM
     state checkdamagecaps-general


     // Stage 8s of Damage Formula
     state assessactortype
     subvarvar GENERALDAMAGE ACTORDEFENSE
     ifvarl GENERALDAMAGE 1 { ifrnd 224 setvar GENERALDAMAGE 1 else setvar GENERALDAMAGE 0 }
     state checkdamagecaps-general

     // Stage 9s of Damage Formula
     ifvarg SKILLLEVEL 6 // And the skill level is Damn I'm Good! or greater, same species monsters will heal each other and themselves instead of inflicting damage
     {
      ifvare HITACTORTYPE? 0 state nullgendamage
      else ifvare HITACTORTYPE? 1
      {
       setvarvar tempd GENERALDAMAGE
       state enemyarmordamage
       state showdamage_actor-generalap
       setvarvar GENERALDAMAGE tempd
      }
      state nullgendamage
     }
     else
     ifvarl SKILLLEVEL 7
     ifvarg SKILLLEVEL 3
     {
      ifvare HITACTORTYPE? 0 divvar GENERALDAMAGE 2
      setvarvar tempd GENERALDAMAGE
      state enemyarmordamage
      state showdamage_actor-generalap
      setvarvar GENERALDAMAGE tempd
     }
     else
     ifvarl SKILLLEVEL 4
     ifvarg SKILLLEVEL 0
     {
      ifvare HITACTORTYPE? 0
      {
       mulvar GENERALDAMAGE 3
       divvar GENERALDAMAGE 4
      }
      setvarvar tempd GENERALDAMAGE
      state enemyarmordamage
      state showdamage_actor-generalap
      setvarvar GENERALDAMAGE tempd
     }
     else
     {
      ifvare HITACTORTYPE? 0
      {
       mulvar GENERALDAMAGE 7
       divvar GENERALDAMAGE 8
      }
      setvarvar tempd GENERALDAMAGE
      state enemyarmordamage
      state showdamage_actor-generalap
      setvarvar GENERALDAMAGE tempd
     }
     state checkdamagecaps-general

     // Stage 10s of Damage Formula
     ifvarg GENERALDAMAGE 0 setvar ACTORHPDAMAGED? 1
     subvarvar ACTORHP GENERALDAMAGE state showdamage_actor-generalhp
     setvarvar ACTORLASTDAMAGE GENERALDAMAGE
     state checkdamagecaps-general

     // Stage 11s of Damage Formula
     ifvarg ACTORHP 0
     {
      ifvarg GENERALDAMAGE 0 setactor[THISACTOR].htextra 1
      setactor[THISACTOR].extra 8193
      break
     }
     else
     {
      setvar ACTORHP 0
      setactor[THISACTOR].extra 0
      state checkactorsurvivalvalue
      ifvarg GENERALDAMAGE 32767 setactor[THISACTOR].htextra 100 else setactor[THISACTOR].htextra GENERALDAMAGE
      break
     }
    }
    else
    {
      setvarvar ACTORDEFLECTEDDAMAGE GENERALDAMAGE
      state nullgendamage
      setactor[THISACTOR].htextra 0
      sound INVULNITEM3
      /*
      // Deflecting Damage back at monsters of a different species
      setvar ACTORDEFLECTDAMAGESTATE 1 // TO BE FIXED LATER
      setactor[OWNERTEMP].htextra 0
      */
      setvar ACTORINVULN? 1
    }
    state checkdamagecaps-general

   }
  }
 }
} // ifvarg tempb 0
ends 
//** Formatting End **