state frozenactor-breakcode
	sound GLASS_BREAKING setactor[THISACTOR].extra -1
	setvar FROZEN? 0
ends

state checkbuddhamode
	ifvarand CHEATBITFIELD? 4
	{
		getactor[PLAYERID].extra TEMPVAR3
		ifvarl TEMPVAR3 1 setvar TEMPVAR3 1 
		setactor[PLAYERID].extra TEMPVAR3
		ifvarl CURRENTHITPOINTS 1 setvar CURRENTHITPOINTS 1 
	
		ifvarn VEHICLEID -1
		{
			getactorvar[VEHICLEID].ACTORHP TEMPVAR3
			ifvarl TEMPVAR3 1 setvar TEMPVAR3 1 
			setactorvar[VEHICLEID].ACTORHP TEMPVAR3
		}
		else
		{
			ifvarn tempvehicleid -1
			{
				getactorvar[tempvehicleid].ACTORHP TEMPVAR3
				ifvarl TEMPVAR3 1 setvar TEMPVAR3 1 
				setactorvar[tempvehicleid].ACTORHP TEMPVAR3
			}
		}
	}
	/*
	else
	{
	}
	*/
ends

state checkactorsurvivalvalue
	// Check Survival Rate for Actor
	randvar SURVIVALCHECK 10000
	ifvarvarl SURVIVALCHECK ACTORSURVIVALVALUE_TEMP
	{
		setvar ACTORHP 1
		setactor[THISACTOR].extra 16384
		setvar ACTORDEATHSWITCHDELAY 39
	}
ends

state getenemyid
	addvar ENEMYIDGLOBAL 1
	setvarvar ENEMYIDLOCAL ENEMYIDGLOBAL
	
	// Checks for the current game's Randomized Jewel #ID
	ifvare HAVEASHIKONJEWEL? 0 ifvare SHIKONONMAP? 0
	{      
		ifvarvare ENEMYIDLOCAL SHIKONHOLDERENEMYID setvar ENEMYHASSHIKON? 1
	}
ends

//

state playergetcorrectz // For getting z ranges for damagefloors, slippery floors and walking sounds
	getactor[THISACTOR].x x
	getactor[THISACTOR].y y
	updatesector x y TEMP
	getflorzofslope TEMP x y tempb
	setvarvar tempe tempb
	addvar tempb -513
	getactor[THISACTOR].z PLAYERDMGFLRZ
	ifp pducking addvar PLAYERDMGFLRZ -5280
	addvar PLAYERDMGFLRZ 32
	setvar tempd 82
	getactor[THISACTOR].xrepeat temp
	mulvarvar tempd temp
	mulvar tempd 4
	addvar tempd 4096
	ifvare temp 0 { addvar tempd 512 addvar tempb -512 }
	addvarvar tempe tempd
	ifvare SHRUNK? 1 { addvar tempe 16128 addvar tempb 16128 }
ends

state slipperycode_players
	ifp pjetpack break 
	
	setvar CANDMGFLOOR2? 0
	ifp ponground { state playergetcorrectz ifvarvarl PLAYERDMGFLRZ tempe { ifvarvarg PLAYERDMGFLRZ tempb setvar CANDMGFLOOR2? 1 } }
	ifvare CANDMGFLOOR2? 1 nullop else break // iffloordistl 48 nullop else break
	
	ifvarn VEHICLEID -1 break
	
	/*
	ifvare sector[THISACTOR].lotag 1 break
	ifvare sector[THISACTOR].lotag 2 break
	ifvarn sector[THISACTOR].lotag 50
	{
		ifvare player[THISACTOR].spritebridge YES
		{
		getplayer[THISACTOR].sbs spriteid
		ifvarn sprite[spriteid].picnum SECTOREFFECTOR
		getactor[spriteid].lotag lotagsav	
		}
		ifvarn lotagsav 50 { setvar lotagsav 0 break }
	}
	*/
	
	ifvare sector[THISACTOR].lotag 50 // Icy
	{
		ifvare player[THISACTOR].spritebridge YES
		{
			getplayer[THISACTOR].sbs spriteid
			ifvarn sprite[spriteid].picnum SECTOREFFECTOR
			getactor[spriteid].lotag lotagsav
		}
		ifvare lotagsav 50 { setvar lotagsav 0 break }
	}
	else
	ifvare sector[THISACTOR].lotag 51 // Oily
	{
		ifvare player[THISACTOR].spritebridge YES
		{
			getplayer[THISACTOR].sbs spriteid
			ifvarn sprite[spriteid].picnum SECTOREFFECTOR
			getactor[spriteid].lotag lotagsav
		}
		ifvare lotagsav 51 { setvar lotagsav 0 break }
	}
	else
	{
		break
	}
	
	getplayer[THISACTOR].posxv xvel
	setvar x 0
	ifvarg xvel 0 ifvarvarl xvel oposxv setvar x -1 // slowing down x vel
	ifvarl xvel 0 ifvarvarg xvel oposxv setvar x -1
	
	getplayer[THISACTOR].posyv yvel
	setvar y 0
	ifvarg yvel 0 ifvarvarl yvel oposyv setvar y -1 // slowing down y vel
	ifvarl yvel 0 ifvarvarg yvel oposyv setvar y -1
	
	subvarvar oposxv xvel
	ifvare sector[THISACTOR].lotag 50 // Icy
	{
		ifvare CHARACTERSELECTED? 1 setvar TEMPVAR3 703 // Duke
		ifvare CHARACTERSELECTED? 2 setvar TEMPVAR3 856 // Jack
		ifvare CHARACTERSELECTED? 3 setvar TEMPVAR3 937 // Bubsy
		ifvare CHARACTERSELECTED? 4 setvar TEMPVAR3 156 // Ami
		ifvare CHARACTERSELECTED? 5 setvar TEMPVAR3 665 // Lo Wang
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR3 937 // ESSence
		ifvare CHARACTERSELECTED? 7 setvar TEMPVAR3 762 // Ted
		ifvare CHARACTERSELECTED? 8 setvar TEMPVAR3 753 // Lisa
		ifvare CHARACTERSELECTED? 9 setvar TEMPVAR3 313 // Cybanis
		ifvare CHARACTERSELECTED? 10 setvar TEMPVAR3 469 // Christina/Nethra
		ifvare CHARACTERSELECTED? 11 setvar TEMPVAR3 781 // Paula
		ifvare CHARACTERSELECTED? 12 setvar TEMPVAR3 742 // Lori
		ifvare CHARACTERSELECTED? 13 setvar TEMPVAR3 820 // Minako
		ifvare CHARACTERSELECTED? 14 setvar TEMPVAR3 391 // Mystery Lady
		ifvare CHARACTERSELECTED? 15 setvar TEMPVAR3 856 // Maken
	}
	ifvare sector[THISACTOR].lotag 51 // Oily
	{
		ifvare CHARACTERSELECTED? 1 setvar TEMPVAR3 352 // Duke
		ifvare CHARACTERSELECTED? 2 setvar TEMPVAR3 428 // Jack
		ifvare CHARACTERSELECTED? 3 setvar TEMPVAR3 234 // Bubsy
		ifvare CHARACTERSELECTED? 4 setvar TEMPVAR3 312 // Ami
		ifvare CHARACTERSELECTED? 5 setvar TEMPVAR3 332 // Lo Wang
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR3 234 // ESSence
		ifvare CHARACTERSELECTED? 7 setvar TEMPVAR3 381 // Ted
		ifvare CHARACTERSELECTED? 8 setvar TEMPVAR3 375 // Lisa
		ifvare CHARACTERSELECTED? 9 setvar TEMPVAR3 157 // Cybanis
		ifvare CHARACTERSELECTED? 10 
		{ 
			setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 0 { setvar TEMPVAR3 117 } else { setvar TEMPVAR3 234 } 
		} // Christina/Nethra
		ifvare CHARACTERSELECTED? 11 setvar TEMPVAR3 390 // Paula
		ifvare CHARACTERSELECTED? 12 setvar TEMPVAR3 371 // Lori
		ifvare CHARACTERSELECTED? 13 setvar TEMPVAR3 410 // Minako
		ifvare CHARACTERSELECTED? 14 setvar TEMPVAR3 195 // Mystery Lady
		ifvare CHARACTERSELECTED? 15 setvar TEMPVAR3 428 // Maken
	}
	// addlogvar TEMPVAR3
	ifvare x -1 // Directly Moving...
	{ 
		mulvar TEMPVAR3 100
		divvar TEMPVAR3 100
		ifp pducking
		{
			mulvar TEMPVAR3 67
			divvar TEMPVAR3 100
		}
	}
	else // Not Directly Moving...
	{
		mulvar TEMPVAR3 75
		divvar TEMPVAR3 100
		ifp pducking
		{
			mulvar TEMPVAR3 67
			divvar TEMPVAR3 100
		}
	}
	// addlogvar TEMPVAR3
	mulvarvar oposxv TEMPVAR3
	divvar oposxv 1000
	addvarvar xvel oposxv
	setplayer[THISACTOR].posxv xvel 
	
	subvarvar oposyv yvel
	ifvare sector[THISACTOR].lotag 50 // Icy
	{
		ifvare CHARACTERSELECTED? 1 setvar TEMPVAR3 703 // Duke
		ifvare CHARACTERSELECTED? 2 setvar TEMPVAR3 856 // Jack
		ifvare CHARACTERSELECTED? 3 setvar TEMPVAR3 937 // Bubsy
		ifvare CHARACTERSELECTED? 4 setvar TEMPVAR3 156 // Ami
		ifvare CHARACTERSELECTED? 5 setvar TEMPVAR3 665 // Lo Wang
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR3 937 // ESSence
		ifvare CHARACTERSELECTED? 7 setvar TEMPVAR3 762 // Ted
		ifvare CHARACTERSELECTED? 8 setvar TEMPVAR3 753 // Lisa
		ifvare CHARACTERSELECTED? 9 setvar TEMPVAR3 313 // Cybanis
		ifvare CHARACTERSELECTED? 10 setvar TEMPVAR3 469 // Christina/Nethra
		ifvare CHARACTERSELECTED? 11 setvar TEMPVAR3 781 // Paula
		ifvare CHARACTERSELECTED? 12 setvar TEMPVAR3 742 // Lori
		ifvare CHARACTERSELECTED? 13 setvar TEMPVAR3 820 // Minako
		ifvare CHARACTERSELECTED? 14 setvar TEMPVAR3 391 // Mystery Lady
		ifvare CHARACTERSELECTED? 15 setvar TEMPVAR3 856 // Maken
	}
	ifvare sector[THISACTOR].lotag 51 // Oily
	{
		ifvare CHARACTERSELECTED? 1 setvar TEMPVAR3 352 // Duke
		ifvare CHARACTERSELECTED? 2 setvar TEMPVAR3 428 // Jack
		ifvare CHARACTERSELECTED? 3 setvar TEMPVAR3 234 // Bubsy
		ifvare CHARACTERSELECTED? 4 setvar TEMPVAR3 312 // Ami
		ifvare CHARACTERSELECTED? 5 setvar TEMPVAR3 332 // Lo Wang
		ifvare CHARACTERSELECTED? 6 setvar TEMPVAR3 234 // ESSence
		ifvare CHARACTERSELECTED? 7 setvar TEMPVAR3 381 // Ted
		ifvare CHARACTERSELECTED? 8 setvar TEMPVAR3 375 // Lisa
		ifvare CHARACTERSELECTED? 9 setvar TEMPVAR3 157 // Cybanis
		ifvare CHARACTERSELECTED? 10 
		{ 
			setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 0 { setvar TEMPVAR3 117 } else { setvar TEMPVAR3 234 } 
		} // Christina/Nethra
		ifvare CHARACTERSELECTED? 11 setvar TEMPVAR3 390 // Paula
		ifvare CHARACTERSELECTED? 12 setvar TEMPVAR3 371 // Lori
		ifvare CHARACTERSELECTED? 13 setvar TEMPVAR3 410 // Minako
		ifvare CHARACTERSELECTED? 14 setvar TEMPVAR3 195 // Mystery Lady
		ifvare CHARACTERSELECTED? 15 setvar TEMPVAR3 428 // Maken
	}
	// addlogvar TEMPVAR3
	ifvare y -1 // Directly Moving...
	{
		mulvar TEMPVAR3 100
		divvar TEMPVAR3 100
		ifp pducking
		{
			mulvar TEMPVAR3 67
			divvar TEMPVAR3 100
		}
	}
	else // Not Directly Moving...
	{
		mulvar TEMPVAR3 75
		divvar TEMPVAR3 100
		ifp pducking
		{
			mulvar TEMPVAR3 67
			divvar TEMPVAR3 100
		}
	}
	// addlogvar TEMPVAR3
	mulvarvar oposyv TEMPVAR3
	divvar oposyv 1000
	addvarvar yvel oposyv
	setplayer[THISACTOR].posyv yvel
	
	ifvare x -1 state STOPSTEPSOUNDS_PLAYER else ifvare y -1 state STOPSTEPSOUNDS_PLAYER
ends

state slipperycode_actor

	iffloordistl 48 nullop else break
	
	ifvare sector[THISACTOR].lotag 50 nullop
	else ifvare sector[THISACTOR].lotag 51 nullop
	else break
	
	getactor[THISACTOR].xvel ACTORXVEL
	setvar x 0
	ifvarg ACTORXVEL 0 ifvarvarl ACTORXVEL oposxv setvar x -1 // slowing down x vel
	ifvarl ACTORXVEL 0 ifvarvarg ACTORXVEL oposxv setvar x -1
	
	getactor[THISACTOR].yvel ACTORYVEL
	setvar y 0
	ifvarg ACTORYVEL 0 ifvarvarl ACTORYVEL oposyv setvar y -1 // slowing down y vel
	ifvarl ACTORYVEL 0 ifvarvarg ACTORYVEL oposyv setvar y -1
		
	subvarvar actor_oposxv ACTORXVEL
	ifactor LIZTROOP
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 866
			else ifspritepal 21 setvar TEMPVAR3 812
			else ifspritepal 19 setvar TEMPVAR3 667
			else ifspritepal 14 setvar TEMPVAR3 937
			else ifspritepal 17 setvar TEMPVAR3 500
			else setvar TEMPVAR3 866
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 216
			else ifspritepal 21 setvar TEMPVAR3 203
			else ifspritepal 19 setvar TEMPVAR3 166
			else ifspritepal 14 setvar TEMPVAR3 234
			else ifspritepal 17 setvar TEMPVAR3 125
			else setvar TEMPVAR3 216
		}
	}
	else
	ifactor LIZMAN
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 866
			else ifspritepal 19 setvar TEMPVAR3 812
			else ifspritepal 6 setvar TEMPVAR3 866
			else ifspritepal 17 setvar TEMPVAR3 750
			else setvar TEMPVAR3 866
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 216
			else ifspritepal 19 setvar TEMPVAR3 203
			else ifspritepal 6 setvar TEMPVAR3 216
			else ifspritepal 17 setvar TEMPVAR3 187
			else setvar TEMPVAR3 216
		}
	}
	else
	ifactor PIGCOP
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 800
			else ifspritepal 21 setvar TEMPVAR3 775
			else ifspritepal 14 setvar TEMPVAR3 750
			else ifspritepal 24 setvar TEMPVAR3 625
			else setvar TEMPVAR3 800
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 400
			else ifspritepal 21 setvar TEMPVAR3 387
			else ifspritepal 14 setvar TEMPVAR3 375
			else ifspritepal 24 setvar TEMPVAR3 313
			else setvar TEMPVAR3 400
		}
	}
	else
	ifactor NEWBEAST
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 750
			else ifspritepal 17 setvar TEMPVAR3 675
			else ifspritepal 20 setvar TEMPVAR3 600
			else setvar TEMPVAR3 750
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 187
			else ifspritepal 17 setvar TEMPVAR3 168
			else ifspritepal 20 setvar TEMPVAR3 150
			else setvar TEMPVAR3 187
		}
	}
	else
	ifactor BOSS1
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 866
			else ifspritepal 3 setvar TEMPVAR3 866
			else ifspritepal 9 setvar TEMPVAR3 866
			else ifspritepal 24 setvar TEMPVAR3 937
			else setvar TEMPVAR3 903
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 216
			else ifspritepal 3 setvar TEMPVAR3 216
			else ifspritepal 9 setvar TEMPVAR3 216
			else ifspritepal 24 setvar TEMPVAR3 234
			else setvar TEMPVAR3 226
		}
	}
	else
	ifactor BOSS2
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 254
			else ifspritepal 3 setvar TEMPVAR3 254
			else ifspritepal 9 setvar TEMPVAR3 254
			else ifspritepal 24 setvar TEMPVAR3 313
			else setvar TEMPVAR3 283
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 127
			else ifspritepal 3 setvar TEMPVAR3 127
			else ifspritepal 9 setvar TEMPVAR3 127
			else ifspritepal 24 setvar TEMPVAR3 157
			else setvar TEMPVAR3 142
		}
	}
	else
	ifactor BOSS3
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 553
			else ifspritepal 3 setvar TEMPVAR3 553
			else ifspritepal 9 setvar TEMPVAR3 553
			else ifspritepal 24 setvar TEMPVAR3 625
			else setvar TEMPVAR3 592
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 138
			else ifspritepal 3 setvar TEMPVAR3 138
			else ifspritepal 9 setvar TEMPVAR3 138
			else ifspritepal 24 setvar TEMPVAR3 156
			else setvar TEMPVAR3 148
		}
	}
	else
	ifactor BOSS4
	{
		ifvare sector[THISACTOR].lotag 50
		{
			ifspritepal 0 setvar TEMPVAR3 97
			else ifspritepal 3 setvar TEMPVAR3 97
			else ifspritepal 9 setvar TEMPVAR3 97
			else ifspritepal 24 setvar TEMPVAR3 125
			else setvar TEMPVAR3 111
		}
		ifvare sector[THISACTOR].lotag 51
		{
			ifspritepal 0 setvar TEMPVAR3 48
			else ifspritepal 3 setvar TEMPVAR3 48
			else ifspritepal 9 setvar TEMPVAR3 48
			else ifspritepal 24 setvar TEMPVAR3 63
			else setvar TEMPVAR3 56
		}
	}
	else
	{
		ifvare sector[THISACTOR].lotag 50
		{
			setvar TEMPVAR3 781
		}
		ifvare sector[THISACTOR].lotag 51
		{
			setvar TEMPVAR3 390
		}
	}
	ifvare x -1
	{ 
		mulvar TEMPVAR3 100
		divvar TEMPVAR3 100
	}
	else
	{
		mulvar TEMPVAR3 75
		divvar TEMPVAR3 100
	}
	
	mulvarvar actor_oposxv TEMPVAR3
	divvar actor_oposxv 1000
	addvarvar ACTORXVEL actor_oposxv
	setactor[THISACTOR].xvel ACTORXVEL
	
	subvarvar actor_oposyv ACTORYVEL
	ifactor LIZTROOP
	{
		ifspritepal 0 setvar TEMPVAR3 866
		else ifspritepal 21 setvar TEMPVAR3 812
		else ifspritepal 19 setvar TEMPVAR3 667
		else ifspritepal 14 setvar TEMPVAR3 937
		else ifspritepal 17 setvar TEMPVAR3 500
		else setvar TEMPVAR3 866
	}
	else
	ifactor LIZMAN
	{
		ifspritepal 0 setvar TEMPVAR3 866
		else ifspritepal 19 setvar TEMPVAR3 812
		else ifspritepal 6 setvar TEMPVAR3 866
		else ifspritepal 17 setvar TEMPVAR3 750
		else setvar TEMPVAR3 866
	}
	else
	ifactor PIGCOP
	{
		ifspritepal 0 setvar TEMPVAR3 800
		else ifspritepal 21 setvar TEMPVAR3 775
		else ifspritepal 14 setvar TEMPVAR3 750
		else ifspritepal 24 setvar TEMPVAR3 625
		else setvar TEMPVAR3 800
	}
	else
	ifactor NEWBEAST
	{
		ifspritepal 0 setvar TEMPVAR3 750
		else ifspritepal 17 setvar TEMPVAR3 675
		else ifspritepal 20 setvar TEMPVAR3 600
		else setvar TEMPVAR3 750
	}
	else
	ifactor BOSS1
	{
		ifspritepal 0 setvar TEMPVAR3 866
		else ifspritepal 3 setvar TEMPVAR3 866
		else ifspritepal 9 setvar TEMPVAR3 866
		else ifspritepal 24 setvar TEMPVAR3 937
		else setvar TEMPVAR3 903
	}
	else
	ifactor BOSS2
	{
		ifspritepal 0 setvar TEMPVAR3 254
		else ifspritepal 3 setvar TEMPVAR3 254
		else ifspritepal 9 setvar TEMPVAR3 254
		else ifspritepal 24 setvar TEMPVAR3 313
		else setvar TEMPVAR3 283
	}
	else
	ifactor BOSS3
	{
		ifspritepal 0 setvar TEMPVAR3 553
		else ifspritepal 3 setvar TEMPVAR3 553
		else ifspritepal 9 setvar TEMPVAR3 553
		else ifspritepal 24 setvar TEMPVAR3 625
		else setvar TEMPVAR3 592
	}
	else
	ifactor BOSS4
	{
		ifspritepal 0 setvar TEMPVAR3 97
		else ifspritepal 3 setvar TEMPVAR3 97
		else ifspritepal 9 setvar TEMPVAR3 97
		else ifspritepal 24 setvar TEMPVAR3 125
		else setvar TEMPVAR3 111
	}
	else
	{
		setvar TEMPVAR3 781
	}
	ifvare y -1
	{
		mulvar TEMPVAR3 100
		divvar TEMPVAR3 100
	}
	else
	{
		mulvar TEMPVAR3 75
		divvar TEMPVAR3 100
	}
	
	mulvarvar actor_oposyv TEMPVAR3
	divvar actor_oposyv 1000
	addvarvar ACTORYVEL actor_oposyv
	setactor[THISACTOR].yvel ACTORYVEL
	
	ifvare x -1 state STOPSTEPSOUNDS_ACTOR else ifvare y -1 state STOPSTEPSOUNDS_ACTOR
ends



state raincode
	setvar tempe 0
	setvar countvar 0
	setvarvar countvarb raining
	ifvarl countvarb 0 mulvar countvarb -1
	ifmultiplayer nullop else
	{
		ifvarl framerate 2 setvar countvarb 1
		setvarvar TEMPVAR5 framerate mulvar TEMPVAR5 4
		ifvarvarg countvarb TEMPVAR5 setvarvar countvarb TEMPVAR5
	}
	
	ifvarg countvarb 1024 setvar countvarb 1024 // sets the max for rain and snow
	getplayer[THISACTOR].posx x
	getplayer[THISACTOR].posy y
	whilevarvarn countvar countvarb
	{
		addvar countvar 1
		setvarvar xydist x
		randvarvar temp rainradius // the random component of the distance from player
		addvar temp 512
		addvarvar xydist temp
		randvar angvar 2047
	
		rotatepoint x y xydist y angvar tempb y
		// tempb and y are the new x and y coords
		updatesector tempb y tempd
		ifvarn tempd -1
		{
			ifvarn sector[tempd].hitag 101
			ifvarand sector[tempd].ceilingstat 1
			{
				getactorvar[tempd].SPACESECTOR? temp
				ifvare temp 0
				{
					getceilzofslope tempd tempb y z // z is the return var
					ifvarl raining 0 // don't put snow too high up
					{
						getplayer[THISACTOR].posz temp
						setvarvar tempc temp // save posz in tempc
						subvarvar temp z // positive value is distance above player to ceiling
						ifvarvarg temp snowceiling 
						{
							subvarvar tempc snowceiling 
							setvarvar z tempc 
						}
					}
					updatesectorz tempb y z tempd
					ifvarn tempd -1
					{
						espawn RAINSPRITE
						setactor[RETURN].x tempb
						setactor[RETURN].y y
						setactor[RETURN].z z
						changespritesect RETURN tempd // setactor[RETURN].sectnum tempd
						addvar tempe 1
					}
				}
			}
		}
	}
	
	// Sound Checks dependant on Rain Volume
	ifvarg raining 64
	{
		ifoutside ifvarn WATER? 2 soundonce RAINHEAVY
		else
		{
			stopsound RAINHEAVY
			ifvarg tempe 4 soundonce RAIN //else stopsound RAINWINDOW
		}
	}
	else ifvarg raining 16 ifvarl raining 65
	{
		ifoutside ifvarn WATER? 2 soundonce RAIN
		else
		{
			stopsound RAIN
			ifvarg tempe 4 soundonce RAINLOOP //else stopsound RAINWINDOW
		}
	}
	else ifvarg raining 0 ifvarl raining 17
	{
		ifoutside ifvarn WATER? 2 soundonce RAINLOOP
		else
		{
			stopsound RAINLOOP
			ifvarg tempe 4 soundonce RAINWINDOW //else stopsound RAINWINDOW
		}
	}
ends

//

state malakiangemcheck
	// Check Malakian Gem [Permenant Boost Item]
	state checkmalakiangems
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 -2 // 2% per item
	addvar TEMP6 100
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	
	// Check Jewels of Four Souls [Rare Equippable Item]
	ifvare PLAYEREQUIPSLOTITEM1 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM2 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM3 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM4 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM5 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM6 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM7 28 divvar TEMP7 10
	ifvare PLAYEREQUIPSLOTITEM8 28 divvar TEMP7 10
	
	// Iron Rune [Equippable Item] (Lowers Final Critical % in trade for Overall Resistance to damage)
	setvar DAMAGEMODIFIER 1000
	ifvare PLAYEREQUIPSLOTITEM1 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM2 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM3 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM4 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM5 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM6 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM7 21 subvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM8 21 subvar DAMAGEMODIFIER 250
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	mulvarvar TEMP7 DAMAGEMODIFIER
	divvar TEMP7 1000
ends

state nyxgloveschecker
	setvar DAMAGEMODIFIER 0
	ifvare PLAYEREQUIPSLOTITEM1 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM2 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM3 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM4 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM5 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM6 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM7 11 addvar DAMAGEMODIFIER 1
	ifvare PLAYEREQUIPSLOTITEM8 11 addvar DAMAGEMODIFIER 1
ends

state playerdamagehuestrength2
	setvarvar TEMPVAR5 DAMAGEHUEFACTOR
	divvar TEMPVAR5 5 // 10
	addvarvar DAMAGEHUETIMER TEMPVAR5
	ifvarl DAMAGEHUETIMER 0 setvar DAMAGEHUETIMER 0
	ifvarg DAMAGEHUETIMER 200 setvar DAMAGEHUETIMER 200
ends

state playerdamagehues-shakescreen
	ifvarg DAMAGEHUEFACTOR 249 wackplayer
	ifvarg DAMAGEHUEFACTOR 499 wackplayer
	ifvarg DAMAGEHUEFACTOR 749 wackplayer
	ifvarg DAMAGEHUEFACTOR 999 wackplayer
	ifvarg DAMAGEHUEFACTOR 1249 wackplayer
	ifvarg DAMAGEHUEFACTOR 1499 wackplayer
	ifvarg DAMAGEHUEFACTOR 1749 wackplayer
	ifvarg DAMAGEHUEFACTOR 1999 wackplayer
ends

state calcdmgfactor
	mulvar DAMAGEHUEFACTOR 1000
	divvarvar DAMAGEHUEFACTOR MAXHITPOINTS
	state playerdamagehuestrength2
ends

state playerdamagehues-quickcalc
	setvarvar temp DAMAGEHUEFACTOR
	divvar temp 25
	addvar temp 1
	ifvarg temp 64 setvar temp 64
	setplayer[THISACTOR].pals_time temp 
ends

state playerdamagehues-normaltype
	state calcdmgfactor
	
	state playerdamagehues-quickcalc
	setplayer[THISACTOR].pals 0 64 
	setplayer[THISACTOR].pals 1 0 
	setplayer[THISACTOR].pals 2 0
	setvar DAMAGEHUEPAL 21
ends

state playerdamagehues-acidtype
	state calcdmgfactor
	
	state playerdamagehues-quickcalc
	setplayer[THISACTOR].pals 0 0 
	setplayer[THISACTOR].pals 1 64 
	setplayer[THISACTOR].pals 2 0
	setvar DAMAGEHUEPAL 22
ends

state playerdamagehues-electrictype
	state calcdmgfactor
	
	state playerdamagehues-quickcalc
	setplayer[THISACTOR].pals 0 64 
	setplayer[THISACTOR].pals 1 64 
	setplayer[THISACTOR].pals 2 64
	setvar DAMAGEHUEPAL 20
ends

state playerdamagehues-firetype
	state calcdmgfactor
	
	state playerdamagehues-quickcalc
	setplayer[THISACTOR].pals 0 64 
	setplayer[THISACTOR].pals 1 32 
	setplayer[THISACTOR].pals 2 0
	setvar DAMAGEHUEPAL 21
ends

state playerdamagehues-icetype
	state calcdmgfactor
	
	state playerdamagehues-quickcalc
	setplayer[THISACTOR].pals 0 0 
	setplayer[THISACTOR].pals 1 0 
	setplayer[THISACTOR].pals 2 64
	setvar DAMAGEHUEPAL 1
ends

state playerdamagehues-watertype
	state calcdmgfactor
	
	state playerdamagehues-quickcalc
	setplayer[THISACTOR].pals 0 24 
	setplayer[THISACTOR].pals 1 24 
	setplayer[THISACTOR].pals 2 64
	setvar DAMAGEHUEPAL 1
ends

state checkmoneyowner
	getactor[THISACTOR].owner TEMP3
	ifvarvarn THISACTOR TEMP3 { ifvarn RETURN -1 setactor[RETURN].owner TEMP3 }
ends

state hazarddetectifdead
	ifvarn PYTHAGORASTARGET -1
	{ 
		ifvarn actorvar[PYTHAGORASTARGET].DRIVERID -1 { setvar PYTHAGORASTARGET -1 break } // For Vehicles only. If the target doesn't have a driver, the it takes damage individually.
		ifvarl actorvar[PYTHAGORASTARGET].ACTORHP 1 { setvar PYTHAGORASTARGET -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[PYTHAGORASTARGET].SHRUNK? 1 { setvar PYTHAGORASTARGET -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[PYTHAGORASTARGET].EXPANDING? 1 { setvar PYTHAGORASTARGET -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[PYTHAGORASTARGET].FROZEN? 1 { setvar PYTHAGORASTARGET -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[PYTHAGORASTARGET].CLOAKED? 1 { setvar PYTHAGORASTARGET -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		//
		// next code gets distance between actortarget (x,y) and hazard (x,y), puts result in BLOODPOOLDISTANCE
		getactor[THISACTOR].x temp
		getactor[PYTHAGORASTARGET].x tempb
	
		subvarvar temp tempb
		mulvarvar temp temp
	
		getactor[THISACTOR].y tempc
		getactor[PYTHAGORASTARGET].y tempd
	
		subvarvar tempc tempd
		mulvarvar tempc tempc
	
		addvarvar temp tempc
		sqrt temp temp
		setvarvar PYTHAGORASDISTANCE temp
		//
		ifvarg PYTHAGORASDISTANCE 844 { setvar PYTHAGORASTARGET -1 break }
	}
ends

state dukepainsounds
	ifrnd 40
	{
		stopsound DUKE_LONGTERM_PAIN1
		stopsound DUKE_LONGTERM_PAIN2
		stopsound DUKE_LONGTERM_PAIN3
		stopsound DUKE_LONGTERM_PAIN4
		stopsound DUKE_LONGTERM_PAIN5
		stopsound DUKE_LONGTERM_PAIN6
		stopsound DUKE_LONGTERM_PAIN7
	}
	
	ifvare PAINSOUNDSTYPE 0 // Sounds are based on CURRENTHITPOINTS amount when hit
	{
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		ifvarl MISCARRAYID_AMOUNTTEMP 251 ifvarg MISCARRAYID_AMOUNTTEMP -1
		{
			randvar RNDVOICE 2
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound DUKE_LONGTERM_PAIN2
				ifvare RNDVOICE 1 sound DUKE_LONGTERM_PAIN3
				ifvare RNDVOICE 2 sound DUKE_LONGTERM_PAIN4
			}
		}
		else
		ifvarg MISCARRAYID_AMOUNTTEMP 250
		{
			randvar RNDVOICE 3
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound DUKE_LONGTERM_PAIN1
				ifvare RNDVOICE 1 sound DUKE_LONGTERM_PAIN5
				ifvare RNDVOICE 2 sound DUKE_LONGTERM_PAIN6
				ifvare RNDVOICE 3 sound DUKE_LONGTERM_PAIN7
			}
		}
	}
	else // Sounds are based on how much % of damage was taken in a single hit
	{
		ifvarg PAINSOUNDFACTOR -1 ifvarl PAINSOUNDFACTOR 501 // 751
		{
			randvar RNDVOICE 3
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound DUKE_LONGTERM_PAIN1
				ifvare RNDVOICE 1 sound DUKE_LONGTERM_PAIN5
				ifvare RNDVOICE 2 sound DUKE_LONGTERM_PAIN6
				ifvare RNDVOICE 3 sound DUKE_LONGTERM_PAIN7
			}
		}
		else ifvarg PAINSOUNDFACTOR 500 // 750
		{
			randvar RNDVOICE 2
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound DUKE_LONGTERM_PAIN2
				ifvare RNDVOICE 1 sound DUKE_LONGTERM_PAIN3
				ifvare RNDVOICE 2 sound DUKE_LONGTERM_PAIN4
			}
		}
	}
ends


state lowangpainsounds
	ifrnd 40
	{
		stopsound WANG_LONGTERM_PAIN1
		stopsound WANG_LONGTERM_PAIN2
		stopsound WANG_LONGTERM_PAIN3
		stopsound WANG_LONGTERM_PAIN4
		stopsound WANG_LONGTERM_PAIN5
		stopsound WANG_LONGTERM_PAIN6
		stopsound WANG_LONGTERM_PAIN7
		stopsound WANG_LONGTERM_PAIN8
	}
	
	ifvare PAINSOUNDSTYPE 0 // Sounds are based on CURRENTHITPOINTS amount when hit
	{
		randvar RNDVOICE 3
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		ifvarl MISCARRAYID_AMOUNTTEMP 251 ifvarg MISCARRAYID_AMOUNTTEMP -1
		{
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound WANG_LONGTERM_PAIN1
				ifvare RNDVOICE 1 sound WANG_LONGTERM_PAIN2
				ifvare RNDVOICE 2 sound WANG_LONGTERM_PAIN3
				ifvare RNDVOICE 3 sound WANG_LONGTERM_PAIN4
			}
		}
		else
		ifvarg MISCARRAYID_AMOUNTTEMP 250
		{
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound WANG_LONGTERM_PAIN5
				ifvare RNDVOICE 1 sound WANG_LONGTERM_PAIN6
				ifvare RNDVOICE 2 sound WANG_LONGTERM_PAIN7
				ifvare RNDVOICE 3 sound WANG_LONGTERM_PAIN8
			}
		}
	}
	else // Sounds are based on how much % of damage was taken in a single hit
	{
		randvar RNDVOICE 3
		ifvarg PAINSOUNDFACTOR -1 ifvarl PAINSOUNDFACTOR 501 // 751
		{
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound WANG_LONGTERM_PAIN5
				ifvare RNDVOICE 1 sound WANG_LONGTERM_PAIN6
				ifvare RNDVOICE 2 sound WANG_LONGTERM_PAIN7
				ifvare RNDVOICE 3 sound WANG_LONGTERM_PAIN8
			}
		}
		else ifvarg PAINSOUNDFACTOR 500 // 750
		{
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound WANG_LONGTERM_PAIN1
				ifvare RNDVOICE 1 sound WANG_LONGTERM_PAIN2
				ifvare RNDVOICE 2 sound WANG_LONGTERM_PAIN3
				ifvare RNDVOICE 3 sound WANG_LONGTERM_PAIN4
			}
		}
	}
ends

state lisapainsounds
	ifrnd 40
	{
		stopsound LISA_PAINMINOR1
		stopsound LISA_PAINMINOR2
		stopsound LISA_PAINMINOR3
		stopsound LISA_PAINMINOR4
		stopsound LISA_PAINMODERATE1
		stopsound LISA_PAINMODERATE2
		stopsound LISA_PAINMODERATE3
		stopsound LISA_PAINMODERATE4
		stopsound LISA_PAINHIGH1
		stopsound LISA_PAINHIGH2
		stopsound LISA_PAINHIGH3
		stopsound LISA_PAINHIGH4
		stopsound LISA_PAINPERILOUS1
		stopsound LISA_PAINPERILOUS2
		stopsound LISA_PAINPERILOUS3
		stopsound LISA_PAINPERILOUS4
	}
	
	ifvare PAINSOUNDSTYPE 0 // Sounds are based on CURRENTHITPOINTS amount when hit
	{
		randvar RNDVOICE 3
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		ifvarg MISCARRAYID_AMOUNTTEMP 750
		{
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound LISA_PAINMINOR1
				ifvare RNDVOICE 1 sound LISA_PAINMINOR2
				ifvare RNDVOICE 2 sound LISA_PAINMINOR3
				ifvare RNDVOICE 3 sound LISA_PAINMINOR4
			}
		}
		else
		ifvarl MISCARRAYID_AMOUNTTEMP 751 ifvarg MISCARRAYID_AMOUNTTEMP 500
		{
			ifrnd 203
			{
				ifvare RNDVOICE 0 sound LISA_PAINMODERATE1
				ifvare RNDVOICE 1 sound LISA_PAINMODERATE2
				ifvare RNDVOICE 2 sound LISA_PAINMODERATE3
				ifvare RNDVOICE 3 sound LISA_PAINMODERATE4
			}
		}
		else
		ifvarl MISCARRAYID_AMOUNTTEMP 501 ifvarg MISCARRAYID_AMOUNTTEMP 250
		{
			ifrnd 213
			{
				ifvare RNDVOICE 0 sound LISA_PAINHIGH1
				ifvare RNDVOICE 1 sound LISA_PAINHIGH2
				ifvare RNDVOICE 2 sound LISA_PAINHIGH3
				ifvare RNDVOICE 3 sound LISA_PAINHIGH4
			}
		}
		else ifvarl MISCARRAYID_AMOUNTTEMP 251 ifvarg MISCARRAYID_AMOUNTTEMP -1
		{
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound LISA_PAINPERILOUS1
				ifvare RNDVOICE 1 sound LISA_PAINPERILOUS2
				ifvare RNDVOICE 2 sound LISA_PAINPERILOUS3
				ifvare RNDVOICE 3 sound LISA_PAINPERILOUS4
			}
		}
	}
	else // Sounds are based on how much % of damage was taken in a single hit
	{
		randvar RNDVOICE 3
		ifvarg PAINSOUNDFACTOR -1 ifvarl PAINSOUNDFACTOR 251
		{
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound LISA_PAINMINOR1
				ifvare RNDVOICE 1 sound LISA_PAINMINOR2
				ifvare RNDVOICE 2 sound LISA_PAINMINOR3
				ifvare RNDVOICE 3 sound LISA_PAINMINOR4
			}
		}
		ifvarg PAINSOUNDFACTOR 250 ifvarl PAINSOUNDFACTOR 501
		{
			ifrnd 203
			{
				ifvare RNDVOICE 0 sound LISA_PAINMODERATE1
				ifvare RNDVOICE 1 sound LISA_PAINMODERATE2
				ifvare RNDVOICE 2 sound LISA_PAINMODERATE3
				ifvare RNDVOICE 3 sound LISA_PAINMODERATE4
			}
		}
		ifvarg PAINSOUNDFACTOR 500 ifvarl PAINSOUNDFACTOR 751
		{
			ifrnd 213
			{
				ifvare RNDVOICE 0 sound LISA_PAINHIGH1
				ifvare RNDVOICE 1 sound LISA_PAINHIGH2
				ifvare RNDVOICE 2 sound LISA_PAINHIGH3
				ifvare RNDVOICE 3 sound LISA_PAINHIGH4
			}
		}
		else ifvarg PAINSOUNDFACTOR 750
		{
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound LISA_PAINPERILOUS1
				ifvare RNDVOICE 1 sound LISA_PAINPERILOUS2
				ifvare RNDVOICE 2 sound LISA_PAINPERILOUS3
				ifvare RNDVOICE 3 sound LISA_PAINPERILOUS4
			}
		}
	}
ends

state makenpainsounds
	ifrnd 40
	{
		stopsound MAKEN_PAINMINOR1
		stopsound MAKEN_PAINMINOR2
		stopsound MAKEN_PAINMINOR3
		stopsound MAKEN_PAINMINOR4
		stopsound MAKEN_PAINMODERATE1
		stopsound MAKEN_PAINMODERATE2
		stopsound MAKEN_PAINMODERATE3
		stopsound MAKEN_PAINMODERATE4
		stopsound MAKEN_PAINHIGH1
		stopsound MAKEN_PAINHIGH2
		stopsound MAKEN_PAINHIGH3
		stopsound MAKEN_PAINHIGH4
		stopsound MAKEN_PAINPERILOUS1
		stopsound MAKEN_PAINPERILOUS2
		stopsound MAKEN_PAINPERILOUS3
		stopsound MAKEN_PAINPERILOUS4
	}
	
	ifvare PAINSOUNDSTYPE 0 // Sounds are based on CURRENTHITPOINTS amount when hit
	{
		randvar RNDVOICE 3
		setvar MISCARRAYID 94 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HP-FACTOR
		ifvarg MISCARRAYID_AMOUNTTEMP 750
		{
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINMINOR1
				ifvare RNDVOICE 1 sound MAKEN_PAINMINOR2
				ifvare RNDVOICE 2 sound MAKEN_PAINMINOR3
				ifvare RNDVOICE 3 sound MAKEN_PAINMINOR4
			}
		}
		else
		ifvarl MISCARRAYID_AMOUNTTEMP 751 ifvarg MISCARRAYID_AMOUNTTEMP 500
		{
			ifrnd 203
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINMODERATE1
				ifvare RNDVOICE 1 sound MAKEN_PAINMODERATE2
				ifvare RNDVOICE 2 sound MAKEN_PAINMODERATE3
				ifvare RNDVOICE 3 sound MAKEN_PAINMODERATE4
			}
		}
		else
		ifvarl MISCARRAYID_AMOUNTTEMP 501 ifvarg MISCARRAYID_AMOUNTTEMP 250
		{
			ifrnd 213
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINHIGH1
				ifvare RNDVOICE 1 sound MAKEN_PAINHIGH2
				ifvare RNDVOICE 2 sound MAKEN_PAINHIGH3
				ifvare RNDVOICE 3 sound MAKEN_PAINHIGH4
			}
		}
		else ifvarl MISCARRAYID_AMOUNTTEMP 251 ifvarg MISCARRAYID_AMOUNTTEMP -1
		{
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINPERILOUS1
				ifvare RNDVOICE 1 sound MAKEN_PAINPERILOUS2
				ifvare RNDVOICE 2 sound MAKEN_PAINPERILOUS3
				ifvare RNDVOICE 3 sound MAKEN_PAINPERILOUS4
			}
		}
	}
	else // Sounds are based on how much % of damage was taken in a single hit
	{
		randvar RNDVOICE 3
		ifvarg PAINSOUNDFACTOR -1 ifvarl PAINSOUNDFACTOR 251
		{
			ifrnd 192
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINMINOR1
				ifvare RNDVOICE 1 sound MAKEN_PAINMINOR2
				ifvare RNDVOICE 2 sound MAKEN_PAINMINOR3
				ifvare RNDVOICE 3 sound MAKEN_PAINMINOR4
			}
		}
		ifvarg PAINSOUNDFACTOR 250 ifvarl PAINSOUNDFACTOR 501
		{
			ifrnd 203
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINMODERATE1
				ifvare RNDVOICE 1 sound MAKEN_PAINMODERATE2
				ifvare RNDVOICE 2 sound MAKEN_PAINMODERATE3
				ifvare RNDVOICE 3 sound MAKEN_PAINMODERATE4
			}
		}
		ifvarg PAINSOUNDFACTOR 500 ifvarl PAINSOUNDFACTOR 751
		{
			ifrnd 213
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINHIGH1
				ifvare RNDVOICE 1 sound MAKEN_PAINHIGH2
				ifvare RNDVOICE 2 sound MAKEN_PAINHIGH3
				ifvare RNDVOICE 3 sound MAKEN_PAINHIGH4
			}
		}
		else ifvarg PAINSOUNDFACTOR 750
		{
			ifrnd 224
			{
				ifvare RNDVOICE 0 sound MAKEN_PAINPERILOUS1
				ifvare RNDVOICE 1 sound MAKEN_PAINPERILOUS2
				ifvare RNDVOICE 2 sound MAKEN_PAINPERILOUS3
				ifvare RNDVOICE 3 sound MAKEN_PAINPERILOUS4
			}
		}
	}
ends

state characterpainsounds
	stopsound DUKE_LONGTERM_PAIN
	ifvare CHARACTERSELECTED? 1 state dukepainsounds
	ifvare CHARACTERSELECTED? 5 state lowangpainsounds
	ifvare CHARACTERSELECTED? 8 state lisapainsounds
	ifvare CHARACTERSELECTED? 15 state makenpainsounds
ends

state checkpainfactor
	mulvar PAINSOUNDFACTOR 1000
	divvarvar PAINSOUNDFACTOR MAXHITPOINTS
	
	// Check Energy Incurments [Equippable Item]
	setvar DAMAGEMODIFIER 0
	ifvare PLAYEREQUIPSLOTITEM1 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM2 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM3 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM4 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM5 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM6 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM7 26 addvar DAMAGEMODIFIER 250
	ifvare PLAYEREQUIPSLOTITEM8 26 addvar DAMAGEMODIFIER 250
	ifvarg DAMAGEMODIFIER 1000 setvar DAMAGEMODIFIER 1000
	
	// Get HP %Damage into EP %Recovery
	setvarvar TEMPVAR5 PAINSOUNDFACTOR
	mulvarvar TEMPVAR5 DAMAGEMODIFIER
	divvar TEMPVAR5 1000
	
	// Recover EP
	ifvarg TEMPVAR5 0
	{
		setvarvar TEMPVAR4 MAXENERGYPOINTS
		mulvarvar TEMPVAR4 TEMPVAR5
		divvar TEMPVAR4 1000
		addvarvar CURRENTENERGYPOINTS TEMPVAR4
		ifvarvarg CURRENTENERGYPOINTS MAXENERGYPOINTS setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTS
	}
ends

// ****************************************************
// MAP BEACON - By James Stanfield and Nuclear Showdown
// ****************************************************

state MAPBEACON
	setactor[THISACTOR].shade -127
	state shadepulse4
	setactor[THISACTOR].shade shade
	cstat 32800 // Horizontally Flat [on the floor] + Invisible [except on the automap]
	ifvare AUTOMAPMODE 2
	{
		getplayer[THISACTOR].zoom TEMP2
		subvar TEMP2 2048
		mulvar TEMP2 -1
		divvar TEMP2 20
		ifvarl TEMP2 32 setvar TEMP2 32 // ifvarl TEMP2 2 setvar TEMP2 2
		ifvarg TEMP2 128 setvar TEMP2 128 // ifvarg TEMP2 256 setvar TEMP2 256
		setactor[THISACTOR].xrepeat TEMP2
		setactor[THISACTOR].yrepeat TEMP2
		getplayer[THISACTOR].ang TEMP3
		setactor[THISACTOR].ang TEMP3
	}
ends

state bioshieldhitsounds
	sound ESHIELD_HIT
	ifvare ESHIELDADVANCEMENT 1 sound ESHIELD_HIT2
ends

state lisashield_misc
	ifvare CHARACTERSELECTED? 8
	{
		ifvare HAVEENERGYSHIELD? 1 
		{
			ifvare ENERGYSHIELDMODE 1 
			{
				ifvarg TEMPDAMAGEVAR 0
				{
					ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
					{
						setvarvar CELLDAMAGE TEMPDAMAGEVAR
			
						ifvare ESHIELDADVANCEMENT 1 { divvar CELLDAMAGE 2 divvar TEMPDAMAGEVAR 2 }
			
						setvarvar CELLDAMAGETEMP CELLDAMAGE setvar CELLDAMAGETIMER 0 // For the displays
						ifvarn ESHIELDDMGFACTOR 0 divvarvar CELLDAMAGE ESHIELDDMGFACTOR
						ifvarvarg CELLDAMAGE CURRENTCELLS setvarvar CELLDAMAGE CURRENTCELLS
						setvarvar tempc CELLDAMAGE
						mulvarvar tempc ESHIELDDMGFACTOR
						subvarvar TEMPDAMAGEVAR tempc
						subvarvar CURRENTCELLS CELLDAMAGE
						setvar CELLDAMAGELEFT 0
						ifvarg TEMPDAMAGEVAR 0 subvarvar CELLDAMAGETEMP TEMPDAMAGEVAR // For the displays
			
						// Now to Calculate to deal with remaining TEMPDAMAGEVAR
						ifvarg CURRENTCELLS 0 // 1 or more cells left
						{
							ifvarvarg TEMPDAMAGEVAR DAMAGEINCELL // Damage exceeds the remaining power in the current cell
							{
								setvarvar TEMP3 TEMPDAMAGEVAR
								setvar TEMPDAMAGEVAR 0
								addvarvar CELLDAMAGETEMP TEMP3
								subvarvar DAMAGEINCELL TEMP3
								ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
							}
							else // Damage is less than or equal to the remaining power in the current cell
							{
								setvarvar TEMP3 TEMPDAMAGEVAR
								addvarvar CELLDAMAGETEMP TEMPDAMAGEVAR
								subvarvar DAMAGEINCELL TEMPDAMAGEVAR
								setvar TEMPDAMAGEVAR 0
								ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
							}
						}
						else // 0 cells
						{
							ifvarvarg TEMPDAMAGEVAR DAMAGEINCELL // Damage exceeds the remaining power in the last cell
							{
								setvarvar TEMP3 TEMPDAMAGEVAR
								addvarvar CELLDAMAGETEMP DAMAGEINCELL
								subvarvar TEMPDAMAGEVAR DAMAGEINCELL
								setvar DAMAGEINCELL 0
							}
							else // Damage is less than the remaining power in the last cell
							{
								setvarvar TEMP3 TEMPDAMAGEVAR
								addvarvar CELLDAMAGETEMP TEMPDAMAGEVAR
								subvarvar DAMAGEINCELL TEMPDAMAGEVAR
								setvar TEMPDAMAGEVAR 0
							}
						}
			
						stopsound NODAMAGE
						ifvare ENERGYSHIELDMODE 1 { setvar sparkflag 1 state sparkstate }
						state bioshieldhitsounds
						palfrom 32 0 0 64
					}
				}
			}
		}
	}
	setvarvar FULLSHIELDDAMAGE CELLDAMAGE
	mulvarvar FULLSHIELDDAMAGE ESHIELDDMGFACTOR
	addvarvar FULLSHIELDDAMAGE TEMP3
ends

state assesspickuprequirements
	ifvarn oldskoolmode 1 
	{
		ifvarand ACTORFLAGS 128 mulvar TEMPVAR 2 
		ifvarand ACTORFLAGS 256 mulvar TEMPVAR 4
	}
ends

state checkpickupamountflags
	ifvarn oldskoolmode 1
	{
		ifvarand ACTORFLAGS 128 mulvar ACTORPICKUPAMOUNT 2
		ifvarand ACTORFLAGS 256 mulvar ACTORPICKUPAMOUNT 4
	} 
ends

state itemdroptimer
	ifvare mainmenu 0
	{
		ifvare ITEMWASDROPPED? 1
		{
			subvar ITEMDROPTIMER 1
			ifvarl ITEMDROPTIMER 1 killit
		}
	}
ends

state moneybadgemultis
	// Money Badge
	setvar TEMP3 0
	ifvare PLAYEREQUIPSLOTITEM1 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM2 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM3 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM4 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM5 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM6 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM7 9 addvar TEMP3 2
	ifvare PLAYEREQUIPSLOTITEM8 9 addvar TEMP3 2
	ifvarg TEMP3 0 mulvarvar ACTORPICKUPAMOUNT TEMP3
	
	// Pair of Loaded Dice
	state checkfixeddicepairs
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	setvarvar TEMP4 ACTORPICKUPAMOUNT
	mulvarvar TEMP4 TEMP6
	divvar TEMP4 100
	addvarvar ACTORPICKUPAMOUNT TEMP4
ends

state checkforforcefields

	setvar ARRAYPOSITION 0 // Wall IDs >.>
	whilevarn ARRAYPOSITION 16383
	{
		ifvarvarl ARRAYPOSITION NUMWALLS getwall[ARRAYPOSITION].lotag tempb
		ifvarvare tempb lotagsav
		{ 
			ifvare actorvar[ARRAYPOSITION].wall_array 0
			{
				ifvarvarl ARRAYPOSITION NUMWALLS getwall[ARRAYPOSITION].overpicnum tempd
				ifvare tempd BIGFORCE
				{
					setwall[ARRAYPOSITION].overpicnum 0
					setwall[ARRAYPOSITION].cstat 0   
					setactorvar[ARRAYPOSITION].wall_array 1
				}
				else
				ifvare tempd W_FORCEFIELD // W_FORCEFIELD (on)
				{
					setwall[ARRAYPOSITION].overpicnum 0
					setwall[ARRAYPOSITION].cstat 0   
					setactorvar[ARRAYPOSITION].wall_array 2
				}
				else
				ifvare tempd W_FORCEFIELDBLANK // W_FORCEFIELDBLANK (off)
				{
					setwall[ARRAYPOSITION].overpicnum 0
					setwall[ARRAYPOSITION].cstat 0   
					setactorvar[ARRAYPOSITION].wall_array 2
				}
			}
			else
			ifvare actorvar[ARRAYPOSITION].wall_array 1
			{
				ifvarvarl ARRAYPOSITION NUMWALLS getwall[ARRAYPOSITION].overpicnum tempd
				ifvare tempd 0
				{
					setwall[ARRAYPOSITION].overpicnum BIGFORCE
					setwall[ARRAYPOSITION].cstat 209
					setactorvar[ARRAYPOSITION].wall_array 0
				}
			}
			else
			ifvare actorvar[ARRAYPOSITION].wall_array 2
			{
				ifvarvarl ARRAYPOSITION NUMWALLS getwall[ARRAYPOSITION].overpicnum tempd
				ifvare tempd 0
				{
					setwall[ARRAYPOSITION].overpicnum W_FORCEFIELD
					setwall[ARRAYPOSITION].cstat 209
					setactorvar[ARRAYPOSITION].wall_array 0
				}
			}
		}
		addvar ARRAYPOSITION 1
		ifvarg ARRAYPOSITION 16383 break
	}
ends

state pickupexplosion
	ifactor RPGSPRITE hitradius 2670 40 160 360 640
	else ifactor RPGAMMO hitradius 2670 40 160 360 640
	else ifactor DEVISTATORSPRITE hitradius 2225 30 120 270 360
	else ifactor DEVISTATORAMMO hitradius 2225 30 120 270 360
	else ifactor HBOMBAMMO hitradius 3560 35 140 315 560
	else ifactor ICONOFTHEDEFENDER hitradius 890 50 200 450 800
	else ifactor QUADDAMAGE hitradius 890 50 200 450 800
	else ifactor REGENITEM hitradius 890 50 200 450 800
	else ifactor APREGENITEM hitradius 890 50 200 450 800
	else ifactor VAMPIREITEM hitradius 890 50 200 450 800
	else hitradius 1780 25 100 225 400
	
	espawn EXPLOSION2
	sound RPG_EXPLODE
	killit
ends

state activationflag
	ifvarand ACTORFLAGS 512 // Activate Objects
	{
		getplayer[THISACTOR].i temp
		operateactivators lotagsav 0 // temp 
		operatemasterswitches lotagsav
		operaterespawns lotagsav
		state checkforforcefields
	}
	
	ifvarand ACTORFLAGS 4096 // Booby-Trapped Pickup
	{
		redefinequote 335 ^10BOOBY-TRAPPED!! D:
		setvarvar fta fta_normal setvar ftq 335
		state pickupexplosion
	}
ends

state checkexplodeflag
	ifvarand ACTORFLAGS 8192
	{
		redefinequote 335 ^10BOOBY-TRAPPED!! D:
		setvarvar fta fta_normal setvar ftq 335
		state pickupexplosion
		break
	}
ends

state quickcalc
	setvar CALCVAR3 1000
	whilevarvarn CALCVAR1 CALCVAR2
	{  
		addvarvar CALCVAR3 CALCVAR4
		addvar CALCVAR1 1
	}
ends

state resetenemytimers
	setactorvar[THISACTOR].ACTORQUADTIME 0
	setactorvar[THISACTOR].ACTORINVULNTIME 0
	setactorvar[THISACTOR].ACTORREGENTIME 0
	setactorvar[THISACTOR].ACTORAPREGENTIME 0
	setactorvar[THISACTOR].ACTORVAMPIRETIME 0
	setactorvar[THISACTOR].ACTORBOOTSAMOUNT 0
	setactorvar[THISACTOR].ACTORAIRTANKAMOUNT 0
ends

state setexpranklimits
	// addlogvar EXPPTSTEMP
	ifvarl EXPPTSTEMP 0 setvar EXPPTSTEMP 0
	ifvarg EXPPTSTEMP 9163600 setvar EXPPTSTEMP 9163600
	// addlogvar RANKPOINTSTEMP
	ifvarl RANKPOINTSTEMP -2000000 setvar RANKPOINTSTEMP -2000000
	ifvarg RANKPOINTSTEMP 2000000 setvar RANKPOINTSTEMP 2000000
ends

state expmulti // Affects EXP and RANK rewards
	ifvare TEMPVAR 0
	{
		getactor[THISACTOR].htowner temp
		ifvarvarn temp PLAYERID { setvar EXPPTSTEMP 0 setvar RANKPOINTSTEMP 0 break }
	}
	setvar TEMPVAR 0
	
	ifvare oldskoolmode 1
	{
		setvar EXPPTSTEMP 0
		setvar RANKPOINTSTEMP 0
		break
	}
	
	ifvarn ENEMYHASSHIKON? 0
	{
		mulvar EXPPTSTEMP 64 // 100
		mulvar RANKPOINTSTEMP 64 // 100
	}
	
	ifvare PUBLICBETA? 0
	{
		// Overkill Bonus
		setvarvar TEMPVAR3 ACTORMAXHP mulvar TEMPVAR3 16 divvar TEMPVAR 5 // 320% or more Damage is considered "Overkill"
		ifvarvarl ACTORLASTDAMAGE TEMPVAR3 nullop
		else
		{
			redefinequote 340 ^21OVERKILL!! [+50% EXP/RANK BONUS!]
			userquote 340
			mulvar EXPPTSTEMP 3
			divvar EXPPTSTEMP 2
			mulvar RANKPOINTSTEMP 3
			divvar RANKPOINTSTEMP 2
			state setexpranklimits
		}
	
		// On a full-version game, get the party's average level to use for the following.
		setvarvar TEMPVAR2 AVERAGELEVEL
		mulvar TEMPVAR2 125
		divvar TEMPVAR2 100
		addvar TEMPVAR2 100
		mulvarvar EXPPTSTEMP TEMPVAR2
		divvar EXPPTSTEMP 100
		mulvarvar RANKPOINTSTEMP TEMPVAR2
		divvar RANKPOINTSTEMP 100
		state setexpranklimits
	
		ifvarand ACTORFLAGS 1024
		{
			mulvar EXPPTSTEMP 3 divvar EXPPTSTEMP 2 // 150% EXP
			mulvar RANKPOINTSTEMP 3 divvar RANKPOINTSTEMP 2 // 150% Rank
			state setexpranklimits
		}
		ifvarand ACTORFLAGS 512
		{
			mulvar EXPPTSTEMP 5 divvar EXPPTSTEMP 4 // 125% EXP
			mulvar RANKPOINTSTEMP 5 divvar RANKPOINTSTEMP 4 // 125% Rank
			state setexpranklimits
		}
	}
	
	// EXP Multiplier [out of 100%]
	ifvare SKILLLEVEL 0 mulvar EXPPTSTEMP 112
	ifvare SKILLLEVEL 1 mulvar EXPPTSTEMP 150
	ifvare SKILLLEVEL 2 mulvar EXPPTSTEMP 187
	ifvare SKILLLEVEL 3 mulvar EXPPTSTEMP 225
	ifvare SKILLLEVEL 4 mulvar EXPPTSTEMP 262
	ifvare SKILLLEVEL 5 mulvar EXPPTSTEMP 300
	ifvare SKILLLEVEL 6 mulvar EXPPTSTEMP 300
	ifvare SKILLLEVEL 7 mulvar EXPPTSTEMP 262
	ifvare SKILLLEVEL 8 mulvar EXPPTSTEMP 225
	ifvare SKILLLEVEL 9 mulvar EXPPTSTEMP 225
	divvar EXPPTSTEMP 100
	state setexpranklimits
	
	// Rank Multiplier [out of 5]
	ifvare SKILLLEVEL 0 mulvar RANKPOINTSTEMP 5
	ifvare SKILLLEVEL 1 mulvar RANKPOINTSTEMP 6
	ifvare SKILLLEVEL 2 mulvar RANKPOINTSTEMP 7
	ifvare SKILLLEVEL 3 mulvar RANKPOINTSTEMP 8
	ifvare SKILLLEVEL 4 mulvar RANKPOINTSTEMP 9
	ifvare SKILLLEVEL 5 mulvar RANKPOINTSTEMP 9
	ifvare SKILLLEVEL 6 mulvar RANKPOINTSTEMP 8
	ifvare SKILLLEVEL 7 mulvar RANKPOINTSTEMP 7
	ifvare SKILLLEVEL 8 mulvar RANKPOINTSTEMP 7
	ifvare SKILLLEVEL 9 mulvar RANKPOINTSTEMP 8
	divvar RANKPOINTSTEMP 5
	state setexpranklimits
	
	ifvare PUBLICBETA? 1 // "Beta Modes" do calculations here based on both Episode and Level, and if the Map is in the "User Map" [E1L8] slot, similar to a Doom 1 format.
	{
		setvar MISCARRAYID 80 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-EPISODE
		ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar EXPPTSTEMP 4
		ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar EXPPTSTEMP 5
		ifvare MISCARRAYID_AMOUNTTEMP 3 mulvar EXPPTSTEMP 6
		ifvare MISCARRAYID_AMOUNTTEMP 4 mulvar EXPPTSTEMP 7
		ifvare MISCARRAYID_AMOUNTTEMP 5 mulvar EXPPTSTEMP 8
		ifvare MISCARRAYID_AMOUNTTEMP 6 mulvar EXPPTSTEMP 9
		ifvare MISCARRAYID_AMOUNTTEMP 7 mulvar EXPPTSTEMP 10
		divvar EXPPTSTEMP 5
		state setexpranklimits
	
		setvar MISCARRAYID 80 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-EPISODE
		ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar RANKPOINTSTEMP 4
		ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar RANKPOINTSTEMP 5
		ifvare MISCARRAYID_AMOUNTTEMP 3 mulvar RANKPOINTSTEMP 6
		ifvare MISCARRAYID_AMOUNTTEMP 4 mulvar RANKPOINTSTEMP 7
		ifvare MISCARRAYID_AMOUNTTEMP 5 mulvar RANKPOINTSTEMP 8
		ifvare MISCARRAYID_AMOUNTTEMP 6 mulvar RANKPOINTSTEMP 9
		ifvare MISCARRAYID_AMOUNTTEMP 7 mulvar RANKPOINTSTEMP 10
		divvar RANKPOINTSTEMP 5
		state setexpranklimits
	
		setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-LEVEL
		ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar EXPPTSTEMP 20
		ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar EXPPTSTEMP 22
		ifvare MISCARRAYID_AMOUNTTEMP 3 mulvar EXPPTSTEMP 24
		ifvare MISCARRAYID_AMOUNTTEMP 4 mulvar EXPPTSTEMP 26
		ifvare MISCARRAYID_AMOUNTTEMP 5 mulvar EXPPTSTEMP 28
		ifvare MISCARRAYID_AMOUNTTEMP 6 mulvar EXPPTSTEMP 30
		ifvare MISCARRAYID_AMOUNTTEMP 7 mulvar EXPPTSTEMP 32
		ifvare MISCARRAYID_AMOUNTTEMP 8 mulvar EXPPTSTEMP 34
		ifvare MISCARRAYID_AMOUNTTEMP 9 mulvar EXPPTSTEMP 36
		ifvare MISCARRAYID_AMOUNTTEMP 10 mulvar EXPPTSTEMP 38
		ifvare MISCARRAYID_AMOUNTTEMP 11 mulvar EXPPTSTEMP 40
		ifvare MISCARRAYID_AMOUNTTEMP 12 mulvar EXPPTSTEMP 42
		ifvare MISCARRAYID_AMOUNTTEMP 13 mulvar EXPPTSTEMP 44
		ifvare MISCARRAYID_AMOUNTTEMP 14 mulvar EXPPTSTEMP 46
		ifvare MISCARRAYID_AMOUNTTEMP 15 mulvar EXPPTSTEMP 48
		ifvare MISCARRAYID_AMOUNTTEMP 16 mulvar EXPPTSTEMP 50
		ifvare MISCARRAYID_AMOUNTTEMP 17 mulvar EXPPTSTEMP 52
		ifvare MISCARRAYID_AMOUNTTEMP 18 mulvar EXPPTSTEMP 54
		ifvare MISCARRAYID_AMOUNTTEMP 19 mulvar EXPPTSTEMP 56
		ifvare MISCARRAYID_AMOUNTTEMP 20 mulvar EXPPTSTEMP 58
		ifvare MISCARRAYID_AMOUNTTEMP 21 mulvar EXPPTSTEMP 60
		ifvare MISCARRAYID_AMOUNTTEMP 22 mulvar EXPPTSTEMP 62
		ifvare MISCARRAYID_AMOUNTTEMP 23 mulvar EXPPTSTEMP 64
		ifvare MISCARRAYID_AMOUNTTEMP 24 mulvar EXPPTSTEMP 66
		ifvare MISCARRAYID_AMOUNTTEMP 25 mulvar EXPPTSTEMP 68
		ifvare MISCARRAYID_AMOUNTTEMP 26 mulvar EXPPTSTEMP 70
		ifvare MISCARRAYID_AMOUNTTEMP 27 mulvar EXPPTSTEMP 72
		ifvare MISCARRAYID_AMOUNTTEMP 28 mulvar EXPPTSTEMP 74
		ifvare MISCARRAYID_AMOUNTTEMP 29 mulvar EXPPTSTEMP 76
		ifvare MISCARRAYID_AMOUNTTEMP 30 mulvar EXPPTSTEMP 78
		ifvare MISCARRAYID_AMOUNTTEMP 31 mulvar EXPPTSTEMP 80
		ifvare MISCARRAYID_AMOUNTTEMP 32 mulvar EXPPTSTEMP 82
		ifvare MISCARRAYID_AMOUNTTEMP 33 mulvar EXPPTSTEMP 84
		ifvare MISCARRAYID_AMOUNTTEMP 34 mulvar EXPPTSTEMP 86
		ifvare MISCARRAYID_AMOUNTTEMP 35 mulvar EXPPTSTEMP 88
		ifvare MISCARRAYID_AMOUNTTEMP 36 mulvar EXPPTSTEMP 90
		ifvare MISCARRAYID_AMOUNTTEMP 37 mulvar EXPPTSTEMP 92
		ifvare MISCARRAYID_AMOUNTTEMP 38 mulvar EXPPTSTEMP 94
		ifvare MISCARRAYID_AMOUNTTEMP 39 mulvar EXPPTSTEMP 96
		ifvare MISCARRAYID_AMOUNTTEMP 40 mulvar EXPPTSTEMP 98
		ifvare MISCARRAYID_AMOUNTTEMP 41 mulvar EXPPTSTEMP 100
		ifvare MISCARRAYID_AMOUNTTEMP 42 mulvar EXPPTSTEMP 102
		ifvare MISCARRAYID_AMOUNTTEMP 43 mulvar EXPPTSTEMP 104
		ifvare MISCARRAYID_AMOUNTTEMP 44 mulvar EXPPTSTEMP 106
		ifvare MISCARRAYID_AMOUNTTEMP 45 mulvar EXPPTSTEMP 108
		ifvare MISCARRAYID_AMOUNTTEMP 46 mulvar EXPPTSTEMP 110
		ifvare MISCARRAYID_AMOUNTTEMP 47 mulvar EXPPTSTEMP 112
		ifvare MISCARRAYID_AMOUNTTEMP 48 mulvar EXPPTSTEMP 114
		ifvare MISCARRAYID_AMOUNTTEMP 49 mulvar EXPPTSTEMP 116
		ifvare MISCARRAYID_AMOUNTTEMP 50 mulvar EXPPTSTEMP 118
		ifvare MISCARRAYID_AMOUNTTEMP 51 mulvar EXPPTSTEMP 120
		ifvare MISCARRAYID_AMOUNTTEMP 52 mulvar EXPPTSTEMP 122
		ifvare MISCARRAYID_AMOUNTTEMP 53 mulvar EXPPTSTEMP 124
		ifvare MISCARRAYID_AMOUNTTEMP 54 mulvar EXPPTSTEMP 126
		ifvare MISCARRAYID_AMOUNTTEMP 55 mulvar EXPPTSTEMP 128
		ifvare MISCARRAYID_AMOUNTTEMP 56 mulvar EXPPTSTEMP 130
		ifvare MISCARRAYID_AMOUNTTEMP 57 mulvar EXPPTSTEMP 132
		ifvare MISCARRAYID_AMOUNTTEMP 58 mulvar EXPPTSTEMP 134
		ifvare MISCARRAYID_AMOUNTTEMP 59 mulvar EXPPTSTEMP 136
		ifvare MISCARRAYID_AMOUNTTEMP 60 mulvar EXPPTSTEMP 138
		ifvare MISCARRAYID_AMOUNTTEMP 61 mulvar EXPPTSTEMP 140
		ifvare MISCARRAYID_AMOUNTTEMP 62 mulvar EXPPTSTEMP 142
		ifvare MISCARRAYID_AMOUNTTEMP 63 mulvar EXPPTSTEMP 144
		divvar EXPPTSTEMP 20
		state setexpranklimits
	
		setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-LEVEL
		ifvare MISCARRAYID_AMOUNTTEMP 1 mulvar RANKPOINTSTEMP 20
		ifvare MISCARRAYID_AMOUNTTEMP 2 mulvar RANKPOINTSTEMP 21
		ifvare MISCARRAYID_AMOUNTTEMP 3 mulvar RANKPOINTSTEMP 22
		ifvare MISCARRAYID_AMOUNTTEMP 4 mulvar RANKPOINTSTEMP 23
		ifvare MISCARRAYID_AMOUNTTEMP 5 mulvar RANKPOINTSTEMP 24
		ifvare MISCARRAYID_AMOUNTTEMP 6 mulvar RANKPOINTSTEMP 25
		ifvare MISCARRAYID_AMOUNTTEMP 7 mulvar RANKPOINTSTEMP 26
		ifvare MISCARRAYID_AMOUNTTEMP 8 mulvar RANKPOINTSTEMP 27
		ifvare MISCARRAYID_AMOUNTTEMP 9 mulvar RANKPOINTSTEMP 28
		ifvare MISCARRAYID_AMOUNTTEMP 10 mulvar RANKPOINTSTEMP 29
		ifvare MISCARRAYID_AMOUNTTEMP 11 mulvar RANKPOINTSTEMP 30
		ifvare MISCARRAYID_AMOUNTTEMP 12 mulvar RANKPOINTSTEMP 31
		ifvare MISCARRAYID_AMOUNTTEMP 13 mulvar RANKPOINTSTEMP 32
		ifvare MISCARRAYID_AMOUNTTEMP 14 mulvar RANKPOINTSTEMP 33
		ifvare MISCARRAYID_AMOUNTTEMP 15 mulvar RANKPOINTSTEMP 34
		ifvare MISCARRAYID_AMOUNTTEMP 16 mulvar RANKPOINTSTEMP 35
		ifvare MISCARRAYID_AMOUNTTEMP 17 mulvar RANKPOINTSTEMP 36
		ifvare MISCARRAYID_AMOUNTTEMP 18 mulvar RANKPOINTSTEMP 37
		ifvare MISCARRAYID_AMOUNTTEMP 19 mulvar RANKPOINTSTEMP 38
		ifvare MISCARRAYID_AMOUNTTEMP 20 mulvar RANKPOINTSTEMP 39
		ifvare MISCARRAYID_AMOUNTTEMP 21 mulvar RANKPOINTSTEMP 40
		ifvare MISCARRAYID_AMOUNTTEMP 22 mulvar RANKPOINTSTEMP 41
		ifvare MISCARRAYID_AMOUNTTEMP 23 mulvar RANKPOINTSTEMP 42
		ifvare MISCARRAYID_AMOUNTTEMP 24 mulvar RANKPOINTSTEMP 43
		ifvare MISCARRAYID_AMOUNTTEMP 25 mulvar RANKPOINTSTEMP 44
		ifvare MISCARRAYID_AMOUNTTEMP 26 mulvar RANKPOINTSTEMP 45
		ifvare MISCARRAYID_AMOUNTTEMP 27 mulvar RANKPOINTSTEMP 46
		ifvare MISCARRAYID_AMOUNTTEMP 28 mulvar RANKPOINTSTEMP 47
		ifvare MISCARRAYID_AMOUNTTEMP 29 mulvar RANKPOINTSTEMP 48
		ifvare MISCARRAYID_AMOUNTTEMP 30 mulvar RANKPOINTSTEMP 49
		ifvare MISCARRAYID_AMOUNTTEMP 31 mulvar RANKPOINTSTEMP 50
		ifvare MISCARRAYID_AMOUNTTEMP 32 mulvar RANKPOINTSTEMP 51
		ifvare MISCARRAYID_AMOUNTTEMP 33 mulvar RANKPOINTSTEMP 52
		ifvare MISCARRAYID_AMOUNTTEMP 34 mulvar RANKPOINTSTEMP 53
		ifvare MISCARRAYID_AMOUNTTEMP 35 mulvar RANKPOINTSTEMP 54
		ifvare MISCARRAYID_AMOUNTTEMP 36 mulvar RANKPOINTSTEMP 55
		ifvare MISCARRAYID_AMOUNTTEMP 37 mulvar RANKPOINTSTEMP 56
		ifvare MISCARRAYID_AMOUNTTEMP 38 mulvar RANKPOINTSTEMP 57
		ifvare MISCARRAYID_AMOUNTTEMP 39 mulvar RANKPOINTSTEMP 58
		ifvare MISCARRAYID_AMOUNTTEMP 40 mulvar RANKPOINTSTEMP 59
		ifvare MISCARRAYID_AMOUNTTEMP 41 mulvar RANKPOINTSTEMP 60
		ifvare MISCARRAYID_AMOUNTTEMP 42 mulvar RANKPOINTSTEMP 61
		ifvare MISCARRAYID_AMOUNTTEMP 43 mulvar RANKPOINTSTEMP 62
		ifvare MISCARRAYID_AMOUNTTEMP 44 mulvar RANKPOINTSTEMP 63
		ifvare MISCARRAYID_AMOUNTTEMP 45 mulvar RANKPOINTSTEMP 64
		ifvare MISCARRAYID_AMOUNTTEMP 46 mulvar RANKPOINTSTEMP 65
		ifvare MISCARRAYID_AMOUNTTEMP 47 mulvar RANKPOINTSTEMP 66
		ifvare MISCARRAYID_AMOUNTTEMP 48 mulvar RANKPOINTSTEMP 67
		ifvare MISCARRAYID_AMOUNTTEMP 49 mulvar RANKPOINTSTEMP 68
		ifvare MISCARRAYID_AMOUNTTEMP 50 mulvar RANKPOINTSTEMP 69
		ifvare MISCARRAYID_AMOUNTTEMP 51 mulvar RANKPOINTSTEMP 70
		ifvare MISCARRAYID_AMOUNTTEMP 52 mulvar RANKPOINTSTEMP 71
		ifvare MISCARRAYID_AMOUNTTEMP 53 mulvar RANKPOINTSTEMP 72
		ifvare MISCARRAYID_AMOUNTTEMP 54 mulvar RANKPOINTSTEMP 73
		ifvare MISCARRAYID_AMOUNTTEMP 55 mulvar RANKPOINTSTEMP 74
		ifvare MISCARRAYID_AMOUNTTEMP 56 mulvar RANKPOINTSTEMP 75
		ifvare MISCARRAYID_AMOUNTTEMP 57 mulvar RANKPOINTSTEMP 76
		ifvare MISCARRAYID_AMOUNTTEMP 58 mulvar RANKPOINTSTEMP 77
		ifvare MISCARRAYID_AMOUNTTEMP 59 mulvar RANKPOINTSTEMP 78
		ifvare MISCARRAYID_AMOUNTTEMP 60 mulvar RANKPOINTSTEMP 79
		ifvare MISCARRAYID_AMOUNTTEMP 61 mulvar RANKPOINTSTEMP 80
		ifvare MISCARRAYID_AMOUNTTEMP 62 mulvar RANKPOINTSTEMP 81
		ifvare MISCARRAYID_AMOUNTTEMP 63 mulvar RANKPOINTSTEMP 82
		divvar RANKPOINTSTEMP 20
		state setexpranklimits
	
		setvar MISCARRAYID 80 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-EPISODE
		setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // DISPLAY-LEVEL
		ifvare MISCARRAYID_AMOUNTTEMP 1 ifvare MISCARRAYID_AMOUNTTEMP2 8 { mulvar EXPPTSTEMP 4 divvar EXPPTSTEMP 3 mulvar RANKPOINTSTEMP 4 divvar RANKPOINTSTEMP 3 } // EXP: 1.33x, RANK: 1.33x
		state setexpranklimits
	}
	else // "Final Modes" calculated based on a single "Map #", similar to a Doom 2 format.
	{
		setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // DISPLAY-LEVEL
		ifvarl MISCARRAYID_AMOUNTTEMP2 1 { setvar EXPPTSTEMP 0 setvar RANKPOINTSTEMP 0 break } // Being in Prolouge Levels Prevents EXP/Rank Gains.
		else
		{
			setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // DISPLAY-LEVEL
			setvarvar TEMPVAR4 MISCARRAYID_AMOUNTTEMP2
			mulvar TEMPVAR4 10
			setvarvar TEMPVAR3 SKILLLEVEL
			addvar TEMPVAR3 1
			divvar TEMPVAR3 2
			divvarvar TEMPVAR4 TEMPVAR3
			ifvarl TEMPVAR4 0 setvar TEMPVAR4 0
			addvar TEMPVAR4 200
			ifvare SKILLLEVEL 0 subvar TEMPVAR4 0
			ifvare SKILLLEVEL 1 subvar TEMPVAR4 11
			ifvare SKILLLEVEL 2 subvar TEMPVAR4 22
			ifvare SKILLLEVEL 3 subvar TEMPVAR4 33
			ifvare SKILLLEVEL 4 subvar TEMPVAR4 44
			ifvare SKILLLEVEL 5 subvar TEMPVAR4 56
			ifvare SKILLLEVEL 6 subvar TEMPVAR4 67
			ifvare SKILLLEVEL 7 subvar TEMPVAR4 78
			ifvare SKILLLEVEL 8 subvar TEMPVAR4 89
			ifvare SKILLLEVEL 9 subvar TEMPVAR4 100
		
			mulvarvar EXPPTSTEMP TEMPVAR4
			divvar EXPPTSTEMP 100
			mulvarvar RANKPOINTSTEMP TEMPVAR4
			divvar RANKPOINTSTEMP 100
			state setexpranklimits
		}
	}
	
	ifvare CHARACTERSELECTED? 6 { mulvar RANKPOINTSTEMP 11 divvar RANKPOINTSTEMP 8 } // ESSence gets 37.5% more RANK
	ifvare CHARACTERSELECTED? 7 { mulvar RANKPOINTSTEMP 3 divvar RANKPOINTSTEMP 2 } // Ted gets 50% more RANK
	ifvare CHARACTERSELECTED? 11 { mulvar RANKPOINTSTEMP 5 divvar RANKPOINTSTEMP 4 } // Paula gets 25% more RANK
	ifvare CHARACTERSELECTED? 15 { mulvar RANKPOINTSTEMP 5 divvar RANKPOINTSTEMP 4 } // Maken gets 25% more RANK
	state setexpranklimits
	
	// Support System
	setvar DAMAGEMODIFIER 100
	state support-rankbonus
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	ifvarg DAMAGEMODIFIER 1000 setvar DAMAGEMODIFIER 1000
	mulvarvar RANKPOINTSTEMP DAMAGEMODIFIER
	divvar RANKPOINTSTEMP 100
	state setexpranklimits
	
	// Equippables
	setvar TEMP3 0
	ifvare PLAYEREQUIPSLOTITEM1 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM2 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM3 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM4 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM5 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM6 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM7 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM8 8 addvar TEMP3 2 // Rank Badge
	ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvarg TEMP3 0 mulvarvar RANKPOINTSTEMP TEMP3
	state setexpranklimits
	
	//***************************************************************
	//*Increases the Experience Multiplier for Higher Level Monsters*
	//***************************************************************
	setvarvar ACTORLEVELEXPCALC ACTORLEVEL
	ifvare PUBLICBETA? 0
	{
		ifvarg ACTORLEVEL 0 ifvarl ACTORLEVEL 11 mulvar ACTORLEVELEXPCALC 12 // Light Blue Star
		else ifvarg ACTORLEVEL 10 ifvarl ACTORLEVEL 21 mulvar ACTORLEVELEXPCALC 19 // Dark Blue Star
		else ifvarg ACTORLEVEL 20 ifvarl ACTORLEVEL 31 mulvar ACTORLEVELEXPCALC 27 // Light Green Star
		else ifvarg ACTORLEVEL 30 ifvarl ACTORLEVEL 41 mulvar ACTORLEVELEXPCALC 36 // Dark Green Star
		else ifvarg ACTORLEVEL 40 ifvarl ACTORLEVEL 51 mulvar ACTORLEVELEXPCALC 46 // White Star
		else ifvarg ACTORLEVEL 50 ifvarl ACTORLEVEL 61 mulvar ACTORLEVELEXPCALC 57 // Gray Star
		else ifvarg ACTORLEVEL 60 ifvarl ACTORLEVEL 71 mulvar ACTORLEVELEXPCALC 69 // Gold Star
		else ifvarg ACTORLEVEL 70 ifvarl ACTORLEVEL 81 mulvar ACTORLEVELEXPCALC 82 // Copper Star
		else ifvarg ACTORLEVEL 80 ifvarl ACTORLEVEL 91 mulvar ACTORLEVELEXPCALC 96 // Light Red Star
		else ifvarg ACTORLEVEL 90 ifvarl ACTORLEVEL 100 mulvar ACTORLEVELEXPCALC 111 // Dark Red Star
		else ifvare ACTORLEVEL 100 mulvar ACTORLEVELEXPCALC 143 // Night-Vision Star
	}
	else
	{
		ifvarg ACTORLEVEL 0 ifvarl ACTORLEVEL 11 mulvar ACTORLEVELEXPCALC 11 // Light Blue Star
		else ifvarg ACTORLEVEL 10 ifvarl ACTORLEVEL 21 mulvar ACTORLEVELEXPCALC 17 // Dark Blue Star
		else ifvarg ACTORLEVEL 20 ifvarl ACTORLEVEL 31 mulvar ACTORLEVELEXPCALC 24 // Light Green Star
		else ifvarg ACTORLEVEL 30 ifvarl ACTORLEVEL 41 mulvar ACTORLEVELEXPCALC 32 // Dark Green Star
		else ifvarg ACTORLEVEL 40 ifvarl ACTORLEVEL 51 mulvar ACTORLEVELEXPCALC 41 // White Star
		else ifvarg ACTORLEVEL 50 ifvarl ACTORLEVEL 61 mulvar ACTORLEVELEXPCALC 50 // Gray Star
		else ifvarg ACTORLEVEL 60 ifvarl ACTORLEVEL 71 mulvar ACTORLEVELEXPCALC 60 // Gold Star
		else ifvarg ACTORLEVEL 70 ifvarl ACTORLEVEL 81 mulvar ACTORLEVELEXPCALC 71 // Copper Star
		else ifvarg ACTORLEVEL 80 ifvarl ACTORLEVEL 91 mulvar ACTORLEVELEXPCALC 83 // Light Red Star
		else ifvarg ACTORLEVEL 90 ifvarl ACTORLEVEL 100 mulvar ACTORLEVELEXPCALC 96 // Dark Red Star
		else ifvare ACTORLEVEL 100 mulvar ACTORLEVELEXPCALC 124 // Night-Vision Star
	}
	divvar ACTORLEVELEXPCALC 5 // 10
	addvar ACTORLEVELEXPCALC 100
	mulvarvar EXPPTSTEMP ACTORLEVELEXPCALC
	divvar EXPPTSTEMP 100
	state setexpranklimits
	
	//*********************************************************************************************
	//*Determines a Bonus/Handicap to EXP gain by comparing the Monster's Level to the Character's*
	//*********************************************************************************************
	setvarvar EXPFACTOR1 ACTORLEVEL
	ifvare PUBLICBETA? 0 { mulvar EXPFACTOR1 15 divvar EXPFACTOR1 4 } else { mulvar EXPFACTOR1 15 divvar EXPFACTOR1 2 } // 3.75 & 7.5
	setvarvar EXPFACTOR2 PLAYERLEVEL
	divvarvar EXPFACTOR1 EXPFACTOR2
	
	ifvarl EXPFACTOR1 1 setvar EXPFACTOR1 1
	ifvarg EXPFACTOR1 250 setvar EXPFACTOR1 250
	
	mulvarvar EXPPTSTEMP EXPFACTOR1      
	ifvare PUBLICBETA? 0 
	{
		randvar TEMPVAR 2
		ifrnd 128 mulvar TEMPVAR -1
		addvar TEMPVAR 10
		divvarvar EXPPTSTEMP TEMPVAR // divide by a random 8 to 12
	}
	else divvar EXPPTSTEMP 10 // divide by 10
	state setexpranklimits
	
	//*******************************************
	//*Elite Monsters Octuple EXP and Rank Gains*
	//*******************************************
	
	ifvarand ACTORFLAGS 512
	{
		mulvar EXPPTSTEMP 8
		mulvar RANKPOINTSTEMP 8
	}
	state setexpranklimits
	
	//***************************************************
	//*"Boss" Monsters Double-Octuple EXP and Rank Gains*
	//***************************************************
	
	ifvarand ACTORFLAGS 1024
	{
		mulvar EXPPTSTEMP 16
		mulvar RANKPOINTSTEMP 16
	}
	state setexpranklimits
	
	//**********************************************************
	//*"Shrunken" Monsters Divide EXP and Rank Gains by 5 times*
	//**********************************************************
	
	ifvare SHRUNK? 1
	{
		setvar TEMPVAR2 0
		ifactor FEM1 setvar TEMPVAR2 1
		ifactor FEM2 setvar TEMPVAR2 1
		ifactor FEM3 setvar TEMPVAR2 1
		ifactor FEM4 setvar TEMPVAR2 1
		ifactor FEM5 setvar TEMPVAR2 1
		ifactor FEM6 setvar TEMPVAR2 1
		ifactor FEM7 setvar TEMPVAR2 1
		ifactor FEM8 setvar TEMPVAR2 1
		ifactor FEM9 setvar TEMPVAR2 1
		ifactor FEM10 setvar TEMPVAR2 1
		ifactor ROBOTDOG setvar TEMPVAR2 2
		ifactor ROBOTDOG2 setvar TEMPVAR2 2
		ifactor TOUGHGAL setvar TEMPVAR2 2
		ifactor NAKED1 setvar TEMPVAR2 1
		ifactor PODFEM1 setvar TEMPVAR2 1
		ifactor DANCE1 setvar TEMPVAR2 3
		ifactor DANCE2 setvar TEMPVAR2 3
		ifactor DANCE3 setvar TEMPVAR2 3
		ifactor DANCE5 setvar TEMPVAR2 3
		ifactor DANCE6 setvar TEMPVAR2 3
		ifactor DANCE7 setvar TEMPVAR2 3
		ifactor DANCE9 setvar TEMPVAR2 3
		ifactor STAND1 setvar TEMPVAR2 3
		ifactor DEALER setvar TEMPVAR2 3
		ifactor STAND3 setvar TEMPVAR2 3
		ifactor STAND4 setvar TEMPVAR2 3
		ifactor WOLFDUDE setvar TEMPVAR2 3
		ifactor PUNKDUDE setvar TEMPVAR2 3
		ifactor COP1 setvar TEMPVAR2 3
		ifactor COP2 setvar TEMPVAR2 3
		ifactor SITTINGDUDE setvar TEMPVAR2 3
		ifactor ANIMEGIRL1 setvar TEMPVAR2 3
		ifactor ANIMEGIRL2 setvar TEMPVAR2 3
		ifactor ANIMEGIRL3 setvar TEMPVAR2 3
		ifactor ANIMEGIRL4 setvar TEMPVAR2 3
	
		ifvarg TEMPVAR2 0 ifvarl TEMPVAR2 4
		{
			mulvar EXPPTSTEMP 5
			mulvar RANKPOINTSTEMP 5
		
			ifvarn EXPPTSTEMP 0 setvar EXPPTSTEMP 0
			ifvarg RANKPOINTSTEMP -1 setvar RANKPOINTSTEMP -1
		}
		else
		{
			divvar EXPPTSTEMP 5
			divvar RANKPOINTSTEMP 5
		
			ifvarl EXPPTSTEMP 1 setvar EXPPTSTEMP 1
			ifvarl RANKPOINTSTEMP 1 setvar RANKPOINTSTEMP 1
		}
	}
	state setexpranklimits
	
	//***************************************************************
	//*Game Mode Decides If EXP and Rank will be reduced by 10 times*
	//***************************************************************
	ifvare PUBLICBETA? 0
	{
		divvar EXPPTSTEMP 8
		divvar RANKPOINTSTEMP 8
	}
	else
	{
		mulvar EXPPTSTEMP 3 divvar EXPPTSTEMP 4
		mulvar RANKPOINTSTEMP 3 divvar RANKPOINTSTEMP 4
	}
	state setexpranklimits
	
	//***********************************************************************
	//*Divide EXP among the number of people in your group[and people alive]*
	//***********************************************************************
	ifvarg EXPPTSTEMP 0
	{
		setvar TEMPVAR 0
		ifvare DUKE? 1 { setvar CHARACTERARRAY 1 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare JACK? 1 { setvar CHARACTERARRAY 2 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare BUBSY? 1 { setvar CHARACTERARRAY 3 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare AMI? 1 { setvar CHARACTERARRAY 4 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare LOWANG? 1 { setvar CHARACTERARRAY 5 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare ESSENCE? 1 { setvar CHARACTERARRAY 6 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare TED? 1 { setvar CHARACTERARRAY 7 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare LISA? 1 { setvar CHARACTERARRAY 8 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare CYBANIS? 1 { setvar CHARACTERARRAY 9 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare NETHRA? 1 { setvar CHARACTERARRAY 10 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare PAULA? 1 { setvar CHARACTERARRAY 11 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare LORI? 1 { setvar CHARACTERARRAY 12 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare MINAKO? 1 { setvar CHARACTERARRAY 13 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare MYSTERY1? 1 { setvar CHARACTERARRAY 14 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
		ifvare MAKEN? 1 { setvar CHARACTERARRAY 15 ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0 addvar TEMPVAR 1 }
	
		ifvare PUBLICBETA? 1
		{
			ifvare TEMPVAR 1 divvar EXPPTSTEMP 1
			ifvare TEMPVAR 2 divvar EXPPTSTEMP 1
			ifvare TEMPVAR 3 divvar EXPPTSTEMP 2
			ifvare TEMPVAR 4 divvar EXPPTSTEMP 2
			ifvare TEMPVAR 5 divvar EXPPTSTEMP 2
			ifvare TEMPVAR 6 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 7 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 8 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 9 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 10 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 11 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 12 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 13 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 14 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 15 divvar EXPPTSTEMP 5
		}
		else
		{
			ifvare TEMPVAR 1 divvar EXPPTSTEMP 1
			ifvare TEMPVAR 2 divvar EXPPTSTEMP 1
			ifvare TEMPVAR 3 divvar EXPPTSTEMP 1
			ifvare TEMPVAR 4 divvar EXPPTSTEMP 2
			ifvare TEMPVAR 5 divvar EXPPTSTEMP 2
			ifvare TEMPVAR 6 divvar EXPPTSTEMP 2
			ifvare TEMPVAR 7 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 8 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 9 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 10 divvar EXPPTSTEMP 3
			ifvare TEMPVAR 11 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 12 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 13 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 14 divvar EXPPTSTEMP 4
			ifvare TEMPVAR 15 divvar EXPPTSTEMP 4
		}
		state setexpranklimits
	}
	
	//***********************************************
	//*Always Gain at least the enemy's Level in EXP*
	//***********************************************
	setvarvar TEMPVAR ACTORLEVEL
	ifvare PUBLICBETA? 0 { mulvar TEMPVAR 3 divvar TEMPVAR 4 }
	ifvarg ACTORLEVEL 0 { ifvarvarl EXPPTSTEMP TEMPVAR setvarvar EXPPTSTEMP TEMPVAR }
	
	setvar MISCARRAYID 85 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FOUND-A-SECRET
	ifvare MISCARRAYID_AMOUNTTEMP 1
	{
		ifvare RANKPOINTSTEMP 0 setvar RANKPOINTSTEMP 1
		setvar MISCARRAYID 85 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // FOUND-A-SECRET
	}
	state setexpranklimits
	
	state checkrarepiratedoubloons
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	
	setvarvar TEMP7 RANKPOINTSTEMP
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	addvarvar RANKPOINTSTEMP TEMP7
	
	state checkrarepiratedoubloons
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	addvar TEMP6 100
	
	setvar TEMP7 2000000
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	
	ifvarl EXPPTSTEMP 0 setvar EXPPTSTEMP 0
	ifvarg EXPPTSTEMP 9163600 setvar EXPPTSTEMP 9163600
	ifvarl RANKPOINTSTEMP -2000000 setvar RANKPOINTSTEMP -2000000
	ifvarvarg RANKPOINTSTEMP TEMP7 setvarvar RANKPOINTSTEMP TEMP7
	
	ifvarn RANKPOINTSTEMP 0 { setvarvar DISPLAYRANKPOINTS RANKPOINTSTEMP setvar RANKDISPLAYTIMER 0 }
ends


state inactiveexp_checkdoubloons
	state checkrarepiratedoubloons
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	setvarvar TEMP7 INACTIVEXPPTSTEMP
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	addvarvar INACTIVEXPPTSTEMP TEMP7
	
	state checkrarepiratedoubloons
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	addvar TEMP6 100
	setvar TEMP7 9163600
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	
	ifvarl INACTIVEXPPTSTEMP 0 setvar INACTIVEXPPTSTEMP 0
	ifvarvarg INACTIVEXPPTSTEMP TEMP7 setvarvar INACTIVEXPPTSTEMP TEMP7
ends


state exp_checksupportequip
	setvar DAMAGEMODIFIER 100
	// Support System
	ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTJACK 0 addvar DAMAGEMODIFIER 4 // "C" Support w/ Jack
	ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTJACK 1 addvar DAMAGEMODIFIER 6 // "B" Support w/ Jack
	ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTJACK 2 addvar DAMAGEMODIFIER 9 // "A" Support w/ Jack
	ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTJACK 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Jack
	ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTJACK 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Jack
	
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	ifvarg DAMAGEMODIFIER 234 setvar DAMAGEMODIFIER 234
	mulvarvar INACTIVEXPPTSTEMP DAMAGEMODIFIER
	divvar INACTIVEXPPTSTEMP 100
	ifvarl INACTIVEXPPTSTEMP 0 setvar INACTIVEXPPTSTEMP 0
	ifvarg INACTIVEXPPTSTEMP 9163600 setvar INACTIVEXPPTSTEMP 9163600
	
	// Equippables
	setvar TEMP3 0
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 7 addvar TEMP3 2 // EXP Badge
	ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 28 addvar TEMP3 10 // Jewel of Four Souls
	
	ifvarg TEMP3 0 mulvarvar INACTIVEXPPTSTEMP TEMP3
	ifvarl INACTIVEXPPTSTEMP 0 setvar INACTIVEXPPTSTEMP 0
	ifvarg INACTIVEXPPTSTEMP 9163600 setvar INACTIVEXPPTSTEMP 9163600
	
	state inactiveexp_checkdoubloons
	
	getactorvar[CHARACTERARRAY].CHARACTEREXPPTS temp
	addvarvar temp INACTIVEXPPTSTEMP
	ifvarl temp 0 setvar temp 0
	ifvarg temp 9163600 setvar temp 9163600
	setactorvar[CHARACTERARRAY].CHARACTEREXPPTS temp
ends

state exp_given
	addvarvar RANKPOINTS RANKPOINTSTEMP
	
	// New Segment for full-party EXP Gain here
	ifvarg EXPPTSTEMP 0
	{
		setvarvar TEMPVAR EXPPTSTEMP
		// This is the % factor of EXP. This is subject to change, and will likely be based on skill-level
		ifvare PUBLICBETA? 0
		{
			ifvare SKILLLEVEL 0 mulvar TEMPVAR 60
			ifvare SKILLLEVEL 1 mulvar TEMPVAR 57
			ifvare SKILLLEVEL 2 mulvar TEMPVAR 55
			ifvare SKILLLEVEL 3 mulvar TEMPVAR 52
			ifvare SKILLLEVEL 4 mulvar TEMPVAR 50
			ifvare SKILLLEVEL 5 mulvar TEMPVAR 50
			ifvare SKILLLEVEL 6 mulvar TEMPVAR 48
			ifvare SKILLLEVEL 7 mulvar TEMPVAR 45
			ifvare SKILLLEVEL 8 mulvar TEMPVAR 43
			ifvare SKILLLEVEL 9 mulvar TEMPVAR 40
		}
		else
		{
			ifvare SKILLLEVEL 0 mulvar TEMPVAR 70
			ifvare SKILLLEVEL 1 mulvar TEMPVAR 65
			ifvare SKILLLEVEL 2 mulvar TEMPVAR 60
			ifvare SKILLLEVEL 3 mulvar TEMPVAR 55
			ifvare SKILLLEVEL 4 mulvar TEMPVAR 50
			ifvare SKILLLEVEL 5 mulvar TEMPVAR 50
			ifvare SKILLLEVEL 6 mulvar TEMPVAR 45
			ifvare SKILLLEVEL 7 mulvar TEMPVAR 40
			ifvare SKILLLEVEL 8 mulvar TEMPVAR 35
			ifvare SKILLLEVEL 9 mulvar TEMPVAR 30
		}
		// End % factors
		divvar TEMPVAR 100
		ifvarl TEMPVAR 1 setvar TEMPVAR 1
		ifvarg TEMPVAR 9163600 setvar TEMPVAR 9163600
	
		// This is the % factor of EXP. This is subject to change, and will likely be based on skill-level
		ifvarg PARTYSIZE 1
		{
			ifvarg PARTYALIVE 1
			{
				ifvare PUBLICBETA? 0
				{
					ifvare SKILLLEVEL 0 mulvar EXPPTSTEMP 140
					ifvare SKILLLEVEL 1 mulvar EXPPTSTEMP 143
					ifvare SKILLLEVEL 2 mulvar EXPPTSTEMP 145
					ifvare SKILLLEVEL 3 mulvar EXPPTSTEMP 148
					ifvare SKILLLEVEL 4 mulvar EXPPTSTEMP 150
					ifvare SKILLLEVEL 5 mulvar EXPPTSTEMP 150
					ifvare SKILLLEVEL 6 mulvar EXPPTSTEMP 152
					ifvare SKILLLEVEL 7 mulvar EXPPTSTEMP 155
					ifvare SKILLLEVEL 8 mulvar EXPPTSTEMP 157
					ifvare SKILLLEVEL 9 mulvar EXPPTSTEMP 160
				}
				else
				{
					ifvare SKILLLEVEL 0 mulvar EXPPTSTEMP 130
					ifvare SKILLLEVEL 1 mulvar EXPPTSTEMP 135
					ifvare SKILLLEVEL 2 mulvar EXPPTSTEMP 140
					ifvare SKILLLEVEL 3 mulvar EXPPTSTEMP 145
					ifvare SKILLLEVEL 4 mulvar EXPPTSTEMP 150
					ifvare SKILLLEVEL 5 mulvar EXPPTSTEMP 150
					ifvare SKILLLEVEL 6 mulvar EXPPTSTEMP 155
					ifvare SKILLLEVEL 7 mulvar EXPPTSTEMP 160
					ifvare SKILLLEVEL 8 mulvar EXPPTSTEMP 165
					ifvare SKILLLEVEL 9 mulvar EXPPTSTEMP 170
				}
				divvar EXPPTSTEMP 100
				ifvarl EXPPTSTEMP 1 setvar EXPPTSTEMP 1
				ifvarg EXPPTSTEMP 9163600 setvar EXPPTSTEMP 9163600
			}
		}
		// End % factors
	
		ifvare DUKE? 1
		{
			setvar CHARACTERARRAY 1
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 1
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				} 
			} 
		}
	
		ifvare JACK? 1 
		{
			setvar CHARACTERARRAY 2
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 2
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					mulvar INACTIVEXPPTSTEMP 5
					divvar INACTIVEXPPTSTEMP 4
			
					setvar DAMAGEMODIFIER 100
					// Support System
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTDUKE 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Duke
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTDUKE 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Duke
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTBUBSY 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Bubsy
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTBUBSY 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Bubsy
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTAMI 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Ami
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTAMI 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Ami
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTLOWANG 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Lo Wang
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTLOWANG 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Lo Wang
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTESSENCE 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ ESSence
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTESSENCE 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ ESSence
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTTED 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Ted
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTTED 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Ted
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTLISA 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Lisa
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTLISA 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Lisa
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTCYBANIS 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Cybanis
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTCYBANIS 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Cybanis
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTNETHRA 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Nethra
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTNETHRA 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Nethra
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTPAULA 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Paula
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTPAULA 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Paula
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTLORI 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Lori
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTLORI 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Lori
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTMINAKO 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Minako
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTMINAKO 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Minako
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTMYSTERY1 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ "Mystery Lady"
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTMYSTERY1 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ "Mystery Lady"
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTMAKEN 3 addvar DAMAGEMODIFIER 12 // "S" Support w/ Maken
					ifvarg actorvar[CHARACTERARRAY].CHARACTERSUPPORTMAKEN 4 addvar DAMAGEMODIFIER 36 // "*" Support w/ Maken
					ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
					ifvarg DAMAGEMODIFIER 234 setvar DAMAGEMODIFIER 234
					mulvarvar INACTIVEXPPTSTEMP DAMAGEMODIFIER
					divvar INACTIVEXPPTSTEMP 100
					ifvarl INACTIVEXPPTSTEMP 0 setvar INACTIVEXPPTSTEMP 0
					ifvarg INACTIVEXPPTSTEMP 9163600 setvar INACTIVEXPPTSTEMP 9163600
			
					// EXP Badge
					setvar TEMP3 0
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM1 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM2 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM3 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM4 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM5 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM6 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM7 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 7 addvar TEMP3 2 // EXP Badge
					ifvare actorvar[CHARACTERARRAY].CHARACTEREQUIPSLOTITEM8 28 addvar TEMP3 10 // Jewel of Four Souls
					ifvarg TEMP3 0 mulvarvar INACTIVEXPPTSTEMP TEMP3
					ifvarl INACTIVEXPPTSTEMP 0 setvar INACTIVEXPPTSTEMP 0
					ifvarg INACTIVEXPPTSTEMP 9163600 setvar INACTIVEXPPTSTEMP 9163600
			
					state inactiveexp_checkdoubloons
			
					getactorvar[CHARACTERARRAY].CHARACTEREXPPTS temp
					addvarvar temp INACTIVEXPPTSTEMP 
					ifvarl temp 0 setvar temp 0
					ifvarg temp 9163600 setvar temp 9163600
					setactorvar[CHARACTERARRAY].CHARACTEREXPPTS temp
				} 
			} 
		}
	
		ifvare BUBSY? 1 
		{ 
			setvar CHARACTERARRAY 3
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 3
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare AMI? 1
		{
			setvar CHARACTERARRAY 4
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 4
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare LOWANG? 1
		{
			setvar CHARACTERARRAY 5
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 5
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare ESSENCE? 1
		{
			setvar CHARACTERARRAY 6
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 6 
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare TED? 1
		{
			setvar CHARACTERARRAY 7
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 7
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				} 
			}
		}
	
		ifvare LISA? 1
		{
			setvar CHARACTERARRAY 8
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 8
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare CYBANIS? 1 
		{ 
			setvar CHARACTERARRAY 9
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{ 
				ifvarn CHARACTERSELECTED? 9 
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					mulvar INACTIVEXPPTSTEMP 11
					divvar INACTIVEXPPTSTEMP 8
					state exp_checksupportequip
				} 
			} 
		}
	
		ifvare NETHRA? 1
		{
			setvar CHARACTERARRAY 10
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 10 
				{ 
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare PAULA? 1
		{
			setvar CHARACTERARRAY 11
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 11 
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare LORI? 1 
		{
			setvar CHARACTERARRAY 12
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 12 
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					mulvar INACTIVEXPPTSTEMP 3
					divvar INACTIVEXPPTSTEMP 2
					state exp_checksupportequip
				} 
			} 
		}
	
		ifvare MINAKO? 1
		{
			setvar CHARACTERARRAY 13
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 13
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare MYSTERY1? 1
		{
			setvar CHARACTERARRAY 14
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 14 
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					state exp_checksupportequip
				}
			}
		}
	
		ifvare MAKEN? 1 
		{
			setvar CHARACTERARRAY 15
			ifvarg actorvar[CHARACTERARRAY].CHARACTERHP 0
			{
				ifvarn CHARACTERSELECTED? 15
				{
					setvarvar INACTIVEXPPTSTEMP TEMPVAR
					mulvar INACTIVEXPPTSTEMP 5
					divvar INACTIVEXPPTSTEMP 4
					state exp_checksupportequip
				} 
			} 
		}
	
	
	}
	// End full-party EXP Gain here
	
	ifvare CHARACTERSELECTED? 2 { mulvar EXPPTSTEMP 5 divvar EXPPTSTEMP 4 } // Jack gets 25% more EXP
	ifvare CHARACTERSELECTED? 9 { mulvar EXPPTSTEMP 11 divvar EXPPTSTEMP 8 } // Cybanis gets 37.5% more EXP
	ifvare CHARACTERSELECTED? 11
	{
		setvarvar TEMPVAR2 PARTYSIZE subvarvar TEMPVAR2 PARTYALIVE addvar TEMPVAR2 8
		ifvarl TEMPVAR2 8 setvar TEMPVAR2 8 // "Watch Over Me" Multiplies EXP Intake by 25% per dead character, up to a 287.5% EXP intake
		mulvarvar EXPPTSTEMP TEMPVAR2
		divvar EXPPTSTEMP 8     
	}
	ifvare CHARACTERSELECTED? 12 { mulvar EXPPTSTEMP 3 divvar EXPPTSTEMP 2 } // Lori gets 50% more EXP
	ifvare CHARACTERSELECTED? 15 { mulvar EXPPTSTEMP 5 divvar EXPPTSTEMP 4 } // Maken gets 25% more EXP
	
	// Support System
	setvar DAMAGEMODIFIER 100
	state support-expbonus-main
	ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
	ifvarg DAMAGEMODIFIER 234 setvar DAMAGEMODIFIER 234
	mulvarvar EXPPTSTEMP DAMAGEMODIFIER
	divvar EXPPTSTEMP 100
	ifvarl EXPPTSTEMP 0 setvar EXPPTSTEMP 0
	ifvarg EXPPTSTEMP 9163600 setvar EXPPTSTEMP 9163600
	
	// Equippables
	setvar TEMP3 0
	ifvare PLAYEREQUIPSLOTITEM1 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM2 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM3 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM4 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM5 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM6 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM7 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM8 7 addvar TEMP3 2 // EXP Badge
	ifvare PLAYEREQUIPSLOTITEM1 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM2 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM3 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM4 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM5 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM6 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM7 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvare PLAYEREQUIPSLOTITEM8 28 addvar TEMP3 10 // Jewel of Four Souls
	ifvarg TEMP3 0 mulvarvar EXPPTSTEMP TEMP3
	ifvarl EXPPTSTEMP 0 setvar EXPPTSTEMP 0
	ifvarg EXPPTSTEMP 9163600 setvar EXPPTSTEMP 9163600
	
	// Rare Pirate Doubloon
	state checkrarepiratedoubloons
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	setvarvar TEMP7 EXPPTSTEMP
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	addvarvar EXPPTSTEMP TEMP7
	
	state checkrarepiratedoubloons
	ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
	mulvar TEMP6 2 // 2% per item  
	addvar TEMP6 100
	setvar TEMP7 9163600
	mulvarvar TEMP7 TEMP6
	divvar TEMP7 100
	
	ifvarl EXPPTSTEMP 0 setvar EXPPTSTEMP 0
	ifvarvarg EXPPTSTEMP TEMP7 setvarvar EXPPTSTEMP TEMP7
	
	addvarvar EXPPTS EXPPTSTEMP 
	
	ifvarl EXPPTSTEMP 0 setvar EXPPTSTEMP 0
	ifvarg EXPPTSTEMP 9163600 setvar EXPPTSTEMP 9163600
	ifvarg EXPPTSTEMP 0
	{
		setvarvar DISPLAYEXPPOINTS EXPPTSTEMP
		setvarvar DISPLAYEXPPOINTSOTHERS TEMPVAR
	
		state checkrarepiratedoubloons
		ifvarvarg PARTYSIZE ITEMARRAYID_AMOUNTTEMP setvarvar TEMP6 ITEMARRAYID_AMOUNTTEMP else setvarvar TEMP6 PARTYSIZE
		mulvar TEMP6 2 // 2% per item  
		setvarvar TEMP7 DISPLAYEXPPOINTSOTHERS
		mulvarvar TEMP7 TEMP6
		divvar TEMP7 100
		addvarvar DISPLAYEXPPOINTSOTHERS TEMP7
	
		setvar EXPDISPLAYTIMER 0
	}
	
	setvar RANKPOINTSTEMP 0
	setvar EXPPTSTEMP 0
	setvar TEMPVAR 0
ends

state jibfood
	sound SQUISHED
	guts JIBS6 3
	killit
ends

state civjibs
	guts JIBS2 1
	guts JIBS3 2
	guts JIBS4 3
	guts JIBS5 2
ends

state prolougeendeffect
ends

state echeckquadtime
	ifvarg ACTORQUADTIME 0 sound QUADDAMAGE3
ends

state echeckvampiretime
	ifvarg ACTORVAMPIRETIME 0 sound SHOOT_VAMPIREITEM
ends

state fireshotgun_angleeffect
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot SHOTGUN ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state firechaingun_angleeffect
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot CHAINGUN ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state fireshotspark1_angleeffect
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot SHOTSPARK1 ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state firegrowspark_angleeffect
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot GROWSPARK ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state firecoolexplosion1_angleeffect
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot COOLEXPLOSION1 ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state firezapper1_angleeffect
	sound ZAPPER1_FIRE
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot ZAPPER1 ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state firezapper2_angleeffect
	sound ZAPPER2_FIRE
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot ZAPPER2 ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state firezapper3_angleeffect
	sound ZAPPER3_FIRE
	getactorvar[THISACTOR].ACTORANGLE TEMPVAR4 eshoot ZAPPER3 ifvarn RETURN -1 { setactorvar[RETURN].ACTORANGLE TEMPVAR4 }
ends

state pigshotgun
	state fireshotgun_angleeffect
	state fireshotgun_angleeffect
	state fireshotgun_angleeffect
	state fireshotgun_angleeffect
ends

state pigsargeattack1
	state echeckquadtime
	state echeckvampiretime
	sound PIG_ATTACK
	sound PIG_ATTACK
	sound PIG_ATTACK
	state pigshotgun
	state pigshotgun
	state pigshotgun
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE 192
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 10
	setactor[RETURN].yrepeat 10
	setactor[RETURN].extra 64
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE 96
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 15
	setactor[RETURN].yrepeat 15
	setactor[RETURN].extra 96
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE 0
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 20
	setactor[RETURN].yrepeat 20
	setactor[RETURN].extra 128
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE -96
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 15
	setactor[RETURN].yrepeat 15
	setactor[RETURN].extra 96
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE -192
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 10
	setactor[RETURN].yrepeat 10
	setactor[RETURN].extra 64
ends

state pigsargeattack2
	state echeckquadtime
	state echeckvampiretime
	sound PIG_ATTACK
	sound PIG_ATTACK
	sound PIG_ATTACK
	state pigshotgun
	state pigshotgun
	state pigshotgun
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE 128
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 10
	setactor[RETURN].yrepeat 10
	setactor[RETURN].extra 64
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE 64
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 15
	setactor[RETURN].yrepeat 15
	setactor[RETURN].extra 96         
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE 0
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 20
	setactor[RETURN].yrepeat 20
	setactor[RETURN].extra 128
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE -64
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 15
	setactor[RETURN].yrepeat 15
	setactor[RETURN].extra 96
	eshoot RPG // _NOAIM
	getactor[RETURN].ang ATTACKANGLE 
	addvar ATTACKANGLE -128
	setactor[RETURN].ang ATTACKANGLE 
	setactor[RETURN].xrepeat 10
	setactor[RETURN].yrepeat 10
	setactor[RETURN].extra 64
ends

state eggawards
	ifspritepal 9 nullop
	else
	{
		randvar RANKPOINTSTEMP EGGRANKPOINTSRAND 
		addvar RANKPOINTSTEMP EGGRANKPOINTSSOLID 
		randvar EXPPTSTEMP EGGEXPERIENCERAND
		addvar EXPPTSTEMP EGGEXPERIENCE
		state expmulti
		state exp_given
		addkills 1
		state resetenemytimers
	}
ends

state liztroopawards
	ifspritepal 11 nullop
	else ifspritepal 10 nullop
	else ifspritepal 14
	{
		randvar RANKPOINTSTEMP SHRINKTROOPRANKPOINTSRAND 
		addvar RANKPOINTSTEMP SHRINKTROOPRANKPOINTSSOLID 
		randvar EXPPTSTEMP SHRINKTROOPEXPERIENCERAND
		addvar EXPPTSTEMP SHRINKTROOPEXPERIENCE
	} 
	else ifspritepal 17
	{
		randvar RANKPOINTSTEMP ZERMANRANKPOINTSRAND 
		addvar RANKPOINTSTEMP ZERMANRANKPOINTSSOLID 
		randvar EXPPTSTEMP ZERMANEXPERIENCERAND
		addvar EXPPTSTEMP ZERMANEXPERIENCE
	} 
	else ifspritepal 19
	{
		randvar RANKPOINTSTEMP RAVAGERCAPTAINRANKPOINTSRAND 
		addvar RANKPOINTSTEMP RAVAGERCAPTAINRANKPOINTSSOLID 
		randvar EXPPTSTEMP RAVAGERCAPTAINEXPERIENCERAND
		addvar EXPPTSTEMP RAVAGERCAPTAINEXPERIENCE
	} 
	else ifspritepal 21
	{
		randvar RANKPOINTSTEMP CAPTAINRANKPOINTSRAND 
		addvar RANKPOINTSTEMP CAPTAINRANKPOINTSSOLID 
		randvar EXPPTSTEMP CAPTAINEXPERIENCERAND
		addvar EXPPTSTEMP CAPTAINEXPERIENCE
	} 
	else 
	{
		randvar RANKPOINTSTEMP TROOPRANKPOINTSRAND 
		addvar RANKPOINTSTEMP TROOPRANKPOINTSSOLID 
		randvar EXPPTSTEMP TROOPEXPERIENCERAND
		addvar EXPPTSTEMP TROOPEXPERIENCE
	}
	ifvare ACTORBOMBER? 1 ifpdistl 1780
	{
		randvar TEMPVAR 1
		addvar TEMPVAR 2
		mulvarvar EXPPTSTEMP TEMPVAR
	}
ends

state lizmanawards
	ifspritepal 9 nullop
	else ifspritepal 6
	{ 
		randvar RANKPOINTSTEMP BIOLIZRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BIOLIZRANKPOINTSSOLID 
		randvar EXPPTSTEMP BIOLIZEXPERIENCERAND
		addvar EXPPTSTEMP BIOLIZEXPERIENCE
	}
	else ifspritepal 19
	{ 
		randvar RANKPOINTSTEMP LASERLIZRANKPOINTSRAND 
		addvar RANKPOINTSTEMP LASERLIZRANKPOINTSSOLID 
		randvar EXPPTSTEMP LASERLIZEXPERIENCERAND
		addvar EXPPTSTEMP LASERLIZEXPERIENCE
	}
	else ifspritepal 17
	{ 
		randvar RANKPOINTSTEMP FERTANGRANKPOINTSRAND 
		addvar RANKPOINTSTEMP FERTANGRANKPOINTSSOLID 
		randvar EXPPTSTEMP FERTANGEXPERIENCERAND
		addvar EXPPTSTEMP FERTANGEXPERIENCE
	}
	else
	{ 
		randvar RANKPOINTSTEMP LIZRANKPOINTSRAND 
		addvar RANKPOINTSTEMP LIZRANKPOINTSSOLID 
		randvar EXPPTSTEMP LIZEXPERIENCERAND
		addvar EXPPTSTEMP LIZEXPERIENCE
	}
ends

// state droneawards
// ends

state octabrainawards
	ifspritepal 9 nullop
	else ifspritepal 14 
	{
		randvar RANKPOINTSTEMP OCTANINERANKPOINTSRAND 
		addvar RANKPOINTSTEMP OCTANINERANKPOINTSSOLID 
		randvar EXPPTSTEMP OCTANINEEXPERIENCE
		addvar EXPPTSTEMP OCTANINEEXPERIENCE
	}
	else 
	{
		randvar RANKPOINTSTEMP OCTARANKPOINTSRAND 
		addvar RANKPOINTSTEMP OCTARANKPOINTSSOLID 
		randvar EXPPTSTEMP OCTAEXPERIENCE
		addvar EXPPTSTEMP OCTAEXPERIENCE
	}
ends

state pigcopawards
	ifspritepal 9 nullop
	else ifspritepal 21
	{ 
		randvar RANKPOINTSTEMP PIGCAPTAINRANKPOINTSRAND 
		addvar RANKPOINTSTEMP PIGCAPTAINRANKPOINTSSOLID 
		randvar EXPPTSTEMP PIGCAPTAINEXPERIENCERAND
		addvar EXPPTSTEMP PIGCAPTAINEXPERIENCE
	}
	else ifspritepal 14
	{ 
		randvar RANKPOINTSTEMP PIGSARGEANTRANKPOINTSRAND 
		addvar RANKPOINTSTEMP PIGSARGEANTRANKPOINTSSOLID 
		randvar EXPPTSTEMP PIGSARGEANTEXPERIENCERAND
		addvar EXPPTSTEMP PIGSARGEANTEXPERIENCE
	}
	else ifspritepal 24
	{
		randvar RANKPOINTSTEMP RAMONERANKPOINTSRAND 
		addvar RANKPOINTSTEMP RAMONERANKPOINTSSOLID 
		randvar EXPPTSTEMP RAMONEEXPERIENCERAND
		addvar EXPPTSTEMP RAMONEEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP PIGCOPRANKPOINTSRAND 
		addvar RANKPOINTSTEMP PIGCOPRANKPOINTSSOLID 
		randvar EXPPTSTEMP PIGCOPEXPERIENCERAND
		addvar EXPPTSTEMP PIGCOPEXPERIENCE
	}
ends

state boss1awards
	ifspritepal 9 nullop
	else ifspritepal 10 nullop
	else ifspritepal 0 
	{
		randvar RANKPOINTSTEMP BOSS1RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS1RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS1EXPERIENCERAND
		addvar EXPPTSTEMP BOSS1EXPERIENCE
	}
	else ifspritepal 3
	{
		randvar RANKPOINTSTEMP BOSS1RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS1RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS1EXPERIENCERAND
		addvar EXPPTSTEMP BOSS1EXPERIENCE
	}
	else ifspritepal 24 
	{
		randvar RANKPOINTSTEMP BOSS1ESSRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS1ESSRANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS1ESSEXPERIENCERAND
		addvar EXPPTSTEMP BOSS1ESSEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP BOSS1PALRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS1PALRANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS1PALEXPERIENCERAND
		addvar EXPPTSTEMP BOSS1PALEXPERIENCE
	}
ends

state boss2awards
	ifspritepal 10 nullop
	else ifspritepal 0 
	{
		randvar RANKPOINTSTEMP BOSS2RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS2RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS2EXPERIENCERAND
		addvar EXPPTSTEMP BOSS2EXPERIENCE
	}
	else ifspritepal 3
	{
		randvar RANKPOINTSTEMP BOSS2RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS2RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS2EXPERIENCERAND
		addvar EXPPTSTEMP BOSS2EXPERIENCE
	}
	else ifspritepal 9 // Special Prolouge Boss should not give EXP, and triggers a special effect when he dies.
	{ 
		state prolougeendeffect
	}
	else ifspritepal 24 
	{
		randvar RANKPOINTSTEMP BOSS2MEGARANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS2MEGARANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS2MEGAEXPERIENCERAND
		addvar EXPPTSTEMP BOSS2MEGAEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP BOSS2PALRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS2PALRANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS2PALEXPERIENCERAND
		addvar EXPPTSTEMP BOSS2PALEXPERIENCE
	}
ends

state boss3awards
	ifspritepal 9 nullop
	else ifspritepal 10 nullop
	else ifspritepal 0 
	{
		randvar RANKPOINTSTEMP BOSS3RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS3RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS3EXPERIENCERAND
		addvar EXPPTSTEMP BOSS3EXPERIENCE
	}
	else ifspritepal 3
	{
		randvar RANKPOINTSTEMP BOSS3RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS3RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS3EXPERIENCERAND
		addvar EXPPTSTEMP BOSS3EXPERIENCE
	}
	else ifspritepal 24 
	{
		randvar RANKPOINTSTEMP BOSS3VOIDRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS3VOIDRANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS3VOIDEXPERIENCERAND
		addvar EXPPTSTEMP BOSS3VOIDEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP BOSS3PALRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS3PALRANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS3PALEXPERIENCERAND
		addvar EXPPTSTEMP BOSS3PALEXPERIENCE
	}
ends

state boss4awards
	ifspritepal 9 nullop
	else ifspritepal 10 nullop
	else ifspritepal 24
	{
		randvar RANKPOINTSTEMP BOSS4FAKERANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS4FAKERANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS4FAKEEXPERIENCERAND
		addvar EXPPTSTEMP BOSS4FAKEEXPERIENCE
	}
	else ifspritepal 0
	{
		randvar RANKPOINTSTEMP BOSS4RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS4RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS4EXPERIENCERAND
		addvar EXPPTSTEMP BOSS4EXPERIENCE
	}
	else ifspritepal 3
	{
		randvar RANKPOINTSTEMP BOSS4RANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS4RANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS4EXPERIENCERAND
		addvar EXPPTSTEMP BOSS4EXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP BOSS4PALRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BOSS4PALRANKPOINTSSOLID 
		randvar EXPPTSTEMP BOSS4PALEXPERIENCERAND
		addvar EXPPTSTEMP BOSS4PALEXPERIENCE
	} 
ends

state commanderawards
	ifspritepal 9 nullop
	else ifspritepal 14
	{
		randvar RANKPOINTSTEMP GENERALRANKPOINTSRAND 
		addvar RANKPOINTSTEMP GENERALRANKPOINTSSOLID 
		randvar EXPPTSTEMP GENERALEXPERIENCERAND
		addvar EXPPTSTEMP GENERALEXPERIENCE
	}
	else ifspritepal 25
	{
		randvar RANKPOINTSTEMP LEADERRANKPOINTSRAND 
		addvar RANKPOINTSTEMP LEADERRANKPOINTSSOLID 
		randvar EXPPTSTEMP LEADEREXPERIENCERAND
		addvar EXPPTSTEMP LEADEREXPERIENCE
	}
	else ifspritepal 24 
	{
		randvar RANKPOINTSTEMP BAALORANKPOINTSRAND 
		addvar RANKPOINTSTEMP BAALORANKPOINTSSOLID 
		randvar EXPPTSTEMP BAALOEXPERIENCERAND
		addvar EXPPTSTEMP BAALOEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP COMMANDERRANKPOINTSRAND 
		addvar RANKPOINTSTEMP COMMANDERRANKPOINTSSOLID 
		randvar EXPPTSTEMP COMMANDEREXPERIENCERAND
		addvar EXPPTSTEMP COMMANDEREXPERIENCE
	}
ends

// state tankawards
// ends

// state boss4awards
// ends

state newbeastawards
	ifspritepal 9 nullop
	else ifspritepal 17
	{
		randvar RANKPOINTSTEMP NEWBEAST2LRANKPOINTSRAND 
		addvar RANKPOINTSTEMP NEWBEAST2LRANKPOINTSSOLID 
		randvar EXPPTSTEMP NEWBEAST2LEXPERIENCERAND
		addvar EXPPTSTEMP NEWBEAST2LEXPERIENCE
	}
	else ifspritepal 20
	{
		randvar RANKPOINTSTEMP NEWBEAST2GRANKPOINTSRAND 
		addvar RANKPOINTSTEMP NEWBEAST2GRANKPOINTSSOLID 
		randvar EXPPTSTEMP NEWBEAST2GEXPERIENCERAND
		addvar EXPPTSTEMP NEWBEAST2GEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP NEWBEASTRANKPOINTSRAND 
		addvar RANKPOINTSTEMP NEWBEASTRANKPOINTSSOLID 
		randvar EXPPTSTEMP NEWBEASTEXPERIENCERAND
		addvar EXPPTSTEMP NEWBEASTEXPERIENCE
	}
ends

state sharkawards
	ifspritepal 24
	{
		randvar RANKPOINTSTEMP BLOODSHARKRANKPOINTSRAND 
		addvar RANKPOINTSTEMP BLOODSHARKRANKPOINTSSOLID 
		randvar EXPPTSTEMP BLOODSHARKEXPERIENCERAND
		addvar EXPPTSTEMP BLOODSHARKEXPERIENCE
	}
	else
	{
		randvar RANKPOINTSTEMP SHARKRANKPOINTSRAND 
		addvar RANKPOINTSTEMP SHARKRANKPOINTSSOLID 
		randvar EXPPTSTEMP SHARKEXPERIENCERAND
		addvar EXPPTSTEMP SHARKEXPERIENCE
	}
	state expmulti
ends

state invulnflash
	palfrom 32 64 64 64
ends

state nullflash
	palfrom 0 0 0 0
ends

state checkkillerofciv
	ifactor FEM10
	{
		setvar MISCARRAYID 18 // Civs Killed [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 2
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 19 // Civs Killed [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 2
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	}
	else
	{
		setvar MISCARRAYID 18 // Civs Killed [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 19 // Civs Killed [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	}
	
	ifvare TEMPVAR 3 setvarvar TEMP PLAYERID
	else getactor[THISACTOR].htowner TEMP
	ifvarvarn TEMP THISACTOR
	{
		ifvarvarn TEMP PLAYERID
		{
			ifactor FEM10 redefinequote 130 ^102 CIVILIANS WERE KILLED BY AN ENEMY!
			else redefinequote 130 ^10A CIVILIAN WAS KILLED BY AN ENEMY!
			setvarvar fta fta_normal setvar ftq 130
			divvar RANKPOINTSTEMP 6
		}
		else
		{
			ifactor FEM10 redefinequote 130 ^10YOU JUST KILLED 2 CIVILIANS, STUPID!
			else redefinequote 130 ^10YOU JUST KILLED A CIVILIAN, STUPID!
			setvarvar fta fta_normal setvar ftq 130
		}
	}
	else
	{
		ifactor FEM10 redefinequote 130 ^102 CIVILIANS JUST COMMITED SUICIDE...?
		else redefinequote 130 ^10A CIVILIAN JUST COMMITED SUICIDE...?
		setvarvar fta fta_normal setvar ftq 130
		setvar RANKPOINTSTEMP 0
	}
ends

state civiliankilled
	state civjibs
	randvar RANKPOINTSTEMP CIVILIANKILLRANKPOINTSRAND 
	addvar RANKPOINTSTEMP CIVILIANKILLRANKPOINTSSOLID 
	setvar TEMPVAR 1
	state checkkillerofciv
	state expmulti
	state exp_given
	state jibfood
	ifvarn ENEMYHASSHIKON? 0
	{
		espawn SHIKONJEWEL
		setvar ENEMYHASSHIKON? 0
	}
ends

// REMAKING THE INVULNERABILITY BIO-AURAS >_>

define INVULNICON 6143

state invulndrainplayer
	ifvare CHARACTERSELECTED? 8 // If Lisa is selected...
	{
		ifvare HAVEENERGYSHIELD? 1 // Has the Bio-Cell Shield...
		{
			ifvare ENERGYSHIELDMODE 1 // And it's turned on...
			{
				ifvarg CURRENTCELLS -1
				{
					ifvarg DAMAGEINCELL 0 setvar TEMPVAR8 1 // TEMPVAR8 [here] = checks to see if the Bio-Shield requirements are all met
					else setvar TEMPVAR8 0
				}
				else setvar TEMPVAR8 0              
			}
			else setvar TEMPVAR8 0
		}
		else setvar TEMPVAR8 0
	}
	else setvar TEMPVAR8 0
	
	addvar TEMPCOUNT 1
	ifvarg TEMPCOUNT 35
	{
		setvar TEMPCOUNT 0
		ifvare TEMPVAR8 1
		{
			setvarvar TEMPVAR7 MAXHITPOINTS
			mulvarvar TEMPVAR7 INVULNHEALTHDRAIN
			divvar TEMPVAR7 1000
			ifvarl TEMPVAR7 1 setvar TEMPVAR7 1
		
			setvarvar CELLDAMAGE TEMPVAR7
			setvarvar CELLDAMAGETEMP CELLDAMAGE setvar CELLDAMAGETIMER 0 // For the displays
			ifvarn ESHIELDDMGFACTOR 0 divvarvar CELLDAMAGE ESHIELDDMGFACTOR
			ifvarvarg CELLDAMAGE CURRENTCELLS setvarvar CELLDAMAGE CURRENTCELLS
			setvarvar tempc CELLDAMAGE
			mulvarvar tempc ESHIELDDMGFACTOR
			subvarvar TEMPVAR7 tempc
			subvarvar CURRENTCELLS CELLDAMAGE
			setvar CELLDAMAGELEFT 0 
			ifvarg TEMPVAR7 0 subvarvar CELLDAMAGETEMP TEMPVAR7 // For the displays 
		
			// Now to Calculate to deal with remaining TEMPVAR7
			ifvarg CURRENTCELLS 0 // 1 or more cells left
			{
				ifvarvarg TEMPVAR7 DAMAGEINCELL // Damage exceeds the remaining power in the current cell
				{
					setvarvar TEMP3 TEMPVAR7
					setvar TEMPVAR7 0
					addvarvar CELLDAMAGETEMP TEMP3
					subvarvar DAMAGEINCELL TEMP3
					ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
				}
				else // Damage is less than or equal to the remaining power in the current cell
				{
					addvarvar CELLDAMAGETEMP TEMPVAR7
					subvarvar DAMAGEINCELL TEMPVAR7
					setvar TEMPVAR7 0
					ifvarl DAMAGEINCELL 1 { subvar CURRENTCELLS 1 addvarvar DAMAGEINCELL ESHIELDDMGFACTOR }
				}
			}
			else // 0 cells
			{
				ifvarvarg TEMPVAR7 DAMAGEINCELL // Damage exceeds the remaining power in the last cell
				{
					addvarvar CELLDAMAGETEMP DAMAGEINCELL
					subvarvar TEMPVAR7 DAMAGEINCELL
					setvar DAMAGEINCELL 0
				}
				else // Damage is less than the remaining power in the last cell
				{
					addvarvar CELLDAMAGETEMP TEMPVAR7
					subvarvar DAMAGEINCELL TEMPVAR7
					setvar TEMPVAR7 0
				}
			}
		
			stopsound NODAMAGE
			ifvare ENERGYSHIELDMODE 1 { setvar sparkflag 1 state sparkstate }
			state bioshieldhitsounds
			palfrom 32 0 0 64
		
			ifvarn player[THISACTOR].over_shoulder_on 0
			{
				ifvarg TEMPVAR5 0
				{
				setvarvar SHOWDAMAGE TEMPVAR5
				setvar SHOWDAMAGETYPE 2
				setvarvar SHOWDAMAGEACTORID INVULNAURATARGET
				state showdamage
				}
			}
		}
		else
		{
			setvarvar TEMPVAR5 MAXHITPOINTS
			mulvarvar TEMPVAR5 INVULNHEALTHDRAIN
			divvar TEMPVAR5 1000
			ifvarl TEMPVAR5 1 setvar TEMPVAR5 1
			//addlogvar TEMPVAR5
		
			subvarvar CURRENTHITPOINTS TEMPVAR5
			setvarvar PLAYERDAMAGETEMP TEMPVAR5
		
			setvar HEALTHDAMAGETIMER 0
			setvar NULLDAMAGE 0
		
			setvar PLAYERDISPLAYARMORDAMAGE 0 
			setvar ARMORDAMAGETIMER 53 
			state checkbuddhamode
		
			ifvarn player[THISACTOR].over_shoulder_on 0
			{
				ifvarg TEMPVAR5 0
				{
					setvarvar SHOWDAMAGE TEMPVAR5
					setvar SHOWDAMAGETYPE 0
					setvarvar SHOWDAMAGEACTORID INVULNAURATARGET
					state showdamage
				}
			}
		}
		setactor[INVULNAURATARGET].htowner THISACTOR
		setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
		setvar ATTACKERDISPLAYTIMER 0
		getactor[THISACTOR].picnum ATTACKINGACTORPICNUM
		getactor[THISACTOR].pal ATTACKINGACTORPAL
		getactor[THISACTOR].ang ATTACKERANGLE
		getactor[PLAYERID].ang PLAYERHITANGLE
		setvarvar SYSDIFFANGLE ATTACKERANGLE
		subvarvar SYSDIFFANGLE PLAYERHITANGLE
		ifvarl SYSDIFFANGLE 0 addvar SYSDIFFANGLE 2048
	}
ends

state invulnkillplayer
	ifvarand CHEATBITFIELD? 4 setactor[INVULNAURATARGET].extra 0 // TODO: LEAVE-THIS         
	
	ifvare CHARACTERSELECTED? 8
	{
		ifvare HAVEENERGYSHIELD? 1
		{
			ifvare ENERGYSHIELDMODE 1
			{
				ifvarg CURRENTCELLS -1 ifvarg DAMAGEINCELL 0
				{
					setvar CURRENTCELLS 0
					setvar DAMAGEINCELL 0
					state bioshieldhitsounds
				}
			}
		}
	}
	setvar FIRSTAIDCURRENT 0
	setvar CURRENTARMORPOINTS 0
	setvar CURRENTHITPOINTS 0
	state checkbuddhamode
	setactor[INVULNAURATARGET].htextra 1
	setactor[INVULNAURATARGET].htowner THISACTOR
	setactor[INVULNAURATARGET].htpicnum INVULNICON
	palfrom 64 64
ends

state bioshield-invulnsave
	setvar CURRENTCELLS 0
	setvar DAMAGEINCELL 0
	setvar FIRSTAIDCURRENT 0
	setvar CURRENTARMORPOINTS 0
	setvar CURRENTHITPOINTS 1
	setvar DEATHCHARACTERVAR 0
	setvar MISCARRAYID 26 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 39 // DEATHSWITCH-DELAY
	state bioshieldhitsounds
	setactorvar[THISACTOR].ACTORINVULNTIME 0 // Completely eliminates enemy's Invuln-Aura now >:D [as of 5.22.git77]
	setactorvar[THISACTOR].ACTORFIRSTAID 0
	setactorvar[THISACTOR].ACTORAP 0
	setactorvar[THISACTOR].ACTORHP 1
	redefinequote 321 ^23SAVED BY THE BIO-CELLULAR ENERGY SHIELD!
	setvarvar fta fta_normal setvar ftq 321
	palfrom 63 64
ends

// Deals with invuln-damage against players
state dealinvulndmg
	ifvarand CHEATBITFIELD? 32 // God Mode is on, meaning invuln doesn't work
	{
		soundonce INVULNITEM3 palfrom 32 64 64 64
	}
	else // Under normal circumstances...
	{
		getactorvar[INVULNAURATARGET].INVULNTIME tempb // check for invulntimer
		ifvare tempb 0 // if none...
		{
			canseespr THISACTOR INVULNAURATARGET temp
			ifvare temp 1
			{
				setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
				ifvare MISCARRAYID_AMOUNTTEMP 0 // do not attempt against someone in the middle of a 'mercy switch'
				{
					ifvarg INVULNHEALTHDRAIN 2000 // If >2000, execute the instant-death script
					{
						ifvare CHARACTERSELECTED? 8 // If Lisa is selected...
						{
							ifvare HAVEENERGYSHIELD? 1 // Has the Bio-Cell Shield...
							{
								ifvare ENERGYSHIELDMODE 1 // And it's turned on...
								{
									setvarvar TEMPVAR5 CURRENTBIOSHIELDPOWER
									divvarvar TEMPVAR5 MAXHITPOINTS
									ifvarg TEMPVAR5 15 // and she has 16 or more times the total Bio-Cell damageblock than her Max HP...
									{
										state bioshield-invulnsave // Then it will save her from death at the cost of all her energy cells, AP, FA and all but 1 HP, and give her 1.5sec mercy invincibility
									}
									else state invulnkillplayer
								}
								else state invulnkillplayer
							}
							else state invulnkillplayer
						}
						else state invulnkillplayer
					}
					else
					{
						ifvarg INVULNHEALTHDRAIN 0 // if between 1 & 2000, set a % drain for damage per tic
						{
							state invulndrainplayer
						}
					}
				}
			}
		}
		else // If the player is also invulnerable, take no damage and the auras clash endlessly until one runs out :P
		{
			soundonce INVULNITEM3 palfrom 32 64 64 64
		}
	}
ends

state invulnauradetect
	ifvare mainmenu 0
	{
		ifvarn INVULNAURATARGET -1
		{ 
		
			getactor[INVULNAURATARGET].owner TEMPVAR ifvare TEMPVAR -1 { setvar INVULNAURATARGET -1 break }
			ifvarvare INVULNAURATARGET PARENTID { setvar INVULNAURATARGET -1 break }
		
			getactor[INVULNAURATARGET].picnum temp
			ifvare temp APLAYER
			{ 
			getactor[INVULNAURATARGET].owner TEMPVAR ifvare TEMPVAR -1 { setvar INVULNAURATARGET -1 break } else { getactorvar[INVULNAURATARGET].CURRENTHITPOINTS tempc } // Checks the owner to see if the APLAYER sprite is a hologram [-1] [this checks ensures you can't die due to your hologram being touched by an invuln carrier]
			}
			else getactorvar[INVULNAURATARGET].ACTORHP tempc
			ifvarl tempc 1 { setvar INVULNAURATARGET -1 break } // Makes it that if the current "seeker" is dead, set to -1 to search for a living one
		
			ifvare actorvar[INVULNAURATARGET].SHRUNK? 1 { setvar INVULNAURATARGET -1 break } // Makes it that if the current "seeker" is shrunken, set to -1 to search for a non-shrunken one
			ifvare actorvar[INVULNAURATARGET].EXPANDING? 1 { setvar INVULNAURATARGET -1 break } // Makes it that if the current "seeker" is expanding, set to -1 to search for a non-shrunken one
			ifvare actorvar[INVULNAURATARGET].FROZEN? 1 { setvar INVULNAURATARGET -1 break } // Makes it that if the current "seeker" is frozen, set to -1 to search for a non-frozen one
			ifvare actorvar[INVULNAURATARGET].CLOAKED? 1 { setvar INVULNAURATARGET -1 break } // Makes it that if the current "seeker" is cloaked, set to -1 to search for a non-cloaked one
		
			// Attempt to inflict a killing blow if target is alive
			ifvarg tempc 0
			{
				getactor[INVULNAURATARGET].picnum tempe
				ifvarn tempe APLAYER
				{
					ifvarn actorvar[INVULNAURATARGET].SKILLSET? 0
					{
						ifvare actorvar[INVULNAURATARGET].ACTORINVULNTIME 0 // If they have no Invuln, HIT 'EM! XD
						{
							canseespr THISACTOR INVULNAURATARGET temp
							ifvare temp 1
							{
				
								ifvarg INVULNHEALTHDRAIN 0 // if between 1 & 2000, set a % drain for damage per tic
								{
									addvar TEMPCOUNT 1
									ifvarg TEMPCOUNT 7
									{
										setvar TEMPCOUNT 0
										ifvarg INVULNHEALTHDRAIN 2000 // Instant Kill Effect
										{
											setactor[INVULNAURATARGET].htowner THISACTOR
											setactor[INVULNAURATARGET].htextra 1
											setactor[INVULNAURATARGET].htpicnum INVULNICON
										}
										else // Health Drain Effect
										{
											setvarvar TEMPVAR7 actorvar[INVULNAURATARGET].ACTORMAXHP
											mulvarvar TEMPVAR7 INVULNHEALTHDRAIN
											divvar TEMPVAR7 1000
											ifvarl TEMPVAR7 1 setvar TEMPVAR7 1
											getactorvar[INVULNAURATARGET].ACTORHP TEMPVAR5
											subvarvar TEMPVAR5 TEMPVAR7
											setactorvar[INVULNAURATARGET].ACTORHP TEMPVAR5
											setactor[INVULNAURATARGET].htowner THISACTOR
						
											ifvarg TEMPVAR7 0 
											{
												setvar ACTORNULLDAMAGE 0
												setvar ACTORARMORDISPLAYTIMER 53
											}
											getactor[INVULNAURATARGET].picnum DEFENDINGACTORDEBUG
											getactor[INVULNAURATARGET].pal DEFENDINGACTORPAL
											setvarvar DAMAGETEMP TEMPVAR7 
											getactorvar[INVULNAURATARGET].ACTORMAXHP TEMPVAR5
											setvarvar TEMPHITACTORVARHP TEMPVAR5
											setvarvar TEMPATKCHARACTERVAR CHARACTERSELECTED?
											setvar DEFENDERDISPLAYTIMER 0
						
											ifvarg TEMPVAR7 0
											{
												setvarvar SHOWDAMAGE TEMPVAR7
												setvar SHOWDAMAGETYPE 0
												setvarvar SHOWDAMAGEACTORID INVULNAURATARGET
												state showdamage
											}
										}
									}
								}
							}
						}
						else soundonce INVULNITEM3
					}
					else
					{
						setvar INVULNAURATARGET -1
						break 
					}
				}
				else
				ifvare tempe APLAYER
				{
					getactorvar[PLAYERID].VEHICLEID tempvehicleid
					ifvare tempvehicleid -1
					{
						ifvare CHARACTERSELECTED? 10
						{
							ifvare PUBLICBETA? 0
							{
								ifrnd 1 { ifrnd 32 state dealinvulndmg }
							}
							else state dealinvulndmg
						}
						else
						ifvare CHARACTERSELECTED? 14
						{
							ifvare PUBLICBETA? 0 nullop else state dealinvulndmg
						}
						else state dealinvulndmg
					}
					else
					{
						ifvare actorvar[tempvehicleid].ACTORINVULNTIME 0
						{
							ifvarg INVULNHEALTHDRAIN 2000
							{
								ifvarand CHEATBITFIELD? 4 setactorvar[tempvehicleid].ACTORHP 1 else setactorvar[tempvehicleid].ACTORHP 0
								setactor[tempvehicleid].htowner THISACTOR
								setactor[tempvehicleid].htextra 1
								setactor[tempvehicleid].htpicnum INVULNICON
								ifvare CHARACTERSELECTED? 10
								{
									ifvare PUBLICBETA? 0
									{
										ifrnd 1 { ifrnd 32 state dealinvulndmg }
									}
									else state dealinvulndmg
								}
								else
								ifvare CHARACTERSELECTED? 14
								{
									ifvare PUBLICBETA? 0 nullop else state dealinvulndmg
								}
								else state dealinvulndmg
							}
							else
							{
								ifvarg INVULNHEALTHDRAIN 0 ifvarl INVULNHEALTHDRAIN 2001 // if between 1 & 2000, set a % drain for damage per tic
								{
									addvar TEMPCOUNT 1
									ifvarg TEMPCOUNT 35
									{
										setvar TEMPCOUNT 0
						
										setvarvar TEMPVAR7 actorvar[tempvehicleid].ACTORMAXHP
										mulvarvar TEMPVAR7 INVULNHEALTHDRAIN
										divvar TEMPVAR7 1000
										ifvarl TEMPVAR7 1 setvar TEMPVAR7 1
										getactorvar[tempvehicleid].ACTORHP TEMPVAR5
										subvarvar TEMPVAR5 TEMPVAR7
										setactorvar[tempvehicleid].ACTORHP TEMPVAR5
										setactor[tempvehicleid].htowner THISACTOR
						
										setvarvar PLAYERDAMAGETEMP TEMPVAR7
										setvar HEALTHDAMAGETIMER 0
										setvar NULLDAMAGE 0
						
										setvar PLAYERDISPLAYARMORDAMAGE 0 
										setvar ARMORDAMAGETIMER 53 
						
										setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
										setvar ATTACKERDISPLAYTIMER 0
										getactor[THISACTOR].picnum ATTACKINGACTORPICNUM
										getactor[THISACTOR].pal ATTACKINGACTORPAL
										getactor[THISACTOR].ang ATTACKERANGLE
										getactor[PLAYERID].ang PLAYERHITANGLE
										setvarvar SYSDIFFANGLE ATTACKERANGLE
										subvarvar SYSDIFFANGLE PLAYERHITANGLE
										ifvarl SYSDIFFANGLE 0 addvar SYSDIFFANGLE 2048
						
										ifvarn player[THISACTOR].over_shoulder_on 0
										{
											ifvarg TEMPVAR7 0
											{
												setvarvar SHOWDAMAGE TEMPVAR7
												setvar SHOWDAMAGETYPE 0
												setvarvar SHOWDAMAGEACTORID INVULNAURATARGET
												state showdamage
											}
										}
									}
								}
							}
						}
						else soundonce INVULNITEM3
					}
				}
			}
		}
	}
ends

state invulntarget_player
	addvar FINDNEAR_INTERVAL 1
	ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
	{
		findnearactorzvar BOSS4 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar BOSS3 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar BOSS2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar BOSS1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar SCORPIONTANK INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar TANK INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar COMMANDER INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar NEWBEAST INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar OCTABRAIN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DRONE INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar PIGCOP INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar LIZMAN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar RECON INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar LIZTROOP INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ROTATEGUN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar SHARK INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar EGG INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar GREENSLIME INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		setvar FINDNEAR_INTERVAL 0
	}
ends

state invulntarget_civilians
	addvar FINDNEAR_INTERVAL 1
	ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
	{
		findnearactorzvar BOSS4 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar BOSS3 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar BOSS2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar BOSS1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar SCORPIONTANK INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar TANK INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar COMMANDER INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar NEWBEAST INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar OCTABRAIN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DRONE INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar PIGCOP INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar LIZMAN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar RECON INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar LIZTROOP INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ROTATEGUN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar SHARK INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar EGG INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar GREENSLIME INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		setvar FINDNEAR_INTERVAL 0
	}
ends

state invulntarget_monsters
	addvar FINDNEAR_INTERVAL 1
	ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
	{
		findnearactorzvar PRESIDENTCLINTON INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearspritezvar APLAYER INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar PODFEM1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar NAKED1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM3 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM4 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM5 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM6 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM7 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM9 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar FEM10 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar TOUGHGAL INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar WOMAN INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ROBOTDOG INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ROBOTDOG2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar STAND1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DEALER INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar STAND3 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar STAND4 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE3 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE5 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE6 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE7 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar DANCE9 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar WOLFDUDE INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar COP1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar PUNKDUDE INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar COP2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar SITTINGDUDE INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ANIMEGIRL1 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ANIMEGIRL2 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ANIMEGIRL3 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		ifvare INVULNAURATARGET -1 findnearactorzvar ANIMEGIRL4 INVULNAURARANGEXY INVULNAURARANGEZ INVULNAURATARGET state invulnauradetect
		setvar FINDNEAR_INTERVAL 0
	}
ends

state invulnicon
	ifvare oldskoolmode 0
	{
		getactor[PARENTID].x TESTX 
		getactor[PARENTID].y TESTY
		getactor[PARENTID].z TESTZ
		getactor[PARENTID].picnum TEMP
		ifvare TEMP APLAYER subvar TESTZ 512
		setactor[THISACTOR].x TESTX
		setactor[THISACTOR].y TESTY 
		setactor[THISACTOR].z TESTZ
		getactor[PARENTID].xrepeat TESTXREPEAT1 
		getactor[PARENTID].yrepeat TESTYREPEAT1 
		getactorvar[PARENTID].ACTORSHEIGHT INVULNAURARANGEZ
		mulvarvar INVULNAURARANGEZ TESTYREPEAT1
		mulvar INVULNAURARANGEZ 4
		setvar INVULNAURARANGEXY 844
		addvarvar INVULNAURARANGEXY TESTXREPEAT1
		addvar INVULNAURARANGEZ 1688
		addvarvar INVULNAURARANGEZ TESTYREPEAT1
		addvarvar INVULNAURARANGEZ TESTYREPEAT1
	
		getactor[PARENTID].picnum TEMP // Gets the Picnum of the activator
		ifvare TEMP APLAYER // The activator is a Player
		{
			getactorvar[PLAYERID].VEHICLEID tempvehicleid
			ifvare tempvehicleid -1 // If the player's not in a vehicle
			{
				ifvarg actorvar[PARENTID].INVULNTIME 0
				{
					setactor[THISACTOR].cstat 32768 // Sets Invisible
					state invulntarget_player
				}
				else setactor[THISACTOR].cstat 32768 // Sets Invisible
			}
			else // If the player IS in a vehicle, check it's invuln timer instead
			{
				ifvarg actorvar[PARENTID].INVULNTIME 0
				{
					setactor[THISACTOR].cstat 32768 // Sets Invisible
					state invulntarget_player
				}
				else setactor[THISACTOR].cstat 32768 // Sets Invisible
			}
		}
		else // The activator is NOT a Player, but either an NPC or monster
		{
			ifvarg actorvar[PARENTID].ACTORINVULNTIME 0
			{
				setactor[THISACTOR].cstat 32768 // Sets Invisible
				getactor[PARENTID].picnum TEMP
				ifvare TEMP ROTATEGUN state invulntarget_monsters
				ifvare TEMP SHARK state invulntarget_monsters
				ifvare TEMP LIZTROOP state invulntarget_monsters
				ifvare TEMP PIGCOP state invulntarget_monsters
				ifvare TEMP RECON state invulntarget_monsters
				ifvare TEMP LIZMAN state invulntarget_monsters
				ifvare TEMP OCTABRAIN state invulntarget_monsters
				ifvare TEMP DRONE state invulntarget_monsters
				ifvare TEMP NEWBEAST state invulntarget_monsters
				ifvare TEMP COMMANDER state invulntarget_monsters
				ifvare TEMP TANK state invulntarget_monsters
				ifvare TEMP SCORPIONTANK state invulntarget_monsters
				ifvare TEMP BOSS1 state invulntarget_monsters
				ifvare TEMP BOSS2 state invulntarget_monsters
				ifvare TEMP BOSS3 state invulntarget_monsters
				ifvare TEMP BOSS4 state invulntarget_monsters
				ifvare TEMP PRESIDENTCLINTON state invulntarget_civilians
				ifvare TEMP ROBOTDOG state invulntarget_civilians
				ifvare TEMP ROBOTDOG2 state invulntarget_civilians
				ifvare TEMP PODFEM1 state invulntarget_civilians
				ifvare TEMP NAKED1 state invulntarget_civilians
				ifvare TEMP FEM1 state invulntarget_civilians
				ifvare TEMP FEM2 state invulntarget_civilians
				ifvare TEMP FEM3 state invulntarget_civilians
				ifvare TEMP FEM4 state invulntarget_civilians
				ifvare TEMP FEM5 state invulntarget_civilians
				ifvare TEMP FEM6 state invulntarget_civilians
				ifvare TEMP FEM7 state invulntarget_civilians
				ifvare TEMP FEM9 state invulntarget_civilians
				ifvare TEMP FEM10 state invulntarget_civilians
				ifvare TEMP TOUGHGAL state invulntarget_civilians
				ifvare TEMP WOMAN state invulntarget_civilians
				ifvare TEMP DANCE1 state invulntarget_civilians
				ifvare TEMP DANCE2 state invulntarget_civilians
				ifvare TEMP DANCE3 state invulntarget_civilians
				ifvare TEMP DANCE5 state invulntarget_civilians
				ifvare TEMP DANCE6 state invulntarget_civilians
				ifvare TEMP DANCE7 state invulntarget_civilians
				ifvare TEMP DANCE9 state invulntarget_civilians
				ifvare TEMP STAND1 state invulntarget_civilians
				ifvare TEMP DEALER state invulntarget_civilians
				ifvare TEMP STAND3 state invulntarget_civilians
				ifvare TEMP STAND4 state invulntarget_civilians
				ifvare TEMP WOLFDUDE state invulntarget_civilians
				ifvare TEMP COP1 state invulntarget_civilians
				ifvare TEMP PUNKDUDE state invulntarget_civilians
				ifvare TEMP COP2 state invulntarget_civilians
				ifvare TEMP SITTINGDUDE state invulntarget_civilians
				ifvare TEMP ANIMEGIRL1 state invulntarget_civilians
				ifvare TEMP ANIMEGIRL2 state invulntarget_civilians
				ifvare TEMP ANIMEGIRL3 state invulntarget_civilians
				ifvare TEMP ANIMEGIRL4 state invulntarget_civilians
			}
			else setactor[THISACTOR].cstat 32768 // Sets Invisible
		}
	}
	else setactor[THISACTOR].cstat 32768 // Sets Invisible
ends

//******************
//******************
//******************
//******************

state randomshrapnel
	randvar TEMPVAR8 4
	ifvare TEMPVAR8 0 debris SCRAP1 1
	ifvare TEMPVAR8 1 debris SCRAP2 1
	ifvare TEMPVAR8 2 debris SCRAP3 1
	ifvare TEMPVAR8 3 debris SCRAP4 1
	ifvare TEMPVAR8 4 debris SCRAP5 1
ends

state trashcancode
	ifhitweapon
	{ 
		ifwasweapon SHRINKER nullop
		else ifwasweapon SHRINKSPARK nullop
		else
		{
			ifdead
			{
				state randomshrapnel
				state randomshrapnel
				ifrnd 224 state randomshrapnel
				ifrnd 192 state randomshrapnel
				ifrnd 192 state randomshrapnel
				ifrnd 160 state randomshrapnel
				ifrnd 128 state randomshrapnel
				ifrnd 128 state randomshrapnel
				ifrnd 96 state randomshrapnel
				ifrnd 64 state randomshrapnel
				ifrnd 64 state randomshrapnel
				ifrnd 32 state randomshrapnel
				paper 1
				paper 1
				ifrnd 224 paper 1
				ifrnd 192 paper 1
				ifrnd 192 paper 1
				ifrnd 160 paper 1
				ifrnd 128 paper 1
				ifrnd 128 paper 1
				ifrnd 96 paper 1
				ifrnd 64 paper 1
				ifrnd 64 paper 1
				ifrnd 32 paper 1
				mail 1
				mail 1
				ifrnd 224 mail 1
				ifrnd 192 mail 1
				ifrnd 192 mail 1
				ifrnd 160 mail 1
				ifrnd 128 mail 1
				ifrnd 128 mail 1
				ifrnd 96 mail 1
				ifrnd 64 mail 1
				ifrnd 64 mail 1
				ifrnd 32 mail 1
				ifrnd 128 spawn RAT
				ifrnd 128 spawn RAT
				ifrnd 96 spawn RAT
				ifrnd 96 spawn RAT
				ifrnd 64 spawn RAT
				ifrnd 64 spawn RAT
				ifrnd 32 spawn RAT
				ifrnd 32 spawn RAT
				ifrnd 64 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 64 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 32 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 32 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 16 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 16 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 8 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 8 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 32 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 16 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 16 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 8 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 8 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 16 { espawn DIME setactor[RETURN].pal 3 }
				ifrnd 8 { espawn DIME setactor[RETURN].pal 3 }
				ifrnd 8 { espawn DIME setactor[RETURN].pal 3 }
				ifrnd 8 { espawn QUARTER setactor[RETURN].pal 3 }
				ifvarg TEMP -1 ifvarl TEMP 13 nullop
				else
				{
					espawnvar TEMP
					setactor[RETURN].pal TEMP2
					setactorvar[RETURN].ACTORFLAGS actorvar[THISACTOR].ACTORFLAGS
					setactorvar[RETURN].lotagsav actorvar[THISACTOR].lotagsav
				}
				killit
			}
		}
	}
ends

state trashbagcode
	ifhitweapon
	{ 
		ifwasweapon SHRINKER nullop
		else ifwasweapon SHRINKSPARK nullop
		else
		{
			ifdead
			{
				state randomshrapnel
				ifrnd 224 state randomshrapnel
				ifrnd 192 state randomshrapnel
				ifrnd 160 state randomshrapnel
				ifrnd 128 state randomshrapnel
				ifrnd 96 state randomshrapnel
				ifrnd 64 state randomshrapnel
				ifrnd 32 state randomshrapnel
				paper 1
				ifrnd 224 paper 1
				ifrnd 192 paper 1
				ifrnd 160 paper 1
				ifrnd 128 paper 1
				ifrnd 96 paper 1
				ifrnd 64 paper 1
				ifrnd 32 paper 1
				mail 1
				ifrnd 224 mail 1
				ifrnd 192 mail 1
				ifrnd 160 mail 1
				ifrnd 128 mail 1
				ifrnd 96 mail 1
				ifrnd 64 mail 1
				ifrnd 32 mail 1
				ifrnd 96 spawn RAT
				ifrnd 96 spawn RAT
				ifrnd 64 spawn RAT
				ifrnd 64 spawn RAT
				ifrnd 32 spawn RAT
				ifrnd 32 spawn RAT
				ifrnd 64 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 32 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 16 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 8 { espawn PENNY setactor[RETURN].pal 3 }
				ifrnd 16 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 8 { espawn NICKEL setactor[RETURN].pal 3 }
				ifrnd 16 { espawn DIME setactor[RETURN].pal 3 }
				ifrnd 8 { espawn DIME setactor[RETURN].pal 3 }
				ifrnd 8 { espawn QUARTER setactor[RETURN].pal 3 }
				ifvarg TEMP -1 ifvarl TEMP 13 nullop
				else
				{
					espawnvar TEMP
					setactor[RETURN].pal TEMP2
					setactorvar[RETURN].ACTORFLAGS actorvar[THISACTOR].ACTORFLAGS
					setactorvar[RETURN].lotagsav actorvar[THISACTOR].lotagsav
				}
				killit
			}
		}
	}
ends

state tileshuffle_1
	setvar MISCARRAYID 24 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-SHUFFLES
	ifvarg MISCARRAYID_AMOUNTTEMP 8 nullop else jump TEMPVAR3
ends

state tileshuffle_2
	setvar MISCARRAYID 24 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-SHUFFLES
	ifvarg MISCARRAYID_AMOUNTTEMP 8 
	{
		setvar MISCARRAYID 91 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-TITLE-SCREEN
	}
	else jump TEMPVAR3
ends

state getworldtile
	getcurraddress TEMPVAR3
	setvar MISCARRAYID 24 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-SHUFFLES
	addvar MISCARRAYID_AMOUNTTEMP 1
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-SHUFFLES
	
	setvar MISCARRAYID 91 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-TITLE-SCREEN
	randvar MISCARRAYID_AMOUNTTEMP 256
	//addlogvar MISCARRAYID_AMOUNTTEMP
	setvar MISCARRAYID 91 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-TITLE-SCREEN
	
	switch MISCARRAYID_AMOUNTTEMP
		case 0 { state tileshuffle_1 break }
		// Set #1 (1-32)
		case 1 { ifvarand WORLDTILEBITFIELD1 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 2 { ifvarand WORLDTILEBITFIELD1 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 3 { ifvarand WORLDTILEBITFIELD1 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 4 { ifvarand WORLDTILEBITFIELD1 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 5 { ifvarand WORLDTILEBITFIELD1 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 6 { ifvarand WORLDTILEBITFIELD1 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 7 { ifvarand WORLDTILEBITFIELD1 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 8 { ifvarand WORLDTILEBITFIELD1 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 9 { ifvarand WORLDTILEBITFIELD1 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 10 { ifvarand WORLDTILEBITFIELD1 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 11 { ifvarand WORLDTILEBITFIELD1 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 12 { ifvarand WORLDTILEBITFIELD1 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 13 { ifvarand WORLDTILEBITFIELD1 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 14 { ifvarand WORLDTILEBITFIELD1 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 15 { ifvarand WORLDTILEBITFIELD1 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 16 { ifvarand WORLDTILEBITFIELD1 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 17 { ifvarand WORLDTILEBITFIELD1 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 18 { ifvarand WORLDTILEBITFIELD1 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 19 { ifvarand WORLDTILEBITFIELD1 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 20 { ifvarand WORLDTILEBITFIELD1 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 21 { ifvarand WORLDTILEBITFIELD1 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 22 { ifvarand WORLDTILEBITFIELD1 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 23 { ifvarand WORLDTILEBITFIELD1 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 24 { ifvarand WORLDTILEBITFIELD1 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 25 { ifvarand WORLDTILEBITFIELD1 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 26 { ifvarand WORLDTILEBITFIELD1 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 27 { ifvarand WORLDTILEBITFIELD1 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 28 { ifvarand WORLDTILEBITFIELD1 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 29 { ifvarand WORLDTILEBITFIELD1 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 30 { ifvarand WORLDTILEBITFIELD1 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 31 { ifvarand WORLDTILEBITFIELD1 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 32 { ifvarand WORLDTILEBITFIELD1 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #2 (33-64)
		case 33 { ifvarand WORLDTILEBITFIELD2 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 34 { ifvarand WORLDTILEBITFIELD2 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 35 { ifvarand WORLDTILEBITFIELD2 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 36 { ifvarand WORLDTILEBITFIELD2 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 37 { ifvarand WORLDTILEBITFIELD2 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 38 { ifvarand WORLDTILEBITFIELD2 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 39 { ifvarand WORLDTILEBITFIELD2 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 40 { ifvarand WORLDTILEBITFIELD2 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 41 { ifvarand WORLDTILEBITFIELD2 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 42 { ifvarand WORLDTILEBITFIELD2 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 43 { ifvarand WORLDTILEBITFIELD2 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 44 { ifvarand WORLDTILEBITFIELD2 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 45 { ifvarand WORLDTILEBITFIELD2 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 46 { ifvarand WORLDTILEBITFIELD2 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 47 { ifvarand WORLDTILEBITFIELD2 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 48 { ifvarand WORLDTILEBITFIELD2 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 49 { ifvarand WORLDTILEBITFIELD2 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 50 { ifvarand WORLDTILEBITFIELD2 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 51 { ifvarand WORLDTILEBITFIELD2 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 52 { ifvarand WORLDTILEBITFIELD2 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 53 { ifvarand WORLDTILEBITFIELD2 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 54 { ifvarand WORLDTILEBITFIELD2 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 55 { ifvarand WORLDTILEBITFIELD2 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 56 { ifvarand WORLDTILEBITFIELD2 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 57 { ifvarand WORLDTILEBITFIELD2 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 58 { ifvarand WORLDTILEBITFIELD2 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 59 { ifvarand WORLDTILEBITFIELD2 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 60 { ifvarand WORLDTILEBITFIELD2 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 61 { ifvarand WORLDTILEBITFIELD2 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 62 { ifvarand WORLDTILEBITFIELD2 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 63 { ifvarand WORLDTILEBITFIELD2 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 64 { ifvarand WORLDTILEBITFIELD2 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #3 (65-96)
		case 65 { ifvarand WORLDTILEBITFIELD3 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 66 { ifvarand WORLDTILEBITFIELD3 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 67 { ifvarand WORLDTILEBITFIELD3 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 68 { ifvarand WORLDTILEBITFIELD3 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 69 { ifvarand WORLDTILEBITFIELD3 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 70 { ifvarand WORLDTILEBITFIELD3 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 71 { ifvarand WORLDTILEBITFIELD3 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 72 { ifvarand WORLDTILEBITFIELD3 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 73 { ifvarand WORLDTILEBITFIELD3 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 74 { ifvarand WORLDTILEBITFIELD3 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 75 { ifvarand WORLDTILEBITFIELD3 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 76 { ifvarand WORLDTILEBITFIELD3 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 77 { ifvarand WORLDTILEBITFIELD3 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 78 { ifvarand WORLDTILEBITFIELD3 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 79 { ifvarand WORLDTILEBITFIELD3 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 80 { ifvarand WORLDTILEBITFIELD3 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 81 { ifvarand WORLDTILEBITFIELD3 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 82 { ifvarand WORLDTILEBITFIELD3 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 83 { ifvarand WORLDTILEBITFIELD3 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 84 { ifvarand WORLDTILEBITFIELD3 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 85 { ifvarand WORLDTILEBITFIELD3 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 86 { ifvarand WORLDTILEBITFIELD3 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 87 { ifvarand WORLDTILEBITFIELD3 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 88 { ifvarand WORLDTILEBITFIELD3 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 89 { ifvarand WORLDTILEBITFIELD3 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 90 { ifvarand WORLDTILEBITFIELD3 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 91 { ifvarand WORLDTILEBITFIELD3 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 92 { ifvarand WORLDTILEBITFIELD3 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 93 { ifvarand WORLDTILEBITFIELD3 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 94 { ifvarand WORLDTILEBITFIELD3 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 95 { ifvarand WORLDTILEBITFIELD3 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 96 { ifvarand WORLDTILEBITFIELD3 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #4 (97-128)
		case 97 { ifvarand WORLDTILEBITFIELD4 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 98 { ifvarand WORLDTILEBITFIELD4 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 99 { ifvarand WORLDTILEBITFIELD4 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 100 { ifvarand WORLDTILEBITFIELD4 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 101 { ifvarand WORLDTILEBITFIELD4 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 102 { ifvarand WORLDTILEBITFIELD4 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 103 { ifvarand WORLDTILEBITFIELD4 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 104 { ifvarand WORLDTILEBITFIELD4 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 105 { ifvarand WORLDTILEBITFIELD4 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 106 { ifvarand WORLDTILEBITFIELD4 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 107 { ifvarand WORLDTILEBITFIELD4 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 108 { ifvarand WORLDTILEBITFIELD4 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 109 { ifvarand WORLDTILEBITFIELD4 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 110 { ifvarand WORLDTILEBITFIELD4 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 111 { ifvarand WORLDTILEBITFIELD4 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 112 { ifvarand WORLDTILEBITFIELD4 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 113 { ifvarand WORLDTILEBITFIELD4 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 114 { ifvarand WORLDTILEBITFIELD4 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 115 { ifvarand WORLDTILEBITFIELD4 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 116 { ifvarand WORLDTILEBITFIELD4 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 117 { ifvarand WORLDTILEBITFIELD4 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 118 { ifvarand WORLDTILEBITFIELD4 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 119 { ifvarand WORLDTILEBITFIELD4 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 120 { ifvarand WORLDTILEBITFIELD4 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 121 { ifvarand WORLDTILEBITFIELD4 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 122 { ifvarand WORLDTILEBITFIELD4 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 123 { ifvarand WORLDTILEBITFIELD4 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 124 { ifvarand WORLDTILEBITFIELD4 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 125 { ifvarand WORLDTILEBITFIELD4 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 126 { ifvarand WORLDTILEBITFIELD4 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 127 { ifvarand WORLDTILEBITFIELD4 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 128 { ifvarand WORLDTILEBITFIELD4 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #5 (129-160)
		case 129 { ifvarand WORLDTILEBITFIELD5 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 130 { ifvarand WORLDTILEBITFIELD5 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 131 { ifvarand WORLDTILEBITFIELD5 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 132 { ifvarand WORLDTILEBITFIELD5 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 133 { ifvarand WORLDTILEBITFIELD5 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 134 { ifvarand WORLDTILEBITFIELD5 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 135 { ifvarand WORLDTILEBITFIELD5 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 136 { ifvarand WORLDTILEBITFIELD5 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 137 { ifvarand WORLDTILEBITFIELD5 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 138 { ifvarand WORLDTILEBITFIELD5 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 139 { ifvarand WORLDTILEBITFIELD5 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 140 { ifvarand WORLDTILEBITFIELD5 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 141 { ifvarand WORLDTILEBITFIELD5 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 142 { ifvarand WORLDTILEBITFIELD5 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 143 { ifvarand WORLDTILEBITFIELD5 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 144 { ifvarand WORLDTILEBITFIELD5 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 145 { ifvarand WORLDTILEBITFIELD5 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 146 { ifvarand WORLDTILEBITFIELD5 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 147 { ifvarand WORLDTILEBITFIELD5 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 148 { ifvarand WORLDTILEBITFIELD5 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 149 { ifvarand WORLDTILEBITFIELD5 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 150 { ifvarand WORLDTILEBITFIELD5 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 151 { ifvarand WORLDTILEBITFIELD5 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 152 { ifvarand WORLDTILEBITFIELD5 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 153 { ifvarand WORLDTILEBITFIELD5 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 154 { ifvarand WORLDTILEBITFIELD5 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 155 { ifvarand WORLDTILEBITFIELD5 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 156 { ifvarand WORLDTILEBITFIELD5 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 157 { ifvarand WORLDTILEBITFIELD5 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 158 { ifvarand WORLDTILEBITFIELD5 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 159 { ifvarand WORLDTILEBITFIELD5 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 160 { ifvarand WORLDTILEBITFIELD5 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #6 (161-192)
		case 161 { ifvarand WORLDTILEBITFIELD6 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 162 { ifvarand WORLDTILEBITFIELD6 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 163 { ifvarand WORLDTILEBITFIELD6 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 164 { ifvarand WORLDTILEBITFIELD6 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 165 { ifvarand WORLDTILEBITFIELD6 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 166 { ifvarand WORLDTILEBITFIELD6 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 167 { ifvarand WORLDTILEBITFIELD6 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 168 { ifvarand WORLDTILEBITFIELD6 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 169 { ifvarand WORLDTILEBITFIELD6 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 170 { ifvarand WORLDTILEBITFIELD6 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 171 { ifvarand WORLDTILEBITFIELD6 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 172 { ifvarand WORLDTILEBITFIELD6 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 173 { ifvarand WORLDTILEBITFIELD6 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 174 { ifvarand WORLDTILEBITFIELD6 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 175 { ifvarand WORLDTILEBITFIELD6 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 176 { ifvarand WORLDTILEBITFIELD6 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 177 { ifvarand WORLDTILEBITFIELD6 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 178 { ifvarand WORLDTILEBITFIELD6 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 179 { ifvarand WORLDTILEBITFIELD6 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 180 { ifvarand WORLDTILEBITFIELD6 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 181 { ifvarand WORLDTILEBITFIELD6 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 182 { ifvarand WORLDTILEBITFIELD6 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 183 { ifvarand WORLDTILEBITFIELD6 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 184 { ifvarand WORLDTILEBITFIELD6 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 185 { ifvarand WORLDTILEBITFIELD6 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 186 { ifvarand WORLDTILEBITFIELD6 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 187 { ifvarand WORLDTILEBITFIELD6 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 188 { ifvarand WORLDTILEBITFIELD6 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 189 { ifvarand WORLDTILEBITFIELD6 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 190 { ifvarand WORLDTILEBITFIELD6 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 191 { ifvarand WORLDTILEBITFIELD6 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 192 { ifvarand WORLDTILEBITFIELD6 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #7 (193-224)
		case 193 { ifvarand WORLDTILEBITFIELD7 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 194 { ifvarand WORLDTILEBITFIELD7 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 195 { ifvarand WORLDTILEBITFIELD7 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 196 { ifvarand WORLDTILEBITFIELD7 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 197 { ifvarand WORLDTILEBITFIELD7 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 198 { ifvarand WORLDTILEBITFIELD7 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 199 { ifvarand WORLDTILEBITFIELD7 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 200 { ifvarand WORLDTILEBITFIELD7 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 201 { ifvarand WORLDTILEBITFIELD7 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 202 { ifvarand WORLDTILEBITFIELD7 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 203 { ifvarand WORLDTILEBITFIELD7 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 204 { ifvarand WORLDTILEBITFIELD7 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 205 { ifvarand WORLDTILEBITFIELD7 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 206 { ifvarand WORLDTILEBITFIELD7 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 207 { ifvarand WORLDTILEBITFIELD7 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 208 { ifvarand WORLDTILEBITFIELD7 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 209 { ifvarand WORLDTILEBITFIELD7 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 210 { ifvarand WORLDTILEBITFIELD7 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 211 { ifvarand WORLDTILEBITFIELD7 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 212 { ifvarand WORLDTILEBITFIELD7 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 213 { ifvarand WORLDTILEBITFIELD7 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 214 { ifvarand WORLDTILEBITFIELD7 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 215 { ifvarand WORLDTILEBITFIELD7 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 216 { ifvarand WORLDTILEBITFIELD7 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 217 { ifvarand WORLDTILEBITFIELD7 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 218 { ifvarand WORLDTILEBITFIELD7 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 219 { ifvarand WORLDTILEBITFIELD7 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 220 { ifvarand WORLDTILEBITFIELD7 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 221 { ifvarand WORLDTILEBITFIELD7 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 222 { ifvarand WORLDTILEBITFIELD7 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 223 { ifvarand WORLDTILEBITFIELD7 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 224 { ifvarand WORLDTILEBITFIELD7 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
		// Set #8 (225-256)
		case 225 { ifvarand WORLDTILEBITFIELD8 1 state tileshuffle_1 else state tileshuffle_2 break }
		case 226 { ifvarand WORLDTILEBITFIELD8 2 state tileshuffle_1 else state tileshuffle_2 break }
		case 227 { ifvarand WORLDTILEBITFIELD8 4 state tileshuffle_1 else state tileshuffle_2 break }
		case 228 { ifvarand WORLDTILEBITFIELD8 8 state tileshuffle_1 else state tileshuffle_2 break }
		case 229 { ifvarand WORLDTILEBITFIELD8 16 state tileshuffle_1 else state tileshuffle_2 break }
		case 230 { ifvarand WORLDTILEBITFIELD8 32 state tileshuffle_1 else state tileshuffle_2 break }
		case 231 { ifvarand WORLDTILEBITFIELD8 64 state tileshuffle_1 else state tileshuffle_2 break }
		case 232 { ifvarand WORLDTILEBITFIELD8 128 state tileshuffle_1 else state tileshuffle_2 break }
		case 233 { ifvarand WORLDTILEBITFIELD8 256 state tileshuffle_1 else state tileshuffle_2 break }
		case 234 { ifvarand WORLDTILEBITFIELD8 512 state tileshuffle_1 else state tileshuffle_2 break }
		case 235 { ifvarand WORLDTILEBITFIELD8 1024 state tileshuffle_1 else state tileshuffle_2 break }
		case 236 { ifvarand WORLDTILEBITFIELD8 2048 state tileshuffle_1 else state tileshuffle_2 break }
		case 237 { ifvarand WORLDTILEBITFIELD8 4096 state tileshuffle_1 else state tileshuffle_2 break }
		case 238 { ifvarand WORLDTILEBITFIELD8 8192 state tileshuffle_1 else state tileshuffle_2 break }
		case 239 { ifvarand WORLDTILEBITFIELD8 16384 state tileshuffle_1 else state tileshuffle_2 break }
		case 240 { ifvarand WORLDTILEBITFIELD8 32768 state tileshuffle_1 else state tileshuffle_2 break }
		case 241 { ifvarand WORLDTILEBITFIELD8 65536 state tileshuffle_1 else state tileshuffle_2 break }
		case 242 { ifvarand WORLDTILEBITFIELD8 131072 state tileshuffle_1 else state tileshuffle_2 break }
		case 243 { ifvarand WORLDTILEBITFIELD8 262144 state tileshuffle_1 else state tileshuffle_2 break }
		case 244 { ifvarand WORLDTILEBITFIELD8 524288 state tileshuffle_1 else state tileshuffle_2 break }
		case 245 { ifvarand WORLDTILEBITFIELD8 1048576 state tileshuffle_1 else state tileshuffle_2 break }
		case 246 { ifvarand WORLDTILEBITFIELD8 2097152 state tileshuffle_1 else state tileshuffle_2 break }
		case 247 { ifvarand WORLDTILEBITFIELD8 4194304 state tileshuffle_1 else state tileshuffle_2 break }
		case 248 { ifvarand WORLDTILEBITFIELD8 8388608 state tileshuffle_1 else state tileshuffle_2 break }
		case 249 { ifvarand WORLDTILEBITFIELD8 16777216 state tileshuffle_1 else state tileshuffle_2 break }
		case 250 { ifvarand WORLDTILEBITFIELD8 33554432 state tileshuffle_1 else state tileshuffle_2 break }
		case 251 { ifvarand WORLDTILEBITFIELD8 67108864 state tileshuffle_1 else state tileshuffle_2 break }
		case 252 { ifvarand WORLDTILEBITFIELD8 134217728 state tileshuffle_1 else state tileshuffle_2 break }
		case 253 { ifvarand WORLDTILEBITFIELD8 268435456 state tileshuffle_1 else state tileshuffle_2 break }
		case 254 { ifvarand WORLDTILEBITFIELD8 536870912 state tileshuffle_1 else state tileshuffle_2 break }
		case 255 { ifvarand WORLDTILEBITFIELD8 1073741824 state tileshuffle_1 else state tileshuffle_2 break }
		case 256 { ifvarand WORLDTILEBITFIELD8 2147483648 state tileshuffle_1 else state tileshuffle_2 break }
	endswitch
	
	setvar MISCARRAYID 24 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // WORLDTILE-SHUFFLES
	ifvarg MISCARRAYID_AMOUNTTEMP 8 break
ends

state initialize_worldtile
	ifvare SKILLSET? 0
	{
		sizeat 8 12
		setactor[THISACTOR].shade -63 // Full-Brightness
		setactor[THISACTOR].cstat 1040 // Vertically Flat + Hitscannable
		setactor[THISACTOR].ang 0 // Starts the angle at 0
		setvar SKILLSET? 1  
	}
	else
	ifvare SKILLSET? 1
	{
		setvar MISCARRAYID 21 // Max WorldTiles Found [level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		setvar SKILLSET? 2  
	}
ends

state spin_worldtile
	getactor[THISACTOR].ang TEMPVAR5
	addvar TEMPVAR5 32
	setactor[THISACTOR].ang TEMPVAR5
ends

state grab_worldtile
	setvar MISCARRAYID 20 // WorldTiles Found [level]
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
	savegamevar WORLDTILEBITFIELD1
	savegamevar WORLDTILEBITFIELD2
	savegamevar WORLDTILEBITFIELD3
	savegamevar WORLDTILEBITFIELD4
	savegamevar WORLDTILEBITFIELD5
	savegamevar WORLDTILEBITFIELD6
	savegamevar WORLDTILEBITFIELD7
	savegamevar WORLDTILEBITFIELD8
	sound TELEPORTER
	globalsound YEAH
	setvarvar fta fta_normal setvar ftq 410
	spawn TRANSPORTERBEAM
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	killit
ends

state grabinventory
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		setvarvar fta fta_normal setvar ftq 335
		globalsound FOUND_INVENTORY
		palfrom 32 0 32
	}
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	state activationflag
	killit
ends

state grabequippable
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		setvarvar fta fta_normal setvar ftq 335
		globalsound GRAB_EQUIPMENT
		palfrom 32 0 32
	}
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	state activationflag
	killit
ends

state monsterpainsounds1
	switch temp
		case ROTATEGUN
			debris SCRAP1 4
			break
	
		case LIZTROOP
		case LIZTROOPSTAYPUT
		case LIZTROOPJETPACK
		case LIZTROOPSHOOT
		case LIZTROOPDUCKING
		case LIZTROOPONTOILET
		case LIZTROOPRUNNING
		case LIZTROOPJUSTSIT
			soundonce PRED_PAIN
			break
	
		case LIZMAN
		case LIZMANSTAYPUT
		case LIZMANSPITTING
		case LIZMANJUMP
			soundonce CAPT_PAIN
			break
	
		case DRONE
			soundonce DRON_PAIN
			break
	
		case OCTABRAIN
		case OCTABRAINSTAYPUT
			getactor[TEMP5].pal temp
			ifvare temp 14 soundonce NINE_PAIN
			else soundonce OCTA_PAIN  
			break
	
		case PIGCOP
		case PIGCOPSTAYPUT
		case PIGCOPDIVE
			soundonce PIG_PAIN  
			break
		
		case BOSS1
		case BOSS1STAYPUT
		case BOSS1SHOOT
		case BOSS1LOB
			soundonce BOS1_PAIN
			break
	
		case BOSS2
		case BOSS2STAYPUT
		case BOSS2SHOOT
		case BOSS2BREATH
			soundonce BOS2_PAIN
			break
	
		case BOSS3
		case BOSS3STAYPUT
		case BOSS3LOB
			soundonce BOS3_PAIN
			break
	
		case COMMANDER
		case COMMANDERSTAYPUT
			getactor[TEMP5].pal temp
			ifvare temp 14 addvar SOUNDPITCH 416
			ifvare temp 25 addvar SOUNDPITCH -416
			setplayer[THISACTOR].sound_pitch SOUNDPITCH
			soundonce COMM_PAIN
			ifvare temp 14 addvar SOUNDPITCH -416
			ifvare temp 25 addvar SOUNDPITCH 416
			setplayer[THISACTOR].sound_pitch SOUNDPITCH
			break
	
		case BOSS4
		case BOSS4STAYPUT
			soundonce BOS4_PAIN
			break
	
		case NEWBEAST
		case NEWBEASTSTAYPUT
		case NEWBEASTJUMP
		case NEWBEASTHANG
			soundonce NEWBEAST_PAIN
			break
	endswitch
ends

state enemybloodpooldamagesnds
	ifvarg actorvar[PYTHAGORASTARGET].ACTORHP 0
	{
		getactor[PYTHAGORASTARGET].picnum temp
		state monsterpainsounds1
	}
ends

state bloodpooldamagemonster
	getactor[THISACTOR].xrepeat temp
	getactor[THISACTOR].yrepeat tempb
	ifvarg temp 6 
	{
		ifvarg tempb 6
		{
			getactor[THISACTOR].cstat TEMP
			ifvarand TEMP 32 // Flat?
			{
				getactor[THISACTOR].pal TEMP
				ifvarand TEMP 22
				{
					ifvarl actorvar[PYTHAGORASTARGET].ACTORINVULNTIME 1
					{
						getactor[PYTHAGORASTARGET].picnum tempc
						ifvare tempc TANK setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
						else ifvare tempc EMPTYTANK setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
						else ifvare tempc SCORPIONTANK setvar RNDMIZERLIMIT 252 // ifrnd 4 = (256 - 4 = 252)
						else ifvare tempc BOSS1 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
						else ifvare tempc BOSS2 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
						else ifvare tempc BOSS3 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
						else ifvare tempc BOSS4 setvar RNDMIZERLIMIT 254 // ifrnd 2 = (256 - 2 = 254)
						else setvar RNDMIZERLIMIT 240 // ifrnd 16 = (256 - 16 = 240)
						state rndmizer256
						ifvarvarg RNDMIZER RNDMIZERLIMIT
						{
							getactorvar[PYTHAGORASTARGET].ACTORBOOTSAMOUNT TEMP
							ifvarg TEMP 0
							{
								subvar TEMP 1
								ifvarl TEMP 1
								{
									debris SCRAP1 1
									debris SCRAP2 1
									debris SCRAP3 1
									setvar TEMP 0
								}
								setactorvar[PYTHAGORASTARGET].ACTORBOOTSAMOUNT TEMP
							}
							else
							{
								getactorvar[PYTHAGORASTARGET].ACTORHP TEMPVAR8
								//addlogvar TEMPVAR8
								getactor[PYTHAGORASTARGET].picnum tempc
								//addlogvar tempc
								ifvare tempc TANK
								{
									randvar tempe 2
									mulvar tempe 1
									addvar tempe 1
								}
								else
								ifvare tempc EMPTYTANK
								{
									randvar tempe 2
									mulvar tempe 1
									addvar tempe 1
								}
								else
								ifvare tempc SCORPIONTANK
								{
									randvar tempe 2
									mulvar tempe 1
									addvar tempe 1
								}
								else
								ifvare tempc BOSS1
								{
									randvar tempe 1
									mulvar tempe 1
									addvar tempe 0
								}
								else
								ifvare tempc BOSS2
								{
									randvar tempe 1
									mulvar tempe 1
									addvar tempe 0
								}
								else
								ifvare tempc BOSS3
								{
									randvar tempe 1
									mulvar tempe 1
									addvar tempe 0
								}
								else
								ifvare tempc BOSS4
								{
									randvar tempe 1
									mulvar tempe 1
									addvar tempe 0
								}
								else
								{
									randvar tempe 3
									mulvar tempe 1
									addvar tempe 1
								}
				
								ifvarn ENEMYHASSHIKON? 0 divvar tempe 10
				
								subvarvar TEMPVAR8 tempe
								//addlogvar TEMPVAR8
								ifvarg tempe 0
								{
									setvarvar SHOWDAMAGE tempe
									setvar SHOWDAMAGETYPE 0
									setvarvar SHOWDAMAGEACTORID PYTHAGORASTARGET
									state showdamage
								}
								ifvarl TEMPVAR8 1
								{
									setvar TEMPVAR8 0
									setactor[PYTHAGORASTARGET].htowner THISACTOR
									setactor[PYTHAGORASTARGET].htpicnum NEWBLOODPOOL
								}
								//addlogvar TEMPVAR8
								setactorvar[PYTHAGORASTARGET].ACTORHP TEMPVAR8
								ifvarg tempe 0 
								{
									setactorvar[PYTHAGORASTARGET].ACTORHPDAMAGED? 1
									state enemybloodpooldamagesnds
								}
							}
						}
					}
					else
					{
						ifrnd 16 sound INVULNITEM3
					}
				}
			}
		}
	}
ends

state getspritecenterz
	getactor[THISACTOR].xrepeat OBJECTXREPEAT
	getactor[THISACTOR].yrepeat OBJECTYREPEAT
	getactor[THISACTOR].z OBJECTZ
	
	setvarvar OBJECTDIFF OBJECTHEIGHT
	mulvarvar OBJECTDIFF OBJECTYREPEAT
	ifactor NEWPLUG mulvar OBJECTDIFF 2
	else { mulvar OBJECTDIFF 3 divvar OBJECTDIFF 2 }
	
	setvarvar OBJECTDIFF2 OBJECTHEIGHT
	mulvarvar OBJECTDIFF2 OBJECTYREPEAT
	ifactor NEWPLUG mulvar OBJECTDIFF2 4
	else { mulvar OBJECTDIFF2 13 divvar OBJECTDIFF2 2 }
	
	setvarvar OBJECTCENTERZ OBJECTZ
	addvarvar OBJECTCENTERZ OBJECTDIFF
ends

state createmusicsfx_snackcola
	getwall[ARRAYPOSITION].x TEMP
	getwall[ARRAYPOSITION].y TEMP2
	getwall[ARRAYPOSITION].point2 TEMPVAR5
	addvarvar TEMP wall[TEMPVAR5].x divvar TEMP 2
	addvarvar TEMP2 wall[TEMPVAR5].y divvar TEMP2 2
	
	espawn MUSICANDSFX
	setactor[RETURN].xrepeat 32
	setactor[RETURN].yrepeat 32
	setactor[RETURN].hitag 4096 // Sound Radius
	setactor[RETURN].lotag VENDING_HUM // 918
	
	setactor[RETURN].x TEMP
	setactor[RETURN].y TEMP2
	getwall[ARRAYPOSITION].nextwall TEMP4
	getwall[TEMP4].nextsector TEMP4
	getsector[TEMP4].floorz TEMP5
	setactor[RETURN].z TEMP5
	changespritesect RETURN TEMP4
	
	setactorvar[RETURN].MUSICANDSFX_LINKTYPE 1
	setactorvar[RETURN].MUSICANDSFX_LINKID ARRAYPOSITION
	getwall[ARRAYPOSITION].picnum TEMP3
	setactorvar[RETURN].MUSICANDSFX_LINKPICNUM TEMP3
ends

state setupvendingquanityb // For giving 'broken' vending machines an amount of items [doesn't try to add an MUSICANDSFX sprite for this version]
	ifvarvarl ARRAYPOSITION NUMWALLS getwall[ARRAYPOSITION].hitag temp
	ifvarn temp 0
	{
		setactorvar[ARRAYPOSITION].VENDINGQUANITY temp
		setwall[ARRAYPOSITION].hitag 0
	}
	else
	{
		setactorvar[ARRAYPOSITION].VENDINGQUANITY 64
		setwall[ARRAYPOSITION].hitag 0
	}
ends

state setupvendingquanity // Also puts a MUSICANDSFX sprite along the wall with Cola/Snack machine textures to give off an ambient humming
	ifvarvarl ARRAYPOSITION NUMWALLS getwall[ARRAYPOSITION].hitag temp
	ifvarn temp 0
	{
		setactorvar[ARRAYPOSITION].VENDINGQUANITY temp
		setwall[ARRAYPOSITION].hitag 0
	}
	else
	{
		setactorvar[ARRAYPOSITION].VENDINGQUANITY 64
		setwall[ARRAYPOSITION].hitag 0
	}
	
	state createmusicsfx_snackcola
ends

state createmusicsfx_atm
	getwall[ARRAYPOSITION].x TEMP
	getwall[ARRAYPOSITION].y TEMP2
	getwall[ARRAYPOSITION].point2 TEMPVAR5
	addvarvar TEMP wall[TEMPVAR5].x divvar TEMP 2
	addvarvar TEMP2 wall[TEMPVAR5].y divvar TEMP2 2
	
	espawn MUSICANDSFX
	setactor[RETURN].xrepeat 32
	setactor[RETURN].yrepeat 32
	setactor[RETURN].hitag 1280 // Sound Radius
	setactor[RETURN].lotag ATM_HUM // 923
	
	setactor[RETURN].x TEMP
	setactor[RETURN].y TEMP2
	getwall[ARRAYPOSITION].nextwall TEMP4
	getwall[TEMP4].nextsector TEMP4
	getsector[TEMP4].floorz TEMP5
	setactor[RETURN].z TEMP5
	changespritesect RETURN TEMP4
	
	setactorvar[RETURN].MUSICANDSFX_LINKTYPE 1
	setactorvar[RETURN].MUSICANDSFX_LINKID ARRAYPOSITION
	getwall[ARRAYPOSITION].picnum TEMP3
	setactorvar[RETURN].MUSICANDSFX_LINKPICNUM TEMP3 // ATM
ends

state setupatmsounds // Sets a MUSICANDSFX sprite along an wall with an ATM texture to give off an ambient humming
	getwall[ARRAYPOSITION].lotag TEMP6
	ifvarn TEMP6 16384
	{
		state createmusicsfx_atm
	}
ends

state setupmilkfridge
	ifvarn wall[ARRAYPOSITION].lotag 16384
	{
		getwall[ARRAYPOSITION].x TEMP
		getwall[ARRAYPOSITION].y TEMP2
		getwall[ARRAYPOSITION].point2 TEMPVAR5
		addvarvar TEMP wall[TEMPVAR5].x divvar TEMP 2
		addvarvar TEMP2 wall[TEMPVAR5].y divvar TEMP2 2
	
		espawn MUSICANDSFX
		setactor[RETURN].xrepeat 32
		setactor[RETURN].yrepeat 32
		setactor[RETURN].hitag 4096 // Sound Radius
		setactor[RETURN].lotag REFRIGERATOR_HUM // 925
	
		setactor[RETURN].x TEMP
		setactor[RETURN].y TEMP2
		getwall[ARRAYPOSITION].nextwall TEMP4
		ifvarg TEMP4 -1
		{
			getwall[TEMP4].nextsector TEMP4
			getsector[TEMP4].floorz TEMP5
		}
		setactor[RETURN].z TEMP5
		ifvarg TEMP4 -1 changespritesect RETURN TEMP4
	
		setactorvar[RETURN].MUSICANDSFX_LINKTYPE 1
		setactorvar[RETURN].MUSICANDSFX_LINKID ARRAYPOSITION
		getwall[ARRAYPOSITION].picnum TEMP3
		setactorvar[RETURN].MUSICANDSFX_LINKPICNUM TEMP3 // ATM
	}
ends


state maxcivsincrease
	ifactor DEALER nullop
	else
	{
		setvar MISCARRAYID 15 // Civs Saved [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 14 // Civs Saved [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	}
	setvar MISCARRAYID 19 // Civs Killed [Game]
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
	setvar MISCARRAYID 18 // Civs Killed [Level]
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
ends

state maxcivsincrease2
	ifactor DEALER nullop
	else
	{
		setvar MISCARRAYID 15 // Civs Saved [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 2
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 14 // Civs Saved [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 2
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	}
	setvar MISCARRAYID 19 // Civs Killed [Game]
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 2
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
	setvar MISCARRAYID 18 // Civs Killed [Level]
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 2
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
ends

state swapscreen1
	randvar tempe 96
	ifvarl tempe 11
	{
		setvar tempf 10496
		addvarvar tempf tempe
		setwall[ARRAYPOSITION].picnum tempf
	}
	ifvarg tempe 10
	{
		setvar tempf 10533
		addvarvar tempf tempe
		setwall[ARRAYPOSITION].picnum tempf
	}
ends

state swapvendingmachine
	randvar tempe 46
	ifvarl tempe 31
	{
		setvar tempf 7636
		addvarvar tempf tempe
		setwall[ARRAYPOSITION].picnum tempf
	}
	ifvare tempe 31 setwall[ARRAYPOSITION].picnum 7679
	ifvarg tempe 31
	{
		setvar tempf 7788
		addvarvar tempf tempe
		setwall[ARRAYPOSITION].picnum tempf
	}
ends

state sector_centerpoint2
	whilevarvarn TEMPVAR4 TEMPVAR5
	{
		getwall[TEMPVAR6].x TEMPVAR7
		getwall[TEMPVAR6].y TEMPVAR8
		ifvare TEMPVAR4 0
		{
			setvarvar CALCVAR1 TEMPVAR7 setvarvar CALCVAR2 TEMPVAR7
			setvarvar CALCVAR3 TEMPVAR8 setvarvar CALCVAR4 TEMPVAR8
		}
		else
		{
			ifvarvarl TEMPVAR7 CALCVAR1 setvarvar CALCVAR1 TEMPVAR7 else
			ifvarvarg TEMPVAR7 CALCVAR2 setvarvar CALCVAR2 TEMPVAR7
		
			ifvarvarl TEMPVAR8 CALCVAR3 setvarvar CALCVAR3 TEMPVAR8 else
			ifvarvarg TEMPVAR8 CALCVAR4 setvarvar CALCVAR4 TEMPVAR8
		}
		addvar TEMPVAR6 1
		addvar TEMPVAR4 1
		/*
		// addlogvar TEMPVAR4
		ifvare TEMPVAR4 0
		{
			setvarvar TEMPVAR2 0
			setvarvar TEMPVAR3 0
			getsector[ARRAYPOSITION].wallptr TEMPVAR6
			getwall[TEMPVAR6].x TEMPVAR7
			getwall[TEMPVAR6].y TEMPVAR8
			// addlogvar TEMPVAR7
			// addlogvar TEMPVAR8
			addvarvar TEMPVAR2 TEMPVAR7
			addvarvar TEMPVAR3 TEMPVAR8
			// addlogvar TEMPVAR2
			// addlogvar TEMPVAR3
		}
		else
		{
			getwall[TEMPVAR6].point2 TEMPVAR6
			getwall[TEMPVAR6].x TEMPVAR7
			getwall[TEMPVAR6].y TEMPVAR8
			// addlogvar TEMPVAR7
			// addlogvar TEMPVAR8
			addvarvar TEMPVAR2 TEMPVAR7
			addvarvar TEMPVAR3 TEMPVAR8
			// addlogvar TEMPVAR2
			// addlogvar TEMPVAR3
		}
		addvar TEMPVAR4 1
	*/
	}
	subvarvar CALCVAR2 CALCVAR1
	subvarvar CALCVAR4 CALCVAR3
	ifvarl CALCVAR2 0 mulvar CALCVAR2 -1
	ifvarl CALCVAR4 0 mulvar CALCVAR4 -1
	setvarvar x CALCVAR2
	shiftvarr x 3
	setvarvar y CALCVAR4
	shiftvarr y 3
	setvarvar TEMPVAR3 x
	mulvarvar TEMPVAR3 y
	shiftvarr TEMPVAR3 11
	ifvarg TEMPVAR3 320 setvar TEMPVAR3 320
	
	/*
	divvarvar TEMPVAR2 TEMPVAR5
	divvarvar TEMPVAR3 TEMPVAR5
	// addlogvar TEMPVAR2
	// addlogvar TEMPVAR3
	*/
	espawn RPGSPRITE
	setactor[RETURN].x x
	setactor[RETURN].y y
	getsector[ARRAYPOSITION].floorz TEMPVAR8
	setactor[RETURN].z TEMPVAR8
	setactor[RETURN].sectnum ARRAYPOSITION
ends

state sector_centerpoint
	getsector[ARRAYPOSITION].wallptr TEMPVAR6
	// addlogvar TEMPVAR6
	getsector[ARRAYPOSITION].wallnum TEMPVAR5
	// addlogvar TEMPVAR5
	setvar TEMPVAR4 0
	state sector_centerpoint2
ends

state sfx_firecrackle-sector
	getsector[ARRAYPOSITION].wallnum TEMPVAR5
	setvar TEMPVAR4 0
	whilevarvarn TEMPVAR4 TEMPVAR5
	{
		//addlogvar TEMPVAR4
		ifvare TEMPVAR4 0
		{
			setvarvar TEMPVAR2 0
			setvarvar TEMPVAR3 0
			getsector[ARRAYPOSITION].wallptr TEMPVAR6
			getwall[TEMPVAR6].x TEMPVAR7
			getwall[TEMPVAR6].y TEMPVAR8
			//addlogvar TEMPVAR7
			//addlogvar TEMPVAR8
			addvarvar TEMPVAR2 TEMPVAR7
			addvarvar TEMPVAR3 TEMPVAR8
			//addlogvar TEMPVAR2
			//addlogvar TEMPVAR3
		}
		else
		{
			getwall[TEMPVAR6].point2 TEMPVAR6
			getwall[TEMPVAR6].x TEMPVAR7
			getwall[TEMPVAR6].y TEMPVAR8
			//addlogvar TEMPVAR7
			//addlogvar TEMPVAR8
			addvarvar TEMPVAR2 TEMPVAR7
			addvarvar TEMPVAR3 TEMPVAR8
			//addlogvar TEMPVAR2
			//addlogvar TEMPVAR3
		}
		addvar TEMPVAR4 1
	}
	divvarvar TEMPVAR2 TEMPVAR5
	divvarvar TEMPVAR3 TEMPVAR5
	//addlogvar TEMPVAR2
	//addlogvar TEMPVAR3
	espawn MUSICANDSFX
	setactor[RETURN].xrepeat 32
	setactor[RETURN].yrepeat 32
	setactor[RETURN].x TEMPVAR2
	setactor[RETURN].y TEMPVAR3
	
	getsector[ARRAYPOSITION].floorpicnum TEMP3
	ifvare TEMP3 NEWHURTRAIL
	{
		randvar TEMPVAR7 1250
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 2500
		setactor[RETURN].lotag 600
	}
	else
	ifvare TEMP3 NEWFLOORPLASMA
	{
		randvar TEMPVAR7 480
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 1200
		setactor[RETURN].lotag 194
	}
	else
	ifvare TEMP3 HOTLAVA
	{
		randvar TEMPVAR7 640
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 1600
		setactor[RETURN].lotag 194
	}
	else
	ifvare TEMP3 MEGALAVA
	{
		randvar TEMPVAR7 1024
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 2560
		setactor[RETURN].lotag 194
	}
	else
	ifvare TEMP3 ULTRALAVA
	{
		randvar TEMPVAR7 1536
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 4096
		setactor[RETURN].lotag 194
	}
	else
	ifvare TEMP3 HYPERMAGMA
	{
		randvar TEMPVAR7 2048
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 5120
		setactor[RETURN].lotag 194
	}
	else
	{
		randvar TEMPVAR7 1024
		ifrnd 128 mulvar TEMPVAR7 -1
		addvar TEMPVAR7 2560
		setactor[RETURN].lotag 194
	}
	ifvarg TEMPVAR7 0 { mulvar TEMPVAR7 5 divvar TEMPVAR7 4 }
	setactor[RETURN].hitag TEMPVAR7
	
	getsector[ARRAYPOSITION].floorz TEMPVAR8
	randvar TEMPVAR7 192
	ifrnd 128 mulvar TEMPVAR7 -1
	addvar TEMPVAR7 512
	subvarvar TEMPVAR8 TEMPVAR7
	setactor[RETURN].z TEMPVAR8
	setactor[RETURN].sectnum ARRAYPOSITION
	setactorvar[RETURN].MUSICANDSFX_LINKTYPE 3
	setactorvar[RETURN].MUSICANDSFX_LINKID ARRAYPOSITION
	getsector[ARRAYPOSITION].floorpicnum TEMP3
	setactorvar[RETURN].MUSICANDSFX_LINKPICNUM TEMP3
ends

state initializer
	/*
	setarray ACHIEVEMENTS_LOCAL[1] 1
	writearraytofile ACHIEVEMENTS_LOCAL 901
	setarray ACHIEVEMENTS_GLOBAL[1] 1
	writearraytofile ACHIEVEMENTS_GLOBAL 902
	*/
	setvar MISCARRAYID 228 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // GLOBAL-PLAYER-INIT
	ifvare MISCARRAYID_AMOUNTTEMP 0
	{
		state setarrayvars
		setvar MISCARRAYID 228 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 1 // GLOBAL-PLAYER-INIT
	}
	readgamevar debugtoggle
	readgamevar statusdisplaytoggle
	readgamevar miscdisplaytoggle
	readgamevar lifebartogglemode
	readgamevar automedikittoggle
	readgamevar automantletoggle
	readgamevar footstepsndtoggle
	readgamevar normalhitscantoggle
	readgamevar vehiclepickuptoggle
	readgamevar rpgdmgdisplaytoggle
	readgamevar autosavetoggle
	readgamevar weapontoggleselect
	readgamevar upperlefthandlegend
	readgamevar AUTOSAVEFREQUENCY
	readgamevar INVULNREFLECTRATE
	readgamevar INVULNHEALTHDRAIN
	readgamevar ENEMYRANDOMIZERCHANCE
	readgamevar WORLDTILEBITFIELD1
	readgamevar WORLDTILEBITFIELD2
	readgamevar WORLDTILEBITFIELD3
	readgamevar WORLDTILEBITFIELD4
	readgamevar WORLDTILEBITFIELD5
	readgamevar WORLDTILEBITFIELD6
	readgamevar WORLDTILEBITFIELD7
	readgamevar WORLDTILEBITFIELD8
	readgamevar WORLDTILEVIEWMODE
	
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile

	setvar ARRAYPOSITION 0
	whilevarn ARRAYPOSITION 16383
	{
		// Wall IDs <.<
		ifvarg ARRAYPOSITION -1 ifvarvarl ARRAYPOSITION NUMWALLS // 16384
		{
			ifvarn wall[ARRAYPOSITION].picnum -1
			{
				ifvare wall[ARRAYPOSITION].picnum 866
				{
					// gettimedate temp tempb tempc tempd tempe TEMP TEMP2 TEMP3
					// addvar tempe 1
					randvar tempe 4
					addvar tempe 5
					ifvare tempe 5 setwall[ARRAYPOSITION].picnum 6254 // May
					ifvare tempe 6 setwall[ARRAYPOSITION].picnum 6255 // June
					ifvare tempe 7 setwall[ARRAYPOSITION].picnum 6256 // July
					ifvare tempe 8 setwall[ARRAYPOSITION].picnum 6257 // August
					ifvare tempe 9 setwall[ARRAYPOSITION].picnum 6271 // September
				}
				ifvare wall[ARRAYPOSITION].picnum 867 state setupatmsounds
				ifvare wall[ARRAYPOSITION].picnum 1212 state setupvendingquanity
				ifvare wall[ARRAYPOSITION].picnum 1214 state setupvendingquanityb
				ifvare wall[ARRAYPOSITION].picnum 1215 state setupvendingquanity
				ifvare wall[ARRAYPOSITION].picnum 1217 state setupvendingquanityb
				ifvare wall[ARRAYPOSITION].picnum 4181 state setupmilkfridge // W_MILKSHELF
				ifvare wall[ARRAYPOSITION].picnum 6258
				{
					// gettimedate temp tempb tempc tempd tempe TEMP TEMP2 TEMP3
					// addvar tempe 1
					randvar tempe 4
					addvar tempe 5
					ifvare tempe 5 setwall[ARRAYPOSITION].picnum 6254 // May
					ifvare tempe 6 setwall[ARRAYPOSITION].picnum 6255 // June
					ifvare tempe 7 setwall[ARRAYPOSITION].picnum 6256 // July
					ifvare tempe 8 setwall[ARRAYPOSITION].picnum 6257 // August
					ifvare tempe 9 setwall[ARRAYPOSITION].picnum 6271 // September
				}
				ifvare wall[ARRAYPOSITION].picnum 7428 state swapvendingmachine
			
				ifvarg wall[ARRAYPOSITION].picnum 7635 ifvarl wall[ARRAYPOSITION].picnum 7680 state setupvendingquanity
				ifvarg wall[ARRAYPOSITION].picnum 7815 ifvarl wall[ARRAYPOSITION].picnum 7835 state setupvendingquanity
				ifvare wall[ARRAYPOSITION].picnum 10750 state swapscreen1
			}
		}
		
		// Sector IDs >.>
		ifvarg ARRAYPOSITION -1 ifvarvarl ARRAYPOSITION NUMSECTORS // 4096 // Only 4096 sectors can be on a map [ID#s 0-4095]
		{
			// Check the floor tile
			setactorvar[ARRAYPOSITION].SPACESECTOR? 0
			ifvare sector[ARRAYPOSITION].floorpicnum MOONSKY1
			{
				ifvarand sector[ARRAYPOSITION].floorstat 1
				{
					ifvare sector[ARRAYPOSITION].floorpal 0
					{
						setactorvar[ARRAYPOSITION].SPACESECTOR? 1
						setsector[ARRAYPOSITION].floorpal 3
					}
				}
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum BIGORBIT1
			{
				ifvarand sector[ARRAYPOSITION].floorstat 1
				{
					ifvare sector[ARRAYPOSITION].floorpal 0
					{
						setactorvar[ARRAYPOSITION].SPACESECTOR? 1
						setsector[ARRAYPOSITION].floorpal 3
					}
				}
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum FLOORSLIME
			{
				setsector[ARRAYPOSITION].floorpicnum NEWFLOORSLIME
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 0
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
				setactorvar[ARRAYPOSITION].FLOORHEATRATIO 0
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum HURTRAIL
			{
				setsector[ARRAYPOSITION].floorpicnum NEWHURTRAIL
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 0
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
				setactorvar[ARRAYPOSITION].FLOORHEATRATIO 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum FLOORPLASMA
			{
				setsector[ARRAYPOSITION].floorpicnum NEWFLOORPLASMA
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 400 addvar TEMPVAR 1000 } // 1000 to 1400 HP
					else { randvar TEMPVAR 80 addvar TEMPVAR 200 } // 1400 to 2000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA NEWFLOORPLASMA
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB NEWFLOORPLASMAFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare actorvar[ARRAYPOSITION].SUBMERGABLESECTOR? 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum PURPLELAVA
			{
				setsector[ARRAYPOSITION].floorpicnum NEWPURPLELAVA
				setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
				setactorvar[ARRAYPOSITION].FLOORHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 0
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				setactorvar[ARRAYPOSITION].FLOORHEATRATIO 0
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum NEWHURTRAIL
			{
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 0
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
				setactorvar[ARRAYPOSITION].FLOORHEATRATIO 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum NEWFLOORPLASMA
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 400 addvar TEMPVAR 1000 } // 1000 to 1400 HP
					else { randvar TEMPVAR 80 addvar TEMPVAR 200 } // 200 to 280 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA NEWFLOORPLASMA
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB NEWFLOORPLASMAFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum HOTLAVA
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 1000 addvar TEMPVAR 2500 } // 2500 to 3500 HP
					else { randvar TEMPVAR 200 addvar TEMPVAR 500 } // 500 to 700 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA HOTLAVA
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB HOTLAVAFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum MEGALAVA
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 1600 addvar TEMPVAR 4000 } // 4000 to 5600 HP
					else { randvar TEMPVAR 320 addvar TEMPVAR 800 } // 800 to 1120 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA MEGALAVA
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB MEGALAVAFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum ULTRALAVA
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 3000 addvar TEMPVAR 7000 } // 7000 to 10000 HP
					else { randvar TEMPVAR 600 addvar TEMPVAR 1400 } // 1400 to 2000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA ULTRALAVA
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB ULTRALAVAFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum HYPERMAGMA
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 4500 addvar TEMPVAR 10500 } // 10500 to 15000 HP
					else { randvar TEMPVAR 900 addvar TEMPVAR 2100 } // 2100 to 3000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA HYPERMAGMA
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB HYPERMAGMAFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
		
				state sfx_firecrackle-sector
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum 336 // Classic Style Water
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 400 addvar TEMPVAR 1000 } // 1000 to 1400 HP
					else { randvar TEMPVAR 80 addvar TEMPVAR 200 } // 1400 to 2000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 336
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 4068
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum 3784 // Shadow Warrior Style Water [Dark Blue]
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 400 addvar TEMPVAR 1000 } // 1000 to 1400 HP
					else { randvar TEMPVAR 80 addvar TEMPVAR 200 } // 1400 to 2000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 3784
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 4069
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum 3800 // Shadow Warrior Style Water [Light Blue]
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 400 addvar TEMPVAR 1000 } // 1000 to 1400 HP
					else { randvar TEMPVAR 80 addvar TEMPVAR 200 } // 1400 to 2000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 3800
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 4070
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
			}
			else
			ifvare sector[ARRAYPOSITION].floorpicnum 3815 // Shadow Warrior Style Water [Rippling Portal]
			{
				// Set up frozen floors >.>
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0
				{ 
					setvar MISCARRAYID 72 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // FREEZING-MODE?
					ifvare MISCARRAYID_AMOUNTTEMP 0 { randvar TEMPVAR 400 addvar TEMPVAR 1000 } // 1000 to 1400 HP
					else { randvar TEMPVAR 80 addvar TEMPVAR 200 } // 1400 to 2000 HP
				}
				else setvar TEMPVAR 1
		
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORHEALTH TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 3815
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 4071
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				getsector[ARRAYPOSITION].lotag TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA TEMPVAR
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				getactorvar[ARRAYPOSITION].SUBMERGABLESECTOR? tempf
				ifvare tempf 0 setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 1 else setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
			}
			else
			{
				setactorvar[ARRAYPOSITION].FLOORMAXHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORHEALTH 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB 0
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA 0
				setactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB 0
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
				setactorvar[ARRAYPOSITION].FLOORFREEZABLE? 0
				setactorvar[ARRAYPOSITION].FLOORHEATRATIO 0
			}
		
			// Check the ceiling tile
			//ifvarvarl ARRAYPOSITION NUMSECTORS getsector[ARRAYPOSITION].ceilingpicnum tempb
			ifvare sector[ARRAYPOSITION].ceilingpicnum MOONSKY1
			{
				getsector[ARRAYPOSITION].ceilingstat tempf
				ifvarand tempf 1
				{
					getsector[ARRAYPOSITION].ceilingpal tempf
					ifvare tempf 0
					{
						setactorvar[ARRAYPOSITION].SPACESECTOR? 1
						setsector[ARRAYPOSITION].ceilingpal 3
					}
				}
			}
			else
			ifvare sector[ARRAYPOSITION].ceilingpicnum BIGORBIT1
			{
				getsector[ARRAYPOSITION].ceilingstat tempf
				ifvarand tempf 1
				{
					getsector[ARRAYPOSITION].ceilingpal tempf
					ifvare tempf 0
					{
						setactorvar[ARRAYPOSITION].SPACESECTOR? 1
						setsector[ARRAYPOSITION].ceilingpal 3
					}
				}
			}
			else
			ifvare sector[ARRAYPOSITION].ceilingpicnum FLOORSLIME setsector[ARRAYPOSITION].ceilingpicnum NEWFLOORSLIME
			else ifvare sector[ARRAYPOSITION].ceilingpicnum HURTRAIL setsector[ARRAYPOSITION].ceilingpicnum NEWHURTRAIL
			else ifvare sector[ARRAYPOSITION].ceilingpicnum FLOORPLASMA setsector[ARRAYPOSITION].ceilingpicnum NEWFLOORPLASMA
			else ifvare sector[ARRAYPOSITION].ceilingpicnum PURPLELAVA setsector[ARRAYPOSITION].ceilingpicnum NEWPURPLELAVA
		
			setactorvar[ARRAYPOSITION].SECTORISASECRET? 0
			setactorvar[ARRAYPOSITION].SECTOREXTRA 0
		
			// Check the Hitag
			ifvarvarl ARRAYPOSITION NUMSECTORS { getsector[ARRAYPOSITION].hitag tempb setactorvar[ARRAYPOSITION].SECTOREXTRA tempb }
		
			// Check the Lotag
			ifvarvarl ARRAYPOSITION NUMSECTORS getsector[ARRAYPOSITION].lotag tempb
		
			ifvare sector[ARRAYPOSITION].lotag 32767 
			{
				setvar MISCARRAYID 6 // Max Secrets [current level]
				getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
				addvar MISCARRAYID_AMOUNTTEMP 1
				setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		
				setvar MISCARRAYID 7 // Max Secrets [entire game]
				getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
				addvar MISCARRAYID_AMOUNTTEMP 1
				setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
			}
		
			setactorvar[ARRAYPOSITION].SECTORISASECRET? tempb
		}
		
		// Thing IDs -.-
		ifvarl ARRAYPOSITION 16384
		{
			getactor[ARRAYPOSITION].statnum tempc
			ifvarn tempc 1024
			{
				getactor[ARRAYPOSITION].picnum tempc
			
				switch tempc
					// Monsters
					case SHARK
						state load_shark
						break
					case ROTATEGUN
						state load_rotategun
						break
					case LIZTROOP
					case LIZTROOPSTAYPUT
					case LIZTROOPJETPACK
					case LIZTROOPDUCKING
					case LIZTROOPRUNNING
					case LIZTROOPSHOOT
					case LIZTROOPONTOILET
					case LIZTROOPJUSTSIT
						state load_liztroop
						break
					case PIGCOP
					case PIGCOPSTAYPUT
					case PIGCOPDIVE
						state load_pigcop
						break
					case LIZMAN
					case LIZMANSTAYPUT
					case LIZMANSPITTING
					case LIZMANJUMP
						state load_lizman
						break
					case DRONE
						state load_drone
						break
					case OCTABRAIN
					case OCTABRAINSTAYPUT
						state load_octabrain
						break
					case BOSS1
					case BOSS1STAYPUT
					case BOSS1SHOOT
					case BOSS1LOB
						state load_boss1
						break
					case BOSS2
					case BOSS2STAYPUT
					case BOSS2SHOOT
					case BOSS2BREATH
						state load_boss2
						break
					case BOSS3
					case BOSS3STAYPUT
					case BOSS3LOB
						state load_boss3
						break
					case COMMANDER
					case COMMANDERSTAYPUT
						state load_commander
						break
					case TANK
						state load_tank
						break
					case BOSS4
					case BOSS4STAYPUT
						state load_boss4
						break
					case NEWBEAST
					case NEWBEASTSTAYPUT
					case NEWBEASTHANG
					case NEWBEASTJUMP
						state load_newbeast
						break
					case SCORPIONTANK
						state load_scorpiontank
						break
			
					// Duke 3D NPCs
					case FEM1
					case FEM2
					case FEM3
					case FEM4
					case FEM5
					case FEM6
					case FEM7
					case FEM9
					case TOUGHGAL
					case NAKED1
					case PODFEM1
						state maxcivsincrease
						break
			
					case FEM10
						state maxcivsincrease2
						break
				endswitch   
			}
		}
		
		// End
		addvar ARRAYPOSITION 1
		ifvarg ARRAYPOSITION 16383 break
	}
	// addlogvar NUMWALLS
	// addlogvar NUMSECTORS
ends


state checkfloors-freezetimer
	getactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE tempc
	ifvare tempc 0 // Unfrozen
	{
		getactorvar[ARRAYPOSITION].FLOORHEALTH tempd
		getactorvar[ARRAYPOSITION].FLOORMAXHEALTH tempe
		ifvarg tempe 0
		{
			setvarvar tempf tempd
			mulvar tempf 100
			divvarvar tempf tempe
			setactorvar[ARRAYPOSITION].FLOORHEATRATIO tempf
		}
		ifvarvarl tempd tempe
		{
			ifvare mainmenu 0
			{
				addvar tempd 1
				ifvare tempb NEWFLOORPLASMA { ifrnd 16 addvar tempd 1 }
				ifvare tempb HOTLAVA { ifrnd 64 addvar tempd 1 ifrnd 16 addvar tempd 1 }
				ifvare tempb MEGALAVA { ifrnd 96 addvar tempd 1 ifrnd 64 addvar tempd 1 ifrnd 16 addvar tempd 1 }
				ifvare tempb ULTRALAVA { ifrnd 128 addvar tempd 1 ifrnd 96 addvar tempd 1 ifrnd 64 addvar tempd 1 ifrnd 16 addvar tempd 1 }
				ifvare tempb HYPERMAGMA { ifrnd 224 addvar tempd 1 ifrnd 128 addvar tempd 1 ifrnd 96 addvar tempd 1 ifrnd 64 addvar tempd 1 ifrnd 16 addvar tempd 1 }
			}
			ifvarvarg tempd tempe setvarvar tempd tempe
			setactorvar[ARRAYPOSITION].FLOORHEALTH tempd
		}
	
		getactorvar[ARRAYPOSITION].FLOORHEALTH tempd
		getactorvar[ARRAYPOSITION].FLOORMAXHEALTH tempe
		ifvarg tempd 0
		{
			getactorvar[ARRAYPOSITION].freezingmod TEMPVAR3
			addvarvar TEMPVAR3 freezingbase
		
			ifvarg TEMPVAR3 0
			{
				divvar TEMPVAR3 4
				ifvarl TEMPVAR3 1 { ifrnd 128 setvar TEMPVAR3 1 else setvar TEMPVAR3 0 }
			}
			ifvarg TEMPVAR3 1
			{
				ifoutside nullop else { mulvar TEMPVAR3 1 divvar TEMPVAR3 4 }
				ifrnd 192
				{
				randvarvar TEMPVAR4 TEMPVAR3
				getactorvar[ARRAYPOSITION].FLOORHEALTH tempd
				ifvare mainmenu 0 subvarvar tempd TEMPVAR4
				ifvarl tempd 0 setvar tempd 0
				setactorvar[ARRAYPOSITION].FLOORHEALTH tempd
				}
			}
		
			setvarvar tempf tempd
			mulvar tempf 100
			divvarvar tempf tempe
			setactorvar[ARRAYPOSITION].FLOORHEATRATIO tempf
		
			getactorvar[ARRAYPOSITION].FLOORHEALTH tempd
			getactorvar[ARRAYPOSITION].FLOORMAXHEALTH tempe
			ifvare tempd 0 ifvarg tempe 1
			{
				ifvarg ARRAYPOSITION -1 ifvarl ARRAYPOSITION 4096
				{
				getactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERB tempe
				setsector[ARRAYPOSITION].floorpicnum tempe
				getactorvar[ARRAYPOSITION].FLOORTEMPLOTAGB tempe
				setsector[ARRAYPOSITION].lotag tempe
				sound SOMETHINGFROZE
				setactorvar[ARRAYPOSITION].FLOORFREEZETIME 138
				setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 1
				}
			}
		}
	}
	else // Frozen
	{
		setactorvar[ARRAYPOSITION].FLOORHEATRATIO 0
		getactorvar[ARRAYPOSITION].FLOORFREEZETIME tempd
		subvar tempd 1
		ifvare mainmenu 0
		{
			ifvare tempb NEWFLOORPLASMA { ifrnd 16 subvar tempd 1 }
			ifvare tempb HOTLAVA { ifrnd 64 subvar tempd 1 ifrnd 16 subvar tempd 1 }
			ifvare tempb MEGALAVA { ifrnd 96 subvar tempd 1 ifrnd 64 subvar tempd 1 ifrnd 16 subvar tempd 1 }
			ifvare tempb ULTRALAVA { ifrnd 128 subvar tempd 1 ifrnd 96 subvar tempd 1 ifrnd 64 subvar tempd 1 ifrnd 16 subvar tempd 1 }
			ifvare tempb HYPERMAGMA { ifrnd 224 subvar tempd 1 ifrnd 128 subvar tempd 1 ifrnd 96 subvar tempd 1 ifrnd 64 subvar tempd 1 ifrnd 16 subvar tempd 1 }
		
			getactorvar[ARRAYPOSITION].freezingmod TEMPVAR3
			addvarvar TEMPVAR3 freezingbase
		
			ifvarg TEMPVAR3 0
			{
				divvar TEMPVAR3 8
				ifvarl TEMPVAR3 1 { ifrnd 64 setvar TEMPVAR3 1 else setvar TEMPVAR3 0 }
			}
		
			ifvarg TEMPVAR3 1
			{
				ifoutside nullop else { mulvar TEMPVAR3 1 divvar TEMPVAR3 4 }
				ifrnd 192
				{
				randvarvar TEMPVAR4 TEMPVAR3
				ifvare mainmenu 0 addvarvar tempd TEMPVAR4
				}
			}
		
			ifvarl tempd 0 setvar tempd 0
			ifvarg tempd 1560 setvar tempd 1560
			setactorvar[ARRAYPOSITION].FLOORFREEZETIME tempd
		}
		ifvare tempd 0
		{
			getactorvar[ARRAYPOSITION].FLOORTEMPFREEZENUMBERA tempe
			setsector[ARRAYPOSITION].floorpicnum tempe
			getactorvar[ARRAYPOSITION].FLOORTEMPLOTAGA tempe
			setsector[ARRAYPOSITION].lotag tempe
			getactorvar[ARRAYPOSITION].FLOORMAXHEALTH tempe
			divvar tempe 2     
			setactorvar[ARRAYPOSITION].FLOORHEALTH tempe
			setactorvar[ARRAYPOSITION].FLOORTEMPFREEZESTATE 0
		
			getsector[ARRAYPOSITION].floorpicnum tempb
			setvar TEMPVAR4 0
			ifvare tempb NEWFLOORPLASMA setvar TEMPVAR4 1
			ifvare tempb HOTLAVA setvar TEMPVAR4 1
			ifvare tempb MEGALAVA setvar TEMPVAR4 1
			ifvare tempb ULTRALAVA setvar TEMPVAR4 1
			ifvare tempb HYPERMAGMA setvar TEMPVAR4 1
			ifvare tempb 336 setvar TEMPVAR4 2
			ifvare tempb 3784 setvar TEMPVAR4 2
			ifvare tempb 3800 setvar TEMPVAR4 2
			ifvare tempb 3815 setvar TEMPVAR4 2
			
			// addlogvar TEMPVAR4
			ifvare TEMPVAR4 1
			{
				state sfx_firecrackle-sector
				ifrnd 85 sound LANDLAVA_HEAVY
				else ifrnd 128 sound LANDLAVA_LIGHT
				else sound LANDLAVA
			}
			else
			ifvare TEMPVAR4 2
			{      
				getactorvar[ARRAYPOSITION].FLOORMAXHEALTH tempe
				divvar tempe 5
				setactorvar[ARRAYPOSITION].FLOORHEALTH tempe
				ifrnd 85 sound LANDWATER_HEAVY
				else ifrnd 128 sound LANDWATER_LIGHT
				else sound LANDWATER
			}
		}
	}
ends

state checkfloors-freeze
	// Sector IDs >.>
	setvar ARRAYPOSITION 0
	whilevarvarn ARRAYPOSITION NUMSECTORS
	{
		// Check the floor tile
		ifvarvarl ARRAYPOSITION NUMSECTORS getsector[ARRAYPOSITION].floorpicnum tempb
	
		switch tempb
			case NEWFLOORPLASMA
			case NEWFLOORPLASMAFROZE
			case HOTLAVA
			case HOTLAVAFROZE
			case MEGALAVA
			case MEGALAVAFROZE
			case ULTRALAVA
			case ULTRALAVAFROZE
			case HYPERMAGMA
			case HYPERMAGMAFROZE
			case 336
			case 3784
			case 3800
			case 3815
			case 4068
			case 4069
			case 4070
			case 4071
				state checkfloors-freezetimer
				break
		endswitch
	
	addvar ARRAYPOSITION 1
	ifvarvarg ARRAYPOSITION NUMSECTORS break
	}
ends

state ammochange
	ifvare FLAGSSET? 0
	{
		ifvarand ACTORFLAGS 128 setvar FLAGSSET? 1 
		ifvarand ACTORFLAGS 256 setvar FLAGSSET? 1 
		ifvare PUBLICBETA? 1
		{
			ifvare LISA? 1
			{
				ifrnd 16 
				{ 
					ifrnd 4
					{
						getactorvar[THISACTOR].ACTORFLAGS TEMP2
						espawn ENERGYCELL_LARGE
						setactorvar[RETURN].ACTORFLAGS TEMP2
						killit 
					}
					else
					ifrnd 32
					{
						getactorvar[THISACTOR].ACTORFLAGS TEMP2
						espawn ENERGYCELL_MEDIUM
						setactorvar[RETURN].ACTORFLAGS TEMP2
						killit 
					}
					else
					{
						getactorvar[THISACTOR].ACTORFLAGS TEMP2
						espawn ENERGYCELL_SMALL
						setactorvar[RETURN].ACTORFLAGS TEMP2
						killit 
					}    
				}
				else setvar FLAGSSET? 1 
			}
			else setvar FLAGSSET? 1 
		}
	}
ends

state checkrandomhealitem
	ifvare FLAGSSET? 0
	{
		ifvare PUBLICBETA? 1
		{
			ifvare oldskoolmode 0
			{
				ifrnd 12
				{
					ifrnd 64 // Energy Items
					{
						ifrnd 192
						{
							getactorvar[THISACTOR].ACTORFLAGS TEMP2
							espawn SMALLENERGYDRINK
							setactorvar[RETURN].ACTORFLAGS TEMP2
							killit 
						}
						else 
						{
							ifrnd 192
							{
								getactorvar[THISACTOR].ACTORFLAGS TEMP2
								espawn LARGEENERGYDRINK
								setactorvar[RETURN].ACTORFLAGS TEMP2
								killit
							}
							else
							{
								getactorvar[THISACTOR].ACTORFLAGS TEMP2
								espawn HYPERENERGYDRINK
								setactorvar[RETURN].ACTORFLAGS TEMP2
								killit
							}
						}
					}
					else // Status Items
					{
						ifrnd 85 
						{
							getactorvar[THISACTOR].ACTORFLAGS TEMP2
							espawn EYEDROP
							setactorvar[RETURN].ACTORFLAGS TEMP2
							killit 
						}
						else 
						ifrnd 128
						{
							getactorvar[THISACTOR].ACTORFLAGS TEMP2
							espawn ANTIDOTE
							setactorvar[RETURN].ACTORFLAGS TEMP2
							killit
						}
						else
						{
							getactorvar[THISACTOR].ACTORFLAGS TEMP2
							espawn FOGHORN
							setactorvar[RETURN].ACTORFLAGS TEMP2
							killit
						}
					}
				}
				else setvar FLAGSSET? 1
			}
			else setvar FLAGSSET? 1
		}
	}
ends


state checkactorheight
	getactor[THISACTOR].picnum tempc
	
	switch tempc
		// Monsters
		case LIZTROOP
		case LIZTROOPSTAYPUT
		case LIZTROOPJETPACK
		case LIZTROOPDUCKING
		case LIZTROOPRUNNING
		case LIZTROOPSHOOT
		case LIZTROOPONTOILET
		case LIZTROOPJUSTSIT
			setvar ACTORSHEIGHT 88 setvar ACTORSWIDTH 56
			break
		case SHARK
			setvar ACTORSHEIGHT 44 setvar ACTORSWIDTH 56
			break
		case OCTABRAIN
		case OCTABRAINSTAYPUT
			setvar ACTORSHEIGHT 95 setvar ACTORSWIDTH 64
			break
		case SCORPIONTANK
			setvar ACTORSHEIGHT 90 setvar ACTORSWIDTH 128
			break
		case DRONE
			setvar ACTORSHEIGHT 40 setvar ACTORSWIDTH 56
			break
		case COMMANDER
		case COMMANDERSTAYPUT
			setvar ACTORSHEIGHT 83 setvar ACTORSWIDTH 96
			break
		case TANK
		case EMPTYTANK
			setvar ACTORSHEIGHT 74 setvar ACTORSWIDTH 88
			break
		case PIGCOP
		case PIGCOPSTAYPUT
		case PIGCOPDIVE
			setvar ACTORSHEIGHT 87 setvar ACTORSWIDTH 64
			break
		case RECON
			setvar ACTORSHEIGHT 60 setvar ACTORSWIDTH 88
			break
		case LIZMAN
		case LIZMANSTAYPUT
		case LIZMANSPITTING
		case LIZMANJUMP
			setvar ACTORSHEIGHT 87 setvar ACTORSWIDTH 64
			break
		case ROTATEGUN
			setvar ACTORSHEIGHT 19 setvar ACTORSWIDTH 40
			break
		case BOSS1
		case BOSS1STAYPUT
		case BOSS1SHOOT
		case BOSS1LOB
			setvar ACTORSHEIGHT 134 setvar ACTORSWIDTH 128
			break
		case BOSS2
		case BOSS2STAYPUT
		case BOSS2SHOOT
		case BOSS2BREATH
			setvar ACTORSHEIGHT 140 setvar ACTORSWIDTH 128
			break
		case BOSS3
		case BOSS3STAYPUT
		case BOSS3LOB
			setvar ACTORSHEIGHT 132 setvar ACTORSWIDTH 128
			break
		case NEWBEAST
		case NEWBEASTSTAYPUT
		case NEWBEASTHANG
		case NEWBEASTJUMP
			setvar ACTORSHEIGHT 117 setvar ACTORSWIDTH 72
			break
		case BOSS4
		case BOSS4STAYPUT
			setvar ACTORSHEIGHT 164 setvar ACTORSWIDTH 120
			break
	
		case APLAYER
			setvar ACTORSHEIGHT 84 setvar ACTORSWIDTH 48
			break
	
		case PODFEM1
			setvar ACTORSHEIGHT 115 setvar ACTORSWIDTH 72
			break
		case NAKED1
			setvar ACTORSHEIGHT 102 setvar ACTORSWIDTH 88
			break
		case FEM1
			setvar ACTORSHEIGHT 95 setvar ACTORSWIDTH 40
			break
		case FEM2
			setvar ACTORSHEIGHT 96 setvar ACTORSWIDTH 40
			break
		case FEM3
			setvar ACTORSHEIGHT 90 setvar ACTORSWIDTH 32
			break
		case FEM4
			setvar ACTORSHEIGHT 110 setvar ACTORSWIDTH 56
			break
		case FEM5
			setvar ACTORSHEIGHT 164 setvar ACTORSWIDTH 56
			break
		case FEM6
			setvar ACTORSHEIGHT 91 setvar ACTORSWIDTH 136
			break
		case FEM7
			setvar ACTORSHEIGHT 94 setvar ACTORSWIDTH 40
			break
		case FEM9
			setvar ACTORSHEIGHT 113 setvar ACTORSWIDTH 96
			break
		case FEM10
			setvar ACTORSHEIGHT 57 setvar ACTORSWIDTH 72
			break
		case TOUGHGAL
			setvar ACTORSHEIGHT 92 setvar ACTORSWIDTH 40
			break
		case WOMAN
			setvar ACTORSHEIGHT 97 setvar ACTORSWIDTH 40
			break
		case ROBOTDOG
			setvar ACTORSHEIGHT 38 setvar ACTORSWIDTH 24
			break
		case ROBOTDOG2
			setvar ACTORSHEIGHT 35 setvar ACTORSWIDTH 40
			break
		case PRESIDENTCLINTON
			setvar ACTORSHEIGHT 163 setvar ACTORSWIDTH 112
			break
		case DANCE1
			setvar ACTORSHEIGHT 156 setvar ACTORSWIDTH 56
			break
		case DANCE2
			setvar ACTORSHEIGHT 128 setvar ACTORSWIDTH 48
			break
		case DANCE3
			setvar ACTORSHEIGHT 154 setvar ACTORSWIDTH 56
			break
		case DANCE5
			setvar ACTORSHEIGHT 164 setvar ACTORSWIDTH 64
			break
		case DANCE6
			setvar ACTORSHEIGHT 174 setvar ACTORSWIDTH 72
			break
		case DANCE7
			setvar ACTORSHEIGHT 166 setvar ACTORSWIDTH 56
			break
		case DANCE9
			setvar ACTORSHEIGHT 147 setvar ACTORSWIDTH 112
			break
		case STAND1
			setvar ACTORSHEIGHT 170 setvar ACTORSWIDTH 56
			break
		case DEALER
			setvar ACTORSHEIGHT 129 setvar ACTORSWIDTH 56
			break
		case STAND3
			setvar ACTORSHEIGHT 127 setvar ACTORSWIDTH 40
			break
		case STAND4
			setvar ACTORSHEIGHT 162 setvar ACTORSWIDTH 56
			break
		case WOLFDUDE
			setvar ACTORSHEIGHT 66 setvar ACTORSWIDTH 32
			break
		case COP1
			setvar ACTORSHEIGHT 130 setvar ACTORSWIDTH 40
			break
		case PUNKDUDE
			setvar ACTORSHEIGHT 197 setvar ACTORSWIDTH 64
			break
		case COP2
			setvar ACTORSHEIGHT 177 setvar ACTORSWIDTH 48
			break
		case SITTINGDUDE
			setvar ACTORSHEIGHT 120 setvar ACTORSWIDTH 64
			break
		case ANIMEGIRL1
			setvar ACTORSHEIGHT 168 setvar ACTORSWIDTH 103
			break
		case ANIMEGIRL2
			setvar ACTORSHEIGHT 175 setvar ACTORSWIDTH 50
			break
		case ANIMEGIRL3
			setvar ACTORSHEIGHT 120 setvar ACTORSWIDTH 118
			break
		case ANIMEGIRL4
			setvar ACTORSHEIGHT 132 setvar ACTORSWIDTH 77
			break
	endswitch
ends

state rankstarplayer
	ifvare STARCHILD -1
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn PLAYERLEVEL 0
			{
				espawn LEVELRANKSTAR
				setactorvar[THISACTOR].STARCHILD RETURN
				setactorvar[RETURN].STARPARENT THISACTOR
			}
		}
	}
	
	ifvare HPBARCHILD -1
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn MAXHITPOINTS 0
			{
				espawn HPLIFEMETER // HPLIFEMETER represents the actor for HP Bars
				setactorvar[THISACTOR].HPBARCHILD RETURN
				setactorvar[RETURN].HPBARPARENT THISACTOR
			}
		}
	}
	
	ifvare APBARCHILD -1
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn MAXARMORPOINTS 0
			{
				espawn APLIFEMETER // APLIFEMETER represents the actor for AP Bars
				setactorvar[THISACTOR].APBARCHILD RETURN
				setactorvar[RETURN].APBARPARENT THISACTOR
			}
		}
	}
	
	ifvare POWERUPSTRIPCHILD -1
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn POWERUPBITFIELD 0
			{
				espawn POWERUPICONSTRIP
				setactorvar[THISACTOR].POWERUPSTRIPCHILD RETURN
				setactorvar[RETURN].POWERUPSTRIPPARENT THISACTOR
			}
		}
	}
	
	ifvare POINTERICONCHILD -1
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvare RADARARROWSET? 0 // Sets the arrow immediately instead of waiting for the actor to see you
			{
				espawn POINTERARROW // POINTERARROW is for when the actor can be seen on the Mercury Computer's Radar
				setactorvar[THISACTOR].POINTERICONCHILD RETURN
				setactorvar[RETURN].POINTERICONPARENT THISACTOR
				setvar RADARARROWSET? 1
			}
		}
	}
	state checkactorheight
ends

state rankstarbeta
	ifvarg ACTORHP 0
	{
		ifvare STARCHILD -1
		{
			setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
			ifvarn MISCARRAYID_AMOUNTTEMP 0
			{
				ifvarn ACTORLEVEL 0
				{
					espawn LEVELRANKSTAR
					setactorvar[THISACTOR].STARCHILD RETURN
					setactorvar[RETURN].STARPARENT THISACTOR
				}
			}
		}
		
		ifvare HPBARCHILD -1
		{
			setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
			ifvarn MISCARRAYID_AMOUNTTEMP 0
			{
				ifvarn ACTORMAXHP 0
				{
					espawn HPLIFEMETER // HPLIFEMETER represents the actor for HP Bars
					setactorvar[THISACTOR].HPBARCHILD RETURN
					setactorvar[RETURN].HPBARPARENT THISACTOR
				}
			}
		}
		
		ifvare APBARCHILD -1
		{
			setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
			ifvarn MISCARRAYID_AMOUNTTEMP 0
			{
				ifvarn ACTORMAXAP 0
				{
					espawn APLIFEMETER // APLIFEMETER represents the actor for AP Bars
					setactorvar[THISACTOR].APBARCHILD RETURN
					setactorvar[RETURN].APBARPARENT THISACTOR
				}
			}
		}
		
		ifvare POWERUPSTRIPCHILD -1
		{
			setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
			ifvarn MISCARRAYID_AMOUNTTEMP 0
			{
				ifvarn ACTORPOWERUPBITFIELD 0
				{
					espawn POWERUPICONSTRIP
					setactorvar[THISACTOR].POWERUPSTRIPCHILD RETURN
					setactorvar[RETURN].POWERUPSTRIPPARENT THISACTOR
				}
			}
		}
		
		ifvare POINTERICONCHILD -1
		{
			setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
			ifvarn MISCARRAYID_AMOUNTTEMP 0
			{
				ifvare RADARARROWSET? 0 // Sets the arrow immediately instead of waiting for the actor to see you
				{
					ifvarg debugtoggle 0
					{
						espawn POINTERARROW // POINTERARROW is for when the actor can be seen on the Mercury Computer's Radar
						setactorvar[THISACTOR].POINTERICONCHILD RETURN
						setactorvar[RETURN].POINTERICONPARENT THISACTOR
						setvar RADARARROWSET? 1
					}
					else
					{
						setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
						ifvare MISCARRAYID_AMOUNTTEMP 1
						{
							espawn POINTERARROW // POINTERARROW is for when the actor can be seen on the Mercury Computer's Radar
							setactorvar[THISACTOR].POINTERICONCHILD RETURN
							setactorvar[RETURN].POINTERICONPARENT THISACTOR
							setvar RADARARROWSET? 1
						}
					}
				}
			}
			/*
			else
			{
				ifvare RADARARROWSET? 0 // Sets the arrow immediately instead of waiting for the actor to see you
				{
					espawn POINTERARROW // POINTERARROW is for when the actor can be seen on the Mercury Computer's Radar
					setactorvar[THISACTOR].POINTERICONCHILD RETURN
					setactorvar[RETURN].POINTERICONPARENT THISACTOR
					setvar RADARARROWSET? 1
				}
			}
			*/
		}
		state checkactorheight
	}
ends

state getcharactergender
	ifvarg CHARACTERSELECTED? 0 ifvarl CHARACTERSELECTED? 4 setvar GENDER? 0
	ifvare CHARACTERSELECTED? 4 setvar GENDER? 1
	ifvarg CHARACTERSELECTED? 4 ifvarl CHARACTERSELECTED? 8 setvar GENDER? 0
	ifvare CHARACTERSELECTED? 8 setvar GENDER? 1
	ifvare CHARACTERSELECTED? 9 setvar GENDER? 0
	ifvarg CHARACTERSELECTED? 9 ifvarl CHARACTERSELECTED? 16 setvar GENDER? 1
ends

state calculateaveragelevel
	setvar AVERAGELEVEL 0
	ifvare DUKE? 1
	{
		setvar CHARACTERARRAY 1
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare JACK? 1
	{
		setvar CHARACTERARRAY 2
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare BUBSY? 1
	{
		setvar CHARACTERARRAY 3
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare AMI? 1
	{
		setvar CHARACTERARRAY 4
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare LOWANG? 1
	{
		setvar CHARACTERARRAY 5
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare ESSENCE? 1
	{
		setvar CHARACTERARRAY 6
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare TED? 1
	{
		setvar CHARACTERARRAY 7
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare LISA? 1
	{
		setvar CHARACTERARRAY 8
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare CYBANIS? 1
	{
		setvar CHARACTERARRAY 9
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare NETHRA? 1 
	{
		setvar CHARACTERARRAY 10
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare PAULA? 1 
	{
		setvar CHARACTERARRAY 11
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare LORI? 1
	{
		setvar CHARACTERARRAY 12
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare MINAKO? 1
	{
		setvar CHARACTERARRAY 13
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare MYSTERY1? 1
	{
		setvar CHARACTERARRAY 14
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	ifvare MAKEN? 1 
	{
		setvar CHARACTERARRAY 15
		addvarvar AVERAGELEVEL actorvar[CHARACTERARRAY].CHARACTERLEVEL
	}
	divvarvar AVERAGELEVEL PARTYSIZE
ends

state playerabsorbdamage
	setvarvar ABSORBEDDAMAGE PLAYERDAMAGE
	addvarvar CURRENTHITPOINTS PLAYERDAMAGE
	ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
	setvarvar TEMPHEALTH ABSORBEDDAMAGE
	state showhealing_playerhp
	
	setactor[PLAYERID].htextra -1
	stopsound NODAMAGE
	globalsound ABSORB_DAMAGE
	palfrom 32 64 64 64
	setvar PLAYERDAMAGE 0 
	qsprintf 336 337 ABSORBEDDAMAGE
	setvarvar fta fta_normal setvar ftq 336
ends

state calcplayermaxhealthatomic
	setvarvar MAXHITPOINTSATOMIC MAXHITPOINTS
	mulvar MAXHITPOINTSATOMIC 2
	ifvarvarg MAXHITPOINTSATOMIC STATLIMITATOMIC setvarvar MAXHITPOINTSATOMIC STATLIMITATOMIC
ends

state calcplayermaxarmoratomic
	setvarvar MAXARMORPOINTSATOMIC MAXARMORPOINTS
	mulvar MAXARMORPOINTSATOMIC 2
	ifvarvarg MAXARMORPOINTSATOMIC STATLIMITATOMIC setvarvar MAXARMORPOINTSATOMIC STATLIMITATOMIC
ends

state checkenemypickuphealth
	getactorvar[ITEMSEEK].ACTORHP ITEMSEEKB
ends

state resetitemtarget
	setactorvar[ITEMSEEK].ITEMTARGET -1
ends

state fullpower_alterations
	getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMP7 mulvar TEMP7 2 setactorvar[CHARACTERARRAY].CHARACTERFA TEMP7
	getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMP7 mulvar TEMP7 2 setactorvar[CHARACTERARRAY].CHARACTERHP TEMP7
	getactorvar[CHARACTERARRAY].CHARACTERMAXEP TEMP7 mulvar TEMP7 2 setactorvar[CHARACTERARRAY].CHARACTEREP TEMP7
	getactorvar[CHARACTERARRAY].CHARACTERMAXAP TEMP7 mulvar TEMP7 2 setactorvar[CHARACTERARRAY].CHARACTERAP TEMP7
	setactorvar[CHARACTERARRAY].CHARACTERAPABSORB 1000
ends

state fullpower
	state checkcontinues setvar ITEMARRAYID_AMOUNTTEMP 5 state setitemidarrayamount
	state checkbubsylives setvar ITEMARRAYID_AMOUNTTEMP 8 state setitemidarrayamount
	setvar CHARACTERARRAY 1 state fullpower_alterations
	setvar CHARACTERARRAY 2 state fullpower_alterations
	setvar CHARACTERARRAY 3 state fullpower_alterations
	setvar CHARACTERARRAY 4 state fullpower_alterations
	setvar CHARACTERARRAY 5 state fullpower_alterations
	setvar CHARACTERARRAY 6 state fullpower_alterations
	setvar CHARACTERARRAY 7 state fullpower_alterations
	setvar CHARACTERARRAY 8 state fullpower_alterations
	setvar CHARACTERARRAY 9 state fullpower_alterations
	setvar CHARACTERARRAY 10 state fullpower_alterations
	setvar CHARACTERARRAY 11 state fullpower_alterations
	setvar CHARACTERARRAY 12 state fullpower_alterations
	setvar CHARACTERARRAY 13 state fullpower_alterations
	setvar CHARACTERARRAY 14 state fullpower_alterations
	setvar CHARACTERARRAY 15 state fullpower_alterations
	setvarvar FIRSTAIDCURRENT MAXHITPOINTSATOMIC
	setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
	setvarvar CURRENTENERGYPOINTS MAXENERGYPOINTSATOMIC
	setvarvar CURRENTARMORPOINTS MAXARMORPOINTSATOMIC
	setvar ARMORPERCENT 1000
ends

state neardeath_alterations
	setactorvar[CHARACTERARRAY].CHARACTERFA 0
	ifvare NEARDEATH 2 setactorvar[CHARACTERARRAY].CHARACTERHP 0 else setactorvar[CHARACTERARRAY].CHARACTERHP 1
	setactorvar[CHARACTERARRAY].CHARACTEREP 0
	setactorvar[CHARACTERARRAY].CHARACTERAP 0
	setactorvar[CHARACTERARRAY].CHARACTERAPABSORB 0
ends

state neardeath
	ifvarg NEARDEATH 0
	{
		state checkcontinues setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount
		state checkbubsylives setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount
		setvar CHARACTERARRAY 1 state neardeath_alterations
		setvar CHARACTERARRAY 2 state neardeath_alterations
		setvar CHARACTERARRAY 3 state neardeath_alterations
		setvar CHARACTERARRAY 4 state neardeath_alterations
		setvar CHARACTERARRAY 5 state neardeath_alterations
		setvar CHARACTERARRAY 6 state neardeath_alterations
		setvar CHARACTERARRAY 7 state neardeath_alterations
		setvar CHARACTERARRAY 8 state neardeath_alterations
		setvar CHARACTERARRAY 9 state neardeath_alterations
		setvar CHARACTERARRAY 10 state neardeath_alterations
		setvar CHARACTERARRAY 11 state neardeath_alterations
		setvar CHARACTERARRAY 12 state neardeath_alterations
		setvar CHARACTERARRAY 13 state neardeath_alterations
		setvar CHARACTERARRAY 14 state neardeath_alterations
		setvar CHARACTERARRAY 15 state neardeath_alterations
		setvar FIRSTAIDCURRENT 0
		setvar CURRENTHITPOINTS 1
		setvar CURRENTENERGYPOINTS 0
		setvar CURRENTARMORPOINTS 0
		setvar ARMORPERCENT 0
		setvar NEARDEATH 0
	}
ends

state instantdeath_alterations
	setactorvar[CHARACTERARRAY].CHARACTERFA 0
	setactorvar[CHARACTERARRAY].CHARACTERHP 0
	setactorvar[CHARACTERARRAY].CHARACTEREP 0
	setactorvar[CHARACTERARRAY].CHARACTERAP 0
	setactorvar[CHARACTERARRAY].CHARACTERAPABSORB 0
ends

state killallcharacters // for "instant death" situations [bottomless pit, space sectors, or just goofing around :P]
	state checkcontinues setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount
	state checkbubsylives setvar ITEMARRAYID_AMOUNTTEMP 0 state setitemidarrayamount
	setvar CHARACTERARRAY 1 state instantdeath_alterations
	setvar CHARACTERARRAY 2 state instantdeath_alterations
	setvar CHARACTERARRAY 3 state instantdeath_alterations
	setvar CHARACTERARRAY 4 state instantdeath_alterations
	setvar CHARACTERARRAY 5 state instantdeath_alterations
	setvar CHARACTERARRAY 6 state instantdeath_alterations
	setvar CHARACTERARRAY 7 state instantdeath_alterations
	setvar CHARACTERARRAY 8 state instantdeath_alterations
	setvar CHARACTERARRAY 9 state instantdeath_alterations
	setvar CHARACTERARRAY 10 state instantdeath_alterations
	setvar CHARACTERARRAY 11 state instantdeath_alterations
	setvar CHARACTERARRAY 12 state instantdeath_alterations
	setvar CHARACTERARRAY 13 state instantdeath_alterations
	setvar CHARACTERARRAY 14 state instantdeath_alterations
	setvar CHARACTERARRAY 15 state instantdeath_alterations
	setvar FIRSTAIDCURRENT 0
	setvar CURRENTHITPOINTS 0
	setvar CURRENTENERGYPOINTS 0
	setvar CURRENTARMORPOINTS 0
	setvar ARMORPERCENT 0
ends

state resetworldtiles
  setvar WORLDTILEBITFIELD1 0
  setvar WORLDTILEBITFIELD2 0
  setvar WORLDTILEBITFIELD3 0
  setvar WORLDTILEBITFIELD4 0
  setvar WORLDTILEBITFIELD5 0
  setvar WORLDTILEBITFIELD6 0
  setvar WORLDTILEBITFIELD7 0
  setvar WORLDTILEBITFIELD8 0
	savegamevar WORLDTILEBITFIELD1
	savegamevar WORLDTILEBITFIELD2
	savegamevar WORLDTILEBITFIELD3
	savegamevar WORLDTILEBITFIELD4
	savegamevar WORLDTILEBITFIELD5
	savegamevar WORLDTILEBITFIELD6
	savegamevar WORLDTILEBITFIELD7
	savegamevar WORLDTILEBITFIELD8
	setvar RESETWORLDTILES 0
ends

state useswitchcheckwall
	ifvarn hitwall -1 
	{
		setvar MISCARRAYID 214 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-overpicnum
		getwall[hitwall].overpicnum MISCARRAYID_AMOUNTTEMP
		setvar MISCARRAYID 214 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // hitwall-overpicnum
	}
	ifvare MISCARRAYID_AMOUNTTEMP W_FORCEFIELD setvar TEMP2 0
	else ifvare MISCARRAYID_AMOUNTTEMP W_FORCEFIELDBLANK setvar TEMP2 0
	else ifvare MISCARRAYID_AMOUNTTEMP BIGFORCE setvar TEMP2 0
	else setvar TEMP2 1
ends

state rotateprojectilestraight
	getactor[THISACTOR].x ROTATEXORIGIN
	getactor[THISACTOR].y ROTATEYORIGIN
	getplayer[THISACTOR].ang TEMP
	setvarvar ROTATEXPOINT ROTATEXORIGIN
	addvar ROTATEXPOINT 256 // 384 // NOTE: APPEARANTLY ROTATEXPOINT IS THE KEY HERE FOR PROPER FRONT ALIGNMENT
	setvarvar ROTATEYPOINT ROTATEYORIGIN
	subvar ROTATEYPOINT 0
	rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT TEMP ROTATEXRETURN ROTATEYRETURN
	setactor[RETURN].x ROTATEXRETURN
	setactor[RETURN].y ROTATEYRETURN
ends

state rotateprojectileleft
	getactor[THISACTOR].x ROTATEXORIGIN
	getactor[THISACTOR].y ROTATEYORIGIN
	getplayer[THISACTOR].ang TEMP
	setvarvar ROTATEXPOINT ROTATEXORIGIN
	addvar ROTATEXPOINT 256 // 384 // NOTE: APPEARANTLY ROTATEXPOINT IS THE KEY HERE FOR PROPER FRONT ALIGNMENT
	setvarvar ROTATEYPOINT ROTATEYORIGIN
	subvar ROTATEYPOINT 128
	rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT TEMP ROTATEXRETURN ROTATEYRETURN
	setactor[RETURN].x ROTATEXRETURN
	setactor[RETURN].y ROTATEYRETURN
ends

state rotateprojectileright
	getactor[THISACTOR].x ROTATEXORIGIN
	getactor[THISACTOR].y ROTATEYORIGIN
	getplayer[THISACTOR].ang TEMP
	setvarvar ROTATEXPOINT ROTATEXORIGIN
	addvar ROTATEXPOINT 256 // 384 // NOTE: APPEARANTLY ROTATEXPOINT IS THE KEY HERE FOR PROPER FRONT ALIGNMENT
	setvarvar ROTATEYPOINT ROTATEYORIGIN
	addvar ROTATEYPOINT 128
	rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT TEMP ROTATEXRETURN ROTATEYRETURN
	setactor[RETURN].x ROTATEXRETURN
	setactor[RETURN].y ROTATEYRETURN
ends

state rotatepointtest
	getplayer[THISACTOR].posx ROTATEXORIGIN
	getplayer[THISACTOR].posy ROTATEYORIGIN
	setvarvar ROTATEXPOINT ROTATEXORIGIN
	setvarvar ROTATEYPOINT ROTATEYORIGIN
	ifvare ROTATEXINTERVAL 0 { setvar ROTATEXALTER 0 setvar ROTATEYALTER 0 }
	ifvare ROTATEXINTERVAL 1 { setvar ROTATEXALTER 32 setvar ROTATEYALTER 32 }
	ifvare ROTATEXINTERVAL 2 { setvar ROTATEXALTER 64 setvar ROTATEYALTER 64 }
	ifvare ROTATEXINTERVAL 3 { setvar ROTATEXALTER 96 setvar ROTATEYALTER 96 }
	ifvare ROTATEXINTERVAL 4 { setvar ROTATEXALTER 128 setvar ROTATEYALTER 128 }
	ifvare ROTATEXINTERVAL 5 { setvar ROTATEXALTER 160 setvar ROTATEYALTER 160 }
	ifvare ROTATEXINTERVAL 6 { setvar ROTATEXALTER 196 setvar ROTATEYALTER 196 }
	ifvare ROTATEXINTERVAL 7 { setvar ROTATEXALTER 224 setvar ROTATEYALTER 224 }
	ifvare ROTATEXINTERVAL 8 { setvar ROTATEXALTER 256 setvar ROTATEYALTER 256 }
	ifvare ROTATEXINTERVAL 9 { setvar ROTATEXALTER 224 setvar ROTATEYALTER 224 }
	ifvare ROTATEXINTERVAL 10 { setvar ROTATEXALTER 196 setvar ROTATEYALTER 196 }
	ifvare ROTATEXINTERVAL 11 { setvar ROTATEXALTER 160 setvar ROTATEYALTER 160 }
	ifvare ROTATEXINTERVAL 12 { setvar ROTATEXALTER 128 setvar ROTATEYALTER 128 }
	ifvare ROTATEXINTERVAL 13 { setvar ROTATEXALTER 96 setvar ROTATEYALTER 96 }
	ifvare ROTATEXINTERVAL 14 { setvar ROTATEXALTER 64 setvar ROTATEYALTER 64 }
	ifvare ROTATEXINTERVAL 15 { setvar ROTATEXALTER 32 setvar ROTATEYALTER 32 }
	ifvare ROTATEXINTERVAL 16 { setvar ROTATEXALTER 0 setvar ROTATEYALTER 0 }
	ifvare ROTATEXINTERVAL 17 { setvar ROTATEXALTER -32 setvar ROTATEYALTER -32 }
	ifvare ROTATEXINTERVAL 18 { setvar ROTATEXALTER -64 setvar ROTATEYALTER -64 }
	ifvare ROTATEXINTERVAL 19 { setvar ROTATEXALTER -96 setvar ROTATEYALTER -96 }
	ifvare ROTATEXINTERVAL 20 { setvar ROTATEXALTER -128 setvar ROTATEYALTER -128 }
	ifvare ROTATEXINTERVAL 21 { setvar ROTATEXALTER -160 setvar ROTATEYALTER -160 }
	ifvare ROTATEXINTERVAL 22 { setvar ROTATEXALTER -196 setvar ROTATEYALTER -196 }
	ifvare ROTATEXINTERVAL 23 { setvar ROTATEXALTER -224 setvar ROTATEYALTER -224 }
	ifvare ROTATEXINTERVAL 24 { setvar ROTATEXALTER -256 setvar ROTATEYALTER -256 }
	ifvare ROTATEXINTERVAL 25 { setvar ROTATEXALTER -224 setvar ROTATEYALTER -224 }
	ifvare ROTATEXINTERVAL 26 { setvar ROTATEXALTER -196 setvar ROTATEYALTER -196 }
	ifvare ROTATEXINTERVAL 27 { setvar ROTATEXALTER -160 setvar ROTATEYALTER -160 }
	ifvare ROTATEXINTERVAL 28 { setvar ROTATEXALTER -128 setvar ROTATEYALTER -128 }
	ifvare ROTATEXINTERVAL 29 { setvar ROTATEXALTER -96 setvar ROTATEYALTER -96 }
	ifvare ROTATEXINTERVAL 30 { setvar ROTATEXALTER -64 setvar ROTATEYALTER -64 }
	ifvare ROTATEXINTERVAL 31 { setvar ROTATEXALTER -32 setvar ROTATEYALTER -32 }
	addvar ROTATEXINTERVAL 1
	ifvarg ROTATEXINTERVAL 30 setvar ROTATEXINTERVAL 0
	addvarvar ROTATEXPOINT ROTATEXALTER
	addvarvar ROTATEYPOINT ROTATEYALTER
	addvar ROTATEANGLE 96
	rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT ROTATEANGLE ROTATEXRETURN ROTATEYRETURN

	getplayer[THISACTOR].posz ROTATEZORIGIN
	addvar ROTATEZORIGIN 8144
	setvarvar ROTATEZPOINT ROTATEZORIGIN
	setvarvar ROTATEZALTER ROTATEZINTERVAL
	mulvar ROTATEZALTER 1024
	subvarvar ROTATEZPOINT ROTATEZALTER
	setvarvar ROTATEZRETURN ROTATEZPOINT

	espawn EXPLOSION2 sound PIPEBOMB_EXPLODE sound ICE_EXPLODE
	setactor[RETURN].pal 1
	setactor[RETURN].x ROTATEXRETURN
	setactor[RETURN].y ROTATEYRETURN
	setactor[RETURN].z ROTATEZRETURN
	setactor[RETURN].xrepeat 16
	setactor[RETURN].yrepeat 16
	setactor[RETURN].cstat 642
ends

state rotatepointtest2
	getplayer[THISACTOR].posx ROTATEXORIGIN
	getplayer[THISACTOR].posy ROTATEYORIGIN
	setvarvar ROTATEXPOINT ROTATEXORIGIN
	setvarvar ROTATEYPOINT ROTATEYORIGIN
	ifvare ROTATEYINTERVAL 0 { setvar ROTATEXALTER 0 setvar ROTATEYALTER 0 }
	ifvare ROTATEYINTERVAL 1 { setvar ROTATEXALTER -32 setvar ROTATEYALTER -32 }
	ifvare ROTATEYINTERVAL 2 { setvar ROTATEXALTER -64 setvar ROTATEYALTER -64 }
	ifvare ROTATEYINTERVAL 3 { setvar ROTATEXALTER -96 setvar ROTATEYALTER -96 }
	ifvare ROTATEYINTERVAL 4 { setvar ROTATEXALTER -128 setvar ROTATEYALTER -128 }
	ifvare ROTATEYINTERVAL 5 { setvar ROTATEXALTER -160 setvar ROTATEYALTER -160 }
	ifvare ROTATEYINTERVAL 6 { setvar ROTATEXALTER -196 setvar ROTATEYALTER -196 }
	ifvare ROTATEYINTERVAL 7 { setvar ROTATEXALTER -224 setvar ROTATEYALTER -224 }
	ifvare ROTATEYINTERVAL 8 { setvar ROTATEXALTER -256 setvar ROTATEYALTER -256 }
	ifvare ROTATEYINTERVAL 9 { setvar ROTATEXALTER -224 setvar ROTATEYALTER -224 }
	ifvare ROTATEYINTERVAL 10 { setvar ROTATEXALTER -196 setvar ROTATEYALTER -196 }
	ifvare ROTATEYINTERVAL 11 { setvar ROTATEXALTER -160 setvar ROTATEYALTER -160 }
	ifvare ROTATEYINTERVAL 12 { setvar ROTATEXALTER -128 setvar ROTATEYALTER -128 }
	ifvare ROTATEYINTERVAL 13 { setvar ROTATEXALTER -96 setvar ROTATEYALTER -96 }
	ifvare ROTATEYINTERVAL 14 { setvar ROTATEXALTER -64 setvar ROTATEYALTER -64 }
	ifvare ROTATEYINTERVAL 15 { setvar ROTATEXALTER -32 setvar ROTATEYALTER -32 }
	ifvare ROTATEYINTERVAL 16 { setvar ROTATEXALTER 0 setvar ROTATEYALTER 0 }
	ifvare ROTATEYINTERVAL 17 { setvar ROTATEXALTER 32 setvar ROTATEYALTER 32 }
	ifvare ROTATEYINTERVAL 18 { setvar ROTATEXALTER 64 setvar ROTATEYALTER 64 }
	ifvare ROTATEYINTERVAL 19 { setvar ROTATEXALTER 96 setvar ROTATEYALTER 96 }
	ifvare ROTATEYINTERVAL 20 { setvar ROTATEXALTER 128 setvar ROTATEYALTER 128 }
	ifvare ROTATEYINTERVAL 21 { setvar ROTATEXALTER 160 setvar ROTATEYALTER 160 }
	ifvare ROTATEYINTERVAL 22 { setvar ROTATEXALTER 196 setvar ROTATEYALTER 196 }
	ifvare ROTATEYINTERVAL 23 { setvar ROTATEXALTER 224 setvar ROTATEYALTER 224 }
	ifvare ROTATEYINTERVAL 24 { setvar ROTATEXALTER 256 setvar ROTATEYALTER 256 }
	ifvare ROTATEYINTERVAL 25 { setvar ROTATEXALTER 224 setvar ROTATEYALTER 224 }
	ifvare ROTATEYINTERVAL 26 { setvar ROTATEXALTER 196 setvar ROTATEYALTER 196 }
	ifvare ROTATEYINTERVAL 27 { setvar ROTATEXALTER 160 setvar ROTATEYALTER 160 }
	ifvare ROTATEYINTERVAL 28 { setvar ROTATEXALTER 128 setvar ROTATEYALTER 128 }
	ifvare ROTATEYINTERVAL 29 { setvar ROTATEXALTER 96 setvar ROTATEYALTER 96 }
	ifvare ROTATEYINTERVAL 30 { setvar ROTATEXALTER 64 setvar ROTATEYALTER 64 }
	ifvare ROTATEYINTERVAL 31 { setvar ROTATEXALTER 32 setvar ROTATEYALTER 32 }
	addvar ROTATEYINTERVAL 1
	ifvarg ROTATEYINTERVAL 30 setvar ROTATEYINTERVAL 0
	addvarvar ROTATEXPOINT ROTATEXALTER
	addvarvar ROTATEYPOINT ROTATEYALTER
	addvar ROTATEANGLE 96
	rotatepoint ROTATEXORIGIN ROTATEYORIGIN ROTATEXPOINT ROTATEYPOINT ROTATEANGLE ROTATEXRETURN ROTATEYRETURN

	getplayer[THISACTOR].posz ROTATEZORIGIN
	addvar ROTATEZORIGIN 8144
	setvarvar ROTATEZPOINT ROTATEZORIGIN
	setvarvar ROTATEZALTER ROTATEZINTERVAL
	mulvar ROTATEZALTER 1024
	subvarvar ROTATEZPOINT ROTATEZALTER
	setvarvar ROTATEZRETURN ROTATEZPOINT

	espawn EXPLOSION2 sound PIPEBOMB_EXPLODE sound ICE_EXPLODE
	setactor[RETURN].pal 1
	setactor[RETURN].x ROTATEXRETURN
	setactor[RETURN].y ROTATEYRETURN
	setactor[RETURN].z ROTATEZRETURN
	setactor[RETURN].xrepeat 16
	setactor[RETURN].yrepeat 16
	setactor[RETURN].cstat 642

	addvar ROTATEZINTERVAL 1
ends

state getitemseekerspeciesquote
	ifactor ROTATEGUN setvar ITEMSEEKSPECIESTYPE 0
	ifactor SHARK setvar ITEMSEEKSPECIESTYPE 0
	ifactor LIZTROOP setvar ITEMSEEKSPECIESTYPE 0
	ifactor LIZMAN setvar ITEMSEEKSPECIESTYPE 0
	ifactor DRONE setvar ITEMSEEKSPECIESTYPE 0
	ifactor OCTABRAIN setvar ITEMSEEKSPECIESTYPE 0
	ifactor PIGCOP setvar ITEMSEEKSPECIESTYPE 0
	ifactor BOSS1 setvar ITEMSEEKSPECIESTYPE 0
	ifactor BOSS2 setvar ITEMSEEKSPECIESTYPE 0
	ifactor BOSS3 setvar ITEMSEEKSPECIESTYPE 0
	ifactor COMMANDER setvar ITEMSEEKSPECIESTYPE 0
	ifactor TANK setvar ITEMSEEKSPECIESTYPE 0
	ifactor BOSS4 setvar ITEMSEEKSPECIESTYPE 0
	ifactor NEWBEAST setvar ITEMSEEKSPECIESTYPE 0
	ifactor SCORPIONTANK setvar ITEMSEEKSPECIESTYPE 0
	ifactor PRESIDENTCLINTON setvar ITEMSEEKSPECIESTYPE 1
	ifactor ROBOTDOG setvar ITEMSEEKSPECIESTYPE 1
	ifactor ROBOTDOG2 setvar ITEMSEEKSPECIESTYPE 1
	ifactor NAKED1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor PODFEM1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM2 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM3 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM4 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM5 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM6 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM7 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM9 setvar ITEMSEEKSPECIESTYPE 1
	ifactor FEM10 setvar ITEMSEEKSPECIESTYPE 1
	ifactor TOUGHGAL setvar ITEMSEEKSPECIESTYPE 1
	ifactor WOMAN setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE2 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE3 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE5 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE6 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE7 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DANCE9 setvar ITEMSEEKSPECIESTYPE 1
	ifactor DEALER setvar ITEMSEEKSPECIESTYPE 1
	ifactor STAND1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor STAND3 setvar ITEMSEEKSPECIESTYPE 1
	ifactor STAND4 setvar ITEMSEEKSPECIESTYPE 1
	ifactor COP1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor COP2 setvar ITEMSEEKSPECIESTYPE 1
	ifactor PUNKDUDE setvar ITEMSEEKSPECIESTYPE 1
	ifactor SITTINGDUDE setvar ITEMSEEKSPECIESTYPE 1
	ifactor WOLFDUDE setvar ITEMSEEKSPECIESTYPE 1
	ifactor ANIMEGIRL1 setvar ITEMSEEKSPECIESTYPE 1
	ifactor ANIMEGIRL2 setvar ITEMSEEKSPECIESTYPE 1
	ifactor ANIMEGIRL3 setvar ITEMSEEKSPECIESTYPE 1
	ifactor ANIMEGIRL4 setvar ITEMSEEKSPECIESTYPE 1
	
	ifactor EMPTYTANK setvar ITEMSEEKSPECIESTYPE 2
ends

state getitemseekerspecies
	getactor[ITEMSEEK].picnum ITEMSEEKSPECIES
	ifvare ITEMSEEKSPECIES ROTATEGUN setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES SHARK setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES LIZTROOP setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES LIZMAN setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES DRONE setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES OCTABRAIN setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES PIGCOP setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES BOSS1 setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES BOSS2 setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES BOSS3 setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES COMMANDER setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES TANK setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES BOSS4 setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES NEWBEAST setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES SCORPIONTANK setvar ITEMSEEKSPECIESTYPE 0
	ifvare ITEMSEEKSPECIES PRESIDENTCLINTON setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES ROBOTDOG setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES ROBOTDOG2 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES NAKED1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES PODFEM1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM2 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM3 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM4 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM5 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM6 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM7 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM9 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES FEM10 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES TOUGHGAL setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES WOMAN setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE2 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE3 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE5 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE6 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE7 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DANCE9 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES DEALER setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES STAND1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES STAND3 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES STAND4 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES COP1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES COP2 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES PUNKDUDE setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES SITTINGDUDE setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES WOLFDUDE setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES ANIMEGIRL1 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES ANIMEGIRL2 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES ANIMEGIRL3 setvar ITEMSEEKSPECIESTYPE 1
	ifvare ITEMSEEKSPECIES ANIMEGIRL4 setvar ITEMSEEKSPECIESTYPE 1
	
	ifvare ITEMSEEKSPECIES EMPTYTANK setvar ITEMSEEKSPECIESTYPE 2
ends

//***************************
//*Status Ailments [Players]*
//***************************
state addhaste
	ifvarand PLAYERSTATUS? 2 
	{ 
		randvar TEMP 390
		addvar TEMP 390
		addvarvar PLAYERHASTETIMER TEMP
	} 
	else 
	{
		randvar TEMP 390
		addvar TEMP 390
		addvarvar PLAYERHASTETIMER TEMP
		addvar PLAYERSTATUS? 2 
		ifvarand PLAYERSTATUS? 4 { subvar PLAYERSTATUS? 4 setvar PLAYERSLOWTIMER 0 } 
		redefinequote 335 ^22TIME HAS SLOWED DOWN AROUND YOU!
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removehaste
	ifvare PLAYERHASTETIMER 0 redefinequote 335 ^22HASTE HAS WORN OFF!
	else redefinequote 335 ^10YOU ARE NO LONGER HASTED!
	
	ifvarand PLAYERSTATUS? 2 { subvar PLAYERSTATUS? 2 setvar PLAYERHASTETIMER 0 } // removes Haste status
	setvarvar fta fta_normal setvar ftq 335
ends

state addslow
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
						else
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								ifvarand PLAYERSTATUS? 4 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERSLOWTIMER TEMP
								} 
								else 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERSLOWTIMER TEMP
									addvar PLAYERSTATUS? 4 
									ifvarand PLAYERSTATUS? 2 { subvar PLAYERSTATUS? 2 setvar PLAYERHASTETIMER 0 } 
									redefinequote 335 ^10TIME HAS SPED UP AROUND YOU!
									setvarvar fta fta_normal setvar ftq 335
								}
							}
						}
					}
				}
			} // ifvarvarl TEMPMOD DAMAGEMODIFIER
		}
	}
ends

state addslow_overridevehicle
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
							ifvarand PLAYERSTATUS? 4 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERSLOWTIMER TEMP
							} 
							else 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERSLOWTIMER TEMP
								addvar PLAYERSTATUS? 4 
								ifvarand PLAYERSTATUS? 2 { subvar PLAYERSTATUS? 2 setvar PLAYERHASTETIMER 0 } 
								redefinequote 335 ^10TIME HAS SPED UP AROUND YOU!
								setvarvar fta fta_normal setvar ftq 335
							}
						}
					}
				}
			} // ifvarvarl TEMPMOD DAMAGEMODIFIER
		}
	}
ends

state removeslow
	ifvarand PLAYERSTATUS? 4
	{
		ifvare PLAYERSLOWTIMER 0 redefinequote 335 ^22SLOW HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER SLOWED!

		subvar PLAYERSTATUS? 4
		setvar PLAYERSLOWTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state addpoison
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
						else
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								ifvarand PLAYERSTATUS? 8 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERPOISONTIMER TEMP
								} 
								else 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERPOISONTIMER TEMP
									addvar PLAYERSTATUS? 8
									redefinequote 335 ^10YOU HAVE BEEN POISONED!
									setvarvar fta fta_normal setvar ftq 335
								}
							}
						}
					}
				}
			}
		}
	}
ends

state addpoison_overridevehicle
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
							ifvarand PLAYERSTATUS? 8 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERPOISONTIMER TEMP
							} 
							else 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERPOISONTIMER TEMP
								addvar PLAYERSTATUS? 8
								redefinequote 335 ^10YOU HAVE BEEN POISONED!
								setvarvar fta fta_normal setvar ftq 335
							}
						}
					}
				}
			}
		}
	}
ends

state removepoison
	ifvarand PLAYERSTATUS? 8
	{
		ifvare PLAYERPOISONTIMER 0 redefinequote 335 ^22POISON HAS WORN OFF!
		else redefinequote 335 ^22YOU HAVE CURED POISON!
	
		subvar PLAYERSTATUS? 8 // removes Poison status
		setvar PLAYERPOISONTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state adddimness
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
						else
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								ifvarand PLAYERSTATUS? 16 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERDIMNESSTIMER TEMP
								} 
								else 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERDIMNESSTIMER TEMP
									addvar PLAYERSTATUS? 16
									redefinequote 335 ^10YOUR SIGHT HAS BEEN DIMMED!
									setvarvar fta fta_normal setvar ftq 335
								}
							}
						}
					}
				}
			}
		}
	}
ends

state adddimness_overridevehicle
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
							ifvarand PLAYERSTATUS? 16 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERDIMNESSTIMER TEMP
							} 
							else 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERDIMNESSTIMER TEMP
								addvar PLAYERSTATUS? 16
								redefinequote 335 ^10YOUR SIGHT HAS BEEN DIMMED!
								setvarvar fta fta_normal setvar ftq 335
							}
						}
					}
				}
			}
		}
	}
ends

state removedimness
	ifvarand PLAYERSTATUS? 16
	{
		ifvare PLAYERDIMNESSTIMER 0 redefinequote 335 ^22DIMNESS HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER DIMMED!
	
		subvar PLAYERSTATUS? 16
		setvar PLAYERDIMNESSTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state addconfusion
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
						else
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								ifvarand PLAYERSTATUS? 128 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERCONFUSIONTIMER TEMP
								} 
								else 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERCONFUSIONTIMER TEMP
									addvar PLAYERSTATUS? 128 
									redefinequote 335 ^10YOU HAVE BEEN CONFUSED!
									setvarvar fta fta_normal setvar ftq 335
								}
							}
						}
					}
				}
			}
		}
	}
ends

state addconfusion_overridevehicle
	ifvarand CHEATBITFIELD? 4 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
							ifvarand PLAYERSTATUS? 128 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERCONFUSIONTIMER TEMP
							} 
							else 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERCONFUSIONTIMER TEMP
								addvar PLAYERSTATUS? 128 
								redefinequote 335 ^10YOU HAVE BEEN CONFUSED!
								setvarvar fta fta_normal setvar ftq 335
							}
						}
					}
				}
			}
		}
	}
ends

state removeconfusion
	ifvarand PLAYERSTATUS? 128
	{
		ifvare PLAYERCONFUSIONTIMER 0 redefinequote 335 ^22CONFUSION HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER CONFUSED!
	
		subvar PLAYERSTATUS? 128
		setvar PLAYERCONFUSIONTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removedamageshell
	ifvarand PLAYERSTATUS? 512
	{
		ifvare PLAYERSHELLTIMER 0 redefinequote 335 ^22DAMAGE SHELL HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER SHELLED!
	
		subvar PLAYERSTATUS? 512
		setvar PLAYERSHELLTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removeblitzkrieg
	ifvarand PLAYERSTATUS? 2048
	{
		ifvare PLAYERBLITZKRIEGTIMER 0 redefinequote 335 ^22TRIAD BLITZKRIEG HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER BLITZKRIEGED!
	
		subvar PLAYERSTATUS? 2048
		setvar PLAYERBLITZKRIEGTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removebooster
	ifvarand PLAYERSTATUS? 4096
	{
		ifvare PLAYERBOOSTERTIMER 0 redefinequote 335 ^22TRIAD BOOSTER HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER BOOSTED!
	
		subvar PLAYERSTATUS? 4096
		setvar PLAYERBOOSTERTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removebloodlusting
	ifvarand PLAYERSTATUS? 8192
	{
		ifvare PLAYERBLOODLUSTTIMER 0 redefinequote 335 ^22BLOODLUSTING HAS WORN OFF!
		else redefinequote 335 ^22YOU ARE NO LONGER BLOODLUSTED!
	
		subvar PLAYERSTATUS? 8192
		setvar PLAYERBLOODLUSTTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state addcorrosion
	ifvare CURRENTARMORPOINTS 0 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						ifvarg VEHICLETYPE -1 ifvarl VEHICLETYPE 3 nullop
						else
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvare MISCARRAYID_AMOUNTTEMP 0
							{
								ifvarand PLAYERSTATUS? 16384
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERCORROSIONTIMER TEMP
								} 
								else 
								{ 
									randvar TEMP 390
									addvar TEMP 390
									addvarvar PLAYERCORROSIONTIMER TEMP
									addvar PLAYERSTATUS? 16384
									redefinequote 335 ^10YOUR ARMOR IS CORRODING!
									setvarvar fta fta_normal setvar ftq 335
								}
							}
						}
					}
				}
			}
		}
	}
ends

state addcorrosion_overridevehicle
	ifvare CURRENTARMORPOINTS 0 nullop else
	{
		randvar TEMPVAR5 99 addvar TEMPVAR5 1
		ifvarl TEMPVAR5 16
		{
			//****************
			//*Support System*
			//****************
			setvar DAMAGEMODIFIER 1000
			//**Ailment Support / Maken**
			state support-ailmentresist
			ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
			randvar TEMPMOD 1000
			ifvarvarl TEMPMOD DAMAGEMODIFIER
			{ // ifvarvarl TEMPMOD DAMAGEMODIFIER
				ifvarand CHEATBITFIELD? 32 nullop
				else
				{
					ifvarg INVULNTIME 1 nullop
					else
					{
						setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
							ifvarand PLAYERSTATUS? 16384
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERCORROSIONTIMER TEMP
							} 
							else 
							{ 
								randvar TEMP 390
								addvar TEMP 390
								addvarvar PLAYERCORROSIONTIMER TEMP
								addvar PLAYERSTATUS? 16384
								redefinequote 335 ^10YOUR ARMOR IS CORRODING!
								setvarvar fta fta_normal setvar ftq 335
							}
						}
					}
				}
			}
		}
	}
ends

state removecorrosion
	ifvarand PLAYERSTATUS? 16384
	{
		ifvare PLAYERCORROSIONTIMER 0 redefinequote 335 ^22YOUR ARMOR IS NO LONGER CORRODING!
		else redefinequote 335 ^22YOUR ARMOR HAS STOPPED CORRODING!
	
		subvar PLAYERSTATUS? 16384
		setvar PLAYERCORROSIONTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removecorrosion_armorgone
	ifvarand PLAYERSTATUS? 16384
	{
		redefinequote 335 ^22YOUR ARMOR WAS DESTROYED BY CORROSION!
	
		ifvarl CURRENTARMORPOINTS 0 setvar CURRENTARMORPOINTS 0
		subvar PLAYERSTATUS? 16384
		setvar PLAYERCORROSIONTIMER 0
		setvarvar fta fta_normal setvar ftq 335
	}
ends

//*******************************
//*End Status Ailments [Players]*
//******************************



//***********************************
//*Status Ailments [Monsters/Actors]*
//***********************************

state addhaste_actor
	ifvarand ACTORSTATUS? 2 
	{ 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 624
			addvar TEMP 624
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORHASTETIMER TEMP
	} 
	else 
	{
		addvar ACTORSTATUS? 2 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 624
			addvar TEMP 624
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORHASTETIMER TEMP
		ifvarand ACTORSTATUS? 4 { subvar ACTORSTATUS? 4 setvar ACTORSLOWTIMER 0 } 
	
		//  redefinequote 335 ^10AN ENEMY HAS BECOME HASTENED!
		state getitemseekerspeciesquote
		ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY HAS BECOME HASTENED!
		ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN HAS BECOME HASTENED!
		ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE HAS BECOME HASTENED!
	
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removehaste_actor
	// redefinequote 335 ^22AN ENEMY'S HASTINESS HAS WORN OFF! :D
	
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY'S HASTINESS HAS WORN OFF! :D
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S HASTINESS HAS WORN OFF! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S HASTINESS HAS WORN OFF! :O
	
	ifvarand ACTORSTATUS? 2 { subvar ACTORSTATUS? 2 setvar ACTORHASTETIMER 0 } // removes Haste Status
	setvarvar fta fta_normal setvar ftq 335
ends

state addslow_actor
	ifvarand ACTORSTATUS? 4 
	{ 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORSLOWTIMER TEMP
	} 
	else 
	{ 
		addvar ACTORSTATUS? 4 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORSLOWTIMER TEMP
		ifvarand ACTORSTATUS? 2 { subvar ACTORSTATUS? 2 setvar ACTORHASTETIMER 0 } 
		// redefinequote 335 ^22AN ENEMY HAS BECOME SLOWN DOWN!
		state getitemseekerspeciesquote
		ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY HAS BECOME SLOWN DOWN!
		ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN HAS BECOME SLOWN DOWN!
		ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE HAS BECOME SLOWN DOWN!
	
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removeslow_actor
	// redefinequote 335 ^10AN ENEMY'S SLOWNESS HAS WORN OFF! D:
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY'S SLOWNESS HAS WORN OFF! D:
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S SLOWNESS HAS WORN OFF! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S SLOWNESS HAS WORN OFF! :O
	
	ifvarand ACTORSTATUS? 4 { subvar ACTORSTATUS? 4 setvar ACTORSLOWTIMER 0 }
	setvarvar fta fta_normal setvar ftq 335
ends

state addpoison_actor
	ifvarand ACTORSTATUS? 8 
	{ 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		setvarvar ACTORPOISONHITOWNER THISACTOR
		addvarvar ACTORPOISONTIMER TEMP
	} 
	else 
	{ 
		addvar ACTORSTATUS? 8
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		setvarvar ACTORPOISONHITOWNER THISACTOR
		addvarvar ACTORPOISONTIMER TEMP
		// redefinequote 335 ^22AN ENEMY HAS BECOME POISONED!
		state getitemseekerspeciesquote
		ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY HAS BECOME POISONED!
		ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN HAS BECOME POISONED!
		ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE HAS BECOME POISONED!
	
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removepoison_actor
	// redefinequote 335 ^10AN ENEMY'S POISON HAS WORN OFF! :(
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY'S POISON HAS WORN OFF! :(
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S POISON HAS WORN OFF! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S POISON HAS WORN OFF! :O
	
	ifvarand ACTORSTATUS? 8 { subvar ACTORSTATUS? 8 setvar ACTORPOISONTIMER 0 setvar ACTORPOISONHITOWNER -1 }
	setvarvar fta fta_normal setvar ftq 335
ends

state adddimness_actor
	ifvarand ACTORSTATUS? 16 
	{ 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORDIMNESSTIMER TEMP
	} 
	else 
	{ 
		addvar ACTORSTATUS? 16
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORDIMNESSTIMER TEMP
		// redefinequote 335 ^22AN ENEMY'S SIGHT HAS BEEN DIMMED!
		state getitemseekerspeciesquote
		ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY'S SIGHT HAS BEEN DIMMED!
		ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S SIGHT HAS BEEN DIMMED!
		ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S SIGHT HAS BEEN DIMMED!
	
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removedimness_actor
	// redefinequote 335 ^10AN ENEMY'S DIMNESS HAS WORN OFF! :(
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY'S DIMNESS HAS WORN OFF! :(
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S DIMNESS HAS WORN OFF! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S DIMNESS HAS WORN OFF! :O
	
	ifvarand ACTORSTATUS? 16 { subvar ACTORSTATUS? 16 setvar ACTORDIMNESSTIMER 0 }
	setvarvar fta fta_normal setvar ftq 335
ends

state addconfusion_actor
	ifvarand ACTORSTATUS? 128 
	{ 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORCONFUSIONTIMER TEMP
	} 
	else 
	{ 
		addvar ACTORSTATUS? 128 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 156
			addvar TEMP 156
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORCONFUSIONTIMER TEMP
		// redefinequote 335 ^22AN ENEMY HAS BEEN CONFUSED!
		state getitemseekerspeciesquote
		ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY HAS BEEN CONFUSED!
		ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN HAS BEEN CONFUSED!
		ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE HAS BEEN CONFUSED!
	
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removeconfusion_actor
	// redefinequote 335 ^10AN ENEMY'S CONFUSION HAS WORN OFF! :(
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY'S CONFUSION HAS WORN OFF! :(
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S CONFUSION HAS WORN OFF! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S CONFUSION HAS WORN OFF! :O
	
	
	ifvarand ACTORSTATUS? 128 { subvar ACTORSTATUS? 128 setvar ACTORCONFUSIONTIMER 0 }
	setvarvar fta fta_normal setvar ftq 335
ends

state adddamageshell_actor
	ifvarand ACTORSTATUS? 512
	{ 
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 624
			addvar TEMP 624
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORSHELLTIMER TEMP
	} 
	else 
	{ 
		addvar ACTORSTATUS? 512
		ifvarand ACTORFLAGS 512
		{   
			randvar TEMP 624
			addvar TEMP 624
		}
		else
		{
			randvar TEMP 390
			addvar TEMP 390
		}
		addvarvar ACTORSHELLTIMER TEMP
		// redefinequote 335 ^10AN ENEMY HAS BEEN GIVEN DAMAGE-SHELL!
		state getitemseekerspeciesquote
		ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY HAS BEEN GIVEN DAMAGE-SHELL!
		ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN HAS BEEN GIVEN DAMAGE-SHELL!
		ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE HAS BEEN GIVEN DAMAGE-SHELL!
	
		setvarvar fta fta_normal setvar ftq 335
	}
ends

state removedamageshell_actor
	// redefinequote 335 ^22AN ENEMY'S DAMAGE-SHELL HAS WORN OFF! :)
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY'S DAMAGE-SHELL HAS WORN OFF! :)
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S DAMAGE-SHELL HAS WORN OFF! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S DAMAGE-SHELL HAS WORN OFF! :O
	
	ifvarand ACTORSTATUS? 512 { subvar ACTORSTATUS? 512 setvar ACTORSHELLTIMER 0 }
	setvarvar fta fta_normal setvar ftq 335
ends

state addcorrosion_actor
	ifvarg ACTORAP 0
	{
		ifvarand ACTORSTATUS? 16384
		{ 
			ifvarand ACTORFLAGS 512
			{   
				randvar TEMP 156
				addvar TEMP 156
			}
			else
			{
				randvar TEMP 390
				addvar TEMP 390
			}
			addvarvar ACTORCORROSIONTIMER TEMP
		} 
		else 
		{ 
			addvar ACTORSTATUS? 16384
			ifvarand ACTORFLAGS 512
			{   
				randvar TEMP 156
				addvar TEMP 156
			}
			else
			{
				randvar TEMP 390
				addvar TEMP 390
			}
			addvarvar ACTORCORROSIONTIMER TEMP
			state getitemseekerspeciesquote
			ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^22AN ENEMY'S ARMOR HAS STARTED CORRODING!
			ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S ARMOR HAS STARTED CORRODING!
			ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S ARMOR HAS STARTED CORRODING!
		
			setvarvar fta fta_normal setvar ftq 335
		}
	}
ends

state removecorrosion_actor
	// redefinequote 335 ^10AN ENEMY'S POISON HAS WORN OFF! :(
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY'S ARMOR STOPPED CORRODING! :(
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S ARMOR STOPPED CORRODING! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S ARMOR STOPPED CORRODING! :O
	
	ifvarand ACTORSTATUS? 16384 { subvar ACTORSTATUS? 16384 setvar ACTORCORROSIONTIMER 0 }
	setvarvar fta fta_normal setvar ftq 335
ends

state removecorrosion_actor_noarmor
	// redefinequote 335 ^10AN ENEMY'S POISON HAS WORN OFF! :(
	state getitemseekerspeciesquote
	ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 335 ^10AN ENEMY'S ARMOR WAS DESTROYED BY CORROSION! :D
	ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 335 ^15A CIVILIAN'S ARMOR WAS DESTROYED BY CORROSION! :O
	ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 335 ^15A VEHICLE'S ARMOR WAS DESTROYED BY CORROSION! :O
	
	ifvarand ACTORSTATUS? 16384 { subvar ACTORSTATUS? 16384 setvar ACTORCORROSIONTIMER 0 }
	setvarvar fta fta_normal setvar ftq 335
ends


//***************************************
//*End Status Ailments [Monsters/Actors]*
//***************************************

state nullgendamage
	setvar GENERALDAMAGE 0
ends

state fourfreezers
	shoot FREEZEBLAST
	shoot FREEZEBLAST
	shoot FREEZEBLAST
	shoot FREEZEBLAST
ends

state fourexpanders
	state firegrowspark_angleeffect 
	state firegrowspark_angleeffect 
	state firegrowspark_angleeffect 
	state firegrowspark_angleeffect 
ends

state fourlasers
	shoot FIRELASER 
	shoot FIRELASER 
	shoot FIRELASER 
	shoot FIRELASER 
ends

state fourrockets
	eshoot RPG //_NOAIM
	eshoot RPG //_NOAIM
	eshoot RPG //_NOAIM
	eshoot RPG //_NOAIM
ends

state threerockets
	eshoot RPG //_NOAIM
	eshoot RPG //_NOAIM
	eshoot RPG //_NOAIM
ends

state liztroopattack
	state echeckquadtime
	state echeckvampiretime
	ifspritepal 14 
	{ 
		ifrnd 128 
		{ 
			sound PRED_ATTACK 
			sound SHRINKER_FIRE 
			shoot SHRINKER 
		} 
		else 
		{ 
			sound PRED_ATTACK 
			sound EXPANDERSHOOT 
			state fourexpanders
		} 
	} 
	else ifspritepal 19 
	{ 
		sound PRED_ATTACK 
		sound RPG_SHOOT 
		ifrnd 128 eshoot MORTER else eshoot RPG // _NOAIM
	} 
	else ifspritepal 17 
	{ 
		ifrnd 64 
		{ 
			sound PRED_ATTACK 
			sound PRED_ATTACK 
			state fourlasers
			state fourlasers
		}
		else 
		ifrnd 85 
		{ 
			sound CAT_FIRE 
			sound CAT_FIRE 
			sound PRED_ATTACK 
			sound PRED_ATTACK 
			state fourfreezers
			state fourfreezers
			state fourfreezers
			state fourfreezers
		}
		else 
		ifrnd 128 
		{ 
			ifrnd 128 
			{ 
				sound PRED_ATTACK 
				sound SHRINKER_FIRE 
				shoot SHRINKER 
			} 
			else 
			{ 
				sound PRED_ATTACK 
				sound EXPANDERSHOOT 
				state fourexpanders
				state fourexpanders
			} 
		}
		else 
		{ 
			sound PRED_ATTACK 
			sound RPG_SHOOT 
			ifrnd 96 shoot MORTER 
			else state fourrockets
		}
	} 
	else 
	ifspritepal 21
	{ 
		ifrnd 224
		{
			sound PRED_ATTACK 
			shoot FIRELASER 
			shoot FIRELASER 
		}
		else
		{
			sound PISTOL_FIRE
			state fireshotspark1_angleeffect
			state fireshotspark1_angleeffect
		}
	}
	else 
	ifspritepal 10
	{ 
		ifrnd 224
		{
			sound PRED_ATTACK 
			shoot FIRELASER 
			shoot FIRELASER 
		}
		else
		{
			sound PISTOL_FIRE
			state fireshotspark1_angleeffect
			state fireshotspark1_angleeffect
		}
	}
	else 
	{ 
		sound PRED_ATTACK 
		shoot FIRELASER 
	}
ends

state getmeleedmg // For Fire/Steam
	setvar MELEEATTACK? 1
	setvarvar ATTACKINGACTOR THISACTOR
	getactor[THISACTOR].ang ATTACKERANGLE
	setactor[PLAYERID].htextra MELEEDAMAGE
	getactor[THISACTOR].picnum MELEEATTACKER
	getactor[THISACTOR].pal MELEEATTACKERPAL
	setvarvar MELEEATTACKERID THISACTOR
	setvarvar ATTACKINGACTOR -1
ends

state getmeleedmg2 // For Monsters
	setvar MELEEATTACK? 1
	setvarvar ATTACKINGACTOR THISACTOR
	ifvarn ATTACKINGACTOR -1 ifvarg actorvar[ATTACKINGACTOR].ACTORQUADTIME 0 mulvar MELEEDAMAGE 4
	getactor[THISACTOR].ang ATTACKERANGLE
	setactor[PLAYERID].htextra MELEEDAMAGE
	getactor[THISACTOR].picnum MELEEATTACKER
	getactor[THISACTOR].pal MELEEATTACKERPAL
	setvarvar MELEEATTACKERID THISACTOR
	setvarvar ATTACKINGACTOR -1
ends

state getmeleedmg3 // For Monsters
	setvar MELEEATTACK? 1
	setvarvar ATTACKINGACTOR THISACTOR
	ifvarn ATTACKINGACTOR -1 ifvarg actorvar[ATTACKINGACTOR].ACTORQUADTIME 0 mulvar MELEEDAMAGE 4
	getactor[THISACTOR].ang ATTACKERANGLE
	getactor[THISACTOR].picnum MELEEATTACKER
	getactor[THISACTOR].pal MELEEATTACKERPAL
	setvarvar MELEEATTACKERID THISACTOR
	setvarvar ATTACKINGACTOR -1
ends

state meleerandomdmg
	setactor[PLAYERID].htpicnum KNEE
	ifrnd 128 addvarvar MELEEDAMAGE MELEEDAMAGEVAR else subvarvar MELEEDAMAGE MELEEDAMAGEVAR
ends

state queenselfheal
	// Self-Heal with discharges
	ifspritepal 24
	{
		randvar temp 24
		addvar temp 24
		setvarvar TEMP temp
		ifrnd 128
		{
			randvar tempb 12
			addvar tempb 12
			addvarvar TEMP tempb
		}
		ifrnd 85
		{
			randvar tempc 6
			addvar tempc 6
			addvarvar TEMP tempc
		}
		ifrnd 64
		{
			randvar tempd 3
			addvar tempd 3
			addvarvar TEMP tempd
		}
		ifrnd 53
		{
			randvar tempe 1
			addvar tempe 1
			addvarvar TEMP tempe
		}
		setvarvar TEMP3 ACTORMAXHP
		ifvarg SKILLLEVEL -1
		ifvarl SKILLLEVEL 3
		{
			randvar TEMP2 2
			addvar TEMP2 10
		}
		else
		ifvarg SKILLLEVEL 2
		ifvarl SKILLLEVEL 6
		{
			randvar TEMP2 3
			addvar TEMP2 11
		}
		else
		ifvarg SKILLLEVEL 5
		ifvarl SKILLLEVEL 9
		{
			randvar TEMP2 5
			addvar TEMP2 12
		}
		else
		ifvare SKILLLEVEL 9
		{
			randvar TEMP2 7
			addvar TEMP2 14
		}
		mulvarvar TEMP3 TEMP2
		divvar TEMP3 1000
		ifvarl TEMP3 1 setvar TEMP3 1
		addvarvar TEMP TEMP3
	
		ifvarg ACTORQUADTIME 1 mulvar TEMP 4
	
		ifvarvarl ACTORHP ACTORMAXHPATOMIC
		{
			addvarvar ACTORHP TEMP
			ifvarvarg ACTORHP ACTORMAXHPATOMIC setvarvar ACTORHP ACTORMAXHPATOMIC
			ifvarg TEMP 0
			{
				setvarvar ITEMSEEKC TEMP setvarvar ITEMSEEK THISACTOR
				state showhealing_actorhp
		
				setvar ACTORHPDAMAGED? -1
				sound ABSORB_DAMAGE
			}
		} 
	}
	else
	ifspritepal 0
	{
		randvar temp 18
		addvar temp 18
		setvarvar TEMP temp
		ifrnd 128
		{
			randvar tempb 9
			addvar tempb 9
			addvarvar TEMP tempb
		}
		ifrnd 85
		{
			randvar tempc 4
			addvar tempc 4
			addvarvar TEMP tempc
		}
		ifrnd 64
		{
			randvar tempd 2
			addvar tempd 2
			addvarvar TEMP tempd
		}
		ifrnd 53
		{
			randvar tempe 1
			addvar tempe 1
			addvarvar TEMP tempe
		}
	
		setvarvar TEMP3 ACTORMAXHP
		ifvarg SKILLLEVEL -1
		ifvarl SKILLLEVEL 3
		{
			randvar TEMP2 1
			addvar TEMP2 7
		}
		else
		ifvarg SKILLLEVEL 2
		ifvarl SKILLLEVEL 6
		{
			randvar TEMP2 1
			addvar TEMP2 8
		}
		else
		ifvarg SKILLLEVEL 5
		ifvarl SKILLLEVEL 9
		{
			randvar TEMP2 2
			addvar TEMP2 9
		}
		else
		ifvare SKILLLEVEL 9
		{
			randvar TEMP2 3
			addvar TEMP2 11
		}
		mulvarvar TEMP3 TEMP2
		divvar TEMP3 1000
		ifvarl TEMP3 1 setvar TEMP3 1
		addvarvar TEMP TEMP3
	
		ifvarg ACTORQUADTIME 1 mulvar TEMP 4
	
		ifvarvarl ACTORHP ACTORMAXHPATOMIC
		{
			addvarvar ACTORHP TEMP
			ifvarvarg ACTORHP ACTORMAXHPATOMIC setvarvar ACTORHP ACTORMAXHPATOMIC
			ifvarg TEMP 0
			{
				setvarvar ITEMSEEKC TEMP setvarvar ITEMSEEK THISACTOR
				state showhealing_actorhp
		
				setvar ACTORHPDAMAGED? -1
				sound ABSORB_DAMAGE
			}
		} 
	}
	else
	ifspritepal 3
	{
		randvar temp 18
		addvar temp 18
		setvarvar TEMP temp
		ifrnd 128
		{
			randvar tempb 9
			addvar tempb 9
			addvarvar TEMP tempb
		}
		ifrnd 85
		{
			randvar tempc 4
			addvar tempc 4
			addvarvar TEMP tempc
		}
		ifrnd 64
		{
			randvar tempd 2
			addvar tempd 2
			addvarvar TEMP tempd
		}
		ifrnd 53
		{
			randvar tempe 1
			addvar tempe 1
			addvarvar TEMP tempe
		}
	
		setvarvar TEMP3 ACTORMAXHP
		ifvarg SKILLLEVEL -1
		ifvarl SKILLLEVEL 3
		{
			randvar TEMP2 1
			addvar TEMP2 7
		}
		else
		ifvarg SKILLLEVEL 2
		ifvarl SKILLLEVEL 6
		{
			randvar TEMP2 1
			addvar TEMP2 8
		}
		else
		ifvarg SKILLLEVEL 5
		ifvarl SKILLLEVEL 9
		{
			randvar TEMP2 2
			addvar TEMP2 9
		}
		else
		ifvare SKILLLEVEL 9
		{
			randvar TEMP2 3
			addvar TEMP2 11
		}
		mulvarvar TEMP3 TEMP2
		divvar TEMP3 1000
		ifvarl TEMP3 1 setvar TEMP3 1
		addvarvar TEMP TEMP3
	
		ifvarg ACTORQUADTIME 1 mulvar TEMP 4
	
		ifvarvarl ACTORHP ACTORMAXHPATOMIC
		{
			addvarvar ACTORHP TEMP
			ifvarvarg ACTORHP ACTORMAXHPATOMIC setvarvar ACTORHP ACTORMAXHPATOMIC
			ifvarg TEMP 0
			{
				setvarvar ITEMSEEKC TEMP setvarvar ITEMSEEK THISACTOR
				state showhealing_actorhp

				setvar ACTORHPDAMAGED? -1
				sound ABSORB_DAMAGE
			}
		} 
	}
	else
	ifspritepal 9
	{
		randvar temp 18
		addvar temp 18
		setvarvar TEMP temp
		ifrnd 128
		{
			randvar tempb 9
			addvar tempb 9
			addvarvar TEMP tempb
		}
		ifrnd 85
		{
			randvar tempc 4
			addvar tempc 4
			addvarvar TEMP tempc
		}
		ifrnd 64
		{
			randvar tempd 2
			addvar tempd 2
			addvarvar TEMP tempd
		}
		ifrnd 53
		{
			randvar tempe 1
			addvar tempe 1
			addvarvar TEMP tempe
		}
	
		setvarvar TEMP3 ACTORMAXHP
		ifvarg SKILLLEVEL -1
		ifvarl SKILLLEVEL 3
		{
			randvar TEMP2 1
			addvar TEMP2 7
		}
		else
		ifvarg SKILLLEVEL 2
		ifvarl SKILLLEVEL 6
		{
			randvar TEMP2 1
			addvar TEMP2 8
		}
		else
		ifvarg SKILLLEVEL 5
		ifvarl SKILLLEVEL 9
		{
			randvar TEMP2 2
			addvar TEMP2 9
		}
		else
		ifvare SKILLLEVEL 9
		{
			randvar TEMP2 3
			addvar TEMP2 11
		}
		mulvarvar TEMP3 TEMP2
		divvar TEMP3 1000
		ifvarl TEMP3 1 setvar TEMP3 1
		addvarvar TEMP TEMP3
	
		ifvarg ACTORQUADTIME 1 mulvar TEMP 4
	
		ifvarvarl ACTORHP ACTORMAXHPATOMIC
		{
			addvarvar ACTORHP TEMP
			ifvarvarg ACTORHP ACTORMAXHPATOMIC setvarvar ACTORHP ACTORMAXHPATOMIC
			ifvarg TEMP 0
			{
				setvarvar ITEMSEEKC TEMP setvarvar ITEMSEEK THISACTOR
				state showhealing_actorhp
		
				setvar ACTORHPDAMAGED? -1
				sound ABSORB_DAMAGE
			}
		} 
	}
	else
	{
		randvar temp 12
		addvar temp 12
		setvarvar TEMP temp
		ifrnd 128
		{
			randvar tempb 6
			addvar tempb 6
			addvarvar TEMP tempb
		}
		ifrnd 85
		{
			randvar tempc 3
			addvar tempc 3
			addvarvar TEMP tempc
		}
		ifrnd 64
		{
			randvar tempd 1
			addvar tempd 1
			addvarvar TEMP tempd
		}
	
		setvarvar TEMP3 ACTORMAXHP
		ifvarg SKILLLEVEL -1
		ifvarl SKILLLEVEL 3
		{
			randvar TEMP2 1
			addvar TEMP2 4
		}
		else
		ifvarg SKILLLEVEL 2
		ifvarl SKILLLEVEL 6
		{
			randvar TEMP2 1
			addvar TEMP2 5
		}
		else
		ifvarg SKILLLEVEL 5
		ifvarl SKILLLEVEL 9
		{
			randvar TEMP2 2
			addvar TEMP2 6
		}
		else
		ifvare SKILLLEVEL 9
		{
			randvar TEMP2 3
			addvar TEMP2 7
		}
		mulvarvar TEMP3 TEMP2
		divvar TEMP3 1000
		ifvarl TEMP3 1 setvar TEMP3 1
		addvarvar TEMP TEMP3
	
		ifvarg ACTORQUADTIME 1 mulvar TEMP 4
	
		ifvarvarl ACTORHP ACTORMAXHPATOMIC
		{
			addvarvar ACTORHP TEMP
			ifvarvarg ACTORHP ACTORMAXHPATOMIC setvarvar ACTORHP ACTORMAXHPATOMIC
			ifvarg TEMP 0
			{
				setvarvar ITEMSEEKC TEMP setvarvar ITEMSEEK THISACTOR
				state showhealing_actorhp
		
				setvar ACTORHPDAMAGED? -1
				sound ABSORB_DAMAGE
			}
		} 
	}
ends

state queenshootzappers
	state echeckquadtime
	state echeckvampiretime
	
	ifvare sector[THISACTOR].lotag 2
	{
		ifspritepal 24 ifrnd 32 shoot ZAPPER3
		else ifspritepal 0 ifrnd 32 shoot ZAPPER1
		else ifspritepal 3 ifrnd 32 shoot ZAPPER1
		else ifspritepal 9 ifrnd 32 shoot ZAPPER1
		else ifrnd 32 shoot ZAPPER2
	}
	else
	{
		ifspritepal 24 ifrnd 128 shoot ZAPPER3
		else ifspritepal 0 ifrnd 128 shoot ZAPPER1
		else ifspritepal 3 ifrnd 128 shoot ZAPPER1
		else ifspritepal 9 ifrnd 128 shoot ZAPPER1
		else ifrnd 128 shoot ZAPPER2
	}
	
	ifvare sector[PLAYERSECTOR].lotag 2 // If the player is in the water
	{
		state meleerandomdmg
		ifspritepal 0 mulvar MELEEDAMAGE 4
		ifspritepal 3 mulvar MELEEDAMAGE 4
		ifspritepal 9 mulvar MELEEDAMAGE 4
		ifspritepal 24 mulvar MELEEDAMAGE 20
		ifvarg CURRENTHITPOINTS 0 state getmeleedmg3
	
		ifvare CHARACTERSELECTED? 10 
		{
			setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
			ifvare MISCARRAYID_AMOUNTTEMP 0 
			{ 
				state calcplayermaxhealthatomic
				mulvar MELEEDAMAGE 2 
				setvarvar ABSORBEDDAMAGE MELEEDAMAGE
				addvarvar CURRENTHITPOINTS MELEEDAMAGE
				ifvarvarg CURRENTHITPOINTS MAXHITPOINTSATOMIC setvarvar CURRENTHITPOINTS MAXHITPOINTSATOMIC
				setvar PLAYERHPDAMAGED? -1
				setactor[PLAYERID].htextra -1
				stopsound NODAMAGE
				setvarvar TEMPHEALTH ABSORBEDDAMAGE
				state showhealing_playerhp
		
				globalsound ABSORB_DAMAGE
				palfrom 32 64 64 64
				setvar MELEEDAMAGE 0
				qsprintf 336 337 ABSORBEDDAMAGE
				setvarvar fta fta_normal setvar ftq 336
			}
			else
			{
				setactor[PLAYERID].htextra MELEEDAMAGE
		
				setvarvar TEMPDAMAGEVAR MELEEDAMAGE
				ifvarn VEHICLEID -1 state char_elecdamage_misc
				setvarvar MELEEDAMAGE TEMPDAMAGEVAR
		
				//****************
				//*Support System*
				//****************
				ifvarg MELEEDAMAGE 0
				{
					setvar DAMAGEMODIFIER 1000
					//**Electric Support / Nethra**
					state support-electricresist
					state damagemod-enemy-melee       
				}
		
				//*********************************
				//*Support System [ESSence Support*
				//*********************************
				ifvarg MELEEDAMAGE 0
				{
					setvar DAMAGEMODIFIER 1000
					//**Overall Support / ESSence**
					state support-overallresist
					state damagemod-enemy-melee          
				}
		
				//******************
				//*Equipment System*
				//******************
				ifvarg MELEEDAMAGE 0
				{
					setvar DAMAGEMODIFIER 1000
					// Equipment Slot #1
					ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #2
					ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #3
					ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #4
					ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #5
					ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #6
					ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #7
					ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					// Equipment Slot #8
					ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
					ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
					state damagemod-enemy-melee        
				}
		
			}
		}
		else
		{
			setactor[PLAYERID].htextra MELEEDAMAGE
			setvarvar TEMPDAMAGEVAR MELEEDAMAGE
			ifvarn VEHICLEID -1 state char_elecdamage_misc
			setvarvar MELEEDAMAGE TEMPDAMAGEVAR
		
			//****************
			//*Support System*
			//****************
			ifvarg MELEEDAMAGE 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Electrical Support / Nethra**
				state support-electricresist
				state damagemod-enemy-melee       
			}
		
			//*********************************
			//*Support System [ESSence Support*
			//*********************************
			ifvarg MELEEDAMAGE 0
			{
				setvar DAMAGEMODIFIER 1000
				//**Overall Support / ESSence**
				state support-overallresist
				state damagemod-enemy-melee          
			}
		
			//******************
			//*Equipment System*
			//******************
			ifvarg MELEEDAMAGE 0
			{
				setvar DAMAGEMODIFIER 1000
				// Equipment Slot #1
				ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #2
				ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #3
				ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #4
				ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #5
				ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #6
				ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #7
				ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				// Equipment Slot #8
				ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -250 // Plasma Ring
				ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
				state damagemod-enemy-melee        
			}
		}
		ifvarg INVULNTIME 0 state invulnflash 
		else ifvarand CHEATBITFIELD? 32 state invulnflash 
		else ifvarl MELEEDAMAGE 1 state nullflash
		else
		{
			ifvarg CURRENTHITPOINTS 0 // ifp palive
			{
				ifrnd 128 sound SHORT_CIRCUIT
				getactorvar[PLAYERID].VEHICLEID tempvehicleid
				ifvare tempvehicleid -1
				{
					setvarvar DAMAGEHUEFACTOR MELEEDAMAGE
					state playerdamagehues-electrictype
				}
				else palfrom 16 32 0 0 
			}
		}
	}
ends

state stoppainsounds
	stopsound DUKE_LONGTERM_PAIN
	stopsound DUKE_LONGTERM_PAIN1
	stopsound DUKE_LONGTERM_PAIN2
	stopsound DUKE_LONGTERM_PAIN3
	stopsound DUKE_LONGTERM_PAIN4
	stopsound DUKE_LONGTERM_PAIN5
	stopsound DUKE_LONGTERM_PAIN6
	stopsound DUKE_LONGTERM_PAIN7
	stopsound DUKE_LONGTERM_PAIN8
	stopsound WANG_LONGTERM_PAIN1
	stopsound WANG_LONGTERM_PAIN2
	stopsound WANG_LONGTERM_PAIN3
	stopsound WANG_LONGTERM_PAIN4
	stopsound WANG_LONGTERM_PAIN5
	stopsound WANG_LONGTERM_PAIN6
	stopsound WANG_LONGTERM_PAIN7
	stopsound WANG_LONGTERM_PAIN8
	stopsound LISA_PAINMINOR1
	stopsound LISA_PAINMINOR2
	stopsound LISA_PAINMINOR3
	stopsound LISA_PAINMINOR4
	stopsound LISA_PAINMODERATE1
	stopsound LISA_PAINMODERATE2
	stopsound LISA_PAINMODERATE3
	stopsound LISA_PAINMODERATE4
	stopsound LISA_PAINHIGH1
	stopsound LISA_PAINHIGH2
	stopsound LISA_PAINHIGH3
	stopsound LISA_PAINHIGH4
	stopsound LISA_PAINPERILOUS1
	stopsound LISA_PAINPERILOUS2
	stopsound LISA_PAINPERILOUS3
	stopsound LISA_PAINPERILOUS4
	stopsound MAKEN_PAINMINOR1
	stopsound MAKEN_PAINMINOR2
	stopsound MAKEN_PAINMINOR3
	stopsound MAKEN_PAINMINOR4
	stopsound MAKEN_PAINMODERATE1
	stopsound MAKEN_PAINMODERATE2
	stopsound MAKEN_PAINMODERATE3
	stopsound MAKEN_PAINMODERATE4
	stopsound MAKEN_PAINHIGH1
	stopsound MAKEN_PAINHIGH2
	stopsound MAKEN_PAINHIGH3
	stopsound MAKEN_PAINHIGH4
	stopsound MAKEN_PAINPERILOUS1
	stopsound MAKEN_PAINPERILOUS2
	stopsound MAKEN_PAINPERILOUS3
	stopsound MAKEN_PAINPERILOUS4
ends

state deflectshrinker
	ifvare oldskoolmode 0
	{
		state stoppainsounds
		setactor[THISACTOR].htextra -1
		getactor[THISACTOR].htang ATTACKANGLE
		addvar ATTACKANGLE 1024 // Flips the direction of the attack backwards
		ifvarg ATTACKANGLE 2047 subvar ATTACKANGLE 2048
		sound ENERGY_REFLECT
		eshoot SHRINKER
		setactor[RETURN].ang ATTACKANGLE
		// OFF-LIMITS
		setactor[RETURN].extra 0
		// END OFF-LIMITS
	}
ends

state fivepistols
	state fireshotspark1_angleeffect
	state fireshotspark1_angleeffect
	state fireshotspark1_angleeffect
	state fireshotspark1_angleeffect
	state fireshotspark1_angleeffect
ends

state fivechainguns
	state firechaingun_angleeffect
	state firechaingun_angleeffect
	state firechaingun_angleeffect
	state firechaingun_angleeffect
	state firechaingun_angleeffect
ends

state medikitvehicle_ratios
	ifvarvarl TEMPHEALTH tempb ifvarg ACTORPICKUPAMOUNT 0
	{
		ifactor DONUTS2 { setvar TEMP7 50 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor COLA { setvar TEMP7 100 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor DONUTS { setvar TEMP7 150 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor SWMEDIKIT { setvar TEMP7 200 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor SIXPAK { setvar TEMP7 300 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor SWBIGMEDIKIT { setvar TEMP7 500 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor MEDPACK { setvar TEMP7 750 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
		ifactor SURGERYKIT { setvar TEMP7 1000 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 }
	
		subvar ACTORPICKUPAMOUNT 1
		addvar tempe 1
	}
ends

state medikitvehicle
	// TEMP4 = Maximum HP % to reach
	// tempb = becomes the % of health needed to heal to reach TEMP4 [tempb - TEMPARMOR = tempb]
	setvar tempb 1000
	setvar TEMP4 1000
	setvarvar TEMPARMOR TEMPVAR4
	mulvar TEMPARMOR 1000
	divvarvar TEMPARMOR TEMPVAR5
	subvarvar tempb TEMPARMOR
	
	setvar TEMPHEALTH 0
	setvar ACTORPICKUPAMOUNT 1
	state checkpickupamountflags state checkdoublepickupbonus
	setvar tempe 0
	
	setvar TEMPVAR3 10
	whilevarn TEMPVAR3 0
	{
		state medikitvehicle_ratios
		subvar TEMPVAR3 1
	}
	
	mulvarvar TEMPHEALTH TEMPVAR5
	divvar TEMPHEALTH 1000
	addvarvar TEMPVAR4 TEMPHEALTH
	ifvarvarg TEMPVAR4 TEMPVAR5 setvarvar TEMPVAR4 TEMPVAR5
	setactorvar[tempvehicleid].ACTORHP TEMPVAR4
	setactorvar[tempvehicleid].ACTORMAXHP TEMPVAR5
	
	ifactor COLA { state checksmallmedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SWMEDIKIT { state checkmediummedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SIXPAK { state checklargemedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SWBIGMEDIKIT { state checkextralargemedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor MEDPACK { state checkmedpacks addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SURGERYKIT { state checksurgerykits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	
	ifvarand ACTORFLAGS 2 setvar VEHICLEHPDAMAGED? -1
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	globalsound VEHICLE_HEAL
ends

state medikitplayer_pickupamount
	ifvarvarl TEMPHEALTH tempb ifvarg ACTORPICKUPAMOUNT 0
	{
		ifactor DONUTS2 { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 75 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 50 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor COLA { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 150 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 100 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor DONUTS { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 225 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 150 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor SWMEDIKIT { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 300 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 200 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor SIXPAK { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 450 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 300 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor SWBIGMEDIKIT { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 750 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 500 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor MEDPACK { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 1125 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 750 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
		ifactor SURGERYKIT { ifvare CHARACTERSELECTED? 13 { setvar TEMP7 1500 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } else { setvar TEMP7 1000 state secretrecipecheck addvarvar TEMPHEALTH TEMP7 } }
	
		subvar ACTORPICKUPAMOUNT 1
		addvar tempe 1
	}
ends

state medikitplayer
	state gotmedsyoureallyneeded
	
	// TEMP4 = Maximum HP % to reach
	// tempb = becomes the % of health needed to heal to reach TEMP4 [tempb - TEMPARMOR = tempb]
	ifactor SURGERYKIT
	{
		ifvare CHARACTERSELECTED? 13 { setvar tempb 1500 setvar TEMP4 1500 }
		else { setvar tempb 1000 setvar TEMP4 1000 }
	}
	else
	ifactor MEDPACK
	{
		ifvare CHARACTERSELECTED? 13 { setvar tempb 1125 setvar TEMP4 1125 }
		else { setvar tempb 1000 setvar TEMP4 1000 }
	}
	else { setvar tempb 1000 setvar TEMP4 1000 }
	setvarvar TEMPARMOR CURRENTHITPOINTS
	mulvar TEMPARMOR 1000
	divvarvar TEMPARMOR MAXHITPOINTS
	subvarvar tempb TEMPARMOR
	
	setvar TEMPHEALTH 0
	setvar ACTORPICKUPAMOUNT 1
	state checkpickupamountflags state checkdoublepickupbonus
	setvar tempe 0
	
	setvar TEMPVAR5 10
	whilevarn TEMPVAR5 0
	{
		state medikitplayer_pickupamount
		subvar TEMPVAR5 1
	}
	
	// Check for Medic Bag [Equippable Item]
	setvar DAMAGEMODIFIER 0
	ifvare PLAYEREQUIPSLOTITEM1 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM2 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM3 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM4 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM5 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM6 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM7 24 addvar DAMAGEMODIFIER 10
	ifvare PLAYEREQUIPSLOTITEM8 24 addvar DAMAGEMODIFIER 10
	ifvarg DAMAGEMODIFIER 100 setvar DAMAGEMODIFIER 100
	setvarvar TEMPVAR6 TEMPHEALTH
	mulvarvar TEMPVAR6 DAMAGEMODIFIER
	divvar TEMPVAR6 100
	ifvarg TEMPVAR6 0
	{
		ifvarn CHARACTERSELECTED? 1 { setvar CHARACTERARRAY 1 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 2 { setvar CHARACTERARRAY 2 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 3 { setvar CHARACTERARRAY 3 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 4 { setvar CHARACTERARRAY 4 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 5 { setvar CHARACTERARRAY 5 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 6 { setvar CHARACTERARRAY 6 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 7 { setvar CHARACTERARRAY 7 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 8 { setvar CHARACTERARRAY 8 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 9 { setvar CHARACTERARRAY 9 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 10 { setvar CHARACTERARRAY 10 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 11 { setvar CHARACTERARRAY 11 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 12 { setvar CHARACTERARRAY 12 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 13 { setvar CHARACTERARRAY 13 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 14 { setvar CHARACTERARRAY 14 state medicbag_check2 }
		ifvarn CHARACTERSELECTED? 15 { setvar CHARACTERARRAY 15 state medicbag_check2 }
	}
	
	mulvarvar TEMPHEALTH MAXHITPOINTS
	divvar TEMPHEALTH 1000
		addvarvar CURRENTHITPOINTS TEMPHEALTH // Adds the actual heal value to the current player health
	ifvarand ACTORFLAGS 2 nullop else state showhealing_playerhp
	
	ifactor SURGERYKIT
	{
		ifvare CHARACTERSELECTED? 13
		{
			setvarvar tempb MAXHITPOINTS
			mulvar tempb 1500
			divvar tempb 1000
			ifvarvarg CURRENTHITPOINTS tempb setvarvar CURRENTHITPOINTS tempb
		}
		else
		{
			ifvarvarg CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
		}
	}
	else
	ifactor MEDPACK
	{
		ifvare CHARACTERSELECTED? 13
		{
			setvarvar tempb MAXHITPOINTS
			mulvar tempb 1125
			divvar tempb 1000
		ifvarvarg CURRENTHITPOINTS tempb setvarvar CURRENTHITPOINTS tempb
		}
		else
		{
		ifvarvarg CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
		}
	}
	else
	{
		ifvarvarg CURRENTHITPOINTS MAXHITPOINTS setvarvar CURRENTHITPOINTS MAXHITPOINTS
	}
	
	ifactor COLA { state checksmallmedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SWMEDIKIT { state checkmediummedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SIXPAK { state checklargemedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SWBIGMEDIKIT { state checkextralargemedikits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor MEDPACK { state checkmedpacks addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	ifactor SURGERYKIT { state checksurgerykits addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount }
	
	ifvarand ACTORFLAGS 2 setvar PLAYERHPDAMAGED? -1
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	globalsound USE_MEDIKITITEM
ends

state moneyfs
	state checkexplodeflag
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		palfrom 16 0 64 
		sound MONEYSOUND
	}
ends

state moneycalc
	ifvarg CENTS 99
	{
		setvarvar TEMP2 CENTS
		divvar TEMP2 100
		addvarvar DOLLARS TEMP2
		setvarvar TEMP3 CENTS
		modvar TEMP3 100
		setvarvar CENTS TEMP3
	}
	
	ifvarl CENTS 0
	{
		ifvarg DOLLARS 0
		{
			addvar CENTS 100
			subvar DOLLARS 1
		}
		else setvar CENTS 0
	}
ends

state bubblesounds
	getsector[THISACTOR].lotag TEMP5
	ifvare TEMP5 2
	{
		ifrnd 254
		{
			ifrnd 248
			{
				ifrnd 85 sound BUBBLES1
				else ifrnd 128 sound BUBBLES2
				else sound BUBBLES3
			}
		}
	}
	else
	{
		ifrnd 1
		{
			ifrnd 7
			{
				ifrnd 85 sound BUBBLES1
				else ifrnd 128 sound BUBBLES2
				else sound BUBBLES3
			}
		}
	}
ends

state jetpacksmoke
	espawn SMALLSMOKE
	getactor[THISACTOR].x TEMP
	setactor[RETURN].x TEMP
	getactor[THISACTOR].y TEMP
	setactor[RETURN].y TEMP
	getactor[THISACTOR].xrepeat temp
	getactorvar[THISACTOR].ACTORSHEIGHT tempc
	setvarvar tempb temp
	mulvar tempb 46
	divvar tempb 100
	setvarvar tempd tempc
	mulvarvar tempd tempb
	mulvar tempd 4
	getactor[THISACTOR].z TEMP
	subvarvar TEMP tempd
	setactor[RETURN].z TEMP
	ifrnd 128 setactor[RETURN].cstat 2 else setactor[RETURN].cstat 514
ends

state jetpackbubbles
	espawn WATERBUBBLE
	state bubblesounds
	getactor[THISACTOR].x TEMP
	setactor[RETURN].x TEMP
	getactor[THISACTOR].y TEMP
	setactor[RETURN].y TEMP
	getactor[THISACTOR].xrepeat temp
	getactorvar[THISACTOR].ACTORSHEIGHT tempc
	setvarvar tempb temp
	mulvar tempb 46
	divvar tempb 100
	setvarvar tempd tempc
	mulvarvar tempd tempb
	mulvar tempd 4
	getactor[THISACTOR].z TEMP
	subvarvar TEMP tempd
	setactor[RETURN].z TEMP
	ifrnd 128 setactor[RETURN].cstat 2 else setactor[RETURN].cstat 514
ends

state drownbubbles
	espawn WATERBUBBLE
	getactor[THISACTOR].x TEMP
	setactor[RETURN].x TEMP
	getactor[THISACTOR].y TEMP
	setactor[RETURN].y TEMP
	getactor[THISACTOR].xrepeat temp
	getactorvar[THISACTOR].ACTORSHEIGHT tempc
	setvarvar tempb tempc
	mulvar tempb 9
	divvar tempb 10
	setvarvar tempd tempb
	mulvarvar tempd temp
	mulvar tempd 4
	getactor[THISACTOR].z TEMP
	subvarvar TEMP tempd
	setactor[RETURN].z TEMP
ends

state monsterpainsounds2
	getactor[THISACTOR].picnum tempb
	switch tempb
	
		case ROTATEGUN
			debris SCRAP1 4
			break
	
		case LIZTROOP
		case LIZTROOPSTAYPUT
		case LIZTROOPJETPACK
		case LIZTROOPSHOOT
		case LIZTROOPDUCKING
		case LIZTROOPRUNNING
		case LIZTROOPONTOILET
		case LIZTROOPJUSTSIT
			soundonce PRED_PAIN
			break
		
		case LIZMAN
		case LIZMANSTAYPUT
		case LIZMANSPITTING
		case LIZMANJUMP
			soundonce CAPT_PAIN
			break
	
		case DRONE
			soundonce DRON_PAIN
			break
	
		case OCTABRAIN
		case OCTABRAINSTAYPUT
			getactor[THISACTOR].pal temp
			ifvare temp 14 soundonce NINE_PAIN
			else soundonce OCTA_PAIN  
			break
	
		case PIGCOP
		case PIGCOPSTAYPUT
		case PIGCOPDIVE
			soundonce PIG_PAIN
			break
	
		case BOSS1
		case BOSS1STAYPUT
		case BOSS1SHOOT
		case BOSS1LOB
			soundonce BOS1_PAIN
			break
	
		case BOSS2
		case BOSS2STAYPUT
		case BOSS2SHOOT
		case BOSS2BREATH
			soundonce BOS2_PAIN
			break
	
		case BOSS3
		case BOSS3STAYPUT
		case BOSS3LOB
			soundonce BOS3_PAIN
			break
	
		case COMMANDER
		case COMMANDERSTAYPUT
			getactor[THISACTOR].pal temp
			ifvare temp 14 addvar SOUNDPITCH 416
			ifvare temp 25 addvar SOUNDPITCH -416
			setplayer[THISACTOR].sound_pitch SOUNDPITCH
			soundonce COMM_PAIN
			ifvare temp 14 addvar SOUNDPITCH -416
			ifvare temp 25 addvar SOUNDPITCH 416
			setplayer[THISACTOR].sound_pitch SOUNDPITCH
			break
	
		case BOSS4
		case BOSS4STAYPUT
			soundonce BOS4_PAIN
			break
	
	
		case NEWBEAST
		case NEWBEASTSTAYPUT
		case NEWBEASTHANG
		case NEWBEASTJUMP
			soundonce NEWBEAST_PAIN
			break
	
	endswitch

	/*
	ifactor ROTATEGUN debris SCRAP1 4 
	else ifactor LIZTROOP soundonce PRED_PAIN
	else ifactor LIZTROOPSTAYPUT soundonce PRED_PAIN
	else ifactor LIZTROOPJETPACK soundonce PRED_PAIN
	else ifactor LIZTROOPSHOOT soundonce PRED_PAIN
	else ifactor LIZTROOPDUCKING soundonce PRED_PAIN
	else ifactor LIZTROOPRUNNING soundonce PRED_PAIN
	else ifactor LIZTROOPONTOILET soundonce PRED_PAIN
	else ifactor LIZTROOPJUSTSIT soundonce PRED_PAIN
	else ifactor LIZMAN soundonce CAPT_PAIN
	else ifactor LIZMANSTAYPUT soundonce CAPT_PAIN
	else ifactor LIZMANSPITTING soundonce CAPT_PAIN
	else ifactor LIZMANJUMP soundonce CAPT_PAIN
	else ifactor DRONE soundonce DRON_PAIN
	else
	ifactor OCTABRAIN
	{
		getactor[THISACTOR].pal temp
		ifvare temp 14 soundonce NINE_PAIN
		else soundonce OCTA_PAIN  
	}
	else
	ifactor OCTABRAINSTAYPUT
	{
		getactor[THISACTOR].pal temp
		ifvare temp 14 soundonce NINE_PAIN
		else soundonce OCTA_PAIN  
	}
	else ifactor PIGCOP soundonce PIG_PAIN
	else ifactor PIGCOPSTAYPUT soundonce PIG_PAIN
	else ifactor PIGCOPDIVE soundonce PIG_PAIN
	else ifactor BOSS1 soundonce BOS1_PAIN
	else ifactor BOSS1STAYPUT soundonce BOS1_PAIN
	else ifactor BOSS1SHOOT soundonce BOS1_PAIN
	else ifactor BOSS1LOB soundonce BOS1_PAIN
	else ifactor BOSS2 soundonce BOS2_PAIN
	else ifactor BOSS2STAYPUT soundonce BOS2_PAIN
	else ifactor BOSS2SHOOT soundonce BOS2_PAIN
	else ifactor BOSS2BREATH soundonce BOS2_PAIN
	else ifactor BOSS3 soundonce BOS3_PAIN
	else ifactor BOSS3STAYPUT soundonce BOS3_PAIN
	else ifactor BOSS3LOB soundonce BOS3_PAIN
	else
	ifactor COMMANDER
	{
		getactor[THISACTOR].pal temp
		ifvare temp 14 addvar SOUNDPITCH 416
		ifvare temp 25 addvar SOUNDPITCH -416
		setplayer[THISACTOR].sound_pitch SOUNDPITCH
		soundonce COMM_PAIN
		ifvare temp 14 addvar SOUNDPITCH -416
		ifvare temp 25 addvar SOUNDPITCH 416
		setplayer[THISACTOR].sound_pitch SOUNDPITCH
	}
	else
	ifactor COMMANDERSTAYPUT
	{
		getactor[THISACTOR].pal temp
		ifvare temp 14 addvar SOUNDPITCH 416
		ifvare temp 25 addvar SOUNDPITCH -416
		setplayer[THISACTOR].sound_pitch SOUNDPITCH
		soundonce COMM_PAIN
		ifvare temp 14 addvar SOUNDPITCH -416
		ifvare temp 25 addvar SOUNDPITCH 416
		setplayer[THISACTOR].sound_pitch SOUNDPITCH
	}
	else ifactor BOSS4 soundonce BOS4_PAIN
	else ifactor BOSS4STAYPUT soundonce BOS4_PAIN
	else ifactor NEWBEAST soundonce NEWBEAST_PAIN
	else ifactor NEWBEASTHANG soundonce NEWBEAST_PAIN
	else ifactor NEWBEASTJUMP soundonce NEWBEAST_PAIN
	else ifactor NEWBEASTSTAYPUT soundonce NEWBEAST_PAIN
	*/
ends

//********************
//********************
include TILEEMUL.CON
//********************
//********************

state enemyfirstaidstationcheck
	setvar ITEMFATARGET -1
	ifvarn ITEMTARGET -1
	{
		// Otherwise so far all other items are fair game to all monster species
		getactor[THISACTOR].picnum TEMP
		ifvare TEMP BOSS2
		{
			getactor[THISACTOR].pal TEMP
			ifvare TEMP 0
			{
				getactor[ITEMTARGET].sectnum TEMP
				getsector[TEMP].lotag TEMP
				ifvarn TEMP 3
				{
					setvar ITEMTARGET -1
					break
				}
				else
				{
					ifactornotstayput
					{
					ifvarl actorvar[ITEMTARGET].HEALPANEL_CHARGES 1
					{
						setvar ITEMTARGET -1
						break
					}
					else setvarvar ITEMFATARGET ITEMTARGET
					}
					else
					{
					getactor[THISACTOR].sectnum TEMP2
					getactor[ITEMTARGET].sectnum TEMP3
					ifvarvarn TEMP2 TEMP3
					{
						setvar ITEMTARGET -1
						break
					}
					else setvarvar ITEMFATARGET ITEMTARGET
					}
				}
			}
			else
			{
				ifactornotstayput
				{
					ifvarl actorvar[ITEMTARGET].HEALPANEL_CHARGES 1
					{
						setvar ITEMTARGET -1
						break
					}
					else setvarvar ITEMFATARGET ITEMTARGET
				}
				else
				{
					getactor[THISACTOR].sectnum TEMP2
					getactor[ITEMTARGET].sectnum TEMP3
					ifvarvarn TEMP2 TEMP3
					{
						setvar ITEMTARGET -1
						break
					}
					else setvarvar ITEMFATARGET ITEMTARGET
				}
			}
		}
		else
		{
			ifactornotstayput
			{
				ifvarl actorvar[ITEMTARGET].HEALPANEL_CHARGES 1
				{
					setvar ITEMTARGET -1
					break
				}
				else setvarvar ITEMFATARGET ITEMTARGET
			}
			else
			{
				getactor[THISACTOR].sectnum TEMP2
				getactor[ITEMTARGET].sectnum TEMP3
				ifvarvarn TEMP2 TEMP3
				{
					setvar ITEMTARGET -1
					break
				}
				else setvarvar ITEMFATARGET ITEMTARGET
			}
		}
	}
ends

state enemyitemcheckstayput
	ifvarn ITEMTARGET -1
	{
		ifvarand actorvar[ITEMTARGET].ACTORFLAGS 16
		{
			setvar ITEMTARGET -1
			break
		}
	}
	/*
	else
	ifvarand TEMP 8192 // Enemies will not try to grab items that are fully booby-trapped
	{
		setvar ITEMTARGET -1
		break
	}
	*/
	else
	{
		ifvarn ITEMTARGET -1
		{
			ifvarl actorvar[ITEMTARGET].ITEMDROPPEDTIME 1 // Checks to see if the item is still recovering from being dropped by a player
			{
				// Only LIZTROOPs will look for Jetpacks
				getactor[ITEMTARGET].picnum TEMP
				ifvare TEMP JETPACK
				{
					getactor[THISACTOR].picnum TEMP
					ifvarn TEMP LIZTROOP // Stops the search for a jetpack if the creature is not a LIZTROOP
					{
						setvar ITEMTARGET -1
						break
					}
					else // If it is a LIZTROOP, make sure it is not stayput and the jetpack is in a different sector from it.
					{
						ifactornotstayput nullop
						else
						{
							getactor[THISACTOR].sectnum TEMP2
							getactor[ITEMTARGET].sectnum TEMP3
							ifvarvarn TEMP2 TEMP3
							{
								setvar ITEMTARGET -1
								break
							}
						}
					}
				}
				// Only Living Creatures will look for Winter Clothes
				getactor[ITEMTARGET].picnum TEMP
				ifvare TEMP WINTERCLOTHES
				{
					getactor[THISACTOR].picnum TEMP
					ifvare TEMP ROTATEGUN { setvar ITEMTARGET -1 break }
					else ifvare TEMP DRONE { setvar ITEMTARGET -1 break }
					else ifvare TEMP TANK { setvar ITEMTARGET -1 break }
					else ifvare TEMP SCORPIONTANK { setvar ITEMTARGET -1 break }
					else ifvare TEMP EMPTYTANK { setvar ITEMTARGET -1 break }
					else // If it is a Living Creature, make sure it is not stayput and the winterclothes is in a different sector from it.
					{
						ifactornotstayput nullop
						else
						{
							getactor[THISACTOR].sectnum TEMP2
							getactor[ITEMTARGET].sectnum TEMP3
							ifvarvarn TEMP2 TEMP3
							{
								setvar ITEMTARGET -1
								break
							}
						}
					}
				}
		
				// Otherwise so far all other items are fair game to all monster species
				getactor[THISACTOR].picnum TEMP
				ifvare TEMP BOSS2
				{
					getactor[THISACTOR].pal TEMP
					ifvare TEMP 0
					{
						getactor[ITEMTARGET].sectnum TEMP
						getsector[TEMP].lotag TEMP
						ifvarn TEMP 3
						{
							setvar ITEMTARGET -1
							break
						}
						else
						{
							ifactornotstayput nullop
							else
							{
								getactor[THISACTOR].sectnum TEMP2
								getactor[ITEMTARGET].sectnum TEMP3
								ifvarvarn TEMP2 TEMP3
								{
									setvar ITEMTARGET -1
									break
								}
							}
						}
					}
					else
					{
						ifactornotstayput nullop
						else
						{
							getactor[THISACTOR].sectnum TEMP2
							getactor[ITEMTARGET].sectnum TEMP3
							ifvarvarn TEMP2 TEMP3
							{
								setvar ITEMTARGET -1
								break
							}
						}
					}
				}
				else
				{
					ifactornotstayput nullop
					else
					{
						getactor[THISACTOR].sectnum TEMP2
						getactor[ITEMTARGET].sectnum TEMP3
						ifvarvarn TEMP2 TEMP3
						{
							setvar ITEMTARGET -1
							break
						}
					}
				}
			}
			else
			{
				setvar ITEMTARGET -1
				break
			}
		}
	}
ends

state enemyitemzsetup1
	getactor[ITEMTARGET].z ITEMTARGETZ
	getactor[THISACTOR].z ITEMSEEKERZ
	subvar ITEMTARGETZ 4096
	setactor[ITEMTARGET].z ITEMTARGETZ
	subvar ITEMSEEKERZ 8192
	setactor[THISACTOR].z ITEMSEEKERZ
	canseespr THISACTOR ITEMTARGET CANSEEITEM?
	addvar ITEMTARGETZ 4096
	setactor[ITEMTARGET].z ITEMTARGETZ
	addvar ITEMSEEKERZ 8192
	setactor[THISACTOR].z ITEMSEEKERZ
ends

state enemyitemzsetup2
	getactor[ITEMTARGET].x ITEMTARGETX
	getactor[ITEMTARGET].y ITEMTARGETY
	getactor[THISACTOR].x ITEMSEEKERX
	getactor[THISACTOR].y ITEMSEEKERY
	subvarvar ITEMTARGETX ITEMSEEKERX
	subvarvar ITEMTARGETY ITEMSEEKERY
	getangle ITEMSEEKERANGLE ITEMTARGETX ITEMTARGETY
	ifvarand ACTORSTATUS? 128
	{
		setvarvar TEMPVAR4 ITEMSEEKERANGLE
		subvarvar TEMPVAR4 ACTORANGLE
		subvarvar ITEMSEEKERANGLE TEMPVAR4
	}
	setactor[THISACTOR].ang ITEMSEEKERANGLE
ends

state resetplayeritems
	setvar QUADTIME 0
	setvar INVULNTIME 0
	setvar REGENTIME 0
	setvar APREGENTIME 0
	setvar VAMPIRETIME 0
ends

state enemyhealzsetup2
	getactor[HEALSEEK].x TEMPVAR5
	getactor[THISACTOR].x TEMPVAR7
	subvarvar TEMPVAR5 TEMPVAR7
	getactor[HEALSEEK].y TEMPVAR6
	getactor[THISACTOR].y TEMPVAR8
	subvarvar TEMPVAR6 TEMPVAR8
	getangle TEMPVAR4 TEMPVAR5 TEMPVAR6
	setactor[THISACTOR].ang TEMPVAR4
ends

state healdetectifdead
	ifvarn HEALSEEK -1
	{ 
		getactor[HEALSEEK].pal HEALSEEKB
		ifvarg HEALSEEKB 8 ifvarl HEALSEEKB 12 { setvar HEALSEEK -1 break } // Makes it that if the current target is an "old-skool" monster, set to -1 to search for a non-"old-skool" one
	
		ifvarl actorvar[HEALSEEK].ACTORHP 1 { setvar HEALSEEK -1 break } // Makes it that if the current target is dead, set to -1 to search for a living one
	
		getactorvar[HEALSEEK].ACTORHP TEMP
		getactorvar[HEALSEEK].ACTORMAXHP TEMP2
		setvarvar TEMP3 TEMP
		mulvar TEMP3 1000
		divvarvar TEMP3 TEMP2
		setvarvar HEALSEEKRATIO TEMP3
	
		ifvare HEALTYPE 0 { ifvarg TEMP3 999 { setvar HEALSEEK -1 break } } // For normal types of healing with the usual 100% HP limit
		ifvare HEALTYPE 1 { ifvarg TEMP3 1332 { setvar HEALSEEK -1 break } } // If Heal Life [Lesser] is used, check to see if enemy has less than 133% of their HP and cancel if they have more.
		ifvare HEALTYPE 2 { ifvarg TEMP3 1666 { setvar HEALSEEK -1 break } } // If Heal Life [Greater] is used, check to see if enemy has less than 133% of their HP and cancel if they have more.
	
		ifvare actorvar[HEALSEEK].FROZEN? 1 { setvar HEALSEEK -1 break } // Makes it that if the current target is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[HEALSEEK].EXPANDING? 1 { setvar HEALSEEK -1 break } // Makes it that if the current target is expanding, set to -1 to search for a non-expanded one
		ifvare actorvar[HEALSEEK].CLOAKED? 1 { setvar HEALSEEK -1 break } // Makes it that if the current target is cloaked, set to -1 to search for a non-cloaked one
	
		canseespr THISACTOR HEALSEEK HEALSEEKB
		ifvare HEALSEEKB 0 { setvar HEALSEEK -1 break } // Makes it the healer needs to see his/her target.
	}
ends

state itemdetectifdead
	ifvarand ACTORFLAGS 16 setvar ITEMSEEK -1
	else
	{
		ifvarn ITEMSEEK -1
		{ 
			getactor[ITEMSEEK].pal ITEMSEEKD
			ifvarg ITEMSEEKD 8 ifvarl ITEMSEEKD 12 { setvar ITEMSEEK -1 break } // Makes it that if the current "seeker" is "old-skool", set to -1 to search for a non-"old-skool" one
			ifvarl actorvar[ITEMSEEK].ACTORHP 1 { setvar ITEMSEEK -1 break } // Makes it that if the current "seeker" is dead, set to -1 to search for a living one
			ifvare actorvar[ITEMSEEK].SHRUNK? 1 { setvar ITEMSEEK -1 break } // Makes it that if the current "seeker" is shrunken, set to -1 to search for a non-shrunken one
			ifvare actorvar[ITEMSEEK].EXPANDING? 1 { setvar ITEMSEEK -1 break } // Makes it that if the current "seeker" is expanding, set to -1 to search for a non-expanding one
			ifvare actorvar[ITEMSEEK].FROZEN? 1 { setvar ITEMSEEK -1 break } // Makes it that if the current "seeker" is frozen, set to -1 to search for a non-frozen one
			ifvare actorvar[ITEMSEEK].CLOAKED? 1 { setvar ITEMSEEK -1 break } // Makes it that if the current "seeker" is cloaked, set to -1 to search for a non-cloaked one
			canseespr THISACTOR ITEMSEEK ITEMSEEKD
			ifvare ITEMSEEKD 0 { setvar ITEMSEEK -1 break } // Makes it the monster and the item need a line of sight.
		}
	}
ends

state itemseekingliztroop // For allowing LIZTROOP to grab jetpacks to replenish their own
	ifvarand ACTORFLAGS 16 setvar ITEMSEEK -1
	else
	{
		addvar FINDNEAR_INTERVAL 1
		ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
		{
			findnearactorz LIZTROOP ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			setvar FINDNEAR_INTERVAL 0
		}
	}
ends

state itemseekingactor
	ifvarand ACTORFLAGS 16 setvar ITEMSEEK -1
	else
	{
		addvar FINDNEAR_INTERVAL 1
		ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
		{
			// List in the order of top to low priority
			findnearactorz BOSS4 BOSSRETRIEVEDISTANCE BOSSZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz BOSS2 BOSSRETRIEVEDISTANCE BOSSZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz BOSS3 BOSSRETRIEVEDISTANCE BOSSZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz BOSS1 BOSSRETRIEVEDISTANCE BOSSZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz SCORPIONTANK BOSSRETRIEVEDISTANCE BOSSZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz TANK BOSSRETRIEVEDISTANCE BOSSZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz COMMANDER ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz NEWBEAST ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz OCTABRAIN ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DRONE ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz LIZMAN ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz PIGCOP ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz LIZTROOP ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ROTATEGUN ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz SHARK ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			// NPCs
			ifvare ITEMSEEK -1 findnearactorz PRESIDENTCLINTON ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ROBOTDOG ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ROBOTDOG2 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz PODFEM1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz NAKED1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM2 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM3 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM4 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM5 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM6 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM7 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM9 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz FEM10 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz TOUGHGAL ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz WOMAN ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE2 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE3 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE5 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE6 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE7 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DANCE9 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz STAND1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz DEALER ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz STAND3 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz STAND4 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz WOLFDUDE ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz COP1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz PUNKDUDE ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz COP2 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz SITTINGDUDE ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ANIMEGIRL1 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ANIMEGIRL2 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ANIMEGIRL3 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			ifvare ITEMSEEK -1 findnearactorz ANIMEGIRL4 ENEMYRETRIEVEDISTANCE ENEMYZRETRIEVEDISTANCE ITEMSEEK state itemdetectifdead
			setvar FINDNEAR_INTERVAL 0
		}
	}
ends

state actorseekingsuperatom
	ifvare ITEMTARGET -1 
	{   
		setvar TEMP5 0
		ifvarvarl ACTORHP ACTORMAXHPATOMIC addvar TEMP5 1
		ifvarvarl ACTORAP ACTORMAXAPATOMIC addvar TEMP5 1
		ifvarvarl actorvar[ITEMSEEK].ACTORFIRSTAID ACTORMAXHPATOMIC addvar TEMP5 1
		ifvarand ACTORSTATUS? 16
		{
			ifvarg TEMP5 0 { findnearactorz SUPERATOM ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput }
		}
		else
		{
			ifvarg TEMP5 0 { findnearactorz SUPERATOM ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput }
		}
	}
ends

state actorseekingitem
	addvar FINDNEAR_INTERVAL 1
	ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
	{
		ifvarand ACTORSTATUS? 16
		{
			// List in the order of top to low priority
			findnearactorz ICONOFTHEDEFENDER ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz VAMPIREITEM ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz REGENITEM ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz APREGENITEM ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz QUADDAMAGE ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl enemywinterclothes 50 findnearactorz WINTERCLOTHES ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarand ACTORSTATUS? 128 findnearactorz FOGHORN ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarand ACTORSTATUS? 8 findnearactorz ANTIDOTE ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarand ACTORSTATUS? 16 findnearactorz EYEDROP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz AIRTIMEBONUS ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORMAXHP STATLIMIT ifvarvarl ACTORMAXAP STATLIMIT findnearactorz MAXHPAPUP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORMAXAP STATLIMIT findnearactorz MAXAPUP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORMAXHP STATLIMIT findnearactorz MAXHPUP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORATTACK STATLIMIT ifvarvarl ACTORDEFENSE STATLIMIT findnearactorz ATKDEFUP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORDEFENSE STATLIMIT findnearactorz DEFUP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORATTACK STATLIMIT findnearactorz ATKUP ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			state actorseekingsuperatom
		
			ifvare ITEMTARGET -1 ifvarvarl ACTORAP STATLIMITATOMIC ifvarvarl ACTORAP ACTORMAXAPATOMIC findnearactorz SUPERSHIELD ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl actorvar[ITEMSEEK].ACTORFIRSTAID ACTORMAXHP findnearactorz FIRSTAID ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORAP ACTORMAXAP findnearactorz COLORSHIELD ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORAP ACTORMAXAP findnearactorz SHIELD ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP STATLIMITATOMIC ifvarvarl ACTORHP ACTORMAXHPATOMIC findnearactorz FORTUNECOOKIE ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP STATLIMITATOMIC ifvarvarl ACTORHP ACTORMAXHPATOMIC findnearactorz ATOMICHEALTH ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl ACTORJETPACKAMOUNT JETPACK_AMOUNT findnearactorz JETPACK ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl ACTORBOOTSAMOUNT BOOT_AMOUNT findnearactorz BOOTS ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl ACTORAIRTANKAMOUNT SCUBA_AMOUNT findnearactorz AIRTANK ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SURGERYKIT ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz MEDPACK ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SWBIGMEDIKIT ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SIXPAK ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SWMEDIKIT ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz COLA ENEMYSEEKDISTANCEDIM ENEMYSEEKZDISTANCEDIM ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz FIRSTAIDPANEL_ON ENEMYSEEKDISTANCEDIM 422 ITEMTARGET state enemyfirstaidstationcheck
		}
		else
		{
			// List in the order of top to low priority
			findnearactorz ICONOFTHEDEFENDER ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz VAMPIREITEM ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz REGENITEM ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz APREGENITEM ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz QUADDAMAGE ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl enemywinterclothes 50 findnearactorz WINTERCLOTHES ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarand ACTORSTATUS? 8 findnearactorz ANTIDOTE ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 findnearactorz AIRTIMEBONUS ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORMAXHP STATLIMIT ifvarvarl ACTORMAXAP STATLIMIT findnearactorz MAXHPAPUP ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORMAXAP STATLIMIT findnearactorz MAXAPUP ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORMAXHP STATLIMIT findnearactorz MAXHPUP ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORATTACK STATLIMIT ifvarvarl ACTORDEFENSE STATLIMIT findnearactorz ATKDEFUP ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORDEFENSE STATLIMIT findnearactorz DEFUP ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORATTACK STATLIMIT findnearactorz ATKUP ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			state actorseekingsuperatom //  ifvare ITEMTARGET -1 ifvarvarl ACTORHP STATLIMITATOMIC ifvarvarl ACTORHP ACTORMAXHPATOMIC findnearactorz SUPERATOM ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
		
			ifvare ITEMTARGET -1 ifvarvarl ACTORAP STATLIMITATOMIC ifvarvarl ACTORAP ACTORMAXAPATOMIC findnearactorz SUPERSHIELD ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl actorvar[ITEMSEEK].ACTORFIRSTAID ACTORMAXHP findnearactorz FIRSTAID ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORAP ACTORMAXAP findnearactorz COLORSHIELD ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORAP ACTORMAXAP findnearactorz SHIELD ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP STATLIMITATOMIC ifvarvarl ACTORHP ACTORMAXHPATOMIC findnearactorz FORTUNECOOKIE ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP STATLIMITATOMIC ifvarvarl ACTORHP ACTORMAXHPATOMIC findnearactorz ATOMICHEALTH ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl ACTORJETPACKAMOUNT JETPACK_AMOUNT findnearactorz JETPACK ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl ACTORBOOTSAMOUNT BOOT_AMOUNT findnearactorz BOOTS ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarl ACTORAIRTANKAMOUNT SCUBA_AMOUNT findnearactorz AIRTANK ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SURGERYKIT ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz MEDPACK ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SWBIGMEDIKIT ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SIXPAK ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz SWMEDIKIT ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz COLA ENEMYSEEKDISTANCE ENEMYSEEKZDISTANCE ITEMTARGET state enemyitemcheckstayput
			ifvare ITEMTARGET -1 ifvarvarl ACTORHP ACTORMAXHP findnearactorz FIRSTAIDPANEL_ON ENEMYSEEKDISTANCE 4220 ITEMTARGET state enemyfirstaidstationcheck
		}
		setvar FINDNEAR_INTERVAL 0
	}
ends

state playerstealjustbeforemonster
	// List in the order of top to low priority
	findnearactorz BOSS4 BOSSSTOLENDISTANCE BOSSZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz BOSS2 BOSSSTOLENDISTANCE BOSSZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz BOSS3 BOSSSTOLENDISTANCE BOSSZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz BOSS1 BOSSSTOLENDISTANCE BOSSZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz SCORPIONTANK BOSSSTOLENDISTANCE BOSSZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz TANK BOSSSTOLENDISTANCE BOSSZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz COMMANDER ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz NEWBEAST ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz OCTABRAIN ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz DRONE ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz LIZMAN ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz PIGCOP ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz LIZTROOP ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz ROTATEGUN ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvare ITEMSEEK -1 findnearactorz SHARK ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE ITEMSEEK state itemdetectifdead
	ifvarn ITEMSEEK -1
	{
		ifvarn actorvar[ITEMSEEK].ITEMTARGET -1
		{
			ifvare CHARACTERSELECTED? 8
			{
				globalsound LISA_STEALITEM 
				redefinequote 340 ^7Lisa: Ahaha!! You're too slow, dirtbag!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare CHARACTERSELECTED? 15
			{
				globalsound MAKEN_STEALITEM 
				redefinequote 340 ^10Maken: Nah-nah-nah-nah-nah, you can't catch me!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
	}
ends

state monsterstealjustbeforeplayer
	findnearspritez APLAYER ENEMYSTOLENDISTANCE ENEMYZSTOLENDISTANCE TEMPVAR
	ifvarn TEMPVAR -1
	{
		ifvarg CURRENTHITPOINTS 0
		{
			ifvare CHARACTERSELECTED? 8
			{
				globalsound LISA_ITEMSTOLEN
				redefinequote 340 ^7Lisa: Dammit!! Come back here with that!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare CHARACTERSELECTED? 15
			{
				globalsound MAKEN_ITEMSTOLEN 
				redefinequote 340 ^10Maken: You son of a friggin' bitch!! Come back here!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
	}
ends

state enemygrabitemflash
	ifvarand ACTORFLAGS 4 nullop
	else
	{
		ifvare ITEMSEEKSPECIESTYPE 0 state monsterstealjustbeforeplayer
		setvarvar fta fta_normal setvar ftq 185
		palfrom 4 0 32
	}
	state activationflag killit
ends

state medikitmonster_ratio
	ifvarvarl ITEMSEEKC tempb ifvarg ACTORPICKUPAMOUNT 0
	{
		ifactor COLA addvar ITEMSEEKC 100
		ifactor SWMEDIKIT addvar ITEMSEEKC 200
		ifactor SIXPAK addvar ITEMSEEKC 300
		ifactor SWBIGMEDIKIT addvar ITEMSEEKC 500
		ifactor MEDPACK addvar ITEMSEEKC 750
		ifactor SURGERYKIT addvar ITEMSEEKC 1000
		subvar ACTORPICKUPAMOUNT 1
		addvar tempe 1
	}
ends

state medikitmonster
	state checkenemypickuphealth
	getactorvar[ITEMSEEK].ACTORMAXHP ITEMACTORMAXHP
	
	ifvarg ITEMSEEKB 0 ifvarvarl ITEMSEEKB ITEMACTORMAXHP
	{
		state checkexplodeflag
	
		// TEMP4 = Maximum HP % to reach
		// tempb = becomes the % of health needed to heal to reach TEMP4 [tempb - TEMPARMOR = tempb]
		setvar tempb 1000
		setvar TEMP4 1000
		setvarvar TEMPARMOR ITEMSEEKB
		mulvar TEMPARMOR 1000
		divvarvar TEMPARMOR ITEMACTORMAXHP
		subvarvar tempb TEMPARMOR
	
		setvar ITEMSEEKC 0
		setvar ACTORPICKUPAMOUNT 1
		state checkpickupamountflags
		setvar tempe 0
	
		setvar TEMPVAR5 10
		whilevarn TEMPVAR5 0
		{
			state medikitmonster_ratio
			subvar TEMPVAR5 1
		}
	
		mulvarvar ITEMSEEKC ITEMACTORMAXHP
		divvar ITEMSEEKC 1000
		addvarvar ITEMSEEKB ITEMSEEKC
		ifvarvarg ITEMSEEKB ITEMACTORMAXHP setvarvar ITEMSEEKB ITEMACTORMAXHP
		setactorvar[ITEMSEEK].ACTORHP ITEMSEEKB
		state showhealing_actorhp
	
		state resetitemtarget
		state getitemseekerspecies
	
		ifvarg ACTORPICKUPAMOUNT 7
		{
			ifactor COLA { espawn COLA setactorvar[RETURN].ACTORFLAGS 384 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWMEDIKIT { espawn SWMEDIKIT setactorvar[RETURN].ACTORFLAGS 384 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SIXPAK { espawn SIXPAK setactorvar[RETURN].ACTORFLAGS 384 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWBIGMEDIKIT { espawn SWBIGMEDIKIT setactorvar[RETURN].ACTORFLAGS 384 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor MEDPACK { espawn MEDPACK setactorvar[RETURN].ACTORFLAGS 384 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SURGERYKIT { espawn SURGERYKIT setactorvar[RETURN].ACTORFLAGS 384 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			subvar ACTORPICKUPAMOUNT 8
		}
		ifvarg ACTORPICKUPAMOUNT 3
		{
			ifactor COLA { espawn COLA setactorvar[RETURN].ACTORFLAGS 256 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWMEDIKIT { espawn SWMEDIKIT setactorvar[RETURN].ACTORFLAGS 256 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SIXPAK { espawn SIXPAK setactorvar[RETURN].ACTORFLAGS 256 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWBIGMEDIKIT { espawn SWBIGMEDIKIT setactorvar[RETURN].ACTORFLAGS 256 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor MEDPACK { espawn MEDPACK setactorvar[RETURN].ACTORFLAGS 256 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SURGERYKIT { espawn SURGERYKIT setactorvar[RETURN].ACTORFLAGS 256 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			subvar ACTORPICKUPAMOUNT 4
		}
		ifvarg ACTORPICKUPAMOUNT 1
		{
			ifactor COLA { espawn COLA setactorvar[RETURN].ACTORFLAGS 128 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWMEDIKIT { espawn SWMEDIKIT setactorvar[RETURN].ACTORFLAGS 128 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SIXPAK { espawn SIXPAK setactorvar[RETURN].ACTORFLAGS 128 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWBIGMEDIKIT { espawn SWBIGMEDIKIT setactorvar[RETURN].ACTORFLAGS 128 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor MEDPACK { espawn MEDPACK setactorvar[RETURN].ACTORFLAGS 128 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SURGERYKIT { espawn SURGERYKIT setactorvar[RETURN].ACTORFLAGS 128 setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			subvar ACTORPICKUPAMOUNT 2
		}
		ifvare ACTORPICKUPAMOUNT 1
		{
			ifactor COLA { espawn COLA setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWMEDIKIT { espawn SWMEDIKIT setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SIXPAK { espawn SIXPAK setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SWBIGMEDIKIT { espawn SWBIGMEDIKIT setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor MEDPACK { espawn MEDPACK setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			ifactor SURGERYKIT { espawn SURGERYKIT setactorvar[RETURN].FLAGSSET? 1 state scatterdrops }
			subvar ACTORPICKUPAMOUNT 1
		}
	
		ifvarand ACTORFLAGS 4 nullop
		else
		{
			ifactor COLA 
			{
				ifvarg tempe 1
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT %d SMALL MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT %d SMALL MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT %d SMALL MEDIKITS!
					qsprintf 185 185 tempe
				}
				else
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT A SMALL MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A SMALL MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT A SMALL MEDIKIT!
				}
			}
			ifactor SWMEDIKIT 
			{
				ifvarg tempe 1
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT %d MEDIUM MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT %d MEDIUM MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT %d MEDIUM MEDIKITS!
					qsprintf 185 185 tempe
				}
				else
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT A MEDIUM MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A MEDIUM MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT A MEDIUM MEDIKIT!
				}
			}
			ifactor SIXPAK 
			{
				ifvarg tempe 1
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT %d LARGE MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT %d LARGE MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT %d LARGE MEDIKITS!
					qsprintf 185 185 tempe
				}
				else
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT A LARGE MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A LARGE MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT A LARGE MEDIKIT!
				}
			}
			ifactor SWBIGMEDIKIT
			{
				ifvarg tempe 1
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT %d EXTRA-LARGE MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT %d EXTRA-LARGE MEDIKITS!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT %d EXTRA-LARGE MEDIKITS!
					qsprintf 185 185 tempe
				}
				else
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT AN EXTRA-LARGE MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A EXTRA-LARGE MEDIKIT!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT A EXTRA-LARGE MEDIKIT!
				}
			}
			ifactor MEDPACK 
			{
				ifvarg tempe 1
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT %d MED PACKS!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT %d MED PACKS!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT %d MED PACKS!
					qsprintf 185 185 tempe
				}
				else
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT A MED PACK!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A MED PACK!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT A MED PACK!
				}
			}
			ifactor SURGERYKIT 
			{
				ifvarg tempe 1
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT %d SURGERY KITS!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT %d SURGERY KITS!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT %d SURGERY KITS!
					qsprintf 185 185 tempe
				}
				else
				{
					ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT A SURGERY KIT!
					ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A SURGERY KIT!
					ifvare ITEMSEEKSPECIESTYPE 2 redefinequote 185 ^15A VEHICLE GOT A SURGERY KIT!
				}
			}
		
			setactorvar[ITEMSEEK].ACTORHPDAMAGED? -1
			globalsound DUKE_GET
			globalsound USE_MEDIKITITEM
		}
		state enemygrabitemflash
		setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
		state getworldtile
	}
ends

state difficulty
	getuserdef[THISACTOR].player_skill SKILLLEVEL
	
	setvar MISCARRAYID 80 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-EPISODE
	getuserdef[THISACTOR].volume_number MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setvar MISCARRAYID 80 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-EPISODE
	
	setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-LEVEL
	getuserdef[THISACTOR].level_number MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setvar MISCARRAYID 81 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-LEVEL
ends

// State for calcing enemy health on skills above four and by Episode/Level

state getenemylevel2
	// OFF-LIMITS
	getactor[THISACTOR].extra ACTORLEVEL
	setactor[THISACTOR].extra -1
	getactor[THISACTOR].xvel ACTORLEVELMINSPAWN
	setactor[THISACTOR].xvel 0
	getactor[THISACTOR].yvel ACTORLEVELMAXSPAWN
	setactor[THISACTOR].yvel 0
	getactor[THISACTOR].zvel ACTORFLAGS
	setactor[THISACTOR].zvel 0
	setactor[THISACTOR].htowner -1
	setactorvar[THISACTOR].ACTORMAXHP 1 // Prevents instanteous monster death on activation
	// END OFF LIMITS
	
	state enemytyperandomizer
	
	// Rest of the Code
	setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
	ifvarn MISCARRAYID_AMOUNTTEMP 0
	{
		ifvare RADARARROWSET? 0
		{
			espawn POINTERARROW // POINTERARROW is for when the actor can be seen on the Mercury Computer's Radar
			setactorvar[THISACTOR].POINTERICONCHILD RETURN
			setactorvar[RETURN].POINTERICONPARENT THISACTOR
			setvar RADARARROWSET? 1
		}
	}
	
	ifvarn ACTORLEVEL -1 setvar ACTORLEVELPRESET? 1 // Sets a flag to keep a preset enemy's levels intact despite recalcuations at player levelups
	ifvarl ACTORLEVEL 0 
	{
		setvar ACTORLEVEL 0
		ifvarg ACTORLEVELMINSPAWN 0
		{
			ifvarvarl ACTORLEVELMINSPAWN ACTORLEVELMAXSPAWN
			{
				setvarvar tempc ACTORLEVELMAXSPAWN
				subvarvar tempc ACTORLEVELMINSPAWN    
				randvarvar ACTORLEVEL tempc
				addvarvar ACTORLEVEL ACTORLEVELMINSPAWN
			}
			else
			{
				setvarvar ACTORLEVEL ACTORLEVELMINSPAWN
			}
		}
	}
	
	ifvarg ACTORLEVEL 100 setvar ACTORLEVEL 100
ends

state capmaxhpenemy
	ifvarvarg ACTORHP STATLIMITATOMIC setvarvar ACTORHP STATLIMITATOMIC
ends

state newenemystatcalc
	getactor[THISACTOR].picnum STATCALCPICNUM
	getactor[THISACTOR].pal STATCALCPAL
	
	// ************************************
	// *Calculates Hit Points for Monsters*
	// ************************************
	
	ifvare ACTORLEVEL 0 state getenemylevel
	
	// Skill Level has the most influence on enemy HP levels [100.0%-399.7%]
	setvar TEMPVAR2 1000
	setvar TEMPVAR3 333
	mulvarvar TEMPVAR3 SKILLLEVEL
	addvarvar TEMPVAR2 TEMPVAR3
	mulvarvar ACTORHP TEMPVAR2
	divvar ACTORHP 1000
	
	// Episode has the 2nd most influence on enemy HP levels [100.0%-275.0%]
	setvar TEMPVAR2 750
	setvar TEMPVAR3 250
	setvar MISCARRAYID 80 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-EPISODE
	mulvarvar TEMPVAR3 MISCARRAYID_AMOUNTTEMP
	addvarvar TEMPVAR2 TEMPVAR3
	mulvarvar ACTORHP TEMPVAR2
	divvar ACTORHP 1000
	
	// Level has the least influence on enemy HP levels [100.0%-1700.0%]
	setvar TEMPVAR2 975
	setvar TEMPVAR3 25
	setvar MISCARRAYID 81 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DISPLAY-LEVEL
	mulvarvar TEMPVAR3 MISCARRAYID_AMOUNTTEMP
	addvarvar TEMPVAR2 TEMPVAR3
	mulvarvar ACTORHP TEMPVAR2
	divvar ACTORHP 1000
	
	mulvarvar ACTORHP STARTSTATMULTI
	divvarvar ACTORHP STARTSTATDIVISOR
	ifvarl ACTORHP 1 setvar ACTORHP 1
	
	// Enemy's Max AP is set to their new Max HP
	setvarvar ACTORMAXAP ACTORHP
	
	// Determines 10% of the base HP value to use for the varience
	setvarvar TEMPVAR8 ACTORHP
	mulvar TEMPVAR8 100
	divvar TEMPVAR8 1000
	randvarvar TEMPVAR TEMPVAR8
	
	ifrnd 128 addvarvar ACTORHP TEMPVAR else subvarvar ACTORHP TEMPVAR
	
	//****************
	//*Level Ups here*
	//****************
	ifvarg ACTORLEVEL 1
	{
		setvar ACTORTEMPLEVEL 1
		whilevarvarn ACTORTEMPLEVEL ACTORLEVEL state calcleveluphp
	}
	//********************
	//*End Level Ups here*
	//********************
	
	// Stops HP from Exceeding 'Atomic' max
	state capmaxhpenemy
	setvarvar ACTORMAXHP ACTORHP
	setactor[THISACTOR].extra 16384
	
	// Determines based on the skill level if the monster will have atomic health starting out
	ifvare SKILLLEVEL 0 { ifrnd 3 { ifrnd 14 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 1 { ifrnd 6 { ifrnd 17 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 2 { ifrnd 9 { ifrnd 20 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 3 { ifrnd 12 { ifrnd 26 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 4 { ifrnd 15 { ifrnd 35 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 5 { ifrnd 18 { ifrnd 46 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 6 { ifrnd 24 { ifrnd 57 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 7 { ifrnd 30 { ifrnd 73 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 8 { ifrnd 36 { ifrnd 88 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	ifvare SKILLLEVEL 9 { ifrnd 48 { ifrnd 114 mulvar ACTORHP 200 else mulvar ACTORHP 150 } else mulvar ACTORHP 100 }
	divvar ACTORHP 100
	
	// Stops HP from Exceeding 'Atomic' max [again]
	state capmaxhpenemy
	
	// **************************************
	// *Calculates Armor Points for Monsters*
	// **************************************
	
	setvarvar TEMPVAR8 ACTORMAXAP
	mulvar TEMPVAR8 100
	divvar TEMPVAR8 1000 // Determines 10% of the base HP value to use for the varience
	randvarvar TEMPVAR TEMPVAR8
	
	ifrnd 128 addvarvar ACTORMAXAP TEMPVAR else subvarvar ACTORMAXAP TEMPVAR
	
	//****************
	//*Level Ups here*
	//****************
	ifvarg ACTORLEVEL 1
	{
		setvar ACTORTEMPLEVEL 1
		whilevarvarn ACTORTEMPLEVEL ACTORLEVEL state calclevelupap
	}
	//********************
	//*End Level Ups here*
	//********************
	
	ifvarvarg ACTORMAXAP STATLIMIT setvarvar ACTORMAXAP STATLIMIT
	setvarvar ACTORAP ACTORMAXAP
	
	setvarvar tempd SKILLLEVEL
	ifvarg SKILLLEVEL 4 subvar tempd 1
	mulvarvar ACTORAP tempd
	
	divvar ACTORAP 4 
	ifvarvarg ACTORAP STATLIMITATOMIC setvarvar ACTORAP STATLIMITATOMIC
	
	ifvarg ACTORAP 0
	{
		ifvarl SKILLLEVEL 5
		{
			ifrnd 64 setvar ACTORARMORPERCENT 333
			else ifrnd 85 setvar ACTORARMORPERCENT 500
			else ifrnd 128 setvar ACTORARMORPERCENT 667
			else setvar ACTORARMORPERCENT 900
		}
		else
		{
			ifvarl SKILLLEVEL 8
			{
				ifrnd 85 setvar ACTORARMORPERCENT 667
				else ifrnd 128 setvar ACTORARMORPERCENT 900
				else
				{
					randvar ACTORARMORPERCENT 100
					addvar ACTORARMORPERCENT 900
				}
			}
			else
			{
				ifrnd 128
				{
					randvar ACTORARMORPERCENT 100
					addvar ACTORARMORPERCENT 900
				}
				else setvar ACTORARMORPERCENT 1000
			}
		}
	}
	
	// ********************************
	// *Calculates Attack for Monsters*
	// ********************************
	
	setvarvar ACTORSTAT ACTORATTACK
	state calcatkdef
	setvarvar ACTORATTACK ACTORSTAT
	
	setvarvar TEMPVAR8 ACTORATTACK
	mulvar TEMPVAR8 25
	divvar TEMPVAR8 100 // Determines 100% of the base Def value to use for the varience
	randvarvar TEMPVAR TEMPVAR8
	
	ifrnd 128 addvarvar ACTORATTACK TEMPVAR else subvarvar ACTORATTACK TEMPVAR
	
	//****************
	//*Level Ups here*
	//****************
	ifvarg ACTORLEVEL 1
	{
		setvar ACTORTEMPLEVEL 1
		whilevarvarn ACTORTEMPLEVEL ACTORLEVEL state calclevelupatk
	}
	//********************
	//*End Level Ups here*
	//********************
	
	ifvare STATCALCPAL 9 setvar ACTORATTACK 0
	ifvarvarg ACTORATTACK STATLIMIT setvarvar ACTORATTACK STATLIMIT
	
	// *********************************
	// *Calculates Defense for Monsters*
	// *********************************
	
	setvarvar ACTORSTAT ACTORDEFENSE
	state calcatkdef
	setvarvar ACTORDEFENSE ACTORSTAT
	
	setvarvar TEMPVAR8 ACTORDEFENSE
	mulvar TEMPVAR8 25
	divvar TEMPVAR8 100 // Determines 100% of the base Def value to use for the varience
	randvarvar TEMPVAR TEMPVAR8
	
	ifrnd 128 addvarvar ACTORDEFENSE TEMPVAR else subvarvar ACTORDEFENSE TEMPVAR
	
	//****************
	//*Level Ups here*
	//****************
	ifvarg ACTORLEVEL 1
	{
		setvar ACTORTEMPLEVEL 1
		whilevarvarn ACTORTEMPLEVEL ACTORLEVEL state calclevelupdef
	}
	//********************
	//*End Level Ups here*
	//********************
	
		ifvare STATCALCPAL 9 setvar ACTORDEFENSE 0
	
		ifvarvarg ACTORDEFENSE STATLIMIT setvarvar ACTORDEFENSE STATLIMIT
	
	//*******************
	//*Critical Hit Rate*
	//*******************
	state calcrndcritrates
	ifvarg ACTORLEVEL 1
	{
		setvar ACTORTEMPLEVEL 1
		whilevarvarn ACTORTEMPLEVEL ACTORLEVEL state calcactorcritrate
	}
	
	//***************************
	//*Randomizer Survival Rates*
	//***************************
	state calcrndsurvivalrates
	
	// ***************************************************
	// *Setting Up Possible First Aid Amount for Monsters*
	// ***************************************************
	
	ifvare SKILLLEVEL 0 ifrnd 3 { state setenemyfirstaid1 ifrnd 6 state setenemyfirstaid2 }
	ifvare SKILLLEVEL 1 ifrnd 7 { state setenemyfirstaid1 ifrnd 10 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 2 ifrnd 13 { state setenemyfirstaid1 ifrnd 12 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 3 ifrnd 27 { state setenemyfirstaid1 ifrnd 20 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 4 ifrnd 33 { state setenemyfirstaid1 ifrnd 24 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 5 ifrnd 49 { state setenemyfirstaid1 ifrnd 48 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 6 ifrnd 66 { state setenemyfirstaid1 ifrnd 52 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 7 ifrnd 99 { state setenemyfirstaid1 ifrnd 112 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 8 ifrnd 118 { state setenemyfirstaid1 ifrnd 172 state setenemyfirstaid2 }  
	ifvare SKILLLEVEL 9 ifrnd 134 { state setenemyfirstaid1 ifrnd 200 state setenemyfirstaid2 }  
	
	// ****************************************
	// *Setting Up Possible Boots for Monsters*
	// ****************************************
	
	setvar INITBENEFIT BOOT_AMOUNT
	state calciteminits
	setvarvar ACTORBOOTSAMOUNT INITTYPE
	
	// *********************************************
	// *Setting Up Possible Scuba Gear for Monsters*
	// *********************************************
	
	setvar INITBENEFIT SCUBA_AMOUNT
	state calciteminits
	setvarvar ACTORAIRTANKAMOUNT INITTYPE
	
	// **********************************************
	// *Setting Up Possible Quad Damage for Monsters*
	// **********************************************
	
	setvar INITBENEFIT 780
	state calciteminits
	setvarvar ACTORQUADTIME INITTYPE
	
	// *******************************************************
	// *Setting Up Possible Icon of the Defender for monsters*
	// *******************************************************
	
	setvar INITBENEFIT 780
	state calciteminits
	setvarvar ACTORINVULNTIME INITTYPE
	
	// ****************************************************
	// *Setting Up Possible Regeneration Ankh for monsters*
	// ****************************************************
	
	setvar INITBENEFIT 780
	state calciteminits
	setvarvar ACTORREGENTIME INITTYPE
	
	// ************************************************
	// *Setting Up Possible Shield Emblem for monsters*
	// ************************************************
	
	setvar INITBENEFIT 780
	state calciteminits
	setvarvar ACTORAPREGENTIME INITTYPE
	
	// ***************************************************
	// *Setting Up Possible Vampire Artifact for monsters*
	// ***************************************************
	
	setvar INITBENEFIT 780
	state calciteminits
	setvarvar ACTORVAMPIRETIME INITTYPE
	
	// ***************************************************
	// *Setting Up Possible Winter Clothes for monsters*
	// ***************************************************
	ifvarg freezing 0
	{
		ifvare SKILLLEVEL 0 { ifrnd 13 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 1 { ifrnd 38 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 2 { ifrnd 63 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 3 { ifrnd 88 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 4 { ifrnd 113 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 5 { ifrnd 138 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 6 { ifrnd 163 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 7 { ifrnd 193 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 8 { ifrnd 213 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
		ifvare SKILLLEVEL 9 { ifrnd 238 setvar enemywinterclothes 100 else setvar enemywinterclothes 0 }
	}
	
	// ****************************************
	// ****************************************
	// ** END OF INITIALIZATION CALCULATIONS **
	// ****************************************
	// ****************************************

	ifvarand ACTORFLAGS 512 // 512 = Elite Monster
	{
		mulvar ACTORMAXHP 4
		ifvarvarg ACTORMAXHP STATLIMIT setvarvar ACTORMAXHP STATLIMIT
		mulvar ACTORHP 4
		mulvar ACTORMAXAP 4
		ifvarvarg ACTORMAXAP STATLIMIT setvarvar ACTORMAXAP STATLIMIT
		mulvar ACTORAP 4
		mulvar ACTORARMORPERCENT 2
		ifvarg ACTORARMORPERCENT 1000 setvar ACTORARMORPERCENT 1000
		mulvar ACTORFIRSTAID 4
		mulvar ACTORMAXAIRTIME 4
		mulvar ACTORAIRTIME 4
		mulvar ACTORATTACK 4
		mulvar ACTORDEFENSE 4
		mulvar ACTORBOOTSAMOUNT 4
		mulvar ACTORAIRTANKAMOUNT 4
		mulvar ACTORQUADTIME 4
		mulvar ACTORINVULNTIME 4
		mulvar ACTORREGENTIME 4
		mulvar ACTORAPREGENTIME 4
		mulvar ACTORVAMPIRETIME 4
		addvar ACTORMAXFALLRESIST 8
		addvar ACTORFALLRESIST 8
	}
	
	ifvare ENEMYHASSHIKON? 1
	{
		mulvar ACTORFALLRESIST 5
		divvar ACTORFALLRESIST 2
		mulvar ACTORMAXFALLRESIST 5
		divvar ACTORMAXFALLRESIST 2
	}
	
	ifvarand ACTORFLAGS 4096 // Special Flag #1
	{
		ifactor LIZTROOP setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPSTAYPUT setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPDUCKING setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPSHOOT setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPJETPACK setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPRUNNING setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPONTOILET setvar ACTORBOMBER? 1 
		else ifactor LIZTROOPJUSTSIT setvar ACTORBOMBER? 1 
		else subvar ACTORFLAGS 4096
	}
	
	setactor[THISACTOR].htowner -1

ends

state saverank
	ifactor FEM10
	{
		setvar MISCARRAYID 12 // Civilians Saved [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 2
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 13 // Civilians Saved [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 2
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	}
	else
	{
		setvar MISCARRAYID 12 // Civilians Saved [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 13 // Civilians Saved [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	}
	
	setvar MISCARRAYID 12 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // Civilians Saved [Level]
	setvar MISCARRAYID 14 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // Max Civilians Saved [Level]
	ifvarg MISCARRAYID_AMOUNTTEMP2 0
	{
		ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
		{
			globalsound FOUND_ALLSECRETS
			redefinequote 130 ^23 YOU RESCUED ALL RESCUABLE CIVILIANS, ANIMALS AND INNOCENTS!
			setvarvar fta fta_normal setvar ftq 130
		}
	}
	
	addvarvar RANKPOINTS RANKPOINTSTEMP
	setvar RANKPOINTSTEMP 0
	sound TELEPORTER
	spawn TRANSPORTERSTAR
	ifactor FEM2
	{
		espawn POLEFEM2
		getactor[THISACTOR].xrepeat TEMP
		setactor[RETURN].xrepeat TEMP
		getactor[THISACTOR].yrepeat TEMP
		setactor[RETURN].yrepeat TEMP
		getactor[THISACTOR].cstat TEMP
		ifvarand TEMP 1024 subvar TEMP 1024
		setactor[RETURN].cstat TEMP
		getactor[THISACTOR].pal TEMP
		setactor[RETURN].pal TEMP
	}
	ifactor PODFEM1
	{
		espawn PODFEM1POD
		getactor[THISACTOR].xrepeat TEMP
		setactor[RETURN].xrepeat TEMP
		getactor[THISACTOR].yrepeat TEMP
		setactor[RETURN].yrepeat TEMP
		getactor[THISACTOR].cstat TEMP
		ifvarand TEMP 1024 subvar TEMP 1024
		setactor[RETURN].cstat TEMP
		getactor[THISACTOR].pal TEMP
		setactor[RETURN].pal TEMP
	}
	tip
	// OFF-LIMITS
	setactor[THISACTOR].extra -1 // attempt to remove NPC's lifebars from the map
	// END OFF-LIMITS
	killit
ends

state dogsave
	state useswitchcheckwall
	ifp pfacing 
	{
		ifpdistl 1280 ifvare TEMP2 1 
		{
			ifhitspace 
			{
				state checktelecoils
				ifvarg ITEMARRAYID_AMOUNTTEMP 0
				{
					ifvarg DOLLARS 99
					{
						sound BARKING_DOG 
						state ryansitems
			
						randvar RANKPOINTSTEMP DOGSAVERANKPOINTSRAND 
						addvar RANKPOINTSTEMP DOGSAVERANKPOINTSSOLID 
						setvar TEMPVAR 1
						state expmulti
						state saverank
						redefinequote 130 ^20YOU RESCUED THE LITTLE DOG! 
						setvarvar fta fta_normal setvar ftq 130
					}
					else 
					{ 
						sound MENU_ERROR
						redefinequote 130 ^10NOT ENOUGH MONEY, MAN! 
						setvarvar fta fta_normal setvar ftq 130
					}
				}
				else
				{
					sound MENU_ERROR
					redefinequote 130 ^10YOU HAVE NO TELEPORTER COILS! 
					setvarvar fta fta_normal setvar ftq 130
				}
			}
		}
	}
ends

state femsave
	state useswitchcheckwall
	ifp pfacing 
	{
		ifpdistl 1280 ifvare TEMP2 1
		{
			ifhitspace 
			{
				state checktelecoils
				ifvarg ITEMARRAYID_AMOUNTTEMP 0
				{
					ifvarg DOLLARS 99
					{
						state ryansitems
			
						randvar RANKPOINTSTEMP FEMSAVERANKPOINTSRAND 
						addvar RANKPOINTSTEMP FEMSAVERANKPOINTSSOLID 
						setvar TEMPVAR 1
						state expmulti
						state saverank
						ifactor FEM10 redefinequote 130 ^20YOU RESCUED 2 WOMEN! 
						else redefinequote 130 ^20YOU RESCUED THE WOMAN! 
			
						setvarvar fta fta_normal setvar ftq 130
					}
					else 
					{ 
						sound MENU_ERROR
						redefinequote 130 ^10NOT ENOUGH MONEY, MAN! 
						setvarvar fta fta_normal setvar ftq 130
					}
				}
				else
				{
					sound MENU_ERROR
					redefinequote 130 ^10YOU HAVE NO TELEPORTER COILS! 
					setvarvar fta fta_normal setvar ftq 130
				}
			}
		}
	}
ends

state civsave
	state useswitchcheckwall
	ifp pfacing 
	{
		ifpdistl 1280 ifvare TEMP2 1
		{
			ifhitspace 
			{
				state checktelecoils
				ifvarg ITEMARRAYID_AMOUNTTEMP 0
				{
					ifvarg DOLLARS 99
					{
						state ryansitems
			
						state displaymoney
						randvar RANKPOINTSTEMP CIVILIANSAVERANKPOINTSRAND 
						addvar RANKPOINTSTEMP CIVILIANSAVERANKPOINTSSOLID 
						setvar TEMPVAR 1
						state expmulti
						state saverank
						ifactor FEM10 redefinequote 130 ^20YOU RESCUED 2 CIVILIANS! 
						else redefinequote 130 redefinequote 130 ^20YOU RESCUED THE CIVILIAN!         
						setvarvar fta fta_normal setvar ftq 130
					}
					else 
					{ 
						sound MENU_ERROR
						redefinequote 130 ^10NOT ENOUGH MONEY, MAN! 
						setvarvar fta fta_normal setvar ftq 130
					}
				}
				else
				{
					sound MENU_ERROR
					redefinequote 130 ^10YOU HAVE NO TELEPORTER COILS! 
					setvarvar fta fta_normal setvar ftq 130
				}
			}
		}
	}
ends

state fordencall
	setvar MISCARRAYID 39 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 38 // FORDEN-TIMER
	
	randvar MISCARRAYID_AMOUNTTEMP2 1
	setvar MISCARRAYID 40 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // FORDEN-TYPE
ends

state frosty
	ifvare oldskoolmode 0
	{
		ifrnd 64 
		{
			globalsound FROSTY
			state fordencall
			redefinequote 340 ^1Frosty!!
			userquote 340
		}
	}
ends

state jib_sounds
	// Random Mortal-Kombat related jib sounds
	ifvare PUBLICBETA? 0 setvar RNDMIZERLIMIT 224 else setvar RNDMIZERLIMIT 192 state rndmizer256
	ifvarvarg RNDMIZER RNDMIZERLIMIT
	{
		ifvare oldskoolmode 0
		{
			ifrnd 64
			{
				ifrnd 53
				{
					globalsound KAHNFATALITY
					redefinequote 340 ^10Fatality!!
					userquote 340
				}
				else
				ifrnd 64
				{
					globalsound KAHNEXCELLENT
					redefinequote 340 ^22Excellent!!
					userquote 340
				}
				else
				ifrnd 85 
				{
					globalsound MORTALYELL 
					redefinequote 340 ^20Mortal Kombat!!!!
					userquote 340
				}
				else 
				ifrnd 128 
				{
					globalsound TOASTY
					state fordencall
					redefinequote 340 ^2Toasty!!
					userquote 340
				}
				else 
				{
					globalsound CRISPY
					state fordencall
					redefinequote 340 ^10Crispy!!
					userquote 340
				}
			}
		}
	}
	
	// ifvare PUBLICBETA? 0 setvar RNDMIZERLIMIT 192 else setvar RNDMIZERLIMIT 128 state rndmizer256

	ifvare PUBLICBETA? 0 setvar RNDMIZERLIMIT 224 else setvar RNDMIZERLIMIT 192 state rndmizer256
	ifvarvarg RNDMIZER RNDMIZERLIMIT
	{
		getactor[THISACTOR].htowner temp
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		ifvarvare temp PLAYERID
		{
			ifvare ONELINERINPLAY? 0 // If there is no one-liner playing, continue
			ifrnd SWEARFREQUENCY
			{
				ifvare CHARACTERSELECTED? 1 // If Duke is selected use his sounds and userquotes
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0
					{
						globalsound JIBBED_ACTOR1 
						redefinequote 340 ^17Duke: Hehehe... What a mess!
					}
					ifvare TEMPVAR8 1 
					{
						globalsound JIBBED_ACTOR2
						redefinequote 340 ^17Duke: Bitchin'!
					}
					ifvare TEMPVAR8 2
					{
						globalsound JIBBED_ACTOR3
						redefinequote 340 ^17Duke: Holy cow!
					}
					ifvare TEMPVAR8 3
					{
						globalsound JIBBED_ACTOR4
						redefinequote 340 ^17Duke: Holy shit!
					}
					ifvare TEMPVAR8 4
					{
						globalsound JIBBED_ACTOR5
						redefinequote 340 ^17Duke: Damn I'm good!
					}
					ifvare TEMPVAR8 5 
					{
						globalsound JIBBED_ACTOR6
						redefinequote 340 ^17Duke: Yeah, piece of cake!
					}
					ifvare TEMPVAR8 6 
					{
						globalsound JIBBED_ACTOR7
						redefinequote 340 ^17Duke: Oooh... that's gotta hurt!
					}
					ifvare TEMPVAR8 7
					{
						globalsound JIBBED_ACTOR8
						redefinequote 340 ^17Duke: Blow it out your ass!
					}
					ifvare TEMPVAR8 8
					{
						globalsound JIBBED_ACTOR9
						redefinequote 340 ^17Duke: Eat shit and die!
					}
					ifvare TEMPVAR8 9
					{
						globalsound JIBBED_ACTOR10
						redefinequote 340 ^17Duke: Your face, your ass, what's the difference?!
					}
					ifvare TEMPVAR8 10
					{
						globalsound JIBBED_ACTOR11
						redefinequote 340 ^17Duke: See you in Hell!
					}
					ifvare TEMPVAR8 11
					{
						globalsound JIBBED_ACTOR12
						redefinequote 340 ^17Duke: Suck it down!
					}
					ifvare TEMPVAR8 12
					{
						globalsound JIBBED_ACTOR13
						redefinequote 340 ^17Duke: Let God sort 'em out!
					}
					ifvare TEMPVAR8 13
					{
						globalsound JIBBED_ACTOR14
						redefinequote 340 ^17Duke: Get that crap outta here!
					}
					ifvare TEMPVAR8 14
					{
						globalsound JIBBED_ACTOR15
						redefinequote 340 ^17Duke: You guys suck!
					}
					ifvare TEMPVAR8 15
					{
						globalsound MDEVSPEECH
						redefinequote 340 ^17Duke: I'm gonna get medieval on your asses!
					}
					ifvare TEMPVAR8 16
					{
						globalsound SMACKED
						redefinequote 340 ^17Duke: I'm gonna put the smack dab on your ass!
					}
					ifvare TEMPVAR8 17
					{
						globalsound BONUS_SPEECH3
						redefinequote 340 ^17Duke: Gonna rip 'em a new one!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 2
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						globalsound JACK_ONELINER01
						redefinequote 340 ^17Jack: Still think I'm just a 'little kid'?!
					}
					ifvare TEMPVAR8 1
					{
						globalsound JACK_ONELINER02
						redefinequote 340 ^17Jack: This planet belongs to humans, not you!
					}
					ifvare TEMPVAR8 2
					{
						globalsound JACK_ONELINER03
						redefinequote 340 ^17Jack: A year of defeats, and you still don't get it?!
					}
					ifvare TEMPVAR8 3
					{
						globalsound JACK_ONELINER04
						redefinequote 340 ^17Jack: You guys are really starting to piss me off!
					}
					ifvare TEMPVAR8 4
					{
						globalsound JACK_ONELINER05
						redefinequote 340 ^17Jack: Don't touch me, I'm deadly!
					}
					ifvare TEMPVAR8 5
					{
						globalsound JACK_ONELINER06
						redefinequote 340 ^17Jack: Get off our planet, alien scum!!
					}
					ifvare TEMPVAR8 6
					{
						globalsound JACK_ONELINER07
						redefinequote 340 ^17Jack: Oh I'm no "Boy Wonder", buddy!
					}
					ifvare TEMPVAR8 7
					{
						globalsound JACK_ONELINER08
						redefinequote 340 ^17Jack: Funny, no brain in that mass of parts! Why am I not surprised?!
					}
					ifvare TEMPVAR8 8
					{
						globalsound JACK_ONELINER09
						redefinequote 340 ^17Jack: Wow you break faster than my gaming systems!
					}
					ifvare TEMPVAR8 9
					{
						globalsound JACK_ONELINER10
						redefinequote 340 ^17Jack: I *don't* need Duke to kick your sorry alien asses!
					}
					ifvare TEMPVAR8 10
					{
						globalsound JACK_ONELINER11
						redefinequote 340 ^17Jack: Looks like you weren't a bad enough dude to kill me!
					}
					ifvare TEMPVAR8 11
					{
						globalsound JACK_ONELINER12
						redefinequote 340 ^17Jack: Wow you guys... really suck!
					}
					ifvare TEMPVAR8 12
					{
						globalsound JACK_ONELINER13
						redefinequote 340 ^17Jack: Yeah, go suck that one down!
					}
					ifvare TEMPVAR8 13
					{
						globalsound JACK_ONELINER14
						redefinequote 340 ^17Jack: You guys are very poor judges of appearance, aren't you?!
					}
					ifvare TEMPVAR8 14
					{
						globalsound JACK_ONELINER15
						redefinequote 340 ^17Jack: Good rules and evil drools!!
					}
					ifvare TEMPVAR8 15
					{
						globalsound JACK_ONELINER16
						redefinequote 340 ^17Jack: How *not* mighty an opponent you were!
					}
					ifvare TEMPVAR8 16
					{
						globalsound JACK_ONELINER17
						redefinequote 340 ^17Jack: You should've stayed in school, fella!
					}
					ifvare TEMPVAR8 17
					{
						globalsound JACK_ONELINER18
						redefinequote 340 ^17Jack: Man, saving the world is so much fun!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 3
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						globalsound BUBSY_ONELINER01
						redefinequote 340 ^23Bubsy: Looks like you failed the screen test!
					}
					ifvare TEMPVAR8 1
					{
						globalsound BUBSY_ONELINER02
						redefinequote 340 ^23Bubsy: You jerks are nothing compared to Hamm's minions!
					}
					ifvare TEMPVAR8 2
					{
						globalsound BUBSY_ONELINER03
						redefinequote 340 ^23Bubsy: You're such a waste of talent!
					}
					ifvare TEMPVAR8 3
					{
						globalsound BUBSY_ONELINER04
						redefinequote 340 ^23Bubsy: Looks like your will to live just went on strike!
					}
					ifvare TEMPVAR8 4
					{
						globalsound BUBSY_ONELINER05
						redefinequote 340 ^23Bubsy: Hah, you guys are even more amateur than the Woolies were!
					}
					ifvare TEMPVAR8 5
					{
						globalsound BUBSY_ONELINER06
						redefinequote 340 ^23Bubsy: Bang! Oh you must've blinked! Too bad!
					}
					ifvare TEMPVAR8 6
					{
						globalsound BUBSY_ONELINER07
						redefinequote 340 ^23Bubsy: You didn't die the right way! You gotta do a retake!
					}
					ifvare TEMPVAR8 7
					{
						globalsound BUBSY_ONELINER08
						redefinequote 340 ^23Bubsy: I will crush you all with my awesome star powa'!
					}
					ifvare TEMPVAR8 8
					{
						globalsound BUBSY_ONELINER09
						redefinequote 340 ^23Bubsy: You're supposed to fall down... not explode!!
					}
					ifvare TEMPVAR8 9
					{
						globalsound BUBSY_ONELINER10
						redefinequote 340 ^23Bubsy: You're lucky! You'd be eaten alive in real show business!
					}
					ifvare TEMPVAR8 10
					{
						globalsound BUBSY_ONELINER11
						redefinequote 340 ^23Bubsy: Dear me, it seems you've been cancelled!
					}
					ifvare TEMPVAR8 11
					{
						globalsound BUBSY_ONELINER12
						redefinequote 340 ^23Bubsy: My fur bristles with anger! Agh, I hate it when my fur bristles!
					}
					ifvare TEMPVAR8 12
					{
						globalsound BUBSY_ONELINER13
						redefinequote 340 ^23Bubsy: Go ahead, make me laugh!
					}
					ifvare TEMPVAR8 13
					{
						globalsound BUBSY_ONELINER14
						redefinequote 340 ^23Bubsy: Looks like your wardrobe didn't help you much!
					}
					ifvare TEMPVAR8 14
					{
						globalsound BUBSY_ONELINER15
						redefinequote 340 ^23Bubsy: Don't worry, I'll give you a cameo in my next movie!
					}
					ifvare TEMPVAR8 15
					{
						globalsound BUBSY_ONELINER16
						redefinequote 340 ^23Bubsy: I'm ally to good, and I'm evil's worst nightmare!
					}
					ifvare TEMPVAR8 16
					{
						globalsound BUBSY_ONELINER17
						redefinequote 340 ^23Bubsy: It's called "Bad End"... hahahaha!!
					}
					ifvare TEMPVAR8 17
					{
						globalsound BUBSY_ONELINER18
						redefinequote 340 ^23Bubsy: Lights out, Bubsy radio!!!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 4
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: A good mind is extremely dangerous for you cretins to ignore!
					}
					ifvare TEMPVAR8 1
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: You must've failed the class about "Underestimating The Enemy"!
					}
					ifvare TEMPVAR8 2
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: I guess repentance by water isn't your style!
					}
					ifvare TEMPVAR8 3
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Why are so many alien races so war-happy?!
					}
					ifvare TEMPVAR8 4
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: I hate to judge, but that performance was disappointing!
					}
					ifvare TEMPVAR8 5
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Maybe you'll come back as a better person someday!
					}
					ifvare TEMPVAR8 6
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Sadly there's things even the best doctor can't heal!
					}
					ifvare TEMPVAR8 7
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Are all the members of your race this scatterbrained?!
					}
					ifvare TEMPVAR8 8
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Dunk what's left of yourself in the water and think about this!
					}
					ifvare TEMPVAR8 9
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Quit throwing your lives away for something you can't win!
					}
					ifvare TEMPVAR8 10
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: I will protect this planet from you alien creeps to my last breath!
					}
					ifvare TEMPVAR8 11
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: You are nothing but a stream, while I am the ocean itself!!
					}
					ifvare TEMPVAR8 12
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Looks like you were drowned by your sheer evil!
					}
					ifvare TEMPVAR8 13
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: A pity to extinguish potential like yours, but there was no choice!
					}
					ifvare TEMPVAR8 14
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Now you can never take another life or hurt another one ever again!
					}
					ifvare TEMPVAR8 15
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: My calm surges over the rage burning in your heart!
					}
					ifvare TEMPVAR8 16
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: Why!? Why can't our races just... get along for once?!
					}
					ifvare TEMPVAR8 17
					{
						// SOUND HERE
						redefinequote 340 ^0Ami: I am getting sick... sick and tired of killing you guys!!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 5 // If Lo Wang is selected, use his sounds and userquotes
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						globalsound WANG_ONELINER01 
						redefinequote 340 ^15Higa: You very bad man!
					}
					ifvare TEMPVAR8 1
					{
						globalsound WANG_ONELINER02 
						redefinequote 340 ^15Higa: I stick a firecracker up your ass! Hahaha!!
					}
					ifvare TEMPVAR8 2
					{
						globalsound WANG_ONELINER03 
						redefinequote 340 ^15Higa: I hope you were paying attention!
					}
					ifvare TEMPVAR8 3
					{
						globalsound WANG_ONELINER04
						redefinequote 340 ^15Higa: I kill you!!
					}
					ifvare TEMPVAR8 4
					{
						globalsound WANG_ONELINER05
						redefinequote 340 ^15Higa: Hahah! You no mess with Lo Wang!
					}
					ifvare TEMPVAR8 5
					{
						globalsound WANG_ONELINER06
						redefinequote 340 ^15Higa: You have no honor!
					}
					ifvare TEMPVAR8 6
					{
						globalsound WANG_ONELINER07
						redefinequote 340 ^15Higa: It's all in the reflexes!
					}
					ifvare TEMPVAR8 7
					{
						globalsound WANG_ONELINER08
						redefinequote 340 ^15Higa: Sayanora, scumbag!
					}
					ifvare TEMPVAR8 8
					{
						globalsound WANG_ONELINER09
						redefinequote 340 ^15Higa: Snatch pebble from hand!
					}
					ifvare TEMPVAR8 9
					{
						globalsound WANG_ONELINER10
						redefinequote 340 ^15Higa: You look like stupid!
					}
					ifvare TEMPVAR8 10
					{
					globalsound WANG_ONELINER11
					redefinequote 340 ^15Higa: Taksan balls, score shitpeanuts!
					}
					ifvare TEMPVAR8 11
					{
						globalsound WANG_ONELINER12
						redefinequote 340 ^15Higa: Oh, you little tiny dick!
					}
					ifvare TEMPVAR8 12
					{
						globalsound WANG_ONELINER13
						redefinequote 340 ^15Higa: This no tournament, this is for real!
					}
					ifvare TEMPVAR8 13
					{
						globalsound WANG_ONELINER14
						redefinequote 340 ^15Higa: You move like a pregeant yak!
					}
					ifvare TEMPVAR8 14
					{
						globalsound WANG_ONELINER15
						redefinequote 340 ^15Higa: Who wants some Wang?!
					}
					ifvare TEMPVAR8 15
					{
						globalsound WANG_ONELINER16
						redefinequote 340 ^15Higa: Revenge is dish best served raw!
					}
					ifvare TEMPVAR8 16
					{
						globalsound WANG_ONELINER17
						redefinequote 340 ^15Higa: You are tiny grasshoppa!
					}
					ifvare TEMPVAR8 17
					{
						globalsound WANG_ONELINER18
						redefinequote 340 ^15Higa: Holy shit!!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 6 // ESSence
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						globalsound ESSENCE_ONELINER01
						redefinequote 340 ^12ESSence: Oh come on, you clowns can do better than this!
					}
					ifvare TEMPVAR8 1
					{
						globalsound ESSENCE_ONELINER02
						redefinequote 340 ^12ESSence: You guys are literally falling apart since I switched sides!
					}
					ifvare TEMPVAR8 2
					{
						globalsound ESSENCE_ONELINER03
						redefinequote 340 ^12ESSence: All that potential gone to waste, due to your blind loyalty!
					}
					ifvare TEMPVAR8 3
					{
						globalsound ESSENCE_ONELINER04
						redefinequote 340 ^12ESSence: I might be a traitor, but I'm still alive unlike your pathetic carcass!
					}
					ifvare TEMPVAR8 4
					{
						globalsound ESSENCE_ONELINER05
						redefinequote 340 ^12ESSence: Your superior must've been a big slacker!
					}
					ifvare TEMPVAR8 5
					{
						globalsound ESSENCE_ONELINER06
						redefinequote 340 ^12ESSence: Dammit! Can't any of you fools be a challenge?!
					}
					ifvare TEMPVAR8 6
					{
						globalsound ESSENCE_ONELINER07
						redefinequote 340 ^12ESSence: I'm beginning to see why Nukem can defeat you poor saps so often!
					}
					ifvare TEMPVAR8 7
					{
						globalsound ESSENCE_ONELINER08
						redefinequote 340 ^12ESSence: For my father's honor, you bastards!
					}
					ifvare TEMPVAR8 8
					{
						globalsound ESSENCE_ONELINER09
						redefinequote 340 ^12ESSence: Young, brash, inexperienced, DEAD!
					}
					ifvare TEMPVAR8 9
					{
						globalsound ESSENCE_ONELINER10
						redefinequote 340 ^12ESSence: Holy shit, this is so much fun, hahaha!!
					}
					ifvare TEMPVAR8 10
					{
						globalsound ESSENCE_ONELINER11
						redefinequote 340 ^12ESSence: Rest in pieces, chump!
					}
					ifvare TEMPVAR8 11
					{
						globalsound ESSENCE_ONELINER12
						redefinequote 340 ^12ESSence: Hope they appricate the new red paint job!
					}
					ifvare TEMPVAR8 12
					{
						globalsound ESSENCE_ONELINER13
						redefinequote 340 ^12ESSence: Suck it down, bitches!!
					}
					ifvare TEMPVAR8 13
					{
						globalsound ESSENCE_ONELINER14
						redefinequote 340 ^12ESSence: You just got owned, sucka!
					}
					ifvare TEMPVAR8 14
					{
						globalsound ESSENCE_ONELINER15
						redefinequote 340 ^12ESSence: Hey, at least I'm solving our overpopulation problems this way!
					}
					ifvare TEMPVAR8 15
					{
						globalsound ESSENCE_ONELINER16
						redefinequote 340 ^12ESSence: Indeed the stupid DO die young!
					}
					ifvare TEMPVAR8 16
					{
						globalsound ESSENCE_ONELINER17
						redefinequote 340 ^12ESSence: Maybe you won't be such a disappointment, down in Hell!
					}
					ifvare TEMPVAR8 17
					{
						globalsound ESSENCE_ONELINER18
						redefinequote 340 ^12ESSence: Looks like you woke up on the wrong side of the missile today!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 7
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						globalsound TED_ONELINER01
						redefinequote 340 ^17Ted: Hahaha... you guys are the biggest chumps I've ever met!
					}
					ifvare TEMPVAR8 1
					{
						globalsound TED_ONELINER02
						redefinequote 340 ^17Ted: You're not just dealing with any explosives user!
					}
					ifvare TEMPVAR8 2
					{
						globalsound TED_ONELINER03
						redefinequote 340 ^17Ted: Your style is sloppy, and fatal to yourself!
					}
					ifvare TEMPVAR8 3
					{
						globalsound TED_ONELINER04
						redefinequote 340 ^17Ted: Now that's how you make something explode in style!!
					}
					ifvare TEMPVAR8 4
					{
						globalsound TED_ONELINER05
						redefinequote 340 ^17Ted: Hahaha!! "Grenadier Ted" strikes again!!
					}
					ifvare TEMPVAR8 5
					{
						globalsound TED_ONELINER06
						redefinequote 340 ^17Ted: Looks like I gave you a 'special' image enhancement!
					}
					ifvare TEMPVAR8 6
					{
						globalsound TED_ONELINER07
						redefinequote 340 ^17Ted: I seriously hope the rest of your kind fares better than you!
					}
					ifvare TEMPVAR8 7
					{
						globalsound TED_ONELINER08
						redefinequote 340 ^17Ted: I'm no longer amused by your useless persistance!
					}
					ifvare TEMPVAR8 8
					{
						globalsound TED_ONELINER09
						redefinequote 340 ^17Ted: Looks like you cracked under all the pressure!
					}
					ifvare TEMPVAR8 9
					{
						globalsound TED_ONELINER10
						redefinequote 340 ^17Ted: My name will be infamous among your kind soon enough!
					}
					ifvare TEMPVAR8 10
					{
						globalsound TED_ONELINER11
						redefinequote 340 ^17Ted: Lisa, this one's for you my friend!
					}
					ifvare TEMPVAR8 11
					{
						globalsound TED_ONELINER12
						redefinequote 340 ^17Ted: Stubborness is not always a good thing, you learned that the hard way!
					}
					ifvare TEMPVAR8 12
					{
						globalsound TED_ONELINER13
						redefinequote 340 ^17Ted: Looks like my gun was better than yours!
					}
					ifvare TEMPVAR8 13
					{
						globalsound TED_ONELINER14
						redefinequote 340 ^17Ted: I guess your 'training' isn't what many think it is!
					}
					ifvare TEMPVAR8 14
					{
						globalsound TED_ONELINER15
						redefinequote 340 ^17Ted: Not expecting a 'kid' to kick your ass, did you?!
					}
					ifvare TEMPVAR8 15
					{
						globalsound TED_ONELINER16
						redefinequote 340 ^17Ted: Even in old age, I'll still kick your asses over and over!
					}
					ifvare TEMPVAR8 16
					{
						globalsound TED_ONELINER17
						redefinequote 340 ^17Ted: Don't fall to pieces on me! I'm just getting starting!
					}
					ifvare TEMPVAR8 17
					{
						globalsound TED_ONELINER18
						redefinequote 340 ^17Ted: You guys are nothing but an endless source of humor!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 8
				{
					getactorvar[PLAYERID].VEHICLEID TEMPVAR5
					ifvarn TEMPVAR5 -1
					{
						randvar TEMPVAR8 3
						ifvare TEMPVAR8 0 
						{
							globalsound LISA_ONELINERTANK01
							redefinequote 340 ^7Lisa: Looks like you underestimated my understanding of this Riot Tank!
						}
						ifvare TEMPVAR8 1
						{
							globalsound LISA_ONELINERTANK02
							redefinequote 340 ^7Lisa: This damn thing's too slow, so you'll have to suffice with dying by tank fire!
						}
						ifvare TEMPVAR8 2
						{
							globalsound LISA_ONELINERTANK03
							redefinequote 340 ^7Lisa: It's your fault for trying to attack me while I'm inside this goliath!
						}
						ifvare TEMPVAR8 3
						{
							globalsound LISA_ONELINERTANK04
							redefinequote 340 ^7Lisa: You're lucky I can't *throw* this thing at you instead, or I would!
						}
					}
					else
					{
						randvar TEMPVAR8 17
						ifvare TEMPVAR8 0 
						{
							globalsound LISA_ONELINER01
							redefinequote 340 ^7Lisa: Looks like the sun just set on your life!
						}
						ifvare TEMPVAR8 1
						{
							globalsound LISA_ONELINER02
							redefinequote 340 ^7Lisa: Hehehaha... Behold the chaos of "Sunset Lisa"!!
						}
						ifvare TEMPVAR8 2
						{
							globalsound LISA_ONELINER03
							redefinequote 340 ^7Lisa: You gave no quarter, so you get none, scumbag!
						}
						ifvare TEMPVAR8 3
						{
							globalsound LISA_ONELINER04
							redefinequote 340 ^7Lisa: It's called "Brains *&* Beauty", you pride-driven idiot!
						}
						ifvare TEMPVAR8 4
						{
							globalsound LISA_ONELINER05
							redefinequote 340 ^7Lisa: Are all of you aliens this brash and unfocused?!
						}
						ifvare TEMPVAR8 5
						{
							globalsound LISA_ONELINER06
							redefinequote 340 ^7Lisa: You know, you looked less ugly when you were in one piece!
						}
						ifvare TEMPVAR8 6
						{
							globalsound LISA_ONELINER07
							redefinequote 340 ^7Lisa: Why do you alien turds keep fighting when you can't win?!
						}
						ifvare TEMPVAR8 7
						{
							globalsound LISA_ONELINER08
							redefinequote 340 ^7Lisa: Signed to you with disgust, Lisa Bates!
						}
						ifvare TEMPVAR8 8
						{
							globalsound LISA_ONELINER09
							redefinequote 340 ^7Lisa: Oops, did my appearance distract you too much!?
						}
						ifvare TEMPVAR8 9
						{
							globalsound LISA_ONELINER10
							redefinequote 340 ^7Lisa: That was for gawking at me and my pictures, you pervert!
						}
						ifvare TEMPVAR8 10
						{
							globalsound LISA_ONELINER11
							redefinequote 340 ^7Lisa: That one's for my best friend Ted, dirtbag!
						}
						ifvare TEMPVAR8 11
						{
							globalsound LISA_ONELINER12
							redefinequote 340 ^7Lisa: I an the sunlight, you are the darkness that withers around me!
						}
						ifvare TEMPVAR8 12
						{
							globalsound LISA_ONELINER13
							redefinequote 340 ^7Lisa: Not 'Easy little girl' you thought of me, am I?!
						}
						ifvare TEMPVAR8 13
						{
							globalsound LISA_ONELINER14
							redefinequote 340 ^7Lisa: Hey cretin, I don't play with dolls anymore, more like guns!
						}
						ifvare TEMPVAR8 14
						{
							globalsound LISA_ONELINER15
							redefinequote 340 ^7Lisa: Our tech's not as outdated as you thought, is it?!
						}
						ifvare TEMPVAR8 15
						{
							globalsound LISA_ONELINER16
							redefinequote 340 ^7Lisa: You're not worth of even thinking of ogling me, alien scum!
						}
						ifvare TEMPVAR8 16
						{
							globalsound LISA_ONELINER17
							redefinequote 340 ^7Lisa: I love the ways my technology kicks your alien butts!
						}
						ifvare TEMPVAR8 17
						{
							globalsound LISA_ONELINER18
							redefinequote 340 ^7Lisa: Don't you see the cosmic joke you've been made out as?!
						}
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 9 // Cybanis
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0 
					{
						globalsound CYBANIS_ONELINER01
						redefinequote 340 ^12Cybanis: I'm the hurricane, you're merely stray in the wind!
					}
					ifvare TEMPVAR8 1
					{
						globalsound CYBANIS_ONELINER02
						redefinequote 340 ^12Cybanis: Ha ha ha, crushed like a bug on a window!
					}
					ifvare TEMPVAR8 2
					{
						globalsound CYBANIS_ONELINER03
						redefinequote 340 ^12Cybanis: Keep yourself together, you're all over the place!
					}
					ifvare TEMPVAR8 3
					{
						globalsound CYBANIS_ONELINER04
						redefinequote 340 ^12Cybanis: Feel lucky, your death was quick, and painful!
					}
					ifvare TEMPVAR8 4
					{
						globalsound CYBANIS_ONELINER05
						redefinequote 340 ^12Cybanis: Hmph! I never did like your little 'kiss-ass'...
					}
					ifvare TEMPVAR8 5
					{
						globalsound CYBANIS_ONELINER06
						redefinequote 340 ^12Cybanis: The wrath of a Cycloidian leaves no survivors!!
					}
					ifvare TEMPVAR8 6
					{
						globalsound CYBANIS_ONELINER07
						redefinequote 340 ^12Cybanis: Good alien?! Bad alien?! Who gives a shit?!
					}
					ifvare TEMPVAR8 7
					{
						globalsound CYBANIS_ONELINER08
						redefinequote 340 ^12Cybanis: Ahhh, the invigorating smell of burnt pieces of flesh!
					}
					ifvare TEMPVAR8 8
					{
						globalsound CYBANIS_ONELINER09
						redefinequote 340 ^12Cybanis: You just got, as the humans call it, "Owned!"
					}
					ifvare TEMPVAR8 9
					{
						globalsound CYBANIS_ONELINER10
						redefinequote 340 ^12Cybanis: Anyone else want some?!
					}
					ifvare TEMPVAR8 10
					{
						globalsound CYBANIS_ONELINER11
						redefinequote 340 ^12Cybanis: Mwahaha!! I have enough here for all of you bitches!!
					}
					ifvare TEMPVAR8 11
					{
						globalsound CYBANIS_ONELINER12
						redefinequote 340 ^12Cybanis: *sigh* Nethra, forgive my rash actions on this day...
					}
					ifvare TEMPVAR8 12
					{
						globalsound CYBANIS_ONELINER13
						redefinequote 340 ^12Cybanis: If you hadn't been a suck-up, you might've actually lived!
					}
					ifvare TEMPVAR8 13
					{
						globalsound CYBANIS_ONELINER14
						redefinequote 340 ^12Cybanis: You can thank me for your image improvement in Hell!
					}
					ifvare TEMPVAR8 14
					{
						globalsound CYBANIS_ONELINER15
						redefinequote 340 ^12Cybanis: The strong survive, and the weak... don't exist anymore!
					}
					ifvare TEMPVAR8 15
					{
						globalsound CYBANIS_ONELINER16
						redefinequote 340 ^12Cybanis: Hmph, maybe you'll reincarnate as something useful for once!
					}
					ifvare TEMPVAR8 16
					{
						globalsound CYBANIS_ONELINER17
						redefinequote 340 ^12Cybanis: You bastards turn your backs on me, I kill you! It's nature!
					}
					ifvare TEMPVAR8 17
					{
						globalsound CYBANIS_ONELINER18
						redefinequote 340 ^12Cybanis: I will give you a reason to fear the wrath of Cybanis Morgandos!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 10
				{
					setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 0 // Alien Form
					{
						randvar TEMPVAR8 17
						ifvare TEMPVAR8 0
						{
							globalsound NETHRA_ONELINER01
							redefinequote 340 ^0Nethra: Why must you force me to do this to you?!
						}
						ifvare TEMPVAR8 1
						{
							globalsound NETHRA_ONELINER02
							redefinequote 340 ^0Nethra: Mother, what are you feeding these guys?!
						}
						ifvare TEMPVAR8 2
						{
							globalsound NETHRA_ONELINER03
							redefinequote 340 ^0Nethra: That experience was rather... shocking!
						}
						ifvare TEMPVAR8 3
						{
							globalsound NETHRA_ONELINER04
							redefinequote 340 ^0Nethra: You guys just won't listen to reason will you?!
						}
						ifvare TEMPVAR8 4
						{
							globalsound NETHRA_ONELINER05
							redefinequote 340 ^0Nethra: Dammi, stop with this senseless warmongering!
						}
						ifvare TEMPVAR8 5
						{
							globalsound NETHRA_ONELINER06
							redefinequote 340 ^0Nethra: Mother, you must stop this senseless war! Too many are dying!
						}
						ifvare TEMPVAR8 6
						{
							globalsound NETHRA_ONELINER07
							redefinequote 340 ^0Nethra: All your potential down the drain... man this really sucks!
						}
						ifvare TEMPVAR8 7
						{
							globalsound NETHRA_ONELINER08
							redefinequote 340 ^0Nethra: I've got to snap some sense into Mother before we all die!
						}
						ifvare TEMPVAR8 8
						{
							globalsound NETHRA_ONELINER09
							redefinequote 340 ^0Nethra: Are all of you blindly loyal to Mother?!
						}
						ifvare TEMPVAR8 9
						{
							globalsound NETHRA_ONELINER10
							redefinequote 340 ^0Nethra: I hate to say it, but this *is* solving our population problems!
						}
						ifvare TEMPVAR8 10
						{
							globalsound NETHRA_ONELINER11
							redefinequote 340 ^0Nethra: This is not what I wanted to do with you guys!
						}
						ifvare TEMPVAR8 11
						{
							globalsound NETHRA_ONELINER12
							redefinequote 340 ^0Nethra: I'm getting sick of this bullheadedness!
						}
						ifvare TEMPVAR8 12
						{
							globalsound NETHRA_ONELINER13
							redefinequote 340 ^0Nethra: I'm getting to the point I don't care if you guys die or not!
						}
						ifvare TEMPVAR8 13
						{
							globalsound NETHRA_ONELINER14
							redefinequote 340 ^0Nethra: I just want peace for our kind for once!
						}
						ifvare TEMPVAR8 14
						{
							globalsound NETHRA_ONELINER15
							redefinequote 340 ^0Nethra: Can't you guys see you can't defeat the Earth's people?!
						}
						ifvare TEMPVAR8 15
						{
							globalsound NETHRA_ONELINER16
							redefinequote 340 ^0Nethra: All we're doing is killing ourselves this senseless war!
						}
						ifvare TEMPVAR8 16
						{
							globalsound NETHRA_ONELINER17
							redefinequote 340 ^0Nethra: I am your Princess, I wish you would listen to me for once!
						}
						ifvare TEMPVAR8 17
						{
							globalsound NETHRA_ONELINER18
							redefinequote 340 ^0Nethra: That's it! I've had about all I can stand from you idiots!
						}
						ifvare oldskoolmode 0 userquote 340
					}
					setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
					ifvare MISCARRAYID_AMOUNTTEMP 1 // Human Form
					{
						randvar TEMPVAR8 17
						ifvare TEMPVAR8 0
						{
							globalsound CHRISTINA_ONELINER01
							redefinequote 340 ^0Christina: You're not much of a gentleman, are you?!
						}
						ifvare TEMPVAR8 1
						{
							globalsound CHRISTINA_ONELINER02
							redefinequote 340 ^0Christina: Your punishment was swift, and hopefully just!
						}
						ifvare TEMPVAR8 2
						{
							globalsound CHRISTINA_ONELINER03
							redefinequote 340 ^0Christina: You really know how to sweep a girl off her feet, don't you?!
						}
						ifvare TEMPVAR8 3
						{
							globalsound CHRISTINA_ONELINER04
							redefinequote 340 ^0Christina: You guys should know better not to underestimate little ol' me!
						}
						ifvare TEMPVAR8 4
						{
							globalsound CHRISTINA_ONELINER05
							redefinequote 340 ^0Christina: Hehehe, I guess you stared at me too long!
						}
						ifvare TEMPVAR8 5
						{
							globalsound CHRISTINA_ONELINER06
							redefinequote 340 ^0Christina: Look at it this way, at least you went out with a good view!
						}
						ifvare TEMPVAR8 6
						{
							globalsound CHRISTINA_ONELINER07
							redefinequote 340 ^0Christina: Am I too hot for you to handle!?
						}
						ifvare TEMPVAR8 7
						{
							globalsound CHRISTINA_ONELINER08
							redefinequote 340 ^0Christina: You guys are getting go predictable!
						}
						ifvare TEMPVAR8 8
						{
							globalsound CHRISTINA_ONELINER09
							redefinequote 340 ^0Christina: This is getting really tedious and boring!
						}
						ifvare TEMPVAR8 9
						{
							globalsound CHRISTINA_ONELINER10
							redefinequote 340 ^0Christina: I hope one of you will give me a real challenge soon!
						}
						ifvare TEMPVAR8 10
						{
							globalsound CHRISTINA_ONELINER11
							redefinequote 340 ^0Christina: You got your ass kicked by a girl! Nanah-Nah-Nah-Nah!
						}
						ifvare TEMPVAR8 11
						{
							globalsound CHRISTINA_ONELINER12
							redefinequote 340 ^0Christina: Your testosterone is bigger than you can handle!
						}
						ifvare TEMPVAR8 12
						{
							globalsound CHRISTINA_ONELINER13
							redefinequote 340 ^0Christina: Appearantly you guys don't know the concept discretion!
						}
						ifvare TEMPVAR8 13
						{
							globalsound CHRISTINA_ONELINER14
							redefinequote 340 ^0Christina: Did you seriously think you could kill me with that?!
						}
						ifvare TEMPVAR8 14
						{
							globalsound CHRISTINA_ONELINER15
							redefinequote 340 ^0Christina: If you left this planet, I wouldn't have to kill you guys!
						}
						ifvare TEMPVAR8 15
						{
							globalsound CHRISTINA_ONELINER16
							redefinequote 340 ^0Christina: Is it too much for your guys to use real tact!?
						}
						ifvare TEMPVAR8 16
						{
							globalsound CHRISTINA_ONELINER17
							redefinequote 340 ^0Christina: Come on! I can keep this up all day if I must!
						}
						ifvare TEMPVAR8 17
						{
							globalsound CHRISTINA_ONELINER18
							redefinequote 340 ^0Christina: I'm sure that was worse than just a kick to the nuts!
						}
						ifvare oldskoolmode 0 userquote 340
					}
				}
				else
				ifvare CHARACTERSELECTED? 11
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: You show no mercy, You get no mercy!
					}
					ifvare TEMPVAR8 1
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: Nobody, and I mean nobody threatens my friends when I'm around!!
					}
					ifvare TEMPVAR8 2
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: You guys really are absentminded, aren't you?!
					}
					ifvare TEMPVAR8 3
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: I hates ending lives, but you're a special case!
					}
					ifvare TEMPVAR8 4
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: I just kicked your alien butt black and blue!
					}
					ifvare TEMPVAR8 5
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: I'm sorry, did I give you a mirgrane?!
					}
					ifvare TEMPVAR8 6
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: Ugh, you guys are nothing but brutes!
					}
					ifvare TEMPVAR8 7
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: Tell me you guys don't have a hivemind mentality...!
					}
					ifvare TEMPVAR8 8
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: Ick, I wouldn't want to be you right now!
					}
					ifvare TEMPVAR8 9
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: I'd mourn for you, but I didn't see a brain in there!
					}
					ifvare TEMPVAR8 10
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: Hey, shove off! I'm getting sick of your persistance!
					}
					ifvare TEMPVAR8 11
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: Sorry about that, but you really ticked me off!
					}
					ifvare TEMPVAR8 12
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: I hope your pride's not too sore for losing to me!
					}
					ifvare TEMPVAR8 13
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: You know what, I've fought stronger alien races than you!
					}
					ifvare TEMPVAR8 14
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: You guys just won't learn your lesson, will you?!
					}
					ifvare TEMPVAR8 15
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: This is getting extremely boring! At least try to think better!
					}
					ifvare TEMPVAR8 16
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: I might look weak, but I'm actually very deadly when threatened!
					}
					ifvare TEMPVAR8 17
					{
						// SOUND HERE
						redefinequote 340 ^20Paula: It doesn't take a psychic to see how pathetic you did!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 12
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: You deserve nothing less for what you've done to us!
					}
					ifvare TEMPVAR8 1
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Wow, you guys are sure aggressive! Big mistake!
					}
					ifvare TEMPVAR8 2
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Just leave us and our world alone before I really get mad!
					}
					ifvare TEMPVAR8 3
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: You guys should've made absolutely sure I was dead back there!
					}
					ifvare TEMPVAR8 4
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: I hope I didn't disappoint you! Oh wait, you disappointed *me*!
					}
					ifvare TEMPVAR8 5
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Alright that's it! No more Miss Nice Girl!
					}
					ifvare TEMPVAR8 6
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Uugh... you guys make a big mess out of things!
					}
					ifvare TEMPVAR8 7
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: I might speak soft, but I carry a very big stick!
					}
					ifvare TEMPVAR8 8
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: What is the problem with you guys?!
					}
					ifvare TEMPVAR8 9
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Just another pride-driven alien gone to pieces!
					}
					ifvare TEMPVAR8 10
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: What's left of you won't fill a lunchbox!
					}
					ifvare TEMPVAR8 11
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: For mass-murdering aliens, you sure don't take a hit well!
					}
					ifvare TEMPVAR8 12
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: I'll let God sort you guys out!
					}
					ifvare TEMPVAR8 13
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Get out of my way, alien scum!
					}
					ifvare TEMPVAR8 14
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: I will never forgive what you've all done!
					}
					ifvare TEMPVAR8 15
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: You learned the hard way what happens when I get pissed off!
					}
					ifvare TEMPVAR8 16
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: Now you're not such a sore sight to my eyes!
					}
					ifvare TEMPVAR8 17
					{
						// SOUND HERE
						redefinequote 340 ^15Lori: For those who died at your hands on Flight DNF-9235!!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 13
				{
					randvar TEMPVAR8 17
					ifvare TEMPVAR8 0
					{
						globalsound MINAKO_ONELINER01
						redefinequote 340 ^23Minako: V is for Victory, alien-creep!
					}
					ifvare TEMPVAR8 1
					{
						globalsound MINAKO_ONELINER02
						redefinequote 340 ^23Minako: I'm not just another helpless and pretty blonde, am I!?
					}
					ifvare TEMPVAR8 2
					{
						globalsound MINAKO_ONELINER03
						redefinequote 340 ^23Minako: Guess you didn't believe in yourself well enough!
					}
					ifvare TEMPVAR8 3
					{
						globalsound MINAKO_ONELINER04
						redefinequote 340 ^23Minako: My punishment of you comes from the heavens themselves!
					}
					ifvare TEMPVAR8 4
					{
						globalsound MINAKO_ONELINER05
						redefinequote 340 ^23Minako: My love outshines the darkness of your hatred!
					}
					ifvare TEMPVAR8 5
					{
						globalsound MINAKO_ONELINER06
						redefinequote 340 ^23Minako: Female or not, I deal swift justic to the wicked, human or alien!
					}
					ifvare TEMPVAR8 6
					{
						globalsound MINAKO_ONELINER07
						redefinequote 340 ^23Minako: Now you know why I'm the Goddess of Love!
					}
					ifvare TEMPVAR8 7
					{
						globalsound MINAKO_ONELINER08
						redefinequote 340 ^23Minako: Stop ogling me and fight for real if you guys want to live!
					}
					ifvare TEMPVAR8 8
					{
						globalsound MINAKO_ONELINER09
						redefinequote 340 ^23Minako: You guys are gonna pay for hurting my friends!
					}
					ifvare TEMPVAR8 9
					{
						globalsound MINAKO_ONELINER10
						redefinequote 340 ^23Minako: Sorry, but I don't accept ritual sacrifices!
					}
					ifvare TEMPVAR8 10
					{
						globalsound MINAKO_ONELINER11
						redefinequote 340 ^23Minako: *sings* Shot through the heart, and I'm to blame!
					}
					ifvare TEMPVAR8 11
					{
						globalsound MINAKO_ONELINER12
						redefinequote 340 ^23Minako: Wow, you actually look better now than before!
					}
					ifvare TEMPVAR8 12
					{
						globalsound MINAKO_ONELINER13
						redefinequote 340 ^23Minako: Bow down to the Goddess of Love!
					}
					ifvare TEMPVAR8 13
					{
						globalsound MINAKO_ONELINER14
						redefinequote 340 ^23Minako: I'm not singing any of my songs for you! *huffs*
					}
					ifvare TEMPVAR8 14
					{
						globalsound MINAKO_ONELINER15
						redefinequote 340 ^23Minako: Wow, you really know how to charm a girl, don't you?!
					}
					ifvare TEMPVAR8 15
					{
						globalsound MINAKO_ONELINER16
						redefinequote 340 ^23Minako: That one's for my friends: Usagi, Rei and Makoto!
					}
					ifvare TEMPVAR8 16
					{
						globalsound MINAKO_ONELINER17
						redefinequote 340 ^23Minako: Am I still just another pretty face to you now?!
					}
					ifvare TEMPVAR8 17
					{
						globalsound MINAKO_ONELINER18
						redefinequote 340 ^23Minako: Just another alien who can't perform under pressure!
					}
					ifvare oldskoolmode 0 userquote 340
				}
				else
				ifvare CHARACTERSELECTED? 14
				{
					ifvarg debugtoggle 0 
					{
						randvar TEMPVAR8 17
						ifvare TEMPVAR8 0
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Poor little fool caught like a rat! Hahahaha!!
						}
						ifvare TEMPVAR8 1
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: My anger boils! And no one survives my anger!!
						}
						ifvare TEMPVAR8 2
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Everyone learns their place in Life... or Death... at some point!!
						}
						ifvare TEMPVAR8 3
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: I am the Almighty, and you are not!!
						}
						ifvare TEMPVAR8 4
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Sorry, I guess I overused my power a bit too much! Hahahaha!!
						}
						ifvare TEMPVAR8 5
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Pitiful weakling, that'll teach you a lesson in true power!!
						}
						ifvare TEMPVAR8 6
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: A mere ant cannot defeat an immortal giant like me!
						}
						ifvare TEMPVAR8 7
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: I dearly hoped your arrogance, not your lack of power, got you killed!
						}
						ifvare TEMPVAR8 8
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Carnage is such an invigorating smell... oh wait, that's just your carcass!
						}
						ifvare TEMPVAR8 9
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: No one will miss your pathetic ass!
						}
						ifvare TEMPVAR8 10
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Cowards die horrible deaths, and I can see you're quite the coward!
						}
						ifvare TEMPVAR8 11
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: I commend your bravery, but bravery can also be a sign of stupidity!
						}
						ifvare TEMPVAR8 12
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: You should've groveled at my feet! At least you would've lived!
						}
						ifvare TEMPVAR8 13
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Looks like I just laid the royal smackdown on your ass!
						}
						ifvare TEMPVAR8 14
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: What's wrong, not what you were expecting me to be?!
						}
						ifvare TEMPVAR8 15
						{
							// SOUND HERE
							redefinequote 340 ^0Hinotori: Don't feel bad, at least you were killed by a surpreme being!
						}
						ifvare TEMPVAR8 16
						{
						// SOUND HERE
							redefinequote 340 ^0Hinotori: Your end, comes beyond my chaos!
						}
						ifvare TEMPVAR8 17
						{
						// SOUND HERE
							redefinequote 340 ^0Hinotori: The sun *doesn't* shine out of your ass, now does it?!
						}
						ifvare oldskoolmode 0 userquote 340
					}
				}
				else
				ifvare CHARACTERSELECTED? 15
				{
					getactorvar[PLAYERID].VEHICLEID TEMPVAR5
					ifvarn TEMPVAR5 -1
					{
						randvar TEMPVAR8 3
						ifvare TEMPVAR8 0 
						{
							globalsound MAKEN_ONELINERTANK01
							redefinequote 340 ^10Maken: So how's it feel to have your own weapons used against you!?
						}
						ifvare TEMPVAR8 1
						{
							globalsound MAKEN_ONELINERTANK02
							redefinequote 340 ^10Maken: You're as futile as ants trying to kill a giant!
						}
						ifvare TEMPVAR8 2
						{
							globalsound MAKEN_ONELINERTANK03
							redefinequote 340 ^10Maken: A pity I didn't need to hack this to kill you with it!
						}
						ifvare TEMPVAR8 3
						{
							globalsound MAKEN_ONELINERTANK04
							redefinequote 340 10Maken: Vroom Vroom Vroom, you go squishie, asshole!
						}
					}
					else
					{
						randvar TEMPVAR8 17
						ifvare TEMPVAR8 0
						{
							globalsound MAKEN_ONELINER01
							redefinequote 340 ^10Maken: Justice can be such a bitch, can't it?!
						}
						ifvare TEMPVAR8 1
						{
							globalsound MAKEN_ONELINER02
							redefinequote 340 ^10Maken: The sight of you almost makes me puke!
						}
						ifvare TEMPVAR8 2
						{
							globalsound MAKEN_ONELINER03
							redefinequote 340 ^10Maken: Kasey, that one was for you!
						}
						ifvare TEMPVAR8 3
						{
							globalsound MAKEN_ONELINER04
							redefinequote 340 ^10Maken: You can't defeat one who knows everything about you!
						}
						ifvare TEMPVAR8 4
						{
							globalsound MAKEN_ONELINER05
							redefinequote 340 ^10Maken: The less of you scumbag bastards left, the better I feel!
						}
						ifvare TEMPVAR8 5
						{
							globalsound MAKEN_ONELINER06
							redefinequote 340 ^10Maken: Now you can tell your buddies in Hell of the wrath of Maken Shinkara!
						}
						ifvare TEMPVAR8 6
						{
							globalsound MAKEN_ONELINER07
							redefinequote 340 ^10Maken: At least you died painlessly, a death unfitting of scum like you!
						}
						ifvare TEMPVAR8 7
						{
							globalsound MAKEN_ONELINER08
							redefinequote 340 ^10Maken: Like throwing salt on a slug... a hideous slug that is!
						}
						ifvare TEMPVAR8 8
						{
							globalsound MAKEN_ONELINER09
							redefinequote 340 ^10Maken: In my brother's name, alien bastards!
						}
						ifvare TEMPVAR8 9
						{
							globalsound MAKEN_ONELINER10
							redefinequote 340 ^10Maken: This one's for you Lori!
						}
						ifvare TEMPVAR8 10
						{
							globalsound MAKEN_ONELINER11
							redefinequote 340 ^10Maken: I am darkness beyond your worst nightmares, alien scum!
						}
						ifvare TEMPVAR8 11
						{
							globalsound MAKEN_ONELINER12
							redefinequote 340 ^10Maken: How does it feel to be the ones getting invaded by us?!
						}
						ifvare TEMPVAR8 12
						{
							globalsound MAKEN_ONELINER13
							redefinequote 340 ^10Maken: Die you ugly son of a bitch!
						}
						ifvare TEMPVAR8 13
						{
							globalsound MAKEN_ONELINER14
							redefinequote 340 ^10Maken: You just failed surpremely at life!
						}
						ifvare TEMPVAR8 14
						{
							globalsound MAKEN_ONELINER15
							redefinequote 340 ^10Maken: Yeah, taste my vengenace as I shove a rocket up your ass!
						}
						ifvare TEMPVAR8 15
						{
							globalsound MAKEN_ONELINER16
							redefinequote 340 ^10Maken: I can't believe I ever pretended to work for you assholes!
						}
						ifvare TEMPVAR8 16
						{
							globalsound MAKEN_ONELINER17
							redefinequote 340 ^10Maken: You got what was coming to you, no questions asked!
						}
						ifvare TEMPVAR8 17
						{
							globalsound MAKEN_ONELINER18
							redefinequote 340 ^10Maken: All your lives are belong to me now!
						}
						ifvare oldskoolmode 0 userquote 340
					}
				}
			}
		}
	}
ends


state boss_jibs
	guts JIBS2 2
	guts JIBS3 4
	guts JIBS4 6
	guts JIBS5 4
	guts JIBS6 6
	ifrnd 6 { guts JIBS1 2 { espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34 } } // a badly drawn spine
ends

state standard_jibs
	guts JIBS2 1
	guts JIBS3 2
	guts JIBS4 3
	guts JIBS5 2
	guts JIBS6 3
	ifrnd 6 { guts JIBS1 1 { espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34 } } // a badly drawn spine
	ifactor EGG state jib_sounds
	ifactor LIZTROOP state jib_sounds
	ifactor LIZTROOPSTAYPUT state jib_sounds
	ifactor LIZTROOPSHOOT state jib_sounds
	ifactor LIZTROOPJETPACK state jib_sounds
	ifactor LIZTROOPRUNNING state jib_sounds
	ifactor LIZTROOPDUCKING state jib_sounds
	ifactor LIZTROOPONTOILET state jib_sounds
	ifactor LIZTROOPJUSTSIT state jib_sounds
	ifactor LIZMAN state jib_sounds
	ifactor LIZMANSTAYPUT state jib_sounds
	ifactor LIZMANSPITTING state jib_sounds
	ifactor LIZMANJUMP state jib_sounds
	ifactor OCTABRAIN state jib_sounds
	ifactor OCTABRAINSTAYPUT state jib_sounds
	ifactor PIGCOP state jib_sounds
	ifactor PIGCOPSTAYPUT state jib_sounds
	ifactor PIGCOPDIVE state jib_sounds
	ifactor BOSS1 state jib_sounds
	ifactor BOSS1STAYPUT state jib_sounds
	ifactor BOSS1SHOOT state jib_sounds
	ifactor BOSS1LOB state jib_sounds
	ifactor BOSS2 state jib_sounds
	ifactor BOSS2STAYPUT state jib_sounds
	ifactor BOSS2SHOOT state jib_sounds
	ifactor BOSS2BREATH state jib_sounds
	ifactor BOSS3 state jib_sounds
	ifactor BOSS3STAYPUT state jib_sounds
	ifactor BOSS3LOB state jib_sounds
	ifactor COMMANDER state jib_sounds
	ifactor COMMANDERSTAYPUT state jib_sounds
	ifactor BOSS4 state jib_sounds
	ifactor BOSS4STAYPUT state jib_sounds
	ifactor NEWBEAST state jib_sounds
	ifactor NEWBEASTSTAYPUT state jib_sounds
	ifactor NEWBEASTJUMP state jib_sounds
	ifactor NEWBEASTHANG state jib_sounds
ends

state genericshrunkcode
	ifcount 32
	{
		ifpdistl SQUISHABLEDISTANCE 
		{
			// OFF-LIMITS
			setactor[THISACTOR].extra -1 
			// END OFF-LIMITS
			pstomp
			ifvare player[THISACTOR].knee_incs 3
			{
				setvar TEMPVAR2 0
				ifactor FEM1 setvar TEMPVAR2 1
				ifactor FEM2 setvar TEMPVAR2 1
				ifactor FEM3 setvar TEMPVAR2 1
				ifactor FEM4 setvar TEMPVAR2 1
				ifactor FEM5 setvar TEMPVAR2 1
				ifactor FEM6 setvar TEMPVAR2 1
				ifactor FEM7 setvar TEMPVAR2 1
				ifactor FEM8 setvar TEMPVAR2 1
				ifactor FEM9 setvar TEMPVAR2 1
				ifactor FEM10 setvar TEMPVAR2 1
				ifactor ROBOTDOG setvar TEMPVAR2 2
				ifactor ROBOTDOG2 setvar TEMPVAR2 2
				ifactor TOUGHGAL setvar TEMPVAR2 2
				ifactor NAKED1 setvar TEMPVAR2 1
				ifactor PODFEM1 setvar TEMPVAR2 1
				ifactor DANCE1 setvar TEMPVAR2 3
				ifactor DANCE2 setvar TEMPVAR2 3
				ifactor DANCE3 setvar TEMPVAR2 3
				ifactor DANCE5 setvar TEMPVAR2 3
				ifactor DANCE6 setvar TEMPVAR2 3
				ifactor DANCE7 setvar TEMPVAR2 3
				ifactor DANCE9 setvar TEMPVAR2 3
				ifactor STAND1 setvar TEMPVAR2 3
				ifactor DEALER setvar TEMPVAR2 3
				ifactor STAND3 setvar TEMPVAR2 3
				ifactor STAND4 setvar TEMPVAR2 3
				ifactor WOLFDUDE setvar TEMPVAR2 3
				ifactor PUNKDUDE setvar TEMPVAR2 3
				ifactor COP1 setvar TEMPVAR2 3
				ifactor COP2 setvar TEMPVAR2 3
				ifactor SITTINGDUDE setvar TEMPVAR2 3
				ifactor ANIMEGIRL1 setvar TEMPVAR2 3
				ifactor ANIMEGIRL2 setvar TEMPVAR2 3
				ifactor ANIMEGIRL3 setvar TEMPVAR2 3
				ifactor ANIMEGIRL4 setvar TEMPVAR2 3
		
				ifvarg TEMPVAR2 0 ifvarl TEMPVAR2 4
				{
					ifvare TEMPVAR2 1
					{
						randvar RANKPOINTSTEMP FEMKILLRANKPOINTSRAND 
						addvar RANKPOINTSTEMP FEMKILLRANKPOINTSSOLID 
					}
					ifvare TEMPVAR2 2
					{
						randvar RANKPOINTSTEMP DOGKILLRANKPOINTSRAND 
						addvar RANKPOINTSTEMP DOGKILLRANKPOINTSSOLID 
					}
					ifvare TEMPVAR2 3
					{
						randvar RANKPOINTSTEMP CIVILIANKILLRANKPOINTSRAND 
						addvar RANKPOINTSTEMP CIVILIANKILLRANKPOINTSSOLID 
					}
					redefinequote 340 ^21SQUISH!!
					userquote 340
					setvar TEMPVAR 3 state checkkillerofciv
					setvar TEMPVAR 1 state expmulti
					state exp_given
				}
				else
				{
					state addtokillamounts
					state check_a_characters_kills
					redefinequote 340 ^21SQUISH!!
					userquote 340
					ifactor SHARK state sharkawards
					ifactor LIZTROOP state liztroopawards
					ifactor PIGCOP state pigcopawards
					ifactor LIZMAN state lizmanawards
					ifactor OCTABRAIN state octabrainawards
					ifactor COMMANDER state commanderawards
					ifactor NEWBEAST state newbeastawards
					ifactor BOSS1 state boss1awards
					ifactor BOSS2 state boss2awards
					ifactor BOSS3 state boss3awards
					ifactor BOSS4 state boss4awards
					setvar TEMPVAR 0 state expmulti
					state exp_given
				}
			}
		}
	}
	else
	{
		sizeto MINXSTRETCH MINYSTRETCH
		spawn FRAMEEFFECT1
	}
ends

state genericgrowcode
	ifcount 32
	{
		guts JIBS4 24
		guts JIBS6 28
		addkills 1
		sound SQUISHED
		sound PIPEBOMB_EXPLODE
		hitradius 2048 60 70 80 90
		{ espawn NEWBLOODPOOL setactor[RETURN].pal 2 setactor[RETURN].cstat 34 }
		spawn EXPLOSION2
		setactor[THISACTOR].extra -1
		setvar EXPANDING? 0
		killit
	}
	else
	{
		ifactor COMMANDER
			sizeto 100 100
		else
			ifactor SHARK
				sizeto 84 84
		else
			sizeto MAXXSTRETCH MAXYSTRETCH
			break
	}
ends

// APLAYER = 85h
// SHARK - 44h
// LIZTROOP = 88h
// OCTABRAIN = 95h
// SCORPIONTANK = 90h
// DRONE = 40h
// COMMANDER = 83h
// RECON = 60h
// TANK = 74h
// PIGCOP = 87h
// LIZMAN = 87h
// ROTATEGUN = 19h
// BOSS1 = 134h
// BOSS2 = 140h
// BOSS3 = 132h
// NEWBEAST = 117h
// BOSS4 = 164h

state pythagoras_reactor
	// next code gets distance between actortarget (x,y) and lightning (x,y), puts result in REACTORDISTANCE
	getactor[THISACTOR].x temp
	getactor[REACTORACTORDMGID].x tempb
	
	subvarvar temp tempb
	mulvarvar temp temp
	
	getactor[THISACTOR].y tempc
	getactor[REACTORACTORDMGID].y tempd
	
	subvarvar tempc tempd
	mulvarvar tempc tempc
	
	addvarvar temp tempc
	sqrt temp temp
	setvarvar REACTORDISTANCE temp
ends

state reactordetectifdead
	ifvarn REACTORACTORDMGID -1
	{ 
		ifvarn actorvar[REACTORACTORDMGID].DRIVERID -1 { setvar REACTORACTORDMGID -1 break } // Vehicles only
		ifvarl actorvar[REACTORACTORDMGID].ACTORHP 1 { setvar REACTORACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[REACTORACTORDMGID].SHRUNK? 1 { setvar REACTORACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[REACTORACTORDMGID].EXPANDING? 1 { setvar REACTORACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[REACTORACTORDMGID].FROZEN? 1 { setvar REACTORACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[REACTORACTORDMGID].CLOAKED? 1 { setvar REACTORACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_reactor
		ifvarg REACTORDISTANCE 4096 { setvar REACTORACTORDMGID -1 break }
	}
ends

state pythagoras_lightning
	// next code gets distance between actortarget (x,y) and lightning (x,y), puts result in LIGHTNINGDISTANCE
	getactor[THISACTOR].x temp
	getactor[LIGHTNINGACTORDMGID].x tempb
	
	subvarvar temp tempb
	mulvarvar temp temp
	
	getactor[THISACTOR].y tempc
	getactor[LIGHTNINGACTORDMGID].y tempd
	
	subvarvar tempc tempd
	mulvarvar tempc tempc
	
	addvarvar temp tempc
	sqrt temp temp
	setvarvar LIGHTNINGDISTANCE temp
ends

state lightningdetectifdead
	ifvarn LIGHTNINGACTORDMGID -1
	{ 
		ifvarn actorvar[LIGHTNINGACTORDMGID].DRIVERID -1 { setvar LIGHTNINGACTORDMGID -1 break } // Vehicles only
		ifvarl actorvar[LIGHTNINGACTORDMGID].ACTORHP 1 { setvar LIGHTNINGACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[LIGHTNINGACTORDMGID].SHRUNK? 1 { setvar LIGHTNINGACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[LIGHTNINGACTORDMGID].EXPANDING? 1 { setvar LIGHTNINGACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[LIGHTNINGACTORDMGID].FROZEN? 1 { setvar LIGHTNINGACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[LIGHTNINGACTORDMGID].CLOAKED? 1 { setvar LIGHTNINGACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_lightning
		ifvarg LIGHTNINGDISTANCE 1536 { setvar LIGHTNINGACTORDMGID -1 break }
	}
ends

state monsterdamagesounds
	state monsterpainsounds1
ends

state lightning_damagesounds
	ifvarg TEMPVAR2 0
	{
		getactor[LIGHTNINGACTORDMGID].picnum temp
		setvarvar TEMP5 LIGHTNINGACTORDMGID
		state monsterdamagesounds
	}
ends

state reactor_damagesounds
	ifvarg TEMPVAR2 0
	{
		getactor[REACTORACTORDMGID].picnum temp
		setvarvar TEMP5 REACTORACTORDMGID
		state monsterdamagesounds
	}
ends

state calcrankitems
	state stopsearchsounds
	
	setvar MISCARRAYID 8 // Memorbilia Found [Level]
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
	setvar MISCARRAYID 9 // Memorbilia Found [Game] 
	getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	addvar MISCARRAYID_AMOUNTTEMP 1
	setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
	ifvare PUBLICBETA? 1 nullop else divvar RANKPOINTSTEMP 4
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	globalsound DUKE_GET
	globalsound DUKE_GET
	
	setvar MISCARRAYID 8 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // Memorbilia Found [Level]
	setvar MISCARRAYID 10 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // Max Memorbilia Found [Level]
	ifvarg MISCARRAYID_AMOUNTTEMP2 0
	{
		ifvarvare MISCARRAYID_AMOUNTTEMP MISCARRAYID_AMOUNTTEMP2
		{
			ifactor 6457 nullop
			else
			{
				globalsound FOUND_ALLSECRETS
				redefinequote 335 ^23 YOU HAVE FOUND ALL OF THE MEMORBILIA!
			}
		}
	}
	
	setvar TEMPVAR 1
	state expmulti
	setvarvar fta fta_normal setvar ftq 335
	addvarvar RANKPOINTS RANKPOINTSTEMP
	killit
ends

state setrankitemmax
	ifvare TALLYSET? 0
	{
		getactor[THISACTOR].cstat TEMP ifvarand TEMP 1024 nullop else { addvar TEMP 1024 setactor[THISACTOR].cstat TEMP }
	
		setvar MISCARRAYID 10 // Max Memorbilia Found [Level]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar MISCARRAYID 11 // Memorbilia Found [Game]
		getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
		addvar MISCARRAYID_AMOUNTTEMP 1
		setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP
	
		setvar ISMEMORBILIA? 1
		setvar TALLYSET? 1
	}
ends

// Collectables [Posters, Etc. RANK-heavy items! :P]

state grabspecialfigurine
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{       
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				redefinequote 335 ^23 GRABBED A RARE FIGURINE!
				setvar RANKPOINTSTEMP 400
				state calcrankitems
			}
		}
	}
ends

state graboneofakindimage
	ifvare oldskoolmode 0
	{
		ifactor 6457 nullop else state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				ifactor 6457 state setrankitemmax
				redefinequote 335 ^23 GRABBED A ^10ONE OF A KIND^23 PICTURE!
				setvar RANKPOINTSTEMP 262144
				state calcrankitems
			}
		}
	}
ends

state grabspecialposter5
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				redefinequote 335 ^23 GRABBED A ^10EXTREMELY^23 SPECIAL POSTER!
				randvar RANKPOINTSTEMP 512
				addvar RANKPOINTSTEMP 512
				state calcrankitems
			}
		}
	}
ends

state grabspecialposter4
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				redefinequote 335 ^23 GRABBED A ^10VERY^23 SPECIAL POSTER!
				setvar RANKPOINTSTEMP 384
				state calcrankitems
			}
		}
	}
ends

state grabspecialposter3
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				redefinequote 335 ^23 GRABBED A ^21VERY^23 SPECIAL POSTER!
				setvar RANKPOINTSTEMP 256
				state calcrankitems
			}
		}
	}
ends


state grabspecialposter2
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				redefinequote 335 ^23 GRABBED A VERY SPECIAL POSTER!
				setvar RANKPOINTSTEMP 128
				state calcrankitems
			}
		}
	}
ends

state grabspecialposter
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				redefinequote 335 ^23 GRABBED A SPECIAL POSTER!
				setvar RANKPOINTSTEMP 64
				state calcrankitems
			}
		}
	}
ends

state grabposter
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				state checktip_memorbilia
				redefinequote 335 ^23 GRABBED A POSTER!
				setvar RANKPOINTSTEMP 32
				state calcrankitems
			}
		}
	}
ends

state grabspecialmagazine2
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				state checktip_memorbilia
				redefinequote 335 ^23 GRABBED A VERY SPECIAL MAGAZINE!
				setvar RANKPOINTSTEMP 144
				state calcrankitems
			}
		}
	}
ends

state grabspecialmagazine
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				state checktip_memorbilia
				redefinequote 335 ^23 GRABBED A SPECIAL MAGAZINE!
				setvar RANKPOINTSTEMP 48
				state calcrankitems
			}
		}
	}
ends

state grabmagazine
	ifvare oldskoolmode 0
	{
		state setrankitemmax
		ifvarg CURRENTHITPOINTS 0 // ifp palive
		{
			ifpdistl RETRIEVEDISTANCE ifp pfacing ifhitspace
			{
				state checktip_memorbilia
				redefinequote 335 ^23 GRABBED A MAGAZINE!
				setvar RANKPOINTSTEMP 24
				state calcrankitems
			}
		}
	}
ends

state expanding
	ifactor APLAYER nullop else { setactor[THISACTOR].extra 0 setvar ACTORHP 0 }
	setvar EXPANDING? 1
ends

state freezeup
	sound SOMETHINGFROZE
	
	ifactor APLAYER setactor[THISACTOR].extra 0 else { setactor[THISACTOR].extra 0 setvar ACTORHP 0 }
	setvar FROZEN? 1
	setvar FROZENTIMER 138
ends

state unfreeze
	setvar FROZEN? 0
	setvar FROZENTIMER 0
	
	ifactor APLAYER setvarvar TEMP MAXHITPOINTS
	else setvarvar TEMP ACTORMAXHP
	
	divvar TEMP 100
	ifvarl TEMP 1 setvar TEMP 1
	ifactor APLAYER { setactor[THISACTOR].extra 16384 ifvare oldskoolmode 1 addvar TEMP 2 setvarvar CURRENTHITPOINTS TEMP }
	else ifactor PODFEM1POD { setactor[THISACTOR].extra 1 setvar ACTORHP 1 }
	else { setactor[THISACTOR].extra 16384 setvarvar ACTORHP TEMP }
	setactor[THISACTOR].htpicnum -1
	getlastpal
ends

state headhitstate
	//wackplayer
ends

state pythagoras_fire
	// next code gets distance between actortarget (x,y) and lightning (x,y), puts result in FIREDISTANCE
	getactor[THISACTOR].x temp
	getactor[FIREACTORDMGID].x tempb
	
	subvarvar temp tempb
	mulvarvar temp temp
	
	getactor[THISACTOR].y tempc
	getactor[FIREACTORDMGID].y tempd
	
	subvarvar tempc tempd
	mulvarvar tempc tempc
	
	addvarvar temp tempc
	sqrt temp temp
	setvarvar FIREDISTANCE temp
ends

state firedetectifdead_heat
	ifvarn FIREACTORDMGID -1
	{ 
		ifvarn actorvar[FIREACTORDMGID].DRIVERID -1 { setvar FIREACTORDMGID -1 break } // Vehicles only
		ifvarl actorvar[FIREACTORDMGID].ACTORHP 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[FIREACTORDMGID].SHRUNK? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[FIREACTORDMGID].EXPANDING? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[FIREACTORDMGID].FROZEN? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[FIREACTORDMGID].CLOAKED? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_fire
		ifvarg FIREDISTANCE 6144 { setvar FIREACTORDMGID -1 break }
	}
ends

state firedetectifdead
	ifvarn FIREACTORDMGID -1
	{ 
		ifvarn actorvar[FIREACTORDMGID].DRIVERID -1 { setvar FIREACTORDMGID -1 break } // Vehicles only
		ifvarl actorvar[FIREACTORDMGID].ACTORHP 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[FIREACTORDMGID].SHRUNK? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[FIREACTORDMGID].EXPANDING? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[FIREACTORDMGID].FROZEN? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[FIREACTORDMGID].CLOAKED? 1 { setvar FIREACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_fire
		ifactor FIREBARREL
		{
			ifvarg FIREDISTANCE 1480 { setvar FIREACTORDMGID -1 break }
		}
		else
		ifactor FIREVASE
		{
			ifvarg FIREDISTANCE 1480 { setvar FIREACTORDMGID -1 break }
		}
		else
		ifactor FIRE
		{
			ifvarg FIREDISTANCE 844 { setvar FIREACTORDMGID -1 break }
		}
		else
		ifactor FIRE2
		{
			ifvarg FIREDISTANCE 844 { setvar FIREACTORDMGID -1 break }
		}
		else
		ifactor BURNING
		{
			ifvarg FIREDISTANCE 844 { setvar FIREACTORDMGID -1 break }
		}
		else
		ifactor BURNING2
		{
			ifvarg FIREDISTANCE 844 { setvar FIREACTORDMGID -1 break }
		}
		else
		{
			ifvarg FIREDISTANCE 844 { setvar FIREACTORDMGID -1 break }
		}
	}
ends

state fire_damagesounds
ifvarg TEMPVAR2 0
{
	getactor[FIREACTORDMGID].picnum temp
	setvarvar TEMP5 FIREACTORDMGID
	state monsterdamagesounds
}
ends

state fireheatactors
	//******************************************
	//*Warming up in Freezing Environs [Actors]*
	//******************************************
	addvar FINDNEAR_INTERVAL 1
	ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
	{
		findnearactor3d FEM1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM5 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM6 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM7 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM9 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM10 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d WOMAN 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d TOUGHGAL 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NAKED1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PODFEM1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d WOLFDUDE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE5 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE6 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE7 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE9 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d STAND1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DEALER 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d STAND3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d STAND4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PUNKDUDE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COP1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COP2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d SITTINGDUDE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PRESIDENTCLINTON 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d SHARK 6144 FIREACTORDMGID state firedetectifdead_heat 
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSHOOT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPDUCKING 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJETPACK 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPRUNNING 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJUSTSIT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPONTOILET 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PIGCOP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPDIVE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMAN 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMANJUMP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSPITTING 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAIN 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAINSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEAST 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTJUMP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTHANG 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COMMANDER 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COMMANDERSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1SHOOT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1LOB 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2SHOOT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2BREATH 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS3STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS3LOB 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS4STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		setvar FINDNEAR_INTERVAL 0
	
		ifvarn FIREACTORDMGID -1
		{
			ifvare mainmenu 0
			{
				ifvarl actorvar[FIREACTORDMGID].ACTORINVULNTIME 1
				{
					ifvarg actorvar[FIREACTORDMGID].ACTORHP 0
					{
						ifvarg FIREDISTANCE 3072 ifvarl FIREDISTANCE 6144
						{
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
						else
						ifvarg FIREDISTANCE 1536 ifvarl FIREDISTANCE 3073 
						{
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 4 addvar tempg 5 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
						else
						ifvarg FIREDISTANCE 768 ifvarl FIREDISTANCE 1537
						{
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 4 addvar tempg 5 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 6 addvar tempg 7 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
						else
						ifvarl FIREDISTANCE 769
						{
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 4 addvar tempg 5 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 6 addvar tempg 7 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 8 addvar tempg 9 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
					}
				}
			}
		}
	}
ends

state firebarreldmgactors
	//******************************************
	//*Warming up in Freezing Environs [Actors]*
	//******************************************
	addvar FINDNEAR_INTERVAL 1
	ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
	{
		findnearactor3d FEM1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM5 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM6 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM7 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM9 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d FEM10 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d WOMAN 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d TOUGHGAL 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NAKED1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PODFEM1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d WOLFDUDE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE5 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE6 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE7 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DANCE9 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d STAND1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d DEALER 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d STAND3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d STAND4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PUNKDUDE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COP1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COP2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d SITTINGDUDE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PRESIDENTCLINTON 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d SHARK 6144 FIREACTORDMGID state firedetectifdead_heat 
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSHOOT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPDUCKING 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJETPACK 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPRUNNING 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJUSTSIT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPONTOILET 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PIGCOP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPDIVE 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMAN 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMANJUMP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSPITTING 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAIN 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAINSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEAST 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTJUMP 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTHANG 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COMMANDER 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d COMMANDERSTAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1SHOOT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS1LOB 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2SHOOT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS2BREATH 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS3 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS3STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS3LOB 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS4 6144 FIREACTORDMGID state firedetectifdead_heat
		ifvare FIREACTORDMGID -1 findnearactor3d BOSS4STAYPUT 6144 FIREACTORDMGID state firedetectifdead_heat
		setvar FINDNEAR_INTERVAL 0
	
		ifvarn FIREACTORDMGID -1
		{
			ifvare mainmenu 0
			{
				ifvarl actorvar[FIREACTORDMGID].ACTORINVULNTIME 1
				{
					ifvarg actorvar[FIREACTORDMGID].ACTORHP 0
					{
						ifvarg FIREDISTANCE 3072 ifvarl FIREDISTANCE 6144
						{
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
						else
						ifvarg FIREDISTANCE 1536 ifvarl FIREDISTANCE 3073 
						{
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 4 addvar tempg 5 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
						else
						ifvarg FIREDISTANCE 768 ifvarl FIREDISTANCE 1537
						{
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 4 addvar tempg 5 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 6 addvar tempg 7 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
						else
						ifvarl FIREDISTANCE 769
						{
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 2 addvar tempg 3 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 4 addvar tempg 5 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 256
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 6 addvar tempg 7 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
							ifrnd 64
							{
								getactorvar[FIREACTORDMGID].freezetimer tempf
								ifvarg tempf 0 { randvar tempg 8 addvar tempg 9 subvarvar tempf tempg ifvarl tempf 0 setvar tempf 0 setactorvar[FIREACTORDMGID].freezetimer tempf }
							}
						}
					}
				}
			}
		}
	}
	
	ifrnd 32
	{
		addvar FINDNEAR_INTERVAL 1
		ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
		{
			findnearactor3d FEM1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM2 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM3 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM4 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM5 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM6 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM7 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM9 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM10 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d WOMAN 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG2 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d TOUGHGAL 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NAKED1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PODFEM1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d WOLFDUDE 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE2 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE3 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE5 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE6 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE7 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE9 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d STAND1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DEALER 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d STAND3 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d STAND4 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PUNKDUDE 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COP1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COP2 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d SITTINGDUDE 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL2 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL3 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL4 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PRESIDENTCLINTON 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ROTATEGUN 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d SHARK 1480 FIREACTORDMGID state firedetectifdead 
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOP 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSTAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSHOOT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPDUCKING 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJETPACK 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPRUNNING 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJUSTSIT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPONTOILET 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PIGCOP 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPDIVE 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPSTAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMAN 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSTAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMANJUMP 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSPITTING 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DRONE 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAIN 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAINSTAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEAST 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTSTAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTJUMP 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTHANG 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COMMANDER 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COMMANDERSTAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d TANK 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d EMPTYTANK 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d SCORPIONTANK 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1STAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1SHOOT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1LOB 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2STAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2SHOOT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2BREATH 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS3 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS3STAYPUT 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS3LOB 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS4 1480 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS4STAYPUT 1480 FIREACTORDMGID state firedetectifdead
			setvar FINDNEAR_INTERVAL 0
		}   
	
		ifvarn FIREACTORDMGID -1
		{
	
			ifvare mainmenu 0
			{
				ifvarl actorvar[FIREACTORDMGID].ACTORINVULNTIME 1
				{
					ifvarg actorvar[FIREACTORDMGID].ACTORHP 0
					{
						setactor[FIREACTORDMGID].extra 16384
						randvar tempe 2
						addvar tempe 5
						ifactor FIREBARREL
						{
							ifvarl FIREDISTANCE 1481
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum FIREBARREL
							}
						}
						else
						ifactor FIREVASE
						{
							ifvarl FIREDISTANCE 1481
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum FIREVASE
							}
						}
						else
						ifactor FIRE
						{
							ifvarl FIREDISTANCE 845
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum FIRE
							}
						}
						else
						ifactor FIRE2
						{
							ifvarl FIREDISTANCE 845
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum FIRE2
							}
						}
						else
						ifactor BURNING
						{
							ifvarl FIREDISTANCE 845
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum BURNING
							}
						}
						else
						ifactor BURNING2
						{
							ifvarl FIREDISTANCE 845
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum BURNING2
							}
						}
						else
						{
							ifvarl FIREDISTANCE 845 
							{
								setactor[FIREACTORDMGID].htextra tempe
								setactor[FIREACTORDMGID].htowner THISACTOR
								setactor[FIREACTORDMGID].htpicnum STEAM
							}
						}
					}
				}
				else sound INVULNITEM3
			}
	
		}
	}
ends

state firedmgactors
	ifrnd 32
	{
		addvar FINDNEAR_INTERVAL 1
		ifvarvarg FINDNEAR_INTERVAL FINDNEAR_INTERVAL_MAX
		{
			findnearactor3d FEM1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM2 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM3 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM4 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM5 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM6 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM7 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM9 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d FEM10 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d WOMAN 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ROBOTDOG2 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d TOUGHGAL 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NAKED1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PODFEM1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d WOLFDUDE 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE2 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE3 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE5 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE6 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE7 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DANCE9 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d STAND1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DEALER 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d STAND3 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d STAND4 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PUNKDUDE 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COP1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COP2 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d SITTINGDUDE 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL2 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL3 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ANIMEGIRL4 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PRESIDENTCLINTON 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d ROTATEGUN 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d SHARK 844 FIREACTORDMGID state firedetectifdead 
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOP 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSTAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPSHOOT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPDUCKING 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJETPACK 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPRUNNING 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPJUSTSIT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZTROOPONTOILET 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PIGCOP 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPDIVE 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d PIGCOPSTAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMAN 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSTAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMANJUMP 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d LIZMANSPITTING 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d DRONE 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAIN 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d OCTABRAINSTAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEAST 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTSTAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTJUMP 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d NEWBEASTHANG 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COMMANDER 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d COMMANDERSTAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d TANK 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d EMPTYTANK 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d SCORPIONTANK 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1STAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1SHOOT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS1LOB 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2STAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2SHOOT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS2BREATH 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS3 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS3STAYPUT 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS3LOB 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS4 844 FIREACTORDMGID state firedetectifdead
			ifvare FIREACTORDMGID -1 findnearactor3d BOSS4STAYPUT 844 FIREACTORDMGID state firedetectifdead
			setvar FINDNEAR_INTERVAL 0
		}   
	
		ifvarn FIREACTORDMGID -1
		{
			ifvare mainmenu 0
			{
				ifvarl actorvar[FIREACTORDMGID].ACTORINVULNTIME 1
				{
					ifvarg actorvar[FIREACTORDMGID].ACTORHP 0
					{
						setactor[FIREACTORDMGID].extra 16384
						randvar tempe 2
						addvar tempe 5
						ifvarl FIREDISTANCE 845 
						{
							setactor[FIREACTORDMGID].htextra tempe
							setactor[FIREACTORDMGID].htowner THISACTOR
							setactor[FIREACTORDMGID].htpicnum FIRE
						}
					}
				}
				else sound INVULNITEM3
			}
		}
	}
ends

state pythagoras_steam
	// next code gets distance between actortarget (x,y) and lightning (x,y), puts result in STEAMDISTANCE
	getactor[THISACTOR].x temp
	getactor[STEAMACTORDMGID].x tempb
	
	subvarvar temp tempb
	mulvarvar temp temp
	
	getactor[THISACTOR].y tempc
	getactor[STEAMACTORDMGID].y tempd
	
	subvarvar tempc tempd
	mulvarvar tempc tempc
	
	addvarvar temp tempc
	sqrt temp temp
	setvarvar STEAMDISTANCE temp
ends

state steamdetectifdead_heat
	ifvarn STEAMACTORDMGID -1
	{ 
		ifvarl actorvar[STEAMACTORDMGID].ACTORHP 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[STEAMACTORDMGID].SHRUNK? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[STEAMACTORDMGID].EXPANDING? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[STEAMACTORDMGID].FROZEN? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[STEAMACTORDMGID].CLOAKED? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_steam
		ifvarg STEAMDISTANCE 4608 { setvar STEAMACTORDMGID -1 break }
	}
ends

state steamdetectifdead
	ifvarn STEAMACTORDMGID -1
	{ 
		ifvarn actorvar[STEAMACTORDMGID].DRIVERID -1 { setvar STEAMACTORDMGID -1 break } // Vehicles only
		ifvarl actorvar[STEAMACTORDMGID].ACTORHP 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[STEAMACTORDMGID].SHRUNK? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[STEAMACTORDMGID].EXPANDING? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[STEAMACTORDMGID].FROZEN? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[STEAMACTORDMGID].CLOAKED? 1 { setvar STEAMACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_steam
		ifvarg STEAMDISTANCE 1024 { setvar STEAMACTORDMGID -1 break }
	}
ends

state steam_damagesounds
	ifvarg TEMPVAR2 0
	{
		getactor[STEAMACTORDMGID].picnum temp
		setvarvar TEMP5 STEAMACTORDMGID
		state monsterdamagesounds
	}
ends

state playerarmorshrapnelspecial
	setvarvar ARMORDAMAGEFACTOR tempd
	mulvar ARMORDAMAGEFACTOR 1000
	ifvarn MAXARMORPOINTS 0 divvarvar ARMORDAMAGEFACTOR MAXARMORPOINTS
	
	ifvarg tempd 0 { sound ARMOR_HIT state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 125 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 250 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 375 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 500 { state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 625 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 750 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 875 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1000 { state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 1125 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1250 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1375 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1500 { state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 1625 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1750 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1875 state randomshrapnel
	ifvare ARMORDAMAGEFACTOR 2000 { state sparkstate state randomshrapnel }
ends

state player_specialarmor // for dealing armor-damage outside of the main damage formula
	getactorvar[PLAYERID].VEHICLEID TEMPVAR2
	ifvare TEMPVAR2 -1
	{
		setvarvar ARMORLIMIT tempe
		mulvarvar ARMORLIMIT ARMORPERCENT // 50
		divvar ARMORLIMIT 1000
		subvar ARMORLIMIT 1
	}
	else
	{
		setvarvar ARMORLIMIT tempe
		mulvarvar ARMORLIMIT actorvar[TEMPVAR2].ACTORARMORPERCENT // 50
		divvar ARMORLIMIT 1000
		subvar ARMORLIMIT 1
	}
	
	ifvarg tempe 0
	{
		getactorvar[PLAYERID].VEHICLEID TEMPVAR2
		ifvare TEMPVAR2 -1
		{
			ifvarvarg CURRENTARMORPOINTS ARMORLIMIT
			{
				setvarvar tempd tempe
				mulvarvar tempd ARMORPERCENT // 50
				divvar tempd 1000
		
				mulvarvar tempe DAMAGEPERCENT // 50
				divvar tempe 1000
				subvarvar CURRENTARMORPOINTS tempd
			}
			else
			{
				subvarvar tempe CURRENTARMORPOINTS
				setvarvar tempd CURRENTARMORPOINTS
				setvar CURRENTARMORPOINTS 0
			}
		}
		else
		{
			getactorvar[TEMPVAR2].ACTORAP TEMPVAR3
			ifvarvarg TEMPVAR3 ARMORLIMIT
			{
				setvarvar tempd tempe
				mulvarvar tempd actorvar[TEMPVAR2].ACTORARMORPERCENT // 50
				divvar tempd 1000
		
				setvar TEMPVAR5 1000
				subvarvar TEMPVAR5 actorvar[TEMPVAR2].ACTORARMORPERCENT
				mulvarvar tempe TEMPVAR5 // 50
				divvar tempe 1000
		
				subvarvar TEMPVAR3 tempd
				setactorvar[TEMPVAR2].ACTORAP TEMPVAR3
			}
			else
			{
				subvarvar tempe TEMPVAR3
				setvarvar tempd TEMPVAR3
				setvar TEMPVAR3 0
				setactorvar[TEMPVAR2].ACTORAP TEMPVAR3
			}
		}
	}
	else setvar tempd 0
	
	ifvarg tempd 0 { state playerarmorshrapnelspecial setvar VEHICLEAPDAMAGED? 1 }
ends

state enemyarmorshrapnelspecial
	setvarvar ARMORDAMAGEFACTOR tempd
	mulvar ARMORDAMAGEFACTOR 1000
	ifvarn TEMP2 0 divvarvar ARMORDAMAGEFACTOR TEMP2
	
	ifvarg tempd 0 { sound ARMOR_HIT state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 125 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 250 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 375 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 500 { state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 625 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 750 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 875 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1000 { state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 1125 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1250 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1375 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1500 { state sparkstate state randomshrapnel }
	ifvarg ARMORDAMAGEFACTOR 1625 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1750 state randomshrapnel
	ifvarg ARMORDAMAGEFACTOR 1875 state randomshrapnel
	ifvare ARMORDAMAGEFACTOR 2000 { state sparkstate state randomshrapnel }
ends

state enemy_specialarmor
	setvarvar ACTORARMORLIMIT tempe
	mulvarvar ACTORARMORLIMIT TEMP3 // 50
	divvar ACTORARMORLIMIT 1000
	subvar ACTORARMORLIMIT 1
	ifvarl ACTORARMORLIMIT 1 { ifrnd 128 setvar ACTORARMORLIMIT 1 else setvar ACTORARMORLIMIT 0 }
	
	ifvarg tempe 0
	{
		ifvarvarg TEMPVAR3 ACTORARMORLIMIT
		{
			setvarvar tempd tempe
			mulvarvar tempd TEMP3 // 50
			divvar tempd 1000
			ifvarl tempd 1 { ifrnd 128 { setvar tempd 1 setvar tempe 0 } else { setvar tempd 0 setvar tempe 1 } }
		
			setvar ACTORDAMAGEPERCENT 1000
			subvarvar ACTORDAMAGEPERCENT TEMP3
			mulvarvar tempe ACTORDAMAGEPERCENT // 50
			divvar tempe 1000
			ifvarl tempe 0 setvar tempe 0 
		
			subvarvar TEMPVAR3 tempd
		}
		else
		{
			subvarvar tempe TEMPVAR3
			setvarvar tempd TEMPVAR3
			setvar TEMPVAR3 0
		}
	}
	else setvar tempd 0
	ifvarg tempd 0 { state enemyarmorshrapnelspecial setactorvar[FLOORFLAMEACTORDMGID].ACTORAPDAMAGED? 1 }
ends

state pythagoras_floorflame
	// next code gets distance between actortarget (x,y) and lightning (x,y), puts result in FLOORFLAMEDISTANCE
	getactor[THISACTOR].x temp
	getactor[FLOORFLAMEACTORDMGID].x tempb
	
	subvarvar temp tempb
	mulvarvar temp temp
	
	getactor[THISACTOR].y tempc
	getactor[FLOORFLAMEACTORDMGID].y tempd
	
	subvarvar tempc tempd
	mulvarvar tempc tempc
	
	addvarvar temp tempc
	sqrt temp temp
	setvarvar FLOORFLAMEDISTANCE temp
ends


state floorflamedmgdisplays
	getactorvar[PLAYERID].VEHICLEID TEMPVAR2
	ifvare TEMPVAR2 -1 setvarvar TEMPVAR3 CURRENTARMORPOINTS else getactorvar[TEMPVAR2].ACTORAP TEMPVAR3
	
	ifvarg TEMPVAR3 0
	{
		ifvarn player[THISACTOR].over_shoulder_on 0
		{
			ifvarg tempd 0
			{
				setvarvar SHOWDAMAGE tempd
				setvar SHOWDAMAGETYPE 1
				setvarvar SHOWDAMAGEACTORID PLAYERID
				state showdamage
			}
		}
		ifvarg tempd 0
		{
			setvar ATTACKINGACTORPICNUM 2333
			getactor[THISACTOR].pal TEMP
			setvarvar ATTACKINGACTORPAL TEMP
			setvar ACTORCRITICAL? 0
			setvarvar PLAYERARMORDAMAGETEMP tempd
			setactor[THISACTOR].htpicnum -1
			ifvare TEMPVAR2 -1 setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
			setvar ATTACKERDISPLAYTIMER 0 setvar ARMORNULLDAMAGE 0
			setvar ARMORDAMAGETIMER 0
		}
		else
		{
			ifvarl tempe 1 sound NODAMAGE
			setvar ATTACKINGACTORPICNUM 2333
			getactor[THISACTOR].pal TEMP
			setvarvar ATTACKINGACTORPAL TEMP
			setvar ACTORCRITICAL? 0
			setvarvar PLAYERARMORDAMAGETEMP tempd
			setactor[THISACTOR].htpicnum -1
			ifvare TEMPVAR2 -1 setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
			setvar ATTACKERDISPLAYTIMER 0 setvar ARMORNULLDAMAGE 1
			setvar ARMORDAMAGETIMER 0
		}
	}
	
	ifvarn player[THISACTOR].over_shoulder_on 0
	{
		ifvarg tempe 0
		{
			setvarvar SHOWDAMAGE tempe
			setvar SHOWDAMAGETYPE 0
			setvarvar SHOWDAMAGEACTORID PLAYERID
			state showdamage
		}
	}
	
	ifvarg tempe 0
	{
		setvarvar PAINSOUNDFACTOR tempe
		state checkpainfactor
	
		getactorvar[PLAYERID].VEHICLEID TEMPVAR2
		ifvare TEMPVAR2 -1
		{
			state characterpainsounds
			setvarvar DAMAGEHUEFACTOR TEMPVAR2
			state playerdamagehues-firetype
		}
		else palfrom 32 0 16
	
		setvar ATTACKINGACTORPICNUM 2333
		getactor[THISACTOR].pal TEMP
		setvarvar ATTACKINGACTORPAL TEMP
		setvar ACTORCRITICAL? 0
		setvarvar PLAYERDAMAGETEMP tempe
		setactor[THISACTOR].htpicnum -1
		ifvare TEMPVAR2 -1 setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
		setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
		setvar HEALTHDAMAGETIMER 0
	}
	else
	{
		sound NODAMAGE
		setvar ATTACKINGACTORPICNUM 2333
		getactor[THISACTOR].pal TEMP
		setvarvar ATTACKINGACTORPAL TEMP
		setvar ACTORCRITICAL? 0
		setvarvar PLAYERDAMAGETEMP tempe
		setactor[THISACTOR].htpicnum -1
		ifvare TEMPVAR2 -1 setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
		setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 1
		setvar HEALTHDAMAGETIMER 0
	}
ends

state floorflamedetectifdead_heat
	ifvarn FLOORFLAMEACTORDMGID -1
	{ 
		ifvarl actorvar[FLOORFLAMEACTORDMGID].ACTORHP 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[FLOORFLAMEACTORDMGID].SHRUNK? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[FLOORFLAMEACTORDMGID].EXPANDING? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[FLOORFLAMEACTORDMGID].FROZEN? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[FLOORFLAMEACTORDMGID].CLOAKED? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_floorflame
		ifvarg FLOORFLAMEDISTANCE 9216 { setvar FLOORFLAMEACTORDMGID -1 break }
	}
ends

state floorflamedetectifdead
	ifvarn FLOORFLAMEACTORDMGID -1
	{ 
		ifvarn actorvar[FLOORFLAMEACTORDMGID].DRIVERID -1 { setvar FLOORFLAMEACTORDMGID -1 break } // Vehicles only
		ifvarl actorvar[FLOORFLAMEACTORDMGID].ACTORHP 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is dead, set to -1 to search for a living one
		ifvare actorvar[FLOORFLAMEACTORDMGID].SHRUNK? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is shrunken, set to -1 to search for a non-shrunken one
		ifvare actorvar[FLOORFLAMEACTORDMGID].EXPANDING? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is expanding, set to -1 to search for a non-shrunken one
		ifvare actorvar[FLOORFLAMEACTORDMGID].FROZEN? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is frozen, set to -1 to search for a non-frozen one
		ifvare actorvar[FLOORFLAMEACTORDMGID].CLOAKED? 1 { setvar FLOORFLAMEACTORDMGID -1 break } // Makes it that if the current "target" is cloaked, set to -1 to search for a non-cloaked one
		state pythagoras_floorflame
		ifvarg FLOORFLAMEDISTANCE 1024 { setvar FLOORFLAMEACTORDMGID -1 break }
	}
ends

state floorflame_damagesounds
	ifvarg TEMPVAR2 0
	{
	getactor[FLOORFLAMEACTORDMGID].picnum temp
	setvarvar TEMP5 FLOORFLAMEACTORDMGID
	state monsterdamagesounds
	}
ends

state toughgalspeech
	ifrnd 64 { ifnosounds soundonce TOUGHGALSND1 }
	else ifrnd 64 { ifnosounds soundonce TOUGHGALSND2 }
	else ifrnd 64 { ifnosounds soundonce TOUGHGALSND3 }
	else ifnosounds soundonce TOUGHGALSND4
ends

move MOUSEVELS 32

state scrap1
	debris SCRAP3 4
	debris SCRAP1 3
	debris SCRAP4 2
	debris SCRAP2 2
	debris SCRAP5 1
ends

state piratebreak1
	debris SCRAP2 10
	debris SCRAP1 5
	debris SCRAP3 3
	lotsofglass 10
ends

state dcflaskbreak
	ifrnd 85 lotsofglass 4 else ifrnd 128 lotsofglass 5 else lotsofglass 6
	ifrnd 128 sound GLASS_BREAKING else sound GLASS_HEAVYBREAK
ends

state breakobject
	ifaction 0
	{
		action ANULLACTION
		cstator 257
		ifactor ROBOTMOUSE
			clipdist 64
	}
	else
	ifactor ROBOTMOUSE
	{
		ifdead
		{
			ifcount 32
			{
				ifvare CHARACTERSELECTED? 1 globalsound MOUSEANNOY
				killit
			}
			break
		}
		ifcount 64 ifrnd 6
		{
			ifrnd 128
				move MOUSEVELS randomangle geth
			else
			{
				ifrnd 64
					soundonce HAPPYMOUSESND1
				else ifrnd 64
					soundonce HAPPYMOUSESND2
				else ifrnd 64
					soundonce HAPPYMOUSESND3
				else
					soundonce HAPPYMOUSESND4
			}
			resetcount
		}
	}
	
	ifhitweapon
	{
		ifdead
		{
			ifactor FOODOBJECT6 state jibfood
			else ifactor FOODOBJECT11 state jibfood
			else ifactor FOODOBJECT12 state jibfood
			else ifactor FOODOBJECT13 state jibfood
			else ifactor FOODOBJECT14 state jibfood
			else ifactor FOODOBJECT15 state jibfood
			else ifactor FOODOBJECT16 state jibfood
			else ifactor FOODOBJECT17 state jibfood
			else ifactor SKINNEDCHICKEN state jibfood
			else ifactor BARSTOOL sound VENT_BUST
			else
			ifactor TABLE
			{
				sound GLASS_HEAVYBREAK  
				debris SCRAP1 5
				debris SCRAP2 5
				debris SCRAP3 5
				ifrnd 128 cactor BARBROKE
			}
			else
			ifactor SHOPPINGCART
			{
				debris SCRAP1 5
				debris SCRAP2 5
				debris SCRAP3 5
				sound GLASS_HEAVYBREAK
				killit
			}
			else
			ifactor ROBOTDOG
			{
				soundonce DEAD_DOG
				guts JIBS2 1
				guts JIBS3 2
				guts JIBS6 3
				randvar RANKPOINTSTEMP DOGKILLRANKPOINTSRAND 
				addvar RANKPOINTSTEMP DOGKILLRANKPOINTSSOLID 
				setvar TEMPVAR 1
				state drop_artifacts
				state checkkillerofciv
				state expmulti
				state exp_given
				killit
			}
			else
			ifactor ROBOTDOG2
			{
				soundonce DEAD_DOG
				guts JIBS2 1
				guts JIBS3 2
				guts JIBS6 3
				randvar RANKPOINTSTEMP DOGKILLRANKPOINTSRAND 
				addvar RANKPOINTSTEMP DOGKILLRANKPOINTSSOLID 
				setvar TEMPVAR 1
				state drop_artifacts
				state checkkillerofciv
				state expmulti
				state exp_given
				killit
			}
			else
			ifactor PRESIDENTCLINTON // Kills the player if they Clinton is killed [since he is supposed to be saved, not killed]
			{
				guts JIBS2 1
				guts JIBS3 2
				guts JIBS6 3
				soundonce MALENPC_DEATH1
				state drop_artifacts
				setvar INSTANTDEATH 1
				killit
			}
			else
			ifactor FEATHEREDCHICKEN
				state jibfood
			else
			ifactor DOLPHIN1
			{
				state civjibs
				state jibfood
			}
			else
			ifactor DOLPHIN2
			{
				state civjibs
				state jibfood
			}
			else
			ifactor SNAKEP
			{
				state civjibs
				state jibfood
			}
			else 
			ifactor DONUTS
			{
				debris SCRAP1 1
				spritepal 7
				guts JIBS6 2
				ifvarand ACTORFLAGS 4096 state pickupexplosion
				ifvarand ACTORFLAGS 8192 state pickupexplosion
				killit
			}
			else 
			ifactor DONUTS2
			{
				spritepal 7
				guts JIBS6 2
				ifvarand ACTORFLAGS 4096 state pickupexplosion
				ifvarand ACTORFLAGS 8192 state pickupexplosion
				killit
			}
			else 
			ifactor VIDEO1
			{
				debris SCRAP3 3
				debris SCRAP4 2
				lotsofglass 30
			}
			else 
			ifactor VIDEO3
			{
				debris SCRAP3 3
				debris SCRAP4 2
				lotsofglass 30
			}
			else
			ifactor VIDEO2
			{
				debris SCRAP3 3
				debris SCRAP4 2
				lotsofglass 30
			}
			else
			ifactor E-GLASS
			{
				state scrap1
				sound GLASS_HEAVYBREAK
				lotsofglass 30
			}
			else
			ifactor HERMIT
			{
				state scrap1
				lotsofglass 10
			}
			else
			ifactor WOLFDUDE
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor COP1
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor COP2
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor PUNKDUDE
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor SITTINGDUDE
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DANCE1
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DANCE2
			{
				soundonce LADY_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DANCE3
			{
				soundonce LADY_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DANCE5
			{
				soundonce LADY_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DANCE6
			{
				soundonce LADY_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DANCE7
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor OTTO
			{
				soundonce DOLPHINSND
				state drop_artifacts
				state civjibs
				state scrap1
				state jibfood
			}
			else
			ifactor DANCE9
			{
				soundonce LADY_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor BODY1
			{
				soundonce MALENPC_DEATH1
				sound SQUISHED
				state civjibs
				state jibfood
			}
			else
			ifactor BODY2
			{
				sound SQUISHED
				state civjibs
				state jibfood
			}
			else
			ifactor BODY3
			{
				sound SQUISHED
				state civjibs
				state jibfood
			}
			else
			ifactor STAND1
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor DEALER
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor STAND3
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor STAND4
			{
				soundonce MALENPC_DEATH1
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor ANIMEGIRL1
			{
				soundonce ANIMEGIRL_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor ANIMEGIRL2
			{
				soundonce ANIMEGIRL_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor ANIMEGIRL3
			{
				soundonce ANIMEGIRL_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor ANIMEGIRL4
			{
				soundonce ANIMEGIRL_SCREAM    
				state drop_artifacts
				state civiliankilled
			}
			else
			ifactor MAILBAG
			{
				mail 30
				ifrnd 2 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 16 state gemring_drops
				debris SCRAP3 5
				debris SCRAP4 3
				killit
			}
			else
			ifactor TEDDYBEAR
			{
				debris SCRAP3 5
				spritepal 1
				debris SCRAP3 6
			}
			else
			{
				ifrnd 128
					sound GLASS_BREAKING
				else
					sound GLASS_HEAVYBREAK
			}
	
			ifactor CLOCK
			{
				cactor BROKENCLOCK
				break
			}
			else
			ifactor JOLLYMEAL
			{
				spawn ATOMICHEALTH
				debris SCRAP3 1
				debris SCRAP4 2
			}
			else
			ifactor GUMBALLMACHINE
			{
				cactor GUMBALLMACHINEBROKE
				strength 1
				debris SCRAP4 2
				lotsofglass 10
				break
			}
			else
			ifactor GUMBALLMACHINEBROKE
			{
				debris SCRAP3 3
				debris SCRAP4 2
				lotsofglass 10
			}
			else
			ifactor DUKEBURGER
			{
				debris SCRAP3 14
				debris SCRAP1 13
				debris SCRAP4 12
				debris SCRAP2 12
				debris SCRAP5 11
			}
			else
			ifactor POLICELIGHTPOLE state scrap1
			else
			ifactor TOPSECRET
				paper 10
			else
			ifactor GUNPOWDERBARREL
			{
				spawn EXPLOSION2
				sound PIPEBOMB_EXPLODE
				hitradius 2048 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
				ifpdistl 2048
					wackplayer
				debris SCRAP1 10
				debris SCRAP2 13
				debris SCRAP3 4
				debris SCRAP4 17
				debris SCRAP5 6
			}
			else
			ifactor FLOORBASKET
			{
				spawn PUKE
				debris SCRAP1 2
				debris SCRAP3 3
				debris SCRAP4 2
			}
			else
			ifactor CHESTOFGOLD
			{
				debris SCRAP1 2
				debris SCRAP3 3
				debris SCRAP4 2
				state gemring_drops
				ifrnd 224 state gemring_drops
				ifrnd 192 state gemring_drops
				ifrnd 160 state gemring_drops
				ifrnd 128 state gemring_drops
				ifrnd 128 state gemring_drops
				ifrnd 96 state gemring_drops
				ifrnd 96 state gemring_drops
				ifrnd 64 state gemring_drops
				ifrnd 64 state gemring_drops
				ifrnd 32 state gemring_drops
				ifrnd 32 state gemring_drops
				ifrnd 16 state gemring_drops
				ifrnd 16 state gemring_drops
				ifrnd 16 state gemring_drops
				ifrnd 16 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 8 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifrnd 4 state gemring_drops
				ifvarand ACTORFLAGS 128 ifrnd 32 espawn SHIKONJEWEL
			}
			else
			ifactor ROBOTMOUSE
			{
				debris SCRAP2 10
				spritepal 1
				debris SCRAP3 4
				resetcount
				cstat 32768
				break
			}
			else
			ifactor ROBOTPIRATE
				state piratebreak1
			else
			ifactor PIRATE1A
				state piratebreak1
			else
			ifactor MAN
				state piratebreak1
			else
			ifactor MAN2
				state piratebreak1
			else
			ifactor PIRATE2A
				state piratebreak1
			else
			ifactor PIRATE3A
				state piratebreak1
			else
			ifactor PIRATE4A
				state piratebreak1
			else
			ifactor PIRATE4A
				state piratebreak1
			else
			ifactor PIRATE5A
				state piratebreak1
			else
			ifactor PIRATE6A
				state piratebreak1
			else
			ifactor DCFLASK1EMPTY
				state dcflaskbreak
			else
			ifactor DCFLASK1FILLED
				state dcflaskbreak
			else
			ifactor DCFLASK2EMPTY
				state dcflaskbreak
			else
			ifactor DCFLASK2FILLED
				state dcflaskbreak
			else
			ifactor DCFLASK3EMPTY
				state dcflaskbreak
			else
			ifactor DCFLASK3FILLED
				state dcflaskbreak
			else
			ifactor DCVIALS1
				state dcflaskbreak
			else
			ifactor DCTUBES1
				state dcflaskbreak
			else
			ifactor DCFLASK4FILLED
				state dcflaskbreak
			else
			ifactor DCFLASK5FILLED
			{
				ifrnd 85 lotsofglass 5 else ifrnd 128 lotsofglass 6 else lotsofglass 7
				ifrnd 128 sound GLASS_BREAKING else sound GLASS_HEAVYBREAK
			}
			else
			ifactor DCFLASK6FILLED
			{
				ifrnd 85 lotsofglass 3 else ifrnd 128 lotsofglass 4 else lotsofglass 5
				ifrnd 128 sound GLASS_BREAKING else sound GLASS_HEAVYBREAK
			}
			else
			ifactor DCTUBES2
				state dcflaskbreak
			else
			ifactor DCTUBES3
			{
				state dcflaskbreak
				state dcflaskbreak
			}
			else
			{
				lotsofglass 10
				debris SCRAP4 3
			}
			killit
		}
		else
		ifactor DOLPHIN1
		{
			guts JIBS6 1
			soundonce DOLPHINSND
			ifstrength TOUGH
			{
				cactor DOLPHIN2
				sound SQUISHED
			}
		}
		else
		ifactor DOLPHIN2
		{
			guts JIBS6 1
			soundonce DOLPHINSND
		}
		else
		ifactor ROBOTDOG
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					guts JIBS6 1
					soundonce WHINING_DOG
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor ROBOTDOG2
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					guts JIBS6 1
					soundonce WHINING_DOG
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE1
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE2
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce LADY_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE3
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce LADY_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE5
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce LADY_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE6
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce LADY_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE7
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DANCE9
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce LADY_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor STAND1
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor STAND3
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor STAND4
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor DEALER
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor WOLFDUDE
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor PUNKDUDE
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor SITTINGDUDE
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor COP1
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor COP2
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor PRESIDENTCLINTON
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					ifrnd 85 soundonce MALENPC_PAIN1
					else ifrnd 128 soundonce MALENPC_PAIN2
					else soundonce MALENPC_PAIN3
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor ANIMEGIRL1
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce ANIMEGIRL_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor ANIMEGIRL2
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce ANIMEGIRL_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor ANIMEGIRL3
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce ANIMEGIRL_SCREAM
				}
				else sound NODAMAGE
			}
		}
		else
		ifactor ANIMEGIRL4
		{
			ifvarl ACTORINVULNTIME 1
			{
				ifvarg ACTORLASTDAMAGE 0
				{
					spawn BLOOD
					soundonce ANIMEGIRL_SCREAM
				}
				else sound NODAMAGE
			}
		}
	}
	else
	{
		ifactor CLOCK
			nullop
		else
		ifactor TOPSECRET
			nullop
		else
		ifactor SKINNEDCHICKEN
			nullop
		else
		ifactor FEATHEREDCHICKEN
			nullop
		else
		ifactor FOODOBJECT2
			nullop
		else
		ifactor FOODOBJECT6
			nullop
		else
		ifactor DOLPHIN1
			nullop
		else
		ifactor DOLPHIN2
			nullop
		else
		ifactor HERMIT
			nullop
		else
		ifactor VIDEO1
			nullop
		else
		ifactor VIDEO2
			nullop
		else
		ifactor VIDEO3
			nullop
		else
		ifactor BODY1
			nullop
		else
		ifactor BODY2
			nullop
		else
		ifactor BODY3
			nullop
		else
		ifactor E-GLASS
			nullop
		else
		ifactor ANIMEGIRL4
			nullop
		else
		ifvare mainmenu 0 fall
	}
ends

move RESPAWN_ACTOR_FLAG

state getcode
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		getactor[THISACTOR].picnum tempb
		switch tempb
			case SATCHEL_LARGE
			case SATCHEL_SMALL
			case MAXHPUP
			case MAXAPUP
			case MAXEPUP
			case MAXHPAPUP
			case ATKUP
			case DEFUP
			case ATKDEFUP
			case SPDUP
			case AIRTIMEBONUS
			case AIRJUMPBONUS
			case MANTLEBONUS
				state bonusgrab
				break  
		
			case FORTUNECOOKIE
				globalsound FORTUNECOOKIE1
				break
			
			case ATOMICHEALTH
				globalsound GETATOMICHEALTH
				break
			
			case SUPERATOM
				state superatomsounds
				break
			
			default
				globalsound DUKE_GET
				break
		endswitch
		palfrom 16 0 32
	}
	
	ifvare PUBLICBETA? 1
	{
		randvar CHARACTERARRAY 14
		addvar CHARACTERARRAY 1
		ifvarvare CHARACTERARRAY CHARACTERSELECTED? addvar SHRINKINGRESISTPLAYER 1
		else
		{
			getactorvar[CHARACTERARRAY].CHARACTERSHRINKINGRESIST tempd
			addvar tempd 1
			setactorvar[CHARACTERARRAY].CHARACTERSHRINKINGRESIST tempd
		}
	}
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	ifrespawn
	{
		move RESPAWN_ACTOR_FLAG
		spawn RESPAWNMARKERRED
		cstat 32768
	}
	else
	{
		state activationflag killit
	}
ends

state randgetweapsnds
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		ifvare CHARACTERSELECTED? 1
		{
			randvar RNDVOICE 4
			ifvare RNDVOICE 0
			{
				globalsound DUKE_GETWEAPON1 
				redefinequote 340 ^17Duke: Cool!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 1 
			{
				globalsound DUKE_GETWEAPON2 
				redefinequote 340 ^17Duke: Come get some!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 2 
			{
				globalsound DUKE_GETWEAPON3 
				redefinequote 340 ^17Duke: Groovy!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 3
			{
				globalsound DUKE_GETWEAPON4 
				redefinequote 340 ^17Duke: Who wants some?!?!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 4 
			{
				globalsound DUKE_GETWEAPON6 
				redefinequote 340 ^17Duke: Hail to the King, baby!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
		else
		ifvare CHARACTERSELECTED? 5
		{
			randvar RNDVOICE 4
			ifvare RNDVOICE 0
			{
				globalsound WANG_GETWEAPON1 
				redefinequote 340 ^15Higa: BANZAI!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 1 
			{
				globalsound WANG_GETWEAPON2 
				redefinequote 340 ^15Higa: Hehe-hahahaha!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 2
			{
				globalsound WANG_GETWEAPON3 
				redefinequote 340 ^15Higa: Ehehehehehehe...!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 3 
			{ 
				globalsound WANG_GETWEAPON4 
				redefinequote 340 ^15Higa: Ah-so!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 4 
			{ 
				globalsound WANG_GETWEAPON5 
				redefinequote 340 ^15Higa: Cowabunga!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
		else
		ifvare CHARACTERSELECTED? 8
		{
			randvar RNDVOICE 4
			ifvare RNDVOICE 0
			{
				globalsound LISA_GETWEAPON1
				redefinequote 340 ^7Lisa: Hmmm... this could be useful!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 1
			{
				globalsound LISA_GETWEAPON2
				redefinequote 340 ^7Lisa: Clear out... get out of my way!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 2
			{
				globalsound LISA_GETWEAPON3
				redefinequote 340 ^7Lisa: I just heard a collective gasp of alien fear!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 3
			{
				globalsound LISA_GETWEAPON4
				redefinequote 340 ^7Lisa: Lisa Bates: Judge, Jury AND Executioner!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 4
			{
				globalsound LISA_GETWEAPON5
				redefinequote 340 ^7Lisa: Time to give you alien scum the 'Boot To The Head'!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
		else
		ifvare CHARACTERSELECTED? 15
		{
			randvar RNDVOICE 4
			ifvare RNDVOICE 0
			{
				globalsound MAKEN_GETWEAPON1 
				redefinequote 340 ^10Maken: It's time to hack these guys to pieces!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 1
			{
				globalsound MAKEN_GETWEAPON2 
				redefinequote 340 ^10Maken: Death to the enemies of Maken Shinkara!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 2
			{
				globalsound MAKEN_GETWEAPON3 
				redefinequote 340 ^10Maken: Once I load this, I'll be on the warpath!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 3
			{
				globalsound MAKEN_GETWEAPON4 
				redefinequote 340 ^10Maken: Time to do a little alien reprogrammin'!!
				ifvare oldskoolmode 0 userquote 340
			}
			ifvare RNDVOICE 4
			{
				globalsound MAKEN_GETWEAPON5 
				redefinequote 340 ^10Maken: Just point and shoot! I love it!!
				ifvare oldskoolmode 0 userquote 340
			}
		}
		globalsound DUKE_GET
	}
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
ends

state getweaponcode
	state randgetweapsnds
	ifvarand ACTORFLAGS 2 nullop else palfrom 32 0 32
	ifrespawn
	{
		move RESPAWN_ACTOR_FLAG
		spawn RESPAWNMARKERRED
		cstat 32768
	}
	else
	{
		state activationflag killit
	}
ends

state respawnit
	ifcount RESPAWNITEMTIME
	{
		spawn TRANSPORTERSTAR
		move 0
		cstat 0
		sound TELEPORTER
	}
ends

state quikget
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		getactor[THISACTOR].picnum tempb
		switch tempb
			case SATCHEL_LARGE
			case SATCHEL_SMALL
			case MAXHPUP
			case MAXAPUP
			case MAXEPUP
			case MAXHPAPUP
			case ATKUP
			case DEFUP
			case ATKDEFUP
			case SPDUP
			case AIRTIMEBONUS
			case AIRJUMPBONUS
			case MANTLEBONUS
				state bonusgrab
				break  
		
			case FORTUNECOOKIE
				globalsound FORTUNECOOKIE1
				break
			
			case ATOMICHEALTH
				globalsound GETATOMICHEALTH
				break
			
			case SUPERATOM
				state superatomsounds
				break
			
			default
				globalsound DUKE_GET
				break
		endswitch
		palfrom 16 0 32
	}
	
	ifvare PUBLICBETA? 1
	{
		randvar CHARACTERARRAY 14
		addvar CHARACTERARRAY 1
		ifvarvare CHARACTERARRAY CHARACTERSELECTED? addvar SHRINKINGRESISTPLAYER 1
		else
		{
			getactorvar[CHARACTERARRAY].CHARACTERSHRINKINGRESIST tempd
			addvar tempd 1
			setactorvar[CHARACTERARRAY].CHARACTERSHRINKINGRESIST tempd
		}
	}
	setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
	state getworldtile
	state activationflag killit
ends

state quikweaponget
	state randgetweapsnds
	ifvarand ACTORFLAGS 2 nullop else palfrom 32 0 32
	state activationflag killit
ends

state checkartifacttimes
	ifvare FLAGSSET? 0
	{
		ifvarl POWERUPBENEFIT 1 setvar POWERUPBENEFIT 780
		setvarvar ACTORPICKUPAMOUNT POWERUPBENEFIT
		state checkpickupamountflags
		setvarvar POWERUPBENEFIT ACTORPICKUPAMOUNT
	
		setvar FLAGSSET? 1
	}
ends

state grabheatsensoritem
	state checkexplodeflag
	
	setvarvar NIGHTVISIONTIME HEAT_AMOUNT
	setplayer[THISACTOR].heat_amount NIGHTVISIONTIME 
	
	setvar ACTORPICKUPAMOUNT 1
	state checkpickupamountflags
	subvar ACTORPICKUPAMOUNT 1
	state checkheatsensors addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount
	
	ifvarand ACTORFLAGS 2 nullop
	else
	{
		ifvarg ACTORPICKUPAMOUNT 0
		{
			globalsound FOUND_INVENTORY
			redefinequote 836 ^20NIGHT VISION GOGGLES ^14[+%d ADDED TO INVENTORY!]
			qsprintf 836 836 ACTORPICKUPAMOUNT
			setvarvar fta fta_normal setvar ftq 836
		}
		else
		{
			setvarvar fta fta_normal setvar ftq 101
		}
	}
	ifspawnedby HEATSENSOR
		state getcode
	else
		state quikget
ends

state grabheatsensorinventory
	ifvarn oldskoolmode 1
	{
		setvarvar ACTORPICKUPAMOUNT 1
		state checkpickupamountflags
		state checkheatsensors addvarvar ITEMARRAYID_AMOUNTTEMP ACTORPICKUPAMOUNT state setitemidarrayamount
		ifvarand ACTORFLAGS 2 nullop
		else
		{
			ifvare ACTORPICKUPAMOUNT 1
			{
				redefinequote 836 ^14 STORED A PAIR OF NV GOGGLES INTO INVENTORY!
			}
			else
			{
				redefinequote 836 ^14 STORED %ld PAIRS OF NV GOGGLES INTO INVENTORY!
				qsprintf 836 836 ACTORPICKUPAMOUNT
			}
			setvarvar fta fta_normal setvar ftq 836
		}
		globalsound FOUND_INVENTORY
		ifspawnedby HEATSENSOR
			state getcode
		else
			state quikget
	}
ends

//

state refreshhealth2
	getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMP
	mulvar TEMP 2
	getactorvar[CHARACTERARRAY].CHARACTERHP temp
	ifvarvarg temp TEMP setvarvar temp TEMP
	setactorvar[CHARACTERARRAY].CHARACTERHP temp
	
	getactorvar[CHARACTERARRAY].CHARACTERMAXAP TEMP
	mulvar TEMP 2
	getactorvar[CHARACTERARRAY].CHARACTERAP temp
	ifvarvarg temp TEMP setvarvar temp TEMP
	setactorvar[CHARACTERARRAY].CHARACTERAP temp
	
	getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMP
	mulvar TEMP 2
	getactorvar[CHARACTERARRAY].CHARACTERFA temp
	ifvarvarg temp TEMP setvarvar temp TEMP
	setactorvar[CHARACTERARRAY].CHARACTERFA temp
	
	getactorvar[CHARACTERARRAY].CHARACTERAPABSORB TEMP
	ifvarg TEMP 1000 setvar TEMP 1000
	setactorvar[CHARACTERARRAY].CHARACTERAPABSORB TEMP
ends

state refreshhealthvalues
	ifvarn CHARACTERSELECTED? 1
	{
		setvar CHARACTERARRAY 1
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 2
	{
		setvar CHARACTERARRAY 2
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 3
	{
		setvar CHARACTERARRAY 3
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 4
	{
		setvar CHARACTERARRAY 4
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 5
	{
		setvar CHARACTERARRAY 5
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 6
	{
		setvar CHARACTERARRAY 6
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 7
	{
		setvar CHARACTERARRAY 7
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 8
	{
		setvar CHARACTERARRAY 8
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 9
	{
		setvar CHARACTERARRAY 9
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 10
	{
		setvar CHARACTERARRAY 10
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 11
	{
		setvar CHARACTERARRAY 11
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 12
	{
		setvar CHARACTERARRAY 12
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 13
	{
		setvar CHARACTERARRAY 13
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 14
	{
		setvar CHARACTERARRAY 14
		state refreshhealth2
	}
	ifvarn CHARACTERSELECTED? 15
	{
		setvar CHARACTERARRAY 15
		state refreshhealth2
	}
	
	ifvarl PLAYERHPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0 
		{
			ifvarn HPBARCHILD -1 
			{
				ifvare VEHICLEID -1 setactorvar[HPBARCHILD].HPBARFLASHTIMER -28
			}
		}
		setvar DISPLAYHPFLASHTIMER -28
		setvar PLAYERHPDAMAGED? 0
	}
	
	ifvarg PLAYERHPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn HPBARCHILD -1
			{
				ifvare VEHICLEID -1 setactorvar[HPBARCHILD].HPBARFLASHTIMER 28
			}
		}
		setvar DISPLAYHPFLASHTIMER 28
		setvar PLAYERHPDAMAGED? 0 
	}
	ifvarl DISPLAYHPFLASHTIMER 0 addvar DISPLAYHPFLASHTIMER 1 else ifvarg DISPLAYHPFLASHTIMER 0 subvar DISPLAYHPFLASHTIMER 1
	ifvarl DISPLAYFAFLASHTIMER 0 addvar DISPLAYFAFLASHTIMER 1 else ifvarg DISPLAYFAFLASHTIMER 0 subvar DISPLAYFAFLASHTIMER 1
	ifvarl PLAYERAPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn APBARCHILD -1
			{
				ifvare VEHICLEID -1 setactorvar[APBARCHILD].APBARFLASHTIMER -28
			}
		}
		setvar DISPLAYAPFLASHTIMER -28
		setvar PLAYERAPDAMAGED? 0
	}
	
	ifvarg PLAYERAPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn APBARCHILD -1
			{
				ifvare VEHICLEID -1 setactorvar[APBARCHILD].APBARFLASHTIMER 28
			}
		}
		setvar DISPLAYAPFLASHTIMER 28
		setvar PLAYERAPDAMAGED? 0
	}
	ifvarl DISPLAYAPFLASHTIMER 0 addvar DISPLAYAPFLASHTIMER 1 else ifvarg DISPLAYAPFLASHTIMER 0 subvar DISPLAYAPFLASHTIMER 1
	
	
	
	ifvarl VEHICLEHPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0 
		{
			ifvarn HPBARCHILD -1 
			{
				ifvarn VEHICLEID -1 setactorvar[HPBARCHILD].HPBARFLASHTIMER -28
			}
		}
		setvar VDISPLAYHPFLASHTIMER -28
		setvar VEHICLEHPDAMAGED? 0
	}
	
	ifvarg VEHICLEHPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn HPBARCHILD -1
			{
				ifvarn VEHICLEID -1 setactorvar[HPBARCHILD].HPBARFLASHTIMER 28
			}
		}
		setvar VDISPLAYHPFLASHTIMER 28
		setvar VEHICLEHPDAMAGED? 0 
	}
	ifvarl VDISPLAYHPFLASHTIMER 0 addvar VDISPLAYHPFLASHTIMER 1 else ifvarg VDISPLAYHPFLASHTIMER 0 subvar VDISPLAYHPFLASHTIMER 1
	ifvarl VDISPLAYFAFLASHTIMER 0 addvar VDISPLAYFAFLASHTIMER 1 else ifvarg VDISPLAYFAFLASHTIMER 0 subvar VDISPLAYFAFLASHTIMER 1
	
	
	ifvarl VEHICLEAPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn APBARCHILD -1
			{
				ifvarn VEHICLEID -1 setactorvar[APBARCHILD].APBARFLASHTIMER -28
			}
		}
		setvar VDISPLAYAPFLASHTIMER -28
		setvar VEHICLEAPDAMAGED? 0
	}
	
	ifvarg VEHICLEAPDAMAGED? 0
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn APBARCHILD -1
			{
				ifvarn VEHICLEID -1 setactorvar[APBARCHILD].APBARFLASHTIMER 28
			}
		}
		setvar VDISPLAYAPFLASHTIMER 28
		setvar VEHICLEAPDAMAGED? 0
	}
	ifvarl VDISPLAYAPFLASHTIMER 0 addvar VDISPLAYAPFLASHTIMER 1 else ifvarg VDISPLAYAPFLASHTIMER 0 subvar VDISPLAYAPFLASHTIMER 1
ends

//*****************************
//**Start of Money Radar Code**
//*****************************
state checkgemforbooby
	ifvarn GEMID -1
	{
		ifvarand actorvar[GEMID].ACTORFLAGS 16384 setvar GEMID -1 // Set to NOT appear on radar
		else
		{
		ifvarand actorvar[GEMID].ACTORFLAGS 4096 setvar GEMRIGGED 1
		else ifvarand actorvar[GEMID].ACTORFLAGS 8192 setvar GEMID -1
		else setvar GEMRIGGED 0
		}
	}
ends

state checkmoneyforbooby
	ifvarn MONEYID -1
	{
		getactor[MONEYID].picnum TEMPVAR
		ifvare TEMPVAR MONEYBAG
		{
			ifvarg actorvar[MONEYID].TEMP4 0 setvar MONEYID -1
			else setvar MONEYRIGGED 0
		}
		else
		{
			ifvarand actorvar[MONEYID].ACTORFLAGS 16384 setvar MONEYID -1 // Set to NOT appear on radar
			else
			{
				ifvarand actorvar[MONEYID].ACTORFLAGS 4096 setvar MONEYRIGGED 1
				else ifvarand actorvar[MONEYID].ACTORFLAGS 8192 setvar MONEYID -1
				else setvar MONEYRIGGED 0
			}
		}
	}
ends

// Gem-Detector
state gemfinder
	addvar GEMRTIME 1
	ifvarg GEMRTIME 3 // 6
	{
		setvar GEMRTIME 0
		// Gem-Detector
	
		// Very Short Range - 2048 Units
		findnearsprite GEMRINGGOLD 2048 GEMID state checkgemforbooby
		ifvare GEMID -1 findnearsprite GEMRINGSILVER 2048 GEMID state checkgemforbooby
	
		// Short Range - 4096 Units
		ifvare GEMID -1 findnearsprite GEMRINGGOLD 4096 GEMID state checkgemforbooby
		ifvare GEMID -1 findnearsprite GEMRINGSILVER 4096 GEMID state checkgemforbooby
	
		// Short-Medium Range - 8192 Units
		ifvare GEMID -1 findnearsprite GEMRINGGOLD 8192 GEMID state checkgemforbooby
		ifvare GEMID -1 findnearsprite GEMRINGSILVER 8192 GEMID state checkgemforbooby
	
		// Medium-Long Range - 16384 Units
		ifvare GEMID -1 findnearsprite GEMRINGGOLD 16384 GEMID state checkgemforbooby
		ifvare GEMID -1 findnearsprite GEMRINGSILVER 16384 GEMID state checkgemforbooby
	
		// Long Range - 32768 Units
		ifvare GEMID -1 findnearsprite GEMRINGGOLD 32768 GEMID state checkgemforbooby
		ifvare GEMID -1 findnearsprite GEMRINGSILVER 32768 GEMID state checkgemforbooby
	
		ifvare GEMID -1
		{
			setvar GEMANG -1 
			break
		}
		else
		{
			canseespr GEMID THISACTOR GEMSEE
		
			getactor[GEMID].x GEMX
			getplayer[THISACTOR].posx x
			subvarvar GEMX x
		
			getactor[GEMID].y GEMY
			getplayer[THISACTOR].posy y
			subvarvar GEMY y
		
			getangle GEMANG GEMX GEMY
			getplayer[THISACTOR].ang tempb
			subvarvar GEMANG tempb
			addvar GEMANG 1024
		
			ldist GEMDIST THISACTOR GEMID
			setvar temp 32768
			subvarvar temp GEMDIST
			ifvarl temp 6144 setvar temp 6144
			setvarvar GEMDIST temp
		}
	}
ends

// Money-Detector
state moneyfinder
	addvar MONEYRTIME 1
	ifvarg MONEYRTIME 3 // 6
	{
		setvar MONEYRTIME 0
		
		// Will Search for Highest Denominations first and Smallest ones last
		
		// Very Short Range - 2048 Units
		findnearsprite ONEBILLIONDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEMILLIONDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDTHOUSANDDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENTHOUSANDDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVETHOUSANDDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONETHOUSANDDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEHUNDREDDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite EIGHTYDOLLARBUNDLE 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIFTYDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWENTYDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARBUNDLE 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NINEDOLLARBUNDLE 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARBUNDLE 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARBUNDLE 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARS 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEDOLLAR 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite SACDOLLAR 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite HALFDOLLAR 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite QUARTER 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite DIME 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NICKEL 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite PENNY 2048 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite MONEYBAG 2048 MONEYID state checkmoneyforbooby
		// Short Range - 4096 Units
		ifvare MONEYID -1 findnearsprite ONEBILLIONDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEMILLIONDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDTHOUSANDDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENTHOUSANDDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVETHOUSANDDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONETHOUSANDDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEHUNDREDDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite EIGHTYDOLLARBUNDLE 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIFTYDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWENTYDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARBUNDLE 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NINEDOLLARBUNDLE 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARBUNDLE 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARBUNDLE 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARS 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEDOLLAR 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite SACDOLLAR 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite HALFDOLLAR 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite QUARTER 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite DIME 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NICKEL 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite PENNY 4096 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite MONEYBAG 4096 MONEYID state checkmoneyforbooby
		// Short-Medium Range - 8192 Units
		ifvare MONEYID -1 findnearsprite ONEBILLIONDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEMILLIONDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDTHOUSANDDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENTHOUSANDDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVETHOUSANDDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONETHOUSANDDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEHUNDREDDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite EIGHTYDOLLARBUNDLE 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIFTYDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWENTYDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARBUNDLE 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NINEDOLLARBUNDLE 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARBUNDLE 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARBUNDLE 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARS 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEDOLLAR 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite SACDOLLAR 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite HALFDOLLAR 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite QUARTER 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite DIME 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NICKEL 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite PENNY 8192 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite MONEYBAG 8192 MONEYID state checkmoneyforbooby
		// Medium-Long Range - 16384 Units
		ifvare MONEYID -1 findnearsprite ONEBILLIONDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEMILLIONDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDTHOUSANDDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENTHOUSANDDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVETHOUSANDDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONETHOUSANDDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEHUNDREDDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite EIGHTYDOLLARBUNDLE 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIFTYDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWENTYDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARBUNDLE 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NINEDOLLARBUNDLE 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARBUNDLE 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARBUNDLE 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARS 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEDOLLAR 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite SACDOLLAR 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite HALFDOLLAR 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite QUARTER 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite DIME 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NICKEL 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite PENNY 16384 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite MONEYBAG 16384 MONEYID state checkmoneyforbooby
		// Long Range - 32768 Units
		ifvare MONEYID -1 findnearsprite ONEBILLIONDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEMILLIONDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDTHOUSANDDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENTHOUSANDDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVETHOUSANDDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONETHOUSANDDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEHUNDREDDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEHUNDREDDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite EIGHTYDOLLARBUNDLE 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIFTYDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWENTYDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARBUNDLE 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TENDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NINEDOLLARBUNDLE 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARBUNDLE 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite FIVEDOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARBUNDLE 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite TWODOLLARS 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite ONEDOLLAR 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite SACDOLLAR 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite HALFDOLLAR 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite QUARTER 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite DIME 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite NICKEL 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite PENNY 32768 MONEYID state checkmoneyforbooby
		ifvare MONEYID -1 findnearsprite MONEYBAG 32768 MONEYID state checkmoneyforbooby
		
		ifvare MONEYID -1
		{
			setvar MONEYANG -1 
			break
		}
		else
		{
			canseespr MONEYID THISACTOR MONEYSEE
		
			getactor[MONEYID].x MONEYX
			getplayer[THISACTOR].posx x
			subvarvar MONEYX x
		
			getactor[MONEYID].y MONEYY
			getplayer[THISACTOR].posy y
			subvarvar MONEYY y
		
			getangle MONEYANG MONEYX MONEYY
			getplayer[THISACTOR].ang tempb
			subvarvar MONEYANG tempb
			addvar MONEYANG 1024
		
			ldist MONEYDIST THISACTOR MONEYID
			setvar temp 32768
			subvarvar temp MONEYDIST
			ifvarl temp 6144 setvar temp 6144
			setvarvar MONEYDIST temp
		}
	}
ends
//***************************
//**End of Money Radar Code**
//***************************

state charchecktriadrefractor
	getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	ifvarand TEMPVAR 32
	{
		subvar TEMPVAR 32
		setactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	}
ends

state charchecktriadragnarok
	getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	ifvarand TEMPVAR 64
	{
		subvar TEMPVAR 64
		setactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	}
ends

state charcheckaquaprotection
	getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	ifvarand TEMPVAR 256
	{
		subvar TEMPVAR 256
		setactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	}
ends

state charchecktriadblitzkrieg
	getactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	ifvarand TEMPVAR 2048
	{
		subvar TEMPVAR 2048
		setactorvar[CHARACTERARRAY].CHARACTERSTATUS? TEMPVAR
	}
ends

state setmoneyflags
	getsector[THISACTOR].ceilingz tempb
	getsector[THISACTOR].floorz tempc
	ifvarvarg tempb tempc { killit }
	getactor[THISACTOR].sectnum tempd ifvare tempd -1 { killit }
	
	ifvarg tempe 0 { killit } // for if a money item is "assimilated" into a nearby moneybag
	ifvare SKILLSET? 0
	{
		// Scatters money drops so they're not all on top of each other after spawn
		ifspritepal 0 
		{
			cstat 32
		
			// Sets X-coords
			setvar MISCARRAYID 227 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANDOMSPAWN-MOVEMENT
			setvar MISCARRAYID 224 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // RANDOMSPAWN-X
			getactor[THISACTOR].x MISCARRAYID_AMOUNTTEMP2
			randvar MISCARRAYID_AMOUNTTEMP 128  // Determines the x range
			ifrnd 128 addvarvar MISCARRAYID_AMOUNTTEMP2 MISCARRAYID_AMOUNTTEMP else subvarvar MISCARRAYID_AMOUNTTEMP2 MISCARRAYID_AMOUNTTEMP
			setactor[THISACTOR].x MISCARRAYID_AMOUNTTEMP2
			setvar MISCARRAYID 224 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // RANDOMSPAWN-X
			setvar MISCARRAYID 227 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANDOMSPAWN-MOVEMENT
		
			// Sets Y-coords
			setvar MISCARRAYID 227 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANDOMSPAWN-MOVEMENT
			setvar MISCARRAYID 225 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // RANDOMSPAWN-Y
			getactor[THISACTOR].y MISCARRAYID_AMOUNTTEMP2
			randvar MISCARRAYID_AMOUNTTEMP 128  // Determines the y range
			ifrnd 128 addvarvar MISCARRAYID_AMOUNTTEMP2 MISCARRAYID_AMOUNTTEMP else subvarvar MISCARRAYID_AMOUNTTEMP2 MISCARRAYID_AMOUNTTEMP
			setactor[THISACTOR].y MISCARRAYID_AMOUNTTEMP2
			setvar MISCARRAYID 225 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP2 // RANDOMSPAWN-Y
			setvar MISCARRAYID 227 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANDOMSPAWN-MOVEMENT
		
			// Sets Angle
			setvar MISCARRAYID 226 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANDOMSPAWN-ANGLE
			randvar MISCARRAYID_AMOUNTTEMP 2047 // Determines the facing angle
			setactor[THISACTOR].ang MISCARRAYID_AMOUNTTEMP
			setvar MISCARRAYID 226 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // RANDOMSPAWN-ANGLE
		}
		else 
		ifspritepal 3 cstat 32
		else cstat 16
	
		sizeat 1 1
		getactor[THISACTOR].cstat TEMP
		ifvarand TEMP 1 subvar TEMP 1
		ifvarand TEMP 256 subvar TEMP 256
		ifvarand TEMP 1024 nullop else addvar TEMP 1024
		setactor[THISACTOR].cstat TEMP
	
		setvar SKILLSET? 1
	}
ends

state bonusitemvarience
	setvarvar ITEMSEEKC temp
	ifvare PUBLICBETA? 0 divvar ITEMSEEKC 500 else divvar ITEMSEEKC 200
	ifspritepal 3 mulvar ITEMSEEKC 4
	ifspritepal 9 mulvar ITEMSEEKC 9
	setvarvar tempc temp
	ifvare PUBLICBETA? 0 divvar tempc 1000 else divvar tempc 400
	ifspritepal 3 mulvar tempc 4
	ifspritepal 9 mulvar tempc 9
	randvarvar tempb tempc
	ifrnd 128 addvarvar ITEMSEEKC tempb else subvarvar ITEMSEEKC tempb
	getactorvar[ITEMSEEK].ACTORLEVEL TEMP
	ifvarg TEMP 25 ifvarl TEMP 51 { mulvar ITEMSEEKC 3 divvar ITEMSEEKC 2 } 
	ifvarg TEMP 50 ifvarl TEMP 76 { mulvar ITEMSEEKC 4 divvar ITEMSEEKC 2 } 
	ifvarg TEMP 75 ifvarl TEMP 101 { mulvar ITEMSEEKC 5 divvar ITEMSEEKC 2 } 
	
	ifspritepal 9 { ifvarl ITEMSEEKC 9 setvar ITEMSEEKC 9 }
	else ifspritepal 3 { ifvarl ITEMSEEKC 4 setvar ITEMSEEKC 4 }
	else ifvarl ITEMSEEKC 1 setvar ITEMSEEKC 1
	ifvarand ACTORFLAGS 128 mulvar ITEMSEEKC 2
	ifvarand ACTORFLAGS 256 mulvar ITEMSEEKC 4
	addvarvar temp ITEMSEEKC
ends

state bonusgrabactor
	ifvarand ACTORFLAGS 4 nullop
	else
	{
		globalsound STATBONUSGRAB
	}
ends

state maxhpapbonusgive2
	getactorvar[ITEMSEEK].ACTORMAXHP temp
	ifvarg ITEMSEEKB 0
	{
		ifvarvarl temp STATLIMIT
		{
			state bonusitemvarience
			addvarvar ITEMSEEKB ITEMSEEKC
			ifvarvarg ITEMSEEKB STATLIMITMAXIMUM setvarvar ITEMSEEKB STATLIMITMAXIMUM
			ifvarvarg temp STATLIMIT setvarvar temp STATLIMIT
			setactorvar[ITEMSEEK].ACTORMAXHP temp
			ifvarand ACTORFLAGS 4 nullop else state showhealing_actorhp
		}
		setactorvar[ITEMSEEK].ACTORHP ITEMSEEKB
	
		getactorvar[ITEMSEEK].ACTORAP TEMPVAR3
		getactorvar[ITEMSEEK].ACTORMAXAP temp
		ifvarvarl temp STATLIMIT
		{
			state bonusitemvarience
			ifvarg TEMPVAR3 0 addvarvar TEMPVAR3 ITEMSEEKC
			ifvarvarg TEMPVAR3 STATLIMITMAXIMUM setvarvar TEMPVAR3 STATLIMITMAXIMUM
			ifvarvarg temp STATLIMIT setvarvar temp STATLIMIT
			setactorvar[ITEMSEEK].ACTORMAXAP temp
			ifvarand ACTORFLAGS 4 nullop else { ifvarg TEMPVAR3 0 state showhealing_actorap }
		}          
		setactorvar[ITEMSEEK].ACTORAP TEMPVAR3
		state resetitemtarget
		state bonusgrabactor
	
		state getitemseekerspecies
		ifvarand ACTORFLAGS 4 nullop
		else
		{
			ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT A MAX HP/AP BONUS! :(
			ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT A MAX HP/AP BONUS! :O
		}
		state enemygrabitemflash
		setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
		state getworldtile
	}
ends

state atkdefbonusgive2
	ifvarg ITEMSEEKB 0
	{
		getactorvar[ITEMSEEK].ACTORATTACK temp
		ifvarvarl temp STATLIMIT
		{
			state bonusitemvarience
			setactorvar[ITEMSEEK].ACTORATTACK temp
			state resetitemtarget
			state bonusgrabactor
		}
	
		getactorvar[ITEMSEEK].ACTORDEFENSE temp
		ifvarvarl temp STATLIMIT
		{
			state bonusitemvarience
			setactorvar[ITEMSEEK].ACTORDEFENSE temp
			state resetitemtarget
			state bonusgrabactor
		}
	
		state getitemseekerspecies
		ifvarand ACTORFLAGS 4 nullop
		else
		{
			ifvare ITEMSEEKSPECIESTYPE 0 redefinequote 185 ^10AN ENEMY GOT AN ATK/DEF BONUS! :(
			ifvare ITEMSEEKSPECIESTYPE 1 redefinequote 185 ^15A CIVILIAN GOT AN ATK/DEF BONUS! :O
		}
		state enemygrabitemflash
		setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
		state getworldtile
	}
ends

state hyperatomsetcharacter
	getactorvar[CHARACTERARRAY].CHARACTERHP temp
	ifvarg temp 0
	{
		setactorvar[CHARACTERARRAY].CHARACTERAPABSORB 1000
		getactorvar[CHARACTERARRAY].CHARACTERMAXHP TEMPVAR
		mulvar TEMPVAR 2
		ifvarvarg TEMPVAR STATLIMITATOMIC setvarvar TEMPVAR STATLIMITATOMIC
		setactorvar[CHARACTERARRAY].CHARACTERHP TEMPVAR
		getactorvar[CHARACTERARRAY].CHARACTERMAXAP TEMPVAR
		mulvar TEMPVAR 2
		ifvarvarg TEMPVAR STATLIMITATOMIC setvarvar TEMPVAR STATLIMITATOMIC
		setactorvar[CHARACTERARRAY].CHARACTERAP TEMPVAR
		mulvar TEMPVAR 2
		ifvarvarg TEMPVAR STATLIMITATOMIC setvarvar TEMPVAR STATLIMITATOMIC
		setactorvar[CHARACTERARRAY].CHARACTERFA TEMPVAR
	}
ends

state checklisamoney
	getactor[THISACTOR].pal tempi
	ifvarn RETURN -1 setactor[RETURN].pal tempi
	ifvare CHARACTERSELECTED? 8
	{
		ifvarvarl LISAMONEYTURNS LISAMONEYTURNS2 addvar LISAMONEYTURNS 1 else killit 
	}
	else killit 
ends

state killattachedobject
	ifvarn PARENTID -1
	{
		getactor[THISACTOR].picnum TEMP
		ifvare TEMP LEVELRANKSTAR setactorvar[PARENTID].STARCHILD -1
		else ifvare TEMP HPLIFEMETER setactorvar[PARENTID].HPBARCHILD -1
		else ifvare TEMP APLIFEMETER setactorvar[PARENTID].APBARCHILD -1
		else ifvare TEMP POWERUPICONSTRIP setactorvar[PARENTID].POWERUPSTRIPCHILD -1
		else ifvare TEMP POINTERARROW { setactorvar[PARENTID].POINTERICONCHILD -1 setactorvar[PARENTID].RADARARROWSET? 0 }
		setvar PARENTID -1
	}
	else
	{
		ifvarn MULTIICONPARENT -1
		{
			getactor[THISACTOR].picnum TEMP
			ifvare TEMP PICKUPMULTIICON setactorvar[MULTIICONPARENT].MULTIICONCHILD -1
			setvar MULTIICONPARENT -1
		}
	}
	setactor[THISACTOR].cstat 32768
	killit
ends

state checkattachedobjectstatus
	ifactor INVULNICON
	{
		ifvarn PARENTID -1
		{
			ifvarvarn PARENTID PLAYERID
			{
				ifvarn PARENTID -1 getactorvar[PARENTID].SKILLSET? TEMPVAR
				ifvarn TEMPVAR 0
				{ 
					ifvarn PARENTID -1 getactor[PARENTID].statnum TEMPVAR
					ifvare TEMPVAR 1024 
					{
						ifvarn PARENTID -1 setactor[PARENTID].extra -1
						state killattachedobject
					}
				}
			}
		}
	}
	else
	{
		setvar MISCARRAYID 74 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ATTACHED-OBJECTS?
		ifvarn MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarn PARENTID -1
			{
				ifvarvarn PARENTID PLAYERID
				{
					ifvarn PARENTID -1 getactorvar[PARENTID].SKILLSET? TEMPVAR
					ifvarn TEMPVAR 0
					{ 
						ifvarn PARENTID -1 getactor[PARENTID].statnum TEMPVAR
						ifvare TEMPVAR 1024 
						{
							ifvarn PARENTID -1 setactor[PARENTID].extra -1
							state killattachedobject
						}
					}
				}
			}
		}
		else
		{
			setactor[PARENTID].extra -1
			state killattachedobject
		}
	}
ends

state keypadhandscannerdamage
	ifvarand CHEATBITFIELD? 32 nullop else
	{
		ifvarl INVULNTIME 1
		{
			setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
			ifvare MISCARRAYID_AMOUNTTEMP 0
			{
				ifvarg xvelsav 0 setvarvar tempe xvelsav
				else ifvare xvelsav 0 break
				else ifvarl xvelsav 0
				{
					setvarvar tempe MAXHITPOINTS
					mulvarvar tempe xvelsav
					mulvar tempe -1
					divvar tempe 1000
				}
		
				ifvare extrasav -1 // Normal Damagetype
				{
					// Nyx Gloves Deterrant
					state nyxgloveschecker ifvare DAMAGEMODIFIER 0 palfrom 16 16 16 16
			
					ifvare CHARACTERSELECTED? 3
					{
						setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 1
						{
							mulvar tempe 2
							divvar tempe 5
						}
					}
					else
					ifvare CHARACTERSELECTED? 4
					{
						setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar tempe 4 divvar tempe 3 }
						else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar tempe 2
						else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar tempe 3
						ifvarand PLAYERSTATUS? 256
						{
							ifp pducking divvar tempe 25 else divvar tempe 5
						}
					}
					else
					ifvare CHARACTERSELECTED? 6
					{
						setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
							mulvar tempe 2
							divvar tempe 5
						}
					}
					else
					ifvare CHARACTERSELECTED? 9
					{
						mulvar tempe 3
						divvar tempe 5
					}
					else
					ifvare CHARACTERSELECTED? 13
					{
						setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar tempe 4 divvar tempe 3 }
						else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar tempe 2
						else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar tempe 3
					}
					else ifvare CHARACTERSELECTED? 14 divvar tempe 3
				}
				else
				ifvare extrasav 0 // Electrical Damagetype
				{
					sound SHORT_CIRCUIT state sparkstate
					// Nyx Gloves Deterrant
					state nyxgloveschecker ifvare DAMAGEMODIFIER 0 palfrom 16 32 32 32
			
					setvarvar TEMPDAMAGEVAR tempe
					state char_elecdamage_misc // Used by Player [ignores Drivable Tank checks]
					setvarvar tempe TEMPDAMAGEVAR
				}
				else
				ifvare extrasav 1 // Freezing Damagetype
				{
					// Nyx Gloves Deterrant
					state nyxgloveschecker ifvare DAMAGEMODIFIER 0 palfrom 16 0 0 32
			
					setvarvar TEMPDAMAGEVAR tempe
					state char_icedamage_misc // Used by Player [ignores Drivable Tank checks]
					setvarvar tempe TEMPDAMAGEVAR
					ifrnd 106 state addslow_overridevehicle
				}
				else
				ifvare extrasav 2 // Fire Damagetype
				{
					// Nyx Gloves Deterrant
					state nyxgloveschecker ifvare DAMAGEMODIFIER 0 palfrom 16 64 32
			
					setvarvar TEMPDAMAGEVAR tempe
					state char_firedamage_misc // Used by Player [ignores Drivable Tank checks]
					setvarvar tempe TEMPDAMAGEVAR
				}
				else
				ifvare extrasav 3 // Poison Damagetype
				{
					// Nyx Gloves Deterrant
					state nyxgloveschecker ifvare DAMAGEMODIFIER 0 palfrom 16 0 64
			
					ifvare CHARACTERSELECTED? 2
					{
						// Nyx Gloves Deterrant
						state nyxgloveschecker
						ifvare DAMAGEMODIFIER 0
						{
						mulvar tempe -4
						divvar tempe 3
						sound ABSORB_DAMAGE
						}
					}
					else
					ifvare CHARACTERSELECTED? 3
					{
						setvar MISCARRAYID 103 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // BUBSY-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 1
						{
						mulvar tempe 2
						divvar tempe 5
						}
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					ifvare CHARACTERSELECTED? 4
					{
						setvar MISCARRAYID 104 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // AMI-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar tempe 4 divvar tempe 3 }
						else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar tempe 2
						else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar tempe 3
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					ifvare CHARACTERSELECTED? 6
					{
						setvar MISCARRAYID 106 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // ESSENCE-FORM?
						ifvare MISCARRAYID_AMOUNTTEMP 0
						{
						mulvar tempe 2
						divvar tempe 5
						}
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					ifvare CHARACTERSELECTED? 8
					{
						ifvare HAVEENERGYSHIELD? 1 
						{
						ifvare ENERGYSHIELDMODE 1 
						{
							ifvarg DAMAGEINCELL 0 nullop
							else
							{
							// Nyx Gloves Deterrant
							state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
							}
						}
						else
						{
							// Nyx Gloves Deterrant
							state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
						}
						}
						else
						{
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
						}
					}
					else
					ifvare CHARACTERSELECTED? 9
					{
						mulvar tempe 3
						divvar tempe 5
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					ifvare CHARACTERSELECTED? 12
					{
						mulvar tempe 2
						divvar tempe 3
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					ifvare CHARACTERSELECTED? 13
					{
						setvar MISCARRAYID 113 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // MINAKO-FORM
						ifvare MISCARRAYID_AMOUNTTEMP 0 { mulvar tempe 4 divvar tempe 3 }
						else ifvare MISCARRAYID_AMOUNTTEMP 1 divvar tempe 2
						else ifvare MISCARRAYID_AMOUNTTEMP 2 divvar tempe 3
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					ifvare CHARACTERSELECTED? 14
					{
						divvar tempe 3
			
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
					else
					{
						// Nyx Gloves Deterrant
						state nyxgloveschecker ifvare DAMAGEMODIFIER 0 { ifrnd 212 state addpoison_overridevehicle }
					}
				}
		
				//*********************
				//*Check Malakian Gems*
				//*********************
				setvarvar TEMP7 tempe
				state malakiangemcheck 
				setvarvar tempe TEMP7
		     
				//****************
				//*Support System*
				//****************
				ifvarg tempe 0
				{
					setvar DAMAGEMODIFIER 1000
			   
					ifvare extrasav 0 // Electrical Damagetype
					{
						//**Electric Support / Nethra**
						state support-electricresist
					}
					ifvare extrasav 1 // Freeze Damagetype
					{
						//**Ice Support / Ami & Nethra**
						state support-iceresist
					}
					ifvare extrasav 2 // Fire Damagetype
					{
						//**Fire Support / Ted**
						state support-fireresist
					}
					ifvare extrasav 3 // Poison Damagetype
					{
						//**Poison Support / Jack**
						state support-poisonresist
					}
			   
					state damagemod-tempvar          
				}
		    
				//*********************************
				//*Support System [ESSence Support*
				//*********************************
				ifvarg tempe 0
				{
					setvar DAMAGEMODIFIER 1000
					//**Overall Support / ESSence**
					state support-overallresist
					state damagemod-tempvar          
				}
		    
				//******************
				//*Equipment System*
				//******************
				ifvarg tempe 0
				{
					setvar DAMAGEMODIFIER 1000
					ifvare extrasav 0 // Electrical Damagetype
					{
						ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #1
						ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #2
						ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #3
						ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #4
						ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #5
						ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #6
						ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #7
						ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -238 // Plasma Ring - Equipment Slot #8
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
					}
					ifvare extrasav 1 // Freeze Damagetype
					{
						ifvare PLAYEREQUIPSLOTITEM1 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #1
						ifvare PLAYEREQUIPSLOTITEM2 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #2
						ifvare PLAYEREQUIPSLOTITEM3 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #3
						ifvare PLAYEREQUIPSLOTITEM4 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #4
						ifvare PLAYEREQUIPSLOTITEM5 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #5
						ifvare PLAYEREQUIPSLOTITEM6 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #6
						ifvare PLAYEREQUIPSLOTITEM7 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #7
						ifvare PLAYEREQUIPSLOTITEM8 2 addvar DAMAGEMODIFIER -225 // Aqua Ring - Equipment Slot #8
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
					}
					ifvare extrasav 2 // Fire Damagetype
					{
						ifvare PLAYEREQUIPSLOTITEM1 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #1
						ifvare PLAYEREQUIPSLOTITEM2 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #2
						ifvare PLAYEREQUIPSLOTITEM3 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #3
						ifvare PLAYEREQUIPSLOTITEM4 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #4
						ifvare PLAYEREQUIPSLOTITEM5 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #5
						ifvare PLAYEREQUIPSLOTITEM6 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #6
						ifvare PLAYEREQUIPSLOTITEM7 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #7
						ifvare PLAYEREQUIPSLOTITEM8 1 addvar DAMAGEMODIFIER -250 // Sun Ring - Equipment Slot #8
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
					}
					/*      
					ifvare extrasav 3 // Poison Damagetype
					{
					}
					*/      
					state damagemod-tempvar          
				}
				// Nyx Gloves Deterrant
				ifvarg tempe 0
				{
					state nyxgloveschecker
					ifvarg DAMAGEMODIFIER 0 setvar tempe 0
				}
		    
				ifvare DAMAGEMODIFIER 0 { ifvarand CHEATBITFIELD? 16 { ifvarg tempe 1 { divvar tempe 1000 ifvarl tempe 1 setvar tempe 1 state cheatersound } } }
		    
				setvarvar TEMPDAMAGEVAR tempe
				state lisashield_misc
				setvarvar tempe TEMPDAMAGEVAR
		    
				setvarvar tempb CURRENTHITPOINTS
				subvarvar tempb tempe
				ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
				else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
				ifvarl tempb 0 setvar tempb 0
				ifvarvarg tempb MAXHITPOINTSATOMIC setvarvar tempb MAXHITPOINTSATOMIC
				setactor[PLAYERID].htpicnum -1
				setvarvar CURRENTHITPOINTS tempb
				state checkbuddhamode
		    
				ifvarn player[THISACTOR].over_shoulder_on 0
				{
					ifvarg CELLDAMAGETEMP 0
					{
						setvarvar SHOWDAMAGE CELLDAMAGETEMP
						setvar SHOWDAMAGETYPE 2
						setvarvar SHOWDAMAGEACTORID PLAYERID
						state showdamage
					}
				}
				ifvarg FULLSHIELDDAMAGE 0
				{
					ifactor KEYPAD setvar ATTACKINGACTORPICNUM KEYPAD
					ifactor COMPACTHANDSCANNER setvar ATTACKINGACTORPICNUM COMPACTHANDSCANNER
					ifactor COMPACTHANDSCANNER2 setvar ATTACKINGACTORPICNUM COMPACTHANDSCANNER2
					ifactor HANDSCANNER setvar ATTACKINGACTORPICNUM HANDSCANNER
					ifactor HANDSCANNER2 setvar ATTACKINGACTORPICNUM HANDSCANNER2
					ifactor NEWPLUG setvar ATTACKINGACTORPICNUM NEWPLUG
					getactor[THISACTOR].pal TEMP
					setvarvar ATTACKINGACTORPAL TEMP
					setvar ACTORCRITICAL? 0
					setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
					ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
				}
		    
				ifvarg tempe 0
				{
					ifvarn player[THISACTOR].over_shoulder_on 0
					{
						setvarvar SHOWDAMAGE tempe
						setvar SHOWDAMAGETYPE 0
						setvarvar SHOWDAMAGEACTORID PLAYERID
						state showdamage
					}
				}
				else ifvarl tempe 0
				{
					setvarvar TEMPHEALTH tempe
					mulvar TEMPHEALTH -1
					state showhealing_playerhp
				}
				
				ifvarg tempe 0
				{
					setvarvar PAINSOUNDFACTOR tempe
					state checkpainfactor
				
					ifactor KEYPAD setvar ATTACKINGACTORPICNUM KEYPAD
					ifactor COMPACTHANDSCANNER setvar ATTACKINGACTORPICNUM COMPACTHANDSCANNER
					ifactor COMPACTHANDSCANNER2 setvar ATTACKINGACTORPICNUM COMPACTHANDSCANNER2
					ifactor HANDSCANNER setvar ATTACKINGACTORPICNUM HANDSCANNER
					ifactor HANDSCANNER2 setvar ATTACKINGACTORPICNUM HANDSCANNER2
					ifactor NEWPLUG setvar ATTACKINGACTORPICNUM NEWPLUG
					getactor[THISACTOR].pal TEMP
					setvarvar ATTACKINGACTORPAL TEMP
					setvar ACTORCRITICAL? 0
					setvarvar PLAYERDAMAGETEMP tempe
					setactor[THISACTOR].htpicnum -1
					setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
					setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
					ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
				
					state characterpainsounds
				
					setvarvar DAMAGEHUEFACTOR tempe
					ifvare extrasav -1 state playerdamagehues-normaltype
					else ifvare extrasav 0 state playerdamagehues-electrictype
					else ifvare extrasav 1 state playerdamagehues-icetype
					else ifvare extrasav 2 state playerdamagehues-firetype
					else ifvare extrasav 3 state playerdamagehues-acidtype
				}
			}
		}
		else
		{
			ifvarn xvelsav 0
			{
				sound INVULNITEM3
				palfrom 16 16 16 16
			}
		}
	}
ends

action SCANNEROFF 0
action SCANNERON 1

state loadhandscanner
	getactor[THISACTOR].hitag hitagsav // makes the passcode
	getactor[THISACTOR].lotag lotagsav // lotag to activate/deactivate
	getactor[THISACTOR].extra extrasav // damage type [-1 = Normal, 0 = Electrical, 1 = Freeze, 2 = Fire, etc] 
	getactor[THISACTOR].xvel xvelsav // security damage (when incorrect code is entered) [+ = exact, - = %-based] 
	getactor[THISACTOR].yvel yvelsav // sound that plays when handscanner fails [0 defaults to Tripbomb Beep]
	getactor[THISACTOR].zvel zvelsav // sound that plays when handscanner succeeds [0 defaults to Handscanner sound]
	ifvare yvelsav 0 setvar yvelsav 16
	ifvare zvelsav 0 setvar zvelsav 495
	setactor[THISACTOR].hitag 0
	setactor[THISACTOR].lotag 0 
	setactor[THISACTOR].extra 0 
	setactor[THISACTOR].xvel 0 
	setactor[THISACTOR].yvel 0 
	setactor[THISACTOR].zvel 0 
ends

state characterusescannersuccess
	globalsound SCANNER_SUCCESS
	getplayer[THISACTOR].i temp
	operateactivators lotagsav 0 // temp 
	operatemasterswitches lotagsav
	operaterespawns lotagsav
	state checkforforcefields
	globalsoundvar zvelsav
	redefinequote 334 ^23ACCESS GRANTED!
	setvarvar fta fta_normal setvar ftq 334
	action SCANNERON
	setvar tempe 26
ends

state characterusescannerfail
	globalsound LASERTRIP_ARMING
	ifvare CHARACTERSELECTED? 1 redefinequote 334 ^10DUKE CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 2 redefinequote 334 ^10JACK CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 3 redefinequote 334 ^10BUBSY CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 4 redefinequote 334 ^10AMI CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 5 redefinequote 334 ^10HIGA CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 6 redefinequote 334 ^10ESSENCE CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 7 redefinequote 334 ^10TED CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 8 redefinequote 334 ^10LISA CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 9 redefinequote 334 ^10CYBANIS CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 10 
	{ 
		setvar MISCARRAYID 110 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // NETHRA-FORM?
		ifvare MISCARRAYID_AMOUNTTEMP 0 redefinequote 334 ^10NETHRA CANNOT ACCESS THIS SCANNER!
		ifvare MISCARRAYID_AMOUNTTEMP 1 redefinequote 334 ^10CHRISTINA CANNOT ACCESS THIS SCANNER!
	}
	ifvare CHARACTERSELECTED? 11 redefinequote 334 ^10PAULA CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 12 redefinequote 334 ^10LORI CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 13 redefinequote 334 ^10MINAKO CANNOT ACCESS THIS SCANNER!
	ifvare CHARACTERSELECTED? 14
	{
		ifvare PUBLICBETA? 0
		{
			redefinequote 334 ^10NAFERIA CANNOT ACCESS THIS SCANNER!
		}
		else
		{
			ifvare debugtoggle 0 redefinequote 334 ^10??????? CANNOT ACCESS THIS SCANNER!
			ifvarg debugtoggle 0 redefinequote 334 ^10HINOTORI CANNOT ACCESS THIS SCANNER!          
		}
	}
	ifvare CHARACTERSELECTED? 15 redefinequote 334 ^10MAKEN CANNOT ACCESS THIS SCANNER!
	setvarvar fta fta_normal setvar ftq 334
	globalsoundvar yvelsav
	state keypadhandscannerdamage
	action SCANNEROFF
	setvar tempe 0
ends

state handscannercode
	state useswitchcheckwall
	ifactor HANDSCANNER
	{
		setvar OBJECTWIDTH 32
		setvar OBJECTHEIGHT 32
	}
	ifactor HANDSCANNER2
	{
		setvar OBJECTWIDTH 32
		setvar OBJECTHEIGHT 32
	}
	ifactor HANDSCANNER
	{
		setvar OBJECTWIDTH 32
		setvar OBJECTHEIGHT 32
	}
	ifactor COMPACTHANDSCANNER
	{
		setvar OBJECTWIDTH 23
		setvar OBJECTHEIGHT 24
	}
	ifactor COMPACTHANDSCANNER2
	{
		setvar OBJECTWIDTH 23
		setvar OBJECTHEIGHT 24
	}
	state getspritecenterz
	setvarvar KEYSCANNERZUP OBJECTCENTERZ
	subvarvar KEYSCANNERZUP OBJECTDIFF2
	setvarvar KEYSCANNERZDOWN OBJECTCENTERZ
	addvarvar KEYSCANNERZDOWN OBJECTDIFF2
	
	ifvarg tempe 0 subvar tempe 1
	else { ifaction SCANNERON action SCANNEROFF }
	
	ifpdistl 1536
	{
		ifvare TEMP2 1
		{
			ifp pfacing
			{
				ifhitspace
				{
					ifcansee 
					{
						getactor[PLAYERID].z temp
						subvar temp 6144
						ifvarvarg temp KEYSCANNERZUP
						ifvarvarl temp KEYSCANNERZDOWN
						ifvare com_pause 0 // There are lot of conditions on this line. The last one is there to ensure proper timing. 
						{ 
							state stopsearchsounds
				
							ifvare CHARACTERSELECTED? 1 { ifvarand hitagsav 1 state characterusescannersuccess else state characterusescannerfail } // Checks Duke if he's the current character...
							ifvare CHARACTERSELECTED? 2 { ifvarand hitagsav 2 state characterusescannersuccess else state characterusescannerfail } // Checks Jack if he's the current character...
							ifvare CHARACTERSELECTED? 3 { ifvarand hitagsav 4 state characterusescannersuccess else state characterusescannerfail } // Checks Bubsy if he's the current character...
							ifvare CHARACTERSELECTED? 4 { ifvarand hitagsav 8 state characterusescannersuccess else state characterusescannerfail } // Checks Ami if she's the current character...
							ifvare CHARACTERSELECTED? 5 { ifvarand hitagsav 16 state characterusescannersuccess else state characterusescannerfail } // Checks Higa if he's the current character...
							ifvare CHARACTERSELECTED? 6 { ifvarand hitagsav 32 state characterusescannersuccess else state characterusescannerfail } // Checks ESSence if he's the current character...
							ifvare CHARACTERSELECTED? 7 { ifvarand hitagsav 64 state characterusescannersuccess else state characterusescannerfail } // Checks Ted if he's the current character...
							ifvare CHARACTERSELECTED? 8 { ifvarand hitagsav 128 state characterusescannersuccess else state characterusescannerfail } // Checks Lisa if she's the current character...
							ifvare CHARACTERSELECTED? 9 { ifvarand hitagsav 256 state characterusescannersuccess else state characterusescannerfail } // Checks Cybanis if he's the current character...
							ifvare CHARACTERSELECTED? 10 { ifvarand hitagsav 512 state characterusescannersuccess else state characterusescannerfail } // Checks Christina if she's the current character...
							ifvare CHARACTERSELECTED? 11 { ifvarand hitagsav 1024 state characterusescannersuccess else state characterusescannerfail } // Checks Paula if she's the current character...
							ifvare CHARACTERSELECTED? 12 { ifvarand hitagsav 2048 state characterusescannersuccess else state characterusescannerfail } // Checks Lori if she's the current character...
							ifvare CHARACTERSELECTED? 13 { ifvarand hitagsav 4096 state characterusescannersuccess else state characterusescannerfail } // Checks Minako if she's the current character...
							ifvare CHARACTERSELECTED? 14 { ifvarand hitagsav 8192 state characterusescannersuccess else state characterusescannerfail } // Checks ???????? if she's the current character...
							ifvare CHARACTERSELECTED? 15 { ifvarand hitagsav 16384 state characterusescannersuccess else state characterusescannerfail } // Checks Maken if she's the current character...
							setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
							state getworldtile
							setvar com_pause 10 // This sets a delay between presses of space so that everything doesn't happen at once.
						}
					}
				}
			}
		}
	}
ends

action ACCESSOFF 0
action ACCESSON 1

state character_keycard_sounds
	ifvare CHARACTERSELECTED? 1
	{
		randvar RNDVOICE 3
		ifvare RNDVOICE 0
		{
			sound DUKE_KEYCARD1 
			redefinequote 340 ^17Duke: Mother[BEEP] keycards!! 
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 1
		{
			sound DUKE_KEYCARD2 
			redefinequote 340 ^17Duke: Surprise, surprise... I need a keycard!
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 2
		{
			sound DUKE_KEYCARD3 
			redefinequote 340 ^17Duke: These colored keycards suck!!
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 3
		{
			sound DUKE_KEYCARD4 
			redefinequote 340 ^17Duke: Someone's gonna pay for making me find these friggin... keycards!!
			ifvare oldskoolmode 0 userquote 340
		}
	}
	ifvare CHARACTERSELECTED? 8
	{
		randvar RNDVOICE 3
		ifvare RNDVOICE 0
		{
			sound LISA_KEYCARD1 
			redefinequote 340 ^7Lisa: Ah... I need another freaking key?! Argh... [incoherent grumbling]
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 1
		{
			sound LISA_KEYCARD2 
			redefinequote 340 ^7Lisa: Red key... Blue key... Yellow key... SCREW KEYS!!!
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 2
		{
			sound LISA_KEYCARD3 
			redefinequote 340 ^7Lisa: Arrrgh!!! Now I know how players in most video games feel...!
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 3
		{
			sound LISA_KEYCARD4 
			redefinequote 340 ^7Lisa: Son of a BITCH!! Why does every door need a key these days?!
			ifvare oldskoolmode 0 userquote 340
		}
	}
	ifvare CHARACTERSELECTED? 15
	{
		randvar RNDVOICE 3
		ifvare RNDVOICE 0
		{
			sound MAKEN_KEYCARD1 
			redefinequote 340 ^10Maken: [grumbles]... Looks like I can't hack this... I need a stupid key! [more incoherant grumbling]
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 1
		{
			sound MAKEN_KEYCARD2 
			redefinequote 340 ^10Maken: Key hunts are not, and NEVER will be fun, you ASSHOLES!!
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 2
		{
			sound MAKEN_KEYCARD3 
			redefinequote 340 ^10Maken: If I have to find another friggin' key, I'M GONNA LOSE IT!!
			ifvare oldskoolmode 0 userquote 340
		}
		ifvare RNDVOICE 3
		{
			sound MAKEN_KEYCARD4 
			redefinequote 340 ^10Maken: How do so many keys just get tossed around carelessly anyway?!
			ifvare oldskoolmode 0 userquote 340
		}
	}
ends

state keyscannerarraycheck
	setvar ARRAYPOSITION 0 // Sprite IDs >.>
	whilevarn ARRAYPOSITION 16383
	{
		getactor[ARRAYPOSITION].statnum tempb
		ifvarn tempb 1024
		{
			getactor[ARRAYPOSITION].picnum tempb
			ifvarg tempb 4086 ifvarl tempb 4091 // ACCESSSWITCH3/ACCESSSWITCH4
			{
				getactorvar[ARRAYPOSITION].lotagsav tempb
				ifvarvare lotagsav tempb setactorvar[ARRAYPOSITION].tempe 1
			}
		}
		
		addvar ARRAYPOSITION 1
		ifvarg ARRAYPOSITION 16383 break
	}
ends

state keyscannerstart
	setplayer[THISACTOR].access_incs 1
	setvarvar tempc THISACTOR
	setplayer[THISACTOR].access_spritenum tempc
ends

state keyscannercode // For both ACCESSWITCH3 and ACCESSSWITCH4
	ifvare SKILLSET? 0 { action ACCESSOFF setvar SKILLSET? 1 }
	ifvare tempe 0 action ACCESSOFF else action ACCESSON
	getplayer[THISACTOR].access_incs tempd
	state useswitchcheckwall
	
	setvar OBJECTWIDTH 64
	setvar OBJECTHEIGHT 32
	state getspritecenterz
	setvarvar KEYSCANNERZUP OBJECTCENTERZ
	subvarvar KEYSCANNERZUP OBJECTDIFF2
	setvarvar KEYSCANNERZDOWN OBJECTCENTERZ
	addvarvar KEYSCANNERZDOWN OBJECTDIFF2
	
	ifvare tempd 0 
	{
		ifvare mainmenu 0
		{
			ifpdistl 2048 ifvare TEMP2 1
			{
				ifp pfacing
				{
					ifhitspace
					{
						ifcansee 
						{
							getactor[PLAYERID].z temp
							subvar temp 6144
							ifvarvarg temp KEYSCANNERZUP
							ifvarvarl temp KEYSCANNERZDOWN
							ifvare com_pause 0 // There are lot of conditions on this line. The last one is there to ensure proper timing. 
							{ 
								state stopsearchsounds
								ifaction ACCESSOFF
								{
									ifspritepal 0
									{
										ifvarand ACCESSCARDS? 1 state keyscannerstart
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^16BLUE^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									else
									ifspritepal 21
									{
										ifvarand ACCESSCARDS? 2 state keyscannerstart
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^21RED^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									else
									ifspritepal 23
									{
										ifvarand ACCESSCARDS? 4 state keyscannerstart
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^23YELLOW^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									else
									ifspritepal 22
									{
										ifvarand ACCESSCARDS? 8
										{
											state keyscannerstart
											setvar param 8
										}
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^22GREEN^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									else
									ifspritepal 12
									{
										ifvarand ACCESSCARDS? 16
										{
											state keyscannerstart
											setvar param 16
										}
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^12SILVER^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									else
									ifspritepal 15
									{
										ifvarand ACCESSCARDS? 32
										{
											state keyscannerstart
											setvar param 32
										}
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^15BROWN^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									else
									ifspritepal 24
									{
										ifvarand ACCESSCARDS? 64
										{
											state keyscannerstart
											setvar param 64
										}
										else
										{
											ifvare CHARACTERSELECTED? 15 state keyscannerstart
											else
											{
												redefinequote 334 ^24BLOODY^0 ACCESS CARD REQUIRED
												setvarvar fta fta_normal setvar ftq 334
												state character_keycard_sounds
											}
										}
									}
									setvar com_pause 10 // This sets a delay between presses of space so that everything doesn't happen at once.
								}
							}
						}
					}
				}
			}
		}
	} // ifvare tempd
	//

	ifvarvare tempc THISACTOR
	{
		getplayer[THISACTOR].access_incs TEMP
		ifvarg TEMP 0 setplayer[THISACTOR].movement_lock 31 else setplayer[THISACTOR].movement_lock 0
	
		ifvare TEMP 12
		{
			getplayer[THISACTOR].i temp
			operateactivators lotagsav 0 // temp
			operatemasterswitches lotagsav
			operaterespawns lotagsav
			state checkforforcefields
			ifvarn CHARACTERSELECTED? 15 subvarvar ACCESSCARDS? param
			setvar param 0
			setplayer[THISACTOR].got_access ACCESSCARDS?
	
			setvar MISCARRAYID 24 setactorvar[MISCARRAYID].MISCARRAYID_AMOUNT 0 // WORLDTILE-SHUFFLES
			state getworldtile
			redefinequote 334 ^23UNLOCKED
			setvarvar fta fta_normal setvar ftq 334
			ifvare hitagsav 0 soundonce SWITCH_ON
			else soundoncevar hitagsav
			action ACCESSON
	
			state keyscannerarraycheck
	
		}
	
		ifvare TEMP 21
		{
			setplayer[THISACTOR].movement_lock 0
			setvar tempc -1
			setplayer[THISACTOR].access_spritenum tempc
		}
	}
ends

state spawnairbubble-more
	ifvare sector[THISACTOR].lotag 2
	{
		espawn AIRBUBBLE
		state bubblesounds
		getactor[THISACTOR].z TEMP
		addvar TEMP -1024
		setactor[RETURN].z TEMP
		setactorvar[RETURN].temp temp
		setactorvar[RETURN].tempb tempb
		setactorvar[RETURN].tempc tempc
		setactor[RETURN].cstat 2
	}
ends

state spawnairbubble
	ifvarg framerate 24 state spawnairbubble-more
	else
	{
		ifrnd 32
		{
			ifvarg framerate 6 state spawnairbubble-more
			else
			{
				ifrnd 32 state spawnairbubble-more
			}
		}
	}
ends

state radararrow
	ifvare oldskoolmode 0
	{
		state itemfullbright
	
		getactor[PARENTID].sectnum temp
		ifvarn temp -1 ifvarl temp 4096
		{
			getactor[PARENTID].x tempb
			setactor[THISACTOR].x tempb
			getactor[PARENTID].y tempb
			setactor[THISACTOR].y tempb
			getactor[PARENTID].z tempb
			setactor[THISACTOR].z tempb
			changespritesect THISACTOR temp
		}
	
		getactorvar[PARENTID].ACTORLEVEL RANKSTARLEVEL
		ifvare RANKSTARLEVEL 0 setactor[THISACTOR].pal 15
		ifvarg RANKSTARLEVEL 0 ifvarl RANKSTARLEVEL 11 setactor[THISACTOR].pal 0
		ifvarg RANKSTARLEVEL 10 ifvarl RANKSTARLEVEL 21 setactor[THISACTOR].pal 16
		ifvarg RANKSTARLEVEL 20 ifvarl RANKSTARLEVEL 31 setactor[THISACTOR].pal 22
		ifvarg RANKSTARLEVEL 30 ifvarl RANKSTARLEVEL 41 setactor[THISACTOR].pal 14
		ifvarg RANKSTARLEVEL 40 ifvarl RANKSTARLEVEL 51 setactor[THISACTOR].pal 12
		ifvarg RANKSTARLEVEL 50 ifvarl RANKSTARLEVEL 61 setactor[THISACTOR].pal 13
		ifvarg RANKSTARLEVEL 60 ifvarl RANKSTARLEVEL 71 setactor[THISACTOR].pal 23
		ifvarg RANKSTARLEVEL 70 ifvarl RANKSTARLEVEL 81 setactor[THISACTOR].pal 7
		ifvarg RANKSTARLEVEL 80 ifvarl RANKSTARLEVEL 91 setactor[THISACTOR].pal 21
		ifvarg RANKSTARLEVEL 90 ifvarl RANKSTARLEVEL 100 setactor[THISACTOR].pal 10
		ifvare RANKSTARLEVEL 100
		{
			setvar MISCARRAYID 89 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // shade-pulse-timer
			switch MISCARRAYID_AMOUNTTEMP
				case 0 case 1 setactor[THISACTOR].pal 13 break
				case 2 case 3 case 22 case 23 setactor[THISACTOR].pal 12 break
				case 4 case 5 case 20 case 21 setactor[THISACTOR].pal 17 break
				case 6 case 7 case 18 case 19 setactor[THISACTOR].pal 21 break
				case 8 case 9 case 16 case 17 setactor[THISACTOR].pal 15 break
				case 10 case 11 case 14 case 15 setactor[THISACTOR].pal 14 break
				case 12 case 13 setactor[THISACTOR].pal 16 break
			endswitch
		}
	
		getactor[PARENTID].ang temp
		setactor[THISACTOR].ang temp
	
		// X-Size
		getactor[PARENTID].xrepeat temp
		getactorvar[PARENTID].ACTORFLAGS tempc
		ifvarand tempc 512 // Elite Monsters will have larger arrows than normal monsters
		{
			getactor[PARENTID].xrepeat tempe
			divvar tempe 2
			addvarvar temp tempe
		}
		divvar temp 4
		setactor[THISACTOR].xrepeat temp
		// Y-Size
		getactor[PARENTID].yrepeat temp
		getactorvar[PARENTID].ACTORFLAGS tempc
		ifvarand tempc 512 // Elite Monsters will have larger arrows than normal monsters
		{
			getactor[PARENTID].yrepeat tempe
			divvar tempe 2
			addvarvar temp tempe
		}
		divvar temp 4
		setactor[THISACTOR].yrepeat temp
	
		ifvare AMI? 1
		{
			setvar MISCARRAYID 78 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // HAVE-MERCURY-COMPUTER?
			ifvare MISCARRAYID_AMOUNTTEMP 1
			{
				ifvare debugtoggle 0
					setactor[THISACTOR].cstat 32800 // Sets Flat and Invisible "invisible sprites are still visible on automap if flat"
				else
					setactor[THISACTOR].cstat 32 // Sets Flat
			}
			else
			{
				ifvare debugtoggle 0
					setactor[THISACTOR].cstat 32768 // Sets Invisible
				else
					setactor[THISACTOR].cstat 32 // Sets Flat
			}
		}
		else
		{
			ifvare debugtoggle 0
				setactor[THISACTOR].cstat 32768 // Sets Invisible
			else
				setactor[THISACTOR].cstat 32 // Sets Flat
		}
	}
	else setactor[THISACTOR].cstat 32768 // Sets Invisible
ends

state iconpositioning
	getactor[PARENTID].x TESTX 
	getactor[PARENTID].y TESTY
	getactor[PARENTID].z TESTZ
	getactor[PARENTID].xrepeat TESTXREPEAT1 
	getactor[PARENTID].yrepeat TESTYREPEAT1 
	getactorvar[PARENTID].ACTORSHEIGHT LIFEMETERZ
	mulvarvar LIFEMETERZ TESTYREPEAT1
	mulvar LIFEMETERZ 4
	setvarvar EXTRAZ TESTYREPEAT1
	mulvar EXTRAZ 4
	getactor[PARENTID].picnum TEMP
	ifvare TEMP APLAYER 
	{
		getactor[PARENTID].cstat TEMP
		ifvarand TEMP 8
		{
			getactorvar[PLAYERID].VEHICLEID TEMPVAR3
			ifvare TEMPVAR3 -1
			{
				ifvare CHARACTERSELECTED? 6 mulvar EXTRAZ 68  
				else ifvare CHARACTERSELECTED? 9 mulvar EXTRAZ 72
				else mulvar EXTRAZ 24
			}
			else mulvar EXTRAZ 40
		
			mulvar EXTRAZ -1
			mulvar LIFEMETERZ -1 
		}
		else
		{
			getactorvar[PLAYERID].VEHICLEID TEMPVAR3
			ifvare TEMPVAR3 -1
			{
				ifvare CHARACTERSELECTED? 6 mulvar EXTRAZ 76
				else ifvare CHARACTERSELECTED? 9 mulvar EXTRAZ 80
				else mulvar EXTRAZ 32
			}
			else mulvar EXTRAZ 48
		}
	} 
	else
	ifvare TEMP NAKED1 // NAKED1 is already "Upside Down"
	{
		getactor[PARENTID].cstat TEMP
		ifvarand TEMP 8 mulvar EXTRAZ 24 
		else
		{
			mulvar EXTRAZ 28
			mulvar EXTRAZ -1
			mulvar LIFEMETERZ -1 
		}
	} 
	else
	{
		getactor[PARENTID].cstat TEMP
		ifvarand TEMP 8
		{
			mulvar EXTRAZ 28
			mulvar EXTRAZ -1
			mulvar LIFEMETERZ -1 
		}
		else mulvar EXTRAZ 24 
	}
	subvarvar TESTZ LIFEMETERZ // Subtract from the original Z var
	subvarvar TESTZ EXTRAZ // Subtract from the original Z var
	state itemfullbright
	divvar TESTXREPEAT1 4
	setactor[THISACTOR].xrepeat TESTXREPEAT1
	divvar TESTYREPEAT1 4
	setactor[THISACTOR].yrepeat TESTYREPEAT1
	ifvarvare PARENTID PLAYERID addvarvar TESTZ VIEWCAMERAZDIFF
	
	getactor[PARENTID].sectnum TEMP3
	ifvarn TEMP3 -1
	{
		setactor[THISACTOR].x TESTX
		setactor[THISACTOR].y TESTY 
		setactor[THISACTOR].z TESTZ
		changespritesect THISACTOR TEMP3
	}
ends

action ICONSTRIP0
action ICONSTRIP1 1
action ICONSTRIP2 2
action ICONSTRIP3 3
action ICONSTRIP4 4
action ICONSTRIP5 5
action ICONSTRIP6 6
action ICONSTRIP7 7
action ICONSTRIP8 8
action ICONSTRIP9 9
action ICONSTRIP10 10
action ICONSTRIP11 11
action ICONSTRIP12 12
action ICONSTRIP13 13
action ICONSTRIP14 14
action ICONSTRIP15 15
action ICONSTRIP16 16
action ICONSTRIP17 17
action ICONSTRIP18 18
action ICONSTRIP19 19
action ICONSTRIP20 20
action ICONSTRIP21 21
action ICONSTRIP22 22
action ICONSTRIP23 23
action ICONSTRIP24 24
action ICONSTRIP25 25
action ICONSTRIP26 26
action ICONSTRIP27 27
action ICONSTRIP28 28
action ICONSTRIP29 29
action ICONSTRIP30 30
action ICONSTRIP31 31

state iconstripconditions
	ifvare oldskoolmode 0
	{
		ifvare lifebartogglemode 1
		{
			state iconpositioning
		
			setactor[THISACTOR].cstat 0
			getactor[PARENTID].picnum tempb
			ifvare tempb APLAYER
			{
				ifvare actorvar[PLAYERID].VEHICLEID -1 getactorvar[PARENTID].POWERUPBITFIELD tempe else getactorvar[TEMPVAR3].ACTORPOWERUPBITFIELD tempe
			}
			else getactorvar[PARENTID].ACTORPOWERUPBITFIELD tempe
		
			ifvare tempe 0 state killattachedobject // action ICONSTRIP0
			ifvare tempe 1 action ICONSTRIP1
			ifvare tempe 2 action ICONSTRIP2
			ifvare tempe 3 action ICONSTRIP3
			ifvare tempe 4 action ICONSTRIP4
			ifvare tempe 5 action ICONSTRIP5
			ifvare tempe 6 action ICONSTRIP6
			ifvare tempe 7 action ICONSTRIP7
			ifvare tempe 8 action ICONSTRIP8
			ifvare tempe 9 action ICONSTRIP9
			ifvare tempe 10 action ICONSTRIP10
			ifvare tempe 11 action ICONSTRIP11
			ifvare tempe 12 action ICONSTRIP12
			ifvare tempe 13 action ICONSTRIP13
			ifvare tempe 14 action ICONSTRIP14
			ifvare tempe 15 action ICONSTRIP15
			ifvare tempe 16 action ICONSTRIP16
			ifvare tempe 17 action ICONSTRIP17
			ifvare tempe 18 action ICONSTRIP18
			ifvare tempe 19 action ICONSTRIP19
			ifvare tempe 20 action ICONSTRIP20
			ifvare tempe 21 action ICONSTRIP21
			ifvare tempe 22 action ICONSTRIP22
			ifvare tempe 23 action ICONSTRIP23
			ifvare tempe 24 action ICONSTRIP24
			ifvare tempe 25 action ICONSTRIP25
			ifvare tempe 26 action ICONSTRIP26
			ifvare tempe 27 action ICONSTRIP27
			ifvare tempe 28 action ICONSTRIP28
			ifvare tempe 29 action ICONSTRIP29
			ifvare tempe 30 action ICONSTRIP30
			ifvare tempe 31 action ICONSTRIP31
		}
		else setactor[THISACTOR].cstat 32768 // state killattachedobject
	}
	else setactor[THISACTOR].cstat 32768 // state killattachedobject
ends

state artipickupsounds
	ifvare CHARACTERSELECTED? 5 // Lo Wang
	{
		ifrnd 32 sound WANG_GRABART8
		else ifrnd 36 sound WANG_GRABART7
		else ifrnd 43 sound WANG_GRABART6
		else ifrnd 51 sound WANG_GRABART5
		else ifrnd 64 sound WANG_GRABART4
		else ifrnd 85 sound WANG_GRABART3
		else ifrnd 128 sound WANG_GRABART2
		else sound WANG_GRABART1
	}
ends

state freezeblast-freezefloors2
	getactor[THISACTOR].sectnum tempc
	ifvare actorvar[tempc].SUBMERGABLESECTOR? 0
	{
		ifvare actorvar[tempc].FLOORFREEZABLE? 1
		{
			ifvare actorvar[tempc].FLOORTEMPFREEZESTATE 0
			{
				iffloordistl 8
				{
					getactor[THISACTOR].extra TEMPVAR
					setvarvar TEMP PLAYERATTACK
					ifp ponsteroids { mulvar TEMP 4 divvar TEMP 3 }
					else { mulvar TEMP 3 divvar TEMP 4 }
					addvarvar TEMPVAR TEMP
					ifvare CHARACTERSELECTED? 4 mulvar TEMPVAR 3
					else ifvare CHARACTERSELECTED? 8 { mulvar TEMPVAR 7 divvar TEMPVAR 4 }
					else ifvare CHARACTERSELECTED? 10 mulvar TEMPVAR 2
					ifvarg QUADTIME 0 mulvar TEMPVAR 4
					ifvare PLAYEREQUIPSLOTITEM1 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM2 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM3 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM4 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM5 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM6 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM7 28 mulvar TEMPVAR 10
					ifvare PLAYEREQUIPSLOTITEM8 28 mulvar TEMPVAR 10
					divvar TEMPVAR 2
					getactorvar[tempc].FLOORHEALTH tempd
					subvarvar tempd TEMPVAR
			
					setvar TEMPVAR7 0
					ifvare tempb NEWFLOORPLASMA setvar TEMPVAR7 1
					else ifvare tempb HOTLAVA setvar TEMPVAR7 1
					else ifvare tempb MEGALAVA setvar TEMPVAR7 1
					else ifvare tempb ULTRALAVA setvar TEMPVAR7 1
					else ifvare tempb HYPERMAGMA setvar TEMPVAR7 1
					else ifvare tempb 336 setvar TEMPVAR7 2
					else ifvare tempb 3784 setvar TEMPVAR7 2
					else ifvare tempb 3800 setvar TEMPVAR7 2
					else ifvare tempb 3815 setvar TEMPVAR7 2
			
					ifvare TEMPVAR7 1
					{
						ifrnd 85 sound LANDLAVA_HEAVY
						else ifrnd 128 sound LANDLAVA_LIGHT
						else sound LANDLAVA
						espawn SMALLSMOKE
					}
					else
					{
						addvar SOUNDPITCH -768
						setplayer[THISACTOR].sound_pitch SOUNDPITCH
						sound ICE_HISS
						subvar SOUNDPITCH -768
						setplayer[THISACTOR].sound_pitch SOUNDPITCH
					}
			
					ifvare CHARACTERSELECTED? 4 setvar TEMPVAR4 60 
					else ifvare CHARACTERSELECTED? 8 setvar TEMPVAR4 40
					else ifvare CHARACTERSELECTED? 10 setvar TEMPVAR4 45
					else setvar TEMPVAR4 30
					setactor[RETURN].xrepeat TEMPVAR4 setactor[RETURN].yrepeat TEMPVAR4
			
					setactor[RETURN].cstat 514
					ifvarl tempd 0 setvar tempd 0
					setactorvar[tempc].FLOORHEALTH tempd
					getactorvar[tempc].FLOORMAXHEALTH tempg
					ifvare tempd 0 ifvarg tempg 1
					{
						ifvarg tempc -1 ifvarl tempc 4096
						{
							setsector[tempc].floorpicnum actorvar[tempc].FLOORTEMPFREEZENUMBERB
							setsector[tempc].lotag actorvar[tempc].FLOORTEMPLOTAGB
							sound SOMETHINGFROZE
							setactorvar[tempc].FLOORFREEZETIME 138
							setactorvar[tempc].FLOORTEMPFREEZESTATE 1
						}
					}
					killit
				}
			}
		}  
	}
ends

state freezeblast-freezefloors
	getsector[THISACTOR].lotag temp
	ifvare temp 2 nullop
	else getsector[THISACTOR].floorpicnum tempb
	
	ifvare tempb NEWFLOORPLASMA state freezeblast-freezefloors2
	else ifvare tempb HOTLAVA state freezeblast-freezefloors2
	else ifvare tempb MEGALAVA state freezeblast-freezefloors2
	else ifvare tempb ULTRALAVA state freezeblast-freezefloors2
	else ifvare tempb HYPERMAGMA state freezeblast-freezefloors2
	else ifvare tempb 336 state freezeblast-freezefloors2
	else ifvare tempb 3784 state freezeblast-freezefloors2
	else ifvare tempb 3800 state freezeblast-freezefloors2
	else ifvare tempb 3815 state freezeblast-freezefloors2
ends

state pipebombexplodeonlava
	addstrength 1 setactor[THISACTOR].htextra 1
ends

state pipebomb-checkfloor
	getsector[THISACTOR].lotag temp
	ifvare temp 2 getsector[THISACTOR].ceilingpicnum tempb else getsector[THISACTOR].floorpicnum tempb
	
	ifvare tempb NEWFLOORPLASMA
	{
		ifvare temp 2 { ifrnd 16 state pipebombexplodeonlava } else { iffloordistl 4 { ifrnd 16 state pipebombexplodeonlava } }
	}
	else
	ifvare tempb HOTLAVA
	{
		ifvare temp 2 { ifrnd 64 state pipebombexplodeonlava } else { iffloordistl 4 { ifrnd 64 state pipebombexplodeonlava } }
	}
	else
	ifvare tempb MEGALAVA
	{
		ifvare temp 2 { ifrnd 96 state pipebombexplodeonlava } else { iffloordistl 4 { ifrnd 96 state pipebombexplodeonlava } }
	}
	else
	ifvare tempb ULTRALAVA
	{
		ifvare temp 2 { ifrnd 128 state pipebombexplodeonlava } else { iffloordistl 4 { ifrnd 128 state pipebombexplodeonlava } }
	}
	else
	ifvare tempb HYPERMAGMA
	{
		ifvare temp 2 { ifrnd 224 state pipebombexplodeonlava } else { iffloordistl 4 { ifrnd 224 state pipebombexplodeonlava } }
	}
	
	getsector[THISACTOR].hitag temp
	ifvare temp NEWFLOORPLASMA
	{
		iffloordistl 4
		{
			ifrnd 16 state pipebombexplodeonlava
		}
	}
	else
	ifvare temp HOTLAVA
	{
		iffloordistl 4
		{
			ifrnd 64 state pipebombexplodeonlava
		}
	}
	else
	ifvare temp MEGALAVA
	{
		iffloordistl 4
		{
			ifrnd 96 state pipebombexplodeonlava
		}
	}
	else
	ifvare temp ULTRALAVA
	{
		iffloordistl 4
		{
			ifrnd 128 state pipebombexplodeonlava
		}
	}
	else
	ifvare temp HYPERMAGMA
	{
		iffloordistl 4
		{
			ifrnd 224 state pipebombexplodeonlava
		}
	}
ends



move PHOLDING
move INIT

move CRATEPUSH-RUN 104
move CRATEPUSH-WALK 104

move CRATEPULL-RUN -128
move CRATEPULL-WALK -128

// Physics Code Below

state getpushpullspeeds
	ifmove CRATEPUSH-WALK
	{
		//setactor[THISACTOR].xvel 64
		getactor[THISACTOR].ang TEMPVAR4
		getactor[THISACTOR].x x
		getactor[THISACTOR].y y 
		getplayer[THISACTOR].posx TEMP2
		getplayer[THISACTOR].posy TEMP3 
		subvarvar x TEMP2
		subvarvar y TEMP3
		getangle angvar TEMP2 TEMP3
		setactor[THISACTOR].ang angvar
		getactorvar[PLAYERID].ACTORXVEL TEMPVAR5
		mulvar TEMPVAR5 60
		divvar TEMPVAR5 100
		ifp pwalking mulvar TEMPVAR5 3
		randvar TEMP4 1
		addvarvar TEMPVAR5 TEMP4
		setactor[THISACTOR].xvel TEMPVAR5
		setactor[THISACTOR].ang TEMPVAR4
	}
	ifmove CRATEPUSH-RUN
	{
		//setactor[THISACTOR].xvel 128
		getactor[THISACTOR].ang TEMPVAR4
		getactor[THISACTOR].x x
		getactor[THISACTOR].y y 
		getplayer[THISACTOR].posx TEMP2
		getplayer[THISACTOR].posy TEMP3 
		subvarvar x TEMP2
		subvarvar y TEMP3
		getangle angvar TEMP2 TEMP3
		setactor[THISACTOR].ang angvar
		getactorvar[PLAYERID].ACTORXVEL TEMPVAR5
		mulvar TEMPVAR5 60
		divvar TEMPVAR5 100
		ifp pwalking mulvar TEMPVAR5 3
		randvar TEMP4 1
		addvarvar TEMPVAR5 TEMP4
		setactor[THISACTOR].xvel TEMPVAR5
		setactor[THISACTOR].ang TEMPVAR4
	}
	ifmove CRATEPULL-WALK
	{
		getactor[THISACTOR].ang TEMPVAR4
		getactor[THISACTOR].x x
		getactor[THISACTOR].y y 
		getplayer[THISACTOR].posx TEMP2
		getplayer[THISACTOR].posy TEMP3 
		subvarvar x TEMP2
		subvarvar y TEMP3
		getangle angvar TEMP2 TEMP3
		setactor[THISACTOR].ang angvar
		getactorvar[PLAYERID].ACTORXVEL TEMPVAR5
		mulvar TEMPVAR5 60
		divvar TEMPVAR5 100
		ifp pwalking mulvar TEMPVAR5 2
		randvar TEMP4 1
		subvarvar TEMPVAR5 TEMP4
		setactor[THISACTOR].xvel TEMPVAR5
		setactor[THISACTOR].ang TEMPVAR4
	}
	ifmove CRATEPULL-RUN
	{
		getactor[THISACTOR].ang TEMPVAR4
		getactor[THISACTOR].x x
		getactor[THISACTOR].y y 
		getplayer[THISACTOR].posx TEMP2
		getplayer[THISACTOR].posy TEMP3 
		subvarvar x TEMP2
		subvarvar y TEMP3
		getangle angvar TEMP2 TEMP3
		setactor[THISACTOR].ang angvar
		getactorvar[PLAYERID].ACTORXVEL TEMPVAR5
		mulvar TEMPVAR5 60
		divvar TEMPVAR5 100
		ifp pwalking mulvar TEMPVAR5 2
		randvar TEMP4 1
		subvarvar TEMPVAR5 TEMP4
		setactor[THISACTOR].xvel TEMPVAR5
		setactor[THISACTOR].ang TEMPVAR4
	}
ends

state getstrengthratio
	setvarvar STRENGTHRATIO PLAYERLIFTSTRENGTHTEMP
	mulvar STRENGTHRATIO 100
	divvarvar STRENGTHRATIO ACTORWEIGHT
	
	setvar ACTORPHYSICSFLAGS 0
	ifvarvarg STRENGTHRATIO PUSHRATIO addvar ACTORPHYSICSFLAGS 1
	ifvarvarg STRENGTHRATIO PULLRATIO addvar ACTORPHYSICSFLAGS 2
	ifvarvarg STRENGTHRATIO GRABRATIO addvar ACTORPHYSICSFLAGS 4
	ifvarvarg STRENGTHRATIO LIFTRATIO addvar ACTORPHYSICSFLAGS 8
ends

state getstrengthratio2
	setvarvar STRENGTHRATIO PLAYERLIFTSTRENGTHTEMP
	mulvar STRENGTHRATIO 100
	divvarvar STRENGTHRATIO actorvar[SPRITEID-HOLDING].ACTORWEIGHT
	
	setactorvar[SPRITEID-HOLDING].ACTORPHYSICSFLAGS 0
	setvar TEMP2 0
	ifvarvarg STRENGTHRATIO PUSHRATIO addvar TEMP2 1
	ifvarvarg STRENGTHRATIO PULLRATIO addvar TEMP2 2
	ifvarvarg STRENGTHRATIO GRABRATIO addvar TEMP2 4
	ifvarvarg STRENGTHRATIO LIFTRATIO addvar TEMP2 8
	setactorvar[SPRITEID-HOLDING].ACTORPHYSICSFLAGS TEMP2
ends

state calcmovementphysics
	getactor[THISACTOR].xvel ACTORPHYSICSVELS
	
	setvarvar PHYSICSTEMPB LIFTRATIO
	addvarvar PHYSICSTEMPB GRABRATIO
	divvar PHYSICSTEMPB 2
	
	setvarvar PHYSICSTEMPC STRENGTHRATIO
	mulvar PHYSICSTEMPC 100
	divvarvar PHYSICSTEMPC PHYSICSTEMPB
	
	ifvarl PHYSICSTEMPC 60 setvar PHYSICSTEMPC 60
	ifvarg PHYSICSTEMPC 512 setvar PHYSICSTEMPC 512
	mulvarvar ACTORPHYSICSVELS PHYSICSTEMPC
	divvar ACTORPHYSICSVELS 100
	
	setactor[THISACTOR].xvel ACTORPHYSICSVELS
ends

state positionholding
	getplayer[THISACTOR].horiz zdist
	ifvarvarg STRENGTHRATIO LIFTRATIO
	{
		ifvarvare SPRITEID-HOLDING SPRITEID-TELEKENESIS_P
		{
			subvar zdist 100
			mulvar zdist -32
		}
		else
		{
			subvar zdist 75
			mulvar zdist -24
		}
	}
	else
	{
		subvar zdist 100
		mulvar zdist -32
	}
	addvarvar mz zdist
	rotatepoint x y digx y angvar mx my
	updatesectorz mx my mz temp
	ifvarn temp -1
	{
		changespritesect SPRITEID-HOLDING temp
		setactor[SPRITEID-HOLDING].x mx
		setactor[SPRITEID-HOLDING].y my
		ifvarn PICKUPVELS 0
		{
			getactor[SPRITEID-HOLDING].z tempb
			ifvarvarg mz tempb setvarvar mz tempb
		}
		setactor[SPRITEID-HOLDING].z mz
	}
ends

state holdingcode
	ifvarn SPRITEID-HOLDING -1
	{
		ifvarvare SPRITEID-HOLDING SPRITEID-TELEKENESIS_P soundonce WIERDSHOT_FLY
		getactor[SPRITEID-HOLDING].statnum temp
		ifvare temp 1024 { setvar SPRITEID-HOLDING -1 setvar PICKUPVELS -12 }
		ifvarn SPRITEID-HOLDING -1
		{
			getactor[SPRITEID-HOLDING].picnum picnum
			ifvarvarn picnum PICNUM-HOLDING { setvar SPRITEID-HOLDING -1 setvar PICKUPVELS -12 }
		}
		ifvarn SPRITEID-HOLDING -1
		{
			getplayer[THISACTOR].posz mz
			state getstrengthratio2
			ifvarvarg STRENGTHRATIO LIFTRATIO
			{
				ifvarvare SPRITEID-HOLDING SPRITEID-TELEKENESIS_P
				{
					addvar mz 3072
				}
				else
				{
					subvar mz 3072 // 3072
				}
			}
			else
			{
				addvar mz 3072
			}
			setvarvar temp PICKUPVELS
			ifvarvarg STRENGTHRATIO LIFTRATIO
			{
				ifvarvare SPRITEID-HOLDING SPRITEID-TELEKENESIS_P
				{
					mulvar temp 640
				}
				else
				{
					mulvar temp 960 // 960
				}
			}
			else
			{
				mulvar temp 640
			}
			addvarvar mz temp
			getplayer[THISACTOR].posx x
			getplayer[THISACTOR].posy y
			setvarvar digx x
			addvar digx 320 //480
			ifvare PICNUM-HOLDING CRATE1 addvar digx 80
			ifvare PICNUM-HOLDING CRATE2 addvar digx 80
			getactor[THISACTOR].clipdist TEMP
			mulvar TEMP 3
			divvar TEMP 4
			addvarvar digx TEMP
		
			getplayer[THISACTOR].ang angvar
			state positionholding
			ifvare temp -1 ifvare PICKUPVELS 0 // object not in sector
			{
				getactorvar[SPRITEID-HOLDING].BOUNCESND temp
				ifvarn temp -1 soundoncevar temp
				subvar digx 96
				state positionholding
				ifvare temp -1 ifvarvarn SPRITEID-HOLDING SPRITEID-TELEKENESIS_P
				{
					getactorvar[SPRITEID-HOLDING].initcstat temp
					ifvare ACTORTHROWTIMER 0 setactor[SPRITEID-HOLDING].cstat temp
					setactor[SPRITEID-HOLDING].x x
					setactor[SPRITEID-HOLDING].y y
					//subvar mz 6144
					setactor[SPRITEID-HOLDING].z mz
					setvar SPRITEID-HOLDING -1
					setvar PICKUPVELS -12
				}
			}	
			ifvarg PICKUPVELS 0 subvar PICKUPVELS 1
		}
	} 
	else setvar DROPFLAG 0 // in the player, droptile is 1 only when pressing alt-fire should drop the gg's sprite
	ifvarl PICKUPVELS 0 addvar PICKUPVELS 1
ends

state movespriteprep
	changespritestat THISACTOR 1
	getplayer[THISACTOR].posx mx
	getplayer[THISACTOR].posy my
	getactor[THISACTOR].x x
	getactor[THISACTOR].y y
	subvarvar mx x
	subvarvar my y
	getangle angvar mx my
	cos xvel angvar
	sin yvel angvar
ends

state telekenesisgrabstate
	ifvare initcstat -1 getactor[THISACTOR].cstat initcstat
	
	setvar temp 0
	ifvarvare THISACTOR scannedsprite setvar temp 1
	ifvarvare THISACTOR SPRITEID-TELEKENESIS_P setvar temp 1
	ifpdistl 1024 setvar temp 1
	ifvarvare SPRITEID-HOLDING THISACTOR setvar temp 0
	ifvarg ACTORWEIGHT 450 setvar temp 0 // 100
	findplayer xydist
	ifvare temp 1
	{
		setvar FALLFLAG 1
		setvarvar SPRITEID-TELEKENESIS_P THISACTOR
		ifactor TOILET break
		ifactor HYDRENT break
		state movespriteprep
		shiftvarr xydist 6
		getactorvar[SPRITEID-TELEKENESIS_P].ACTORWEIGHT tempb
		ifvarl tempb 20 setvar tempb 20
		//shiftvarr tempb 1
		addvarvar xydist tempb
		shiftvarr xydist 2
		divvarvar xvel xydist
		divvarvar yvel xydist
		getplayer[THISACTOR].posz mz
		addvar mz 2048
		getactor[THISACTOR].z z
		ifvarvarl mz z { setactor[THISACTOR].zvel -256 ifpdistg 1024 setvar zvel -4096 } else setvar zvel -1024
		movesprite THISACTOR xvel yvel zvel CLIPMASK0 RETURN
		ifpdistl 1024 //RETRIEVEDISTANCE
		{
			ifvarand initcstat 64 subvar initcstat 64
			setvarvar temp initcstat
			ifvarand temp 1 subvar temp 1
			setactor[THISACTOR].cstat temp
			move PHOLDING faceplayer geth getv
			setvarvar SPRITEID-HOLDING THISACTOR
			soundonce KICK_HIT
			getactor[THISACTOR].picnum PICNUM-HOLDING
		}
		break
	}
	else // SHAKE IT BABY!
	{
		ifactor TOILET break
		ifactor HYDRENT break
		getactor[THISACTOR].ang angvar
		randvar temp 32
		ifrnd 128 mulvar temp -1
		addvarvar angvar temp
		setactor[THISACTOR].ang angvar
		state movespriteprep
		
		shiftvarr xydist 6
		setvarvar tempb ACTORWEIGHT
		ifvarl tempb 20 setvar tempb 20
		shiftvarr tempb 1
		addvarvar xydist tempb
		shiftvarr xydist 1
		divvarvar xvel xydist
		divvarvar yvel xydist
		randvar zvel 644
		subvarvar zvel xydist
		mulvar zvel -1
		ifvarg zvel 0 setvar zvel 0
		ifvarl zvel -256 iffloordistl 16 setactor[THISACTOR].zvel -256
		movesprite THISACTOR xvel yvel zvel CLIPMASK0 RETURN	
	}	
ends

state telekenesispickupcode
	ifvare CHARACTERSELECTED? 9 // ifvare gravgun YES
	{
		ifvare SPRITEID-HOLDING -1 ifvare SPRITEID-TELEKENESIS_P -1 ifvarand bits 262144 ifvare PICKUPVELS 0 ifcanseetarget
		{
			ifp pfacing
			state telekenesisgrabstate
		}
		else
		ifvarvare SPRITEID-TELEKENESIS_P THISACTOR ifvare SPRITEID-HOLDING -1
			state telekenesisgrabstate
	}
ends

state grabpullquote
	ifvarg ACTORPHYSICSFLAGS 0
	{
		ifvare mainmenu 0
		{
			ifvare ACTORPHYSICSFLAGS 1
			{
				redefinequote 413 ^20YOU CAN PUSH THIS OBJECT BY HITTING "^0
				getkeyname 414 6 0
				qstrcat 413 414
				redefinequote 415 ^20"!
				qstrcat 413 415
			}
			else
			ifvare ACTORPHYSICSFLAGS 3
			{
				redefinequote 413 ^20YOU CAN PUSH/PULL THIS OBJECT BY HITTING "^0
				getkeyname 414 6 0
				qstrcat 413 414
				redefinequote 415 ^20"!
				qstrcat 413 415
			}
			setvarvar fta 6 setvar ftq 413       
		}
	}
ends

state grabconditions
	ifp ponground
	{
		ifvare SPRITEID-HOLDING -1
		{
			ifvarg MANTLINGTIMER 0
			{
				ifhitspace
				{
					ifvarand extbits 1 // moving forward
					{
						ifp pducking break
						state stopsearchsounds
						setvar temp 0
						ifp pwalking setvar temp 1
						ifvare temp 1
						{
							ifmove CRATEPUSH-WALK nullop else
							move CRATEPUSH-WALK geth
						}
						else
						ifvare temp 0
						{
							ifmove CRATEPUSH-RUN nullop else
							move CRATEPUSH-RUN geth
						}
						getplayer[THISACTOR].ang angvar
						setactor[THISACTOR].ang angvar
						cstator 2
						soundonce DUMPSTER_MOVE // 148
						setvar ACTORPUSHTIMER 3
						setvar PLAYERPUSHINGTIMER 3
			
						randvar PHYSICSTEMPB 60
						addvar PHYSICSTEMPB 240
			
						// Check for Jewel of Four Souls [equippable item]
						ifvare PLAYEREQUIPSLOTITEM1 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM2 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM3 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM4 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM5 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM6 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM7 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM8 28 divvar PHYSICSTEMPB 10
						ifvarl PHYSICSTEMPB 1 setvar PHYSICSTEMPB 1
			
						ifvarl INVULNTIME 1
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvarl MISCARRAYID_AMOUNTTEMP 1
							{
								subvarvar MANTLINGTIMEREXTRA PHYSICSTEMPB
								ifvarl MANTLINGTIMEREXTRA 1
								{
								subvar MANTLINGTIMER 1 
								addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
							}
							else
							{
								ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
								{
								setvarvar MANTLINGTIMER MANTLINGTIMERMAX
								subvarvar MANTLINGTIMER 1
								}
							}
						}
						else
						{
							ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
							{
								setvarvar MANTLINGTIMER MANTLINGTIMERMAX
								subvarvar MANTLINGTIMER 1
							}
						}
					}
					else
					{
						ifvarand extbits 2 nullop else state grabpullquote
						ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
					}
				}
				else
				{
					state grabpullquote
					ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
				}
			}
		}
		else
		{
			ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
		}
	}
	else
	{
		ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
	}
ends

state pullconditions
	ifp ponground
	{
		ifvare SPRITEID-HOLDING -1
		{
			ifvarg MANTLINGTIMER 0
			{
				ifhitspace
				{
					ifvarand extbits 2 // moving backwards
					{
						ifp pducking break
						state stopsearchsounds
						setvar temp 0
						ifp pwalking setvar temp 1
						ifvare temp 1
						{
							ifmove CRATEPULL-WALK nullop else
							move CRATEPULL-WALK geth
						}
						else
						{
							ifmove CRATEPULL-RUN nullop else
							move CRATEPULL-RUN geth
						}
						getplayer[THISACTOR].ang angvar
						setactor[THISACTOR].ang angvar
						cstator 2
						soundonce DUMPSTER_MOVE // 148
						setvar ACTORPUSHTIMER -3
						setvar PLAYERPUSHINGTIMER -3
			
						randvar PHYSICSTEMPB 80
						addvar PHYSICSTEMPB 320
			
						// Check for Jewel of Four Souls [equippable item]
						ifvare PLAYEREQUIPSLOTITEM1 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM2 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM3 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM4 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM5 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM6 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM7 28 divvar PHYSICSTEMPB 10
						ifvare PLAYEREQUIPSLOTITEM8 28 divvar PHYSICSTEMPB 10
						ifvarl PHYSICSTEMPB 1 setvar PHYSICSTEMPB 1
			
						ifvarl INVULNTIME 1
						{
							setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
							ifvarl MISCARRAYID_AMOUNTTEMP 1
							{
								subvarvar MANTLINGTIMEREXTRA PHYSICSTEMPB
								ifvarl MANTLINGTIMEREXTRA 1
								{
									subvar MANTLINGTIMER 1 
									addvar MANTLINGTIMEREXTRA 1000
								}
								ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
							}
							else
							{
								ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
								{
									setvarvar MANTLINGTIMER MANTLINGTIMERMAX
									subvarvar MANTLINGTIMER 1
								}
							}
						}
						else
						{
							ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
							{
								setvarvar MANTLINGTIMER MANTLINGTIMERMAX
								subvarvar MANTLINGTIMER 1
							}
						}
					}
					else
					{
						ifvarand extbits 1 nullop else state grabpullquote
						ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
					}
				}
				else
				{
					state grabpullquote
					ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
				}
			}
		}
		else
		{
		ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
		}
	}
	else
	{
		ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
	}
ends

state pickupconditions
	ifvare PICKUPVELS 0
	{
		getactorvar[PLAYERID].VEHICLEID tempvehicleid
		ifvare tempvehicleid -1
		{
			ifvare PLAYERPUSHINGTIMER 0
			{
				ifvare SPRITEID-HOLDING -1
				{
					ifvarg MANTLINGTIMER 0
					{
						ifhitspace
						{
							ifcanseetarget addvar targetlock 2
							ifvarg targetlock 3 setvar targetlock 3
							ifvarvare scannedsprite THISACTOR setvar targetlock 3
				
							ifvarg targetlock 2
							{
								ifvare initcstat -1 getactor[THISACTOR].cstat initcstat
								ifvarand initcstat 64 subvar initcstat 64 // one sided not allowed
								setvarvar temp initcstat
								ifvarand temp 1 subvar temp 1
								setactor[THISACTOR].cstat temp
								setvar ACTORTHROWTIMER 10
								setvarvar SPRITEID-HOLDING THISACTOR
								resetcount
								setactor[THISACTOR].pitch 0
								setactor[THISACTOR].roll 0
								getactor[THISACTOR].picnum PICNUM-HOLDING
								ifvare CHARACTERSELECTED? 1 soundonce DUKE_GRUNT
								ifvare CHARACTERSELECTED? 8 soundonce LISA_WALLGRAB
								ifvare CHARACTERSELECTED? 15 soundonce MAKEN_MELEE3
								state stopsearchsounds
								ifmove PHOLDING nullop else move PHOLDING faceplayer
								setvar PICKUPVELS 13 // initiates picking up sequence
							}
						}
						else
						{
							ifvarg ACTORPHYSICSFLAGS 3
							{
								ifvare mainmenu 0
								{
									ifvare ACTORPHYSICSFLAGS 7
									{
										redefinequote 413 ^20YOU CAN GRAB THIS OBJECT BY HITTING "^0
										getkeyname 414 6 0
										qstrcat 413 414
										redefinequote 415 ^20"!
										qstrcat 413 415
									}
									else
									ifvare ACTORPHYSICSFLAGS 15
									{
										redefinequote 413 ^20YOU CAN LIFT THIS OBJECT BY HITTING "^0
										getkeyname 414 6 0
										qstrcat 413 414
										redefinequote 415 ^20"!
										qstrcat 413 415
									}
									setvarvar fta 6 setvar ftq 413       
								}
							}
						}
					}
				}
			}
		}
	}
ends

state pickupcode
	state getstrengthratio
	ifvarg targetlock 0 subvar targetlock 1
	
	ifp pshrunk nullop
	else
	{
		ifvarand ACTORPHYSICSFLAGS 4
		{
			ifp palive
			{
				ifp pfacing
				{
					ifpdistl 1024
					{
						state pickupconditions
					}
				}
			}
		}
		else
		{
			ifvarg ACTORPHYSICSFLAGS 0
			{
				ifvarand ACTORPHYSICSFLAGS 1
				{
					ifp phigher
					{
						ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
					}
					else
					{
						ifp pfacing 
						{
							ifp palive
							{
								ifpdistl 1280
								{
									state grabconditions
								}
								else
								{
									ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
								}
							}
							else
							{
								ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
							}
						}
						else
						{
							ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
						}
					}
				}
				ifvarand ACTORPHYSICSFLAGS 2
				{
					ifp phigher
					{
						ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
					}
					else
					{
						ifp pfacing 
						{
							ifp palive
							{
								ifpdistl 1280
								{
									state pullconditions
								}
								else
								{
									ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
								}
							}
							else
							{
								ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
							}
						}
						else
						{
							ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
						}
					}
				}
			}
			else
			{
				ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
				ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
				ifp palive
				{
					ifp pfacing
					{
						ifp ponground
						{
							ifpdistl 1152 // 1280
							{
								ifvare mainmenu 0
								{
									redefinequote 413 ^10YOU ARE NOT STRONG ENOUGH TO MOVE THIS OBJECT IN ANY WAY!
									setvarvar fta 6 setvar ftq 413       
									ifhitspace
									{
										state getpartime
										addvar upresstime 1
										ifvarvare temppartime upresstime nullop else
										{
											ifvare CHARACTERSELECTED? 1 soundonce DUKE_SEARCH1A
											ifvare CHARACTERSELECTED? 2 soundonce JACK_WALLPUSH1
											ifvare CHARACTERSELECTED? 5 soundonce WANG_SEARCH1
											ifvare CHARACTERSELECTED? 6 soundonce ESSENCE_WALLPUSH1
											ifvare CHARACTERSELECTED? 8 soundonce LISA_WALLPUSH1
											ifvare CHARACTERSELECTED? 8 soundonce CYBANIS_WALLPUSH1
											ifvare CHARACTERSELECTED? 15 soundonce MAKEN_WALLPUSH1
										}
										setvarvar upresstime temppartime
									}
								}
							}
						}
					}
				}
			}
		}
	}
	state telekenesispickupcode
ends


state pickupcode2 // for non actors
	state getstrengthratio
	ifvarg targetlock 0 subvar targetlock 1
	
	findplayer xydist
	
	ifp pshrunk nullop
	else
	{
		ifvarand ACTORPHYSICSFLAGS 4
		{
			ifp palive
			{
				ifp pfacing
				{
					ifvarl xydist 1024
					{
						state pickupconditions
					}
				}
			}
		}
		else
		{
			ifvarg ACTORPHYSICSFLAGS 0
			{
				ifvarand ACTORPHYSICSFLAGS 1
				{
					ifp phigher
					{
						ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
					}
					else
					{
						ifp pfacing 
						{
							ifp palive
							{
								ifvarl xydist 1280
								{
									state grabconditions
								}
								else
								{
									ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
								}
							}
							else
							{
								ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
							}
						}
						else
						{
							ifvarg ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER 1
						}
					}
				}
				ifvarand ACTORPHYSICSFLAGS 2
				{
					ifp phigher
					{
						ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
					}
					else
					{
						ifp pfacing 
						{
							ifp palive
							{
								ifvarl xydist 1280
								{
									state pullconditions
								}
								else
								{
									ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
								}
							}
							else
							{
								ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
							}
						}
						else
						{
							ifvarl ACTORPUSHTIMER 0 subvar ACTORPUSHTIMER -1
						}
					}
				}
			}
			else
			{
				ifp palive
				{
					ifp pfacing
					{
						ifp ponground
						{
							ifvarl xydist 1152 // 1280
							{
								ifvare mainmenu 0
								{
									redefinequote 413 ^10YOU ARE NOT STRONG ENOUGH TO MOVE THIS OBJECT IN ANY WAY!
									setvarvar fta 6 setvar ftq 413       
									ifhitspace
									{
										state getpartime
										addvar upresstime 1
										ifvarvare temppartime upresstime nullop else
										{
											ifvare CHARACTERSELECTED? 1 soundonce DUKE_SEARCH1A
											ifvare CHARACTERSELECTED? 2 soundonce JACK_WALLPUSH1
											ifvare CHARACTERSELECTED? 5 soundonce WANG_SEARCH1
											ifvare CHARACTERSELECTED? 6 soundonce ESSENCE_WALLPUSH1
											ifvare CHARACTERSELECTED? 8 soundonce LISA_WALLPUSH1
											ifvare CHARACTERSELECTED? 8 soundonce CYBANIS_WALLPUSH1
											ifvare CHARACTERSELECTED? 15 soundonce MAKEN_WALLPUSH1
										}
										setvarvar upresstime temppartime
									}
								}
							}
						}
					}
				}
			}
		}
	}
	state telekenesispickupcode
ends

move ITEMFLY 384
move ITEMFLY2 480
move ITEMSHOOT 1536 // 2048

state throwitem
	state stopsearchsounds
	setvar SPRITEID-HOLDING -1
	setvar PICKUPVELS -12
	setvar FALLFLAG 1
	
	setvarvar temp ACTORWEIGHT
	
	ifvarl temp 40 setvar WEIGHTFLAG 36 else
	ifvarl temp 80 setvar WEIGHTFLAG 26 else
	setvar WEIGHTFLAG 16
ends


state moveitem
	setactor[THISACTOR].htcgg 0
	ifvare CHARACTERSELECTED? 9 cstator 256
	
	ifvarvare SPRITEID-HOLDING THISACTOR ifvarvare SPRITEID-TELEKENESIS_P THISACTOR
	{
		getplayer[THISACTOR].i HOLDINGID
		getactorvar[HOLDINGID].DROPFLAG digz
		ifvarand bits 262144 
		{
			state stopsearchsounds
			ifvare digz 1
			{
				setvar SPRITEID-HOLDING -1 
				ifvarand initcstat 64 subvar initcstat 64
				setactor[THISACTOR].cstat initcstat
				setvar SPRITEID-TELEKENESIS_P -1 
				setvar PICKUPVELS -12 
				setvar FALLFLAG 1 
			}
		}
		else
		{
			setactorvar[HOLDINGID].DROPFLAG 1
			ifvarand bits 4 
			{
				// getplayer[THISACTOR].ammo_amount 11 temp
				setvar temp 64
				ifvarg temp 0
				{
					// orvar gravonce 2
					// subvar temp 1
					// setplayer[THISACTOR].ammo_amount 11 temp
					sound WIERDSHOT_FLY // sound GRAVSHOOT
			
					// throw it
					setvar SPRITEID-HOLDING -1
					setvar SPRITEID-TELEKENESIS_P -1
					move ITEMSHOOT geth
					setvar WEIGHTFLAG 32
					setvar FALLFLAG 1 // used to tell objects that haven't fallen before that they should start now
					setvar PICKUPVELS -12
					ifvarand initcstat 64 subvar initcstat 64
					setactor[THISACTOR].cstat initcstat
					spriteflags 16
					getplayer[THISACTOR].ang angvar
					setactor[THISACTOR].ang angvar
					getplayer[THISACTOR].horiz temp
					subvar temp 100
					mulvar temp -120
					subvar zvel -2048
					ifvarl temp -16384 setvar temp -16384
					ifvarg temp 16384 setvar temp 16384
					setactor[THISACTOR].zvel temp
				}
			}
		}
		break
	}
	
	ifvarvare SPRITEID-HOLDING THISACTOR 
	{
		state stopsearchsounds
	
		ifvare mainmenu 0
		{
			// Putting the Item Down Manually
			ifhitspace ifvare PICKUPVELS 0
			{
				setactor[THISACTOR].cstat initcstat
				setvar SPRITEID-HOLDING -1
				setvar PICKUPVELS -12
				setvar FALLFLAG 1
			}
		
			ifvarvarn SPRITEID-HOLDING SPRITEID-TELEKENESIS_P // Do not drain meter if Cybanis is using telekenesis to hold the item
			{
				ifvarg STRENGTHRATIO 79 ifvarl STRENGTHRATIO 92 setvar PHYSICSTEMPB 900 // 80-91 [11]
				ifvarg STRENGTHRATIO 91 ifvarl STRENGTHRATIO 106 setvar PHYSICSTEMPB 850 // 92-105 [13]
				ifvarg STRENGTHRATIO 105 ifvarl STRENGTHRATIO 122 setvar PHYSICSTEMPB 800 // 106-121 [15]
				ifvarg STRENGTHRATIO 121 ifvarl STRENGTHRATIO 140 setvar PHYSICSTEMPB 750 // 122-139 [17]
				ifvarg STRENGTHRATIO 139 ifvarl STRENGTHRATIO 160 setvar PHYSICSTEMPB 700 // 140-159 [19]
				ifvarg STRENGTHRATIO 159 ifvarl STRENGTHRATIO 181 setvar PHYSICSTEMPB 650 // 160-180 [20]
				ifvarg STRENGTHRATIO 180 ifvarl STRENGTHRATIO 203 setvar PHYSICSTEMPB 600 // 181-202 [21]
				ifvarg STRENGTHRATIO 202 ifvarl STRENGTHRATIO 225 setvar PHYSICSTEMPB 550 // 203-224 [21]
				ifvarg STRENGTHRATIO 224 ifvarl STRENGTHRATIO 248 setvar PHYSICSTEMPB 500 // 225-247 [22]
				ifvarg STRENGTHRATIO 247 ifvarl STRENGTHRATIO 271 setvar PHYSICSTEMPB 450 // 248-270 [22]
				ifvarg STRENGTHRATIO 270 ifvarl STRENGTHRATIO 295 setvar PHYSICSTEMPB 400 // 271-294 [23]
				ifvarg STRENGTHRATIO 294 ifvarl STRENGTHRATIO 319 setvar PHYSICSTEMPB 350 // 295-318 [23]
				ifvarg STRENGTHRATIO 318 ifvarl STRENGTHRATIO 344 setvar PHYSICSTEMPB 300 // 319-343 [24]
				ifvarg STRENGTHRATIO 343 ifvarl STRENGTHRATIO 369 setvar PHYSICSTEMPB 250 // 344-368 [24]
				ifvarg STRENGTHRATIO 368 ifvarl STRENGTHRATIO 395 setvar PHYSICSTEMPB 200 // 369-394 [25]
				ifvarg STRENGTHRATIO 394 ifvarl STRENGTHRATIO 421 setvar PHYSICSTEMPB 150 // 395-420 [25]
				ifvarg STRENGTHRATIO 420 ifvarl STRENGTHRATIO 448 setvar PHYSICSTEMPB 100 // 421-447 [26]
				ifvarg STRENGTHRATIO 447 setvar PHYSICSTEMPB 50 // 448+
				ifp ponsteroids divvar PHYSICSTEMPB 2
		
				// Check for Jewel of Four Souls [equippable item]
				ifvare PLAYEREQUIPSLOTITEM1 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM2 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM3 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM4 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM5 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM6 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM7 28 divvar PHYSICSTEMPB 10
				ifvare PLAYEREQUIPSLOTITEM8 28 divvar PHYSICSTEMPB 10
				ifvarl PHYSICSTEMPB 1 setvar PHYSICSTEMPB 1
		
				ifvarl INVULNTIME 1
				{
					setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
					ifvarl MISCARRAYID_AMOUNTTEMP 1
					{
						subvarvar MANTLINGTIMEREXTRA PHYSICSTEMPB
						ifvarl MANTLINGTIMEREXTRA 1
						{
							subvar MANTLINGTIMER 1 
							addvar MANTLINGTIMEREXTRA 1000
						}
						ifvarl MANTLINGTIMER 0 setvar MANTLINGTIMER 0
					}
					else
					{
						ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
						{
							setvarvar MANTLINGTIMER MANTLINGTIMERMAX
							subvarvar MANTLINGTIMER 1
						}
					}
				}
				else
				{
					ifvarvare MANTLINGTIMER MANTLINGTIMERMAX
					{
						setvarvar MANTLINGTIMER MANTLINGTIMERMAX
						subvarvar MANTLINGTIMER 1
					}
				}
			}
		
			// Dropping the Item if Strength/Mantle Runs Out
			ifvarl MANTLINGTIMER 1
			{
				setactor[THISACTOR].cstat initcstat
				setvar SPRITEID-HOLDING -1
				setvar PICKUPVELS -12
				setvar FALLFLAG 1
			}
		
			ifvarvarg STRENGTHRATIO GRABRATIO nullop
			else
			{
				setactor[THISACTOR].cstat initcstat
				setvar SPRITEID-HOLDING -1
				setvar PICKUPVELS -12
				setvar FALLFLAG 1
			}
		}
	
		setvar PHYSICSTEMPC 0
		/*
		// don't know whether ifhitweapon has been called before this point, so it gets ugly
		getactor[THISACTOR].htextra temp
		ifwasweapon KNEE { setvar PHYSICSTEMPC 1 ifvarl temp 1 setactor[THISACTOR].htpicnum -1 }
		ifvarg temp 0
		{
			getactor[THISACTOR].htpicnum tempb
			ifvare tempb KNEE
			setvar PHYSICSTEMPC 1
		}
		*/
		ifvare mainmenu 0 { ifvarand bits 4 setvar PHYSICSTEMPC 1 }
		ifvare PICKUPVELS 0
		{
			ifvare PHYSICSTEMPC 1
			{
				state throwitem
				mulvar WEIGHTFLAG 2
			}
		}
		break
	}
	
	ifvare CHARACTERSELECTED? 9
	{
		getactor[THISACTOR].htextra temp
		ifvarg temp 0
		{
			getactor[THISACTOR].htpicnum picnum
			ifvare picnum SHOTSPARK1
			{
				getactor[THISACTOR].htowner HOLDINGID
				getactor[HOLDINGID].picnum picnum
				ifvare picnum APLAYER ifvarl ACTORWEIGHT 160
				{
					setvar WEIGHTFLAG 26
			
					ifvarl ACTORWEIGHT 40 move ITEMSHOOT geth
					else
					ifvarl ACTORWEIGHT 60 move ITEMFLY2 geth
					else
					ifvarl ACTORWEIGHT 100 move ITEMFLY geth
			
					setactor[THISACTOR].htowner THISACTOR
					spriteflags 16
					setvar FALLFLAG 1
					getplayer[THISACTOR].ang angvar
					setactor[THISACTOR].ang angvar
					getplayer[THISACTOR].horiz temp
					subvar temp 100
					mulvar temp -60
					ifvarl temp -6144 setvar temp -6144
					ifvarg temp 6144 setvar temp 6144
					getactor[THISACTOR].zvel tempb
					addvarvar temp tempb
					setactor[THISACTOR].zvel temp
					iffloordistl 8
					{
						getactor[THISACTOR].z z
						subvar z 1024
						setactor[THISACTOR].z z
						setactor[THISACTOR].zvel -2048
					}
				}
			}
		}
	}
	
	ifmove 0
	{
		ifvarl ACTORWEIGHT 1 setvar ACTORWEIGHT 40
		move INIT
	}
	
	ifvarg WEIGHTFLAG 0 
	{
		// ifactor 1769 ifrnd 16 spawn NEWBLOOD1
		// ifactor 2202 ifrnd 16 spawn NEWBLOOD1
	
		ifmove ITEMFLY nullop
		else ifmove ITEMSHOOT nullop
		else ifmove ITEMFLY2 nullop
		else
		{
			ifactor CRATE1 move ITEMFLY geth
			else ifactor CRATE2 move ITEMFLY geth
			else ifvare WEIGHTFLAG 13 move ITEMFLY geth
			else move ITEMFLY2 geth
		
			spriteflags 16
			setvar FALLFLAG 1
			ifvare WEIGHTFLAG 13 setactor[THISACTOR].zvel -1024 // for when thrown by an enemy
			else
			{
				getplayer[THISACTOR].ang angvar
				setactor[THISACTOR].ang angvar
				getplayer[THISACTOR].horiz temp
				subvar temp 100
				mulvar temp -80 //-60
				ifvarl temp -6144 setvar temp -6144
				ifvarg temp 6144 setvar temp 6144
				getactor[THISACTOR].zvel tempb
				addvarvar temp tempb
				// ACTORWEIGHT adjustment
				ifvarl temp 0 ifvarg ACTORWEIGHT 40 
				divvar temp 2
		
				setactor[THISACTOR].zvel temp
			}
		}
	
		getactor[THISACTOR].htmovflag RETURN
		ifvare RETURN 0
		{
			/*
			findnearactorz SHOOTME 480 10240 HOLDINGID 
			ifvarn HOLDINGID -1 { getactorvar[HOLDINGID].myspawner RETURN subvar RETURN 16384 }
			*/
			findnearactorz DEALER 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz STAND1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz STAND3 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz STAND4 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE2 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE3 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE5 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE6 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE7 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DANCE9 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ROBOTDOG 960 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ROBOTDOG2 960 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz PRESIDENTCLINTON 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz COP1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz COP2 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz PUNKDUDE 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz SITTINGDUDE 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM2 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM3 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM4 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM5 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM6 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM7 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM9 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz FEM10 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz TOUGHGAL 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz WOMAN 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz NAKED1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz PODFEM1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ANIMEGIRL1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ANIMEGIRL2 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ANIMEGIRL3 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ANIMEGIRL4 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz EGG 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz GREENSLIME 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz SHARK 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz ROTATEGUN 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz LIZTROOP 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz PIGCOP 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz RECON 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz LIZMAN 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz DRONE 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz OCTABRAIN 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz COMMANDER 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz NEWBEAST 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz TANK 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz SCORPIONTANK 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz BOSS1 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz BOSS2 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz BOSS3 480 10240 HOLDINGID
			ifvare HOLDINGID -1 findnearactorz BOSS4 480 10240 HOLDINGID
			ifvarn HOLDINGID -1 { setvarvar RETURN HOLDINGID subvar RETURN 16384 }
		}
		ifvarn RETURN -1
		{
			// hit something
			addvar RETURN 16384
			ifvarl RETURN 16384
					
			ifvarg RETURN -1
			{
				// impact sound
				getactor[RETURN].statnum tempb
				setvarvar tempb ACTORWEIGHT
				ifvarvarg STRENGTHRATIO LIFTRATIO
				{
				randvar TEMP3 15
				addvar TEMP3 130
				mulvarvar tempb TEMP3
				divvar tempb 100
				}
				mulvar tempb 2
				ifmove ITEMSHOOT nullop else shiftvarr tempb 2
				// add something to prevent ridiculous things, like bottles destroying garbage cans or barrels
		
				ifmove ITEMFLY ifvarl ACTORWEIGHT 1 nullop
				else
				{
				sound THROWSMACK
				setactor[RETURN].htextra tempb
				setactor[RETURN].htpicnum CRATE1 // SHOTSPARK1
				setactor[RETURN].htowner PLAYERID // PLAYERID
				getactor[THISACTOR].ang angvar
				setactor[RETURN].htang angvar
				}
			}
			ifmove ITEMSHOOT 
			{
				sound THROWSMACK
				setvarvar tempb ACTORWEIGHT
				mulvar tempb 2
				move ITEMFLY2 geth  
				setactor[THISACTOR].htextra tempb
				setactor[THISACTOR].htpicnum CRATE2 //SHOTSPARK1
				setactor[THISACTOR].htowner PLAYERID // PLAYERID
			}
			else
			ifmove ITEMFLY2 move ITEMFLY geth
			else
			{
				getactor[THISACTOR].owner HOLDINGID
				ifvarvarn RETURN HOLDINGID
				ifvarg WEIGHTFLAG 1 setvar WEIGHTFLAG 1
			}
		}
	
		iffloordistl 4 
		{
			ifvarg WEIGHTFLAG 6
			{
				ifvarg ACTORWEIGHT 40 subvar WEIGHTFLAG 2
				subvar WEIGHTFLAG 2
				ifvarn BOUNCESND -1 soundvar BOUNCESND
				getactor[THISACTOR].z z
				subvar z 1024
				setactor[THISACTOR].z z
				setvarvar temp WEIGHTFLAG
				mulvar temp -64
				setactor[THISACTOR].zvel temp
			}
		}
		subvar WEIGHTFLAG 1
		iffloordistl 2 nullop else 
		ifvare sector[PLAYERSECTOR].lotag 2 nullop else ifinwater nullop else
		ifvare WEIGHTFLAG 0 setvar WEIGHTFLAG 1
		ifvare WEIGHTFLAG 0
		move INIT
	}
ends

state checkphysicsmoves
	ifmove ITEMFLY
	{
		setactor[THISACTOR].xvel 384
		state calcmovementphysics
	}
	ifmove ITEMFLY2
	{
		setactor[THISACTOR].xvel 480
		state calcmovementphysics
	}
	ifmove ITEMSHOOT
	{
		setactor[THISACTOR].xvel 1536
		// state calcmovementphysics
	}
ends

state setpickupflags
	ifactor SUPERATOM setactor[THISACTOR].pal 16
	else ifactor SUPERSHIELD setactor[THISACTOR].pal 24
	else getactor[THISACTOR].pal ACTORNATURALPAL
	
	getactor[THISACTOR].yvel lotagsav
	setactor[THISACTOR].yvel 0
	getactor[THISACTOR].zvel ACTORFLAGS
	setactor[THISACTOR].zvel 0
	changespritestat THISACTOR 1
	sleeptime 0 
	
	ifvarand ACTORFLAGS 1 // Makes Pickup Completely Invisible [cstat 32768]
	{
		getactor[THISACTOR].cstat TEMP
		ifvarand TEMP 32768 nullop
		else
		{
			addvar TEMP 32768
			setactor[THISACTOR].cstat TEMP
		}
	}
	/*
	ifvarand ACTORFLAGS 2 // Silent Pickup For Players [no sounds, screen flashes or messages] // combine with 4 to create silent pickup for both
	{
	}
	
	ifvarand ACTORFLAGS 4 // Silent Pickup For Monsters [no sounds or messages] // combine with 2 to create silent pickup for both
	{
	}
	
	ifvarand ACTORFLAGS 8 // Player cannot pickup object // Combine with 16 to make an ungrabbable item // Combine with 16 to make an ungrabbable item
	{
	}
	
	ifvarand ACTORFLAGS 16 // Monster cannot pickup object [only affects things monsters can normally pick up] // Combine with 8 to make an ungrabbable item
	{
	}
	
	ifvarand ACTORFLAGS 32 // Inverses Fall Properties [items that normally fall will hover/float, items that normally float/hover will fall]
	{
	}
	
	ifvarand ACTORFLAGS 64
	{
	}
	
	ifvarand ACTORFLAGS 128 // Object is worth double[2x] the normal pickup amount // combine with 256 to make octopule[8x] the normal amount
	{
	}
	
	ifvarand ACTORFLAGS 256 // Object is worth quadruple[4x] the normal pickup amount // combine with 128 to make octopule[8x] the normal amount
	{
	}
	
	ifvarand ACTORFLAGS 512 // Grabbing the object triggers special effects [i.e. spawning objects/monsters, activating objects/forcefields, opening/unlocking doors, etc. Set "yvel" to the lotag of the activator/forcefield/respawn sprites]
	{
	}
	*/
	ifvarand ACTORFLAGS 1024 // Makes pickup invisible to all but the Nightvision Goggles & Mercury VR Visor
	{
		ifvarand ACTORFLAGS 2048 subvar ACTORFLAGS 1024
		else ifvarand ACTORFLAGS 2049 subvar ACTORFLAGS 1024
		else ifvarand ACTORFLAGS 1 subvar ACTORFLAGS 1024
		else
		{
			getactor[THISACTOR].cstat TEMP
			ifvarand TEMP 32768 nullop
			else
			{
				addvar TEMP 32768
				setactor[THISACTOR].cstat TEMP
			}
		}
	}
	//
	ifvarand ACTORFLAGS 2048 // Makes pickup invisible to all but the Mercury VR Visor
	{
		getactor[THISACTOR].cstat TEMP
		ifvarand ACTORFLAGS 1 subvar ACTORFLAGS 2048
		else
		{
			getactor[THISACTOR].cstat TEMP
			ifvarand TEMP 32768 nullop
			else
			{
				addvar TEMP 32768
				setactor[THISACTOR].cstat TEMP
			}
		}
	}
	/*
	ifvarand ACTORFLAGS 4096 // Object is booby-trapped, but still gives you the pickup
	{
	}
	
	ifvarand ACTORFLAGS 8192 // Object is booby-trapped, and will NOT give you the pickup value at all
	{
	}
	*/
	ifvarand ACTORFLAGS 16384 // Special Flag #1
	{
		ifactor SHIELD setvar ARMORISUSED? 1
		ifactor SUPERSHIELD setvar ARMORISUSED? 1
		ifactor COLORSHIELD setvar ARMORISUSED? 1
	}
	/*
	ifvarand ACTORFLAGS 32768 // ?
	{
	}
	*/
ends

state checkoldskool_items // Makes Non-Old Skool Items Vanish so they can't be picked up on Old-Skool Mode
	ifvare oldskoolmode 1 killit
ends

state checkitemflags
	changespritestat THISACTOR 1
	sleeptime 0
	ifvarand ACTORFLAGS 1 // Completely Invisible
	{
		getactor[THISACTOR].cstat TEMP
		ifvarand TEMP 32768 nullop
		else
		{
			addvar TEMP 32768
			setactor[THISACTOR].cstat TEMP
		}
	}
	else
	ifvarand ACTORFLAGS 1024 // Invisible except for NV Goggles & VR Visor
	{
		ifvare player[THISACTOR].heat_on 1
		{
			getactor[THISACTOR].cstat TEMP
			ifvarand TEMP 32768
			{
				subvar TEMP 32768
				setactor[THISACTOR].cstat TEMP
			}
		}
		else
		{
			getactor[THISACTOR].cstat TEMP
			ifvarand TEMP 32768 nullop
			else
			{
				addvar TEMP 32768
				setactor[THISACTOR].cstat TEMP
			}
		}
	}
	else
	ifvarand ACTORFLAGS 2048 // Invisible except for VR Visor
	{
		ifvare CHARACTERSELECTED? 4
		{
			ifvare player[THISACTOR].heat_on 1
			{
				getactor[THISACTOR].cstat TEMP
				ifvarand TEMP 32768
				{
					subvar TEMP 32768
					setactor[THISACTOR].cstat TEMP
				}
			}
			else
			{
				getactor[THISACTOR].cstat TEMP
				ifvarand TEMP 32768 nullop
				else
				{
					addvar TEMP 32768
					setactor[THISACTOR].cstat TEMP
				}
			}
		}
		else
		{
			getactor[THISACTOR].cstat TEMP
			ifvarand TEMP 32768 nullop
			else
			{
				addvar TEMP 32768
				setactor[THISACTOR].cstat TEMP
			}
		}
	}
	ifvare CHARACTERSELECTED? 4
	{
		ifvare player[THISACTOR].heat_on 1
		{
			ifvarand ACTORFLAGS 4096 setactor[THISACTOR].pal 6
			else ifvarand ACTORFLAGS 8192 setactor[THISACTOR].pal 6
			else setactor[THISACTOR].pal ACTORNATURALPAL
		}
		else setactor[THISACTOR].pal ACTORNATURALPAL
	}
	else setactor[THISACTOR].pal ACTORNATURALPAL
	//
	getactor[THISACTOR].cstat TEMP
	ifvarand TEMP 1 subvar TEMP 1 // Items Should not be able to block you
	ifvarand TEMP 256 subvar TEMP 256 // Items Should not be shootable
	ifvarand TEMP 1024 nullop else addvar TEMP 1024
	setactor[THISACTOR].cstat TEMP
ends

state checkitemflags2
	ifvare oldskoolmode 1
	{
		ifvarand ACTORFLAGS 128 subvar ACTORFLAGS 128
		ifvarand ACTORFLAGS 256 subvar ACTORFLAGS 256
	}
	else
	{
		ifvarand ACTORFLAGS 128 setvar tempf 2 else setvar tempf 1
		ifvarand ACTORFLAGS 256 setvar tempg 4 else setvar tempg 1
		setvarvar temph tempf
		mulvarvar temph tempg
		ifvarg temph 1
		{
			setvar MISCARRAYID 73 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // SHOW-MULTI-ICONS?
			ifvare MISCARRAYID_AMOUNTTEMP 1
			{
				ifcanseetarget
				{
					setvar MULTIPLIERITEMCANSEE? 1
					ifvare MULTIICONCHILD -1
					{
						espawn PICKUPMULTIICON
						setactorvar[RETURN].MULTIICONPARENT THISACTOR
						setactorvar[THISACTOR].MULTIICONCHILD RETURN
					}
				}
				else setvar MULTIPLIERITEMCANSEE? 0
			}
		}
	}
ends

state fallflagscrates
	fall
	setactor[THISACTOR].mdflags 16
	setvar position 32768
	
	ifvarand position 32768
	{
		getactor[THISACTOR].sectnum temp
		ifvarn temp -1
		{
			getsector[temp].lotag tempb
		
			ifvare tempb 1
			{
				getactor[THISACTOR].x TEMPVAR2
				getactor[THISACTOR].y TEMPVAR3
				getflorzofslope temp TEMPVAR2 TEMPVAR3 digz
				getactor[THISACTOR].z mz
				subvarvar digz mz
		
				ifvarl digz 1024 // on the floor
				{
					addvar itemtimer 1
				}
				else
				{
					randvar itemtimer 127
				}
			}
			else
			{
				randvar itemtimer 127
			}
		}
		else
		{
			randvar itemtimer 127
		}
	}
	else
	{
		randvar itemtimer 127
	}
ends

state fallflags
	ifvarand ACTORFLAGS 32 nullop
	else
	{
		fall
		setactor[THISACTOR].mdflags 16
		setvar position 32768
	
		ifvarand position 32768
		{
			getactor[THISACTOR].sectnum temp
			ifvarn temp -1
			{
				getsector[temp].lotag tempb
		
				ifvare tempb 1
				{
					getactor[THISACTOR].x TEMPVAR2
					getactor[THISACTOR].y TEMPVAR3
					getflorzofslope temp TEMPVAR2 TEMPVAR3 digz
					getactor[THISACTOR].z mz
					subvarvar digz mz
			
					ifvarl digz 1024 // on the floor
					{
						addvar itemtimer 1
					}
					else
					{
						randvar itemtimer 127
					}
				}
				else
				{
					randvar itemtimer 127
				}
			}
			else
			{
				randvar itemtimer 127
			}
		}
		else
		{
			randvar itemtimer 127
		}
	}
ends

state fallflags2
	ifvarand ACTORFLAGS 32
	{
		fall
		setactor[THISACTOR].mdflags 16
		setvar position 32768
	
		ifvarand position 32768
		{
			getactor[THISACTOR].sectnum temp
			ifvarn temp -1
			{
				getsector[temp].lotag tempb
		
				ifvare tempb 1
				{
					getactor[THISACTOR].x TEMPVAR2
					getactor[THISACTOR].y TEMPVAR3
					getflorzofslope temp TEMPVAR2 TEMPVAR3 digz
					getactor[THISACTOR].z mz
					subvarvar digz mz
			
					ifvarl digz 1024 // on the floor
					{
						addvar itemtimer 1
					}
					else
					{
						randvar itemtimer 127
					}
				}
				else
				{
					randvar itemtimer 127
				}
			}
			else
			{
				randvar itemtimer 127
			}
		}
		else
		{
			randvar itemtimer 127
		}
	}
ends

state setknockback_player
	getuserdef[THISACTOR].god temp
	ifvare temp 1 break
	ifvarg INVULNTIME 0 break
	setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
	ifvarg MISCARRAYID_AMOUNTTEMP 0 break
	
	getplayer[THISACTOR].posx mx
	getplayer[THISACTOR].posy my
	getactor[THISACTOR].x x
	getactor[THISACTOR].y y
	
	subvarvar mx x
	subvarvar my y
	getangle knockbackang mx my
	setvar knockback 10
	ifvare CHARACTERSELECTED? 1 sound DUKE_LAND_HURT2
	ifvare CHARACTERSELECTED? 5 sound WANG_LONGTERM_PAIN6
	ifvare CHARACTERSELECTED? 8 sound LISA_FALLDAMAGE
	ifvare CHARACTERSELECTED? 9 sound CYBANIS_FALLDAMAGE1
	ifvare CHARACTERSELECTED? 15 sound MAKEN_FALLDAMAGE1
ends

state dmgflr-checkinvulntime
	ifvare VEHICLEID -1 setvarvar tempf INVULNTIME else getactorvar[VEHICLEID].ACTORINVULNTIME tempf
ends

// HUBS

state SEHUBSTATE
	ifvare hubwait YES // wait for the player to leave the sector before re-activating
	break
	
	// don't change maps if this map just loaded
	// this avoids problem caused by scroll lock being placed in a map changing sector
	getplayer[THISACTOR].player_par hubtemp
	ifvarl hubtemp 4
	break
	
	// don't change maps if the player is at the edge of the sector
	// this avoids problem of the player going back and forth between maps with slight movement
	getplayer[THISACTOR].cursectnum hubtempb
	getplayer[THISACTOR].posx hubxoff
	getplayer[THISACTOR].posy hubyoff
	addvar hubxoff 128
	addvar hubyoff 128
	updatesector hubxoff hubyoff hubtemp
	ifvarvarn hubtempb hubtemp break
	subvar hubxoff 256
	updatesector hubxoff hubyoff hubtemp
	ifvarvarn hubtempb hubtemp break
	subvar hubyoff 256
	updatesector hubxoff hubyoff hubtemp
	ifvarvarn hubtempb hubtemp break
	addvar hubxoff 256
	updatesector hubxoff hubyoff hubtemp
	ifvarvarn hubtempb hubtemp break
	
	getactor[THISACTOR].shade hubtemp
	ifvare hubtemp 10
	{
		setvar hubxoff 0
		setvar hubyoff 0
		setvar hubzoff 0
	}
	else
	{
		getactor[THISACTOR].x hubtemp
		getplayer[THISACTOR].posx hubxoff
		subvarvar hubxoff hubtemp
		getactor[THISACTOR].y hubtemp
		getplayer[THISACTOR].posy hubyoff
		subvarvar hubyoff hubtemp
		getactor[THISACTOR].z hubtemp
		getplayer[THISACTOR].posz hubzoff
		addvar hubzoff 8192
		subvarvar hubzoff hubtemp
		ifvare hubact1 1 { setvar hubxoff 0 setvar hubyoff 0 setvar hubzoff 0 }
	}
	
	setvarvar hubpdestination hubhitag
	getactor[THISACTOR].pal hubtemp
	setvar hubplayerwait 2
	getplayer[THISACTOR].ang hubpang
	getplayer[THISACTOR].got_access hubsavekeys
	savemapstate
	startlevel VOLUME hubtemp
ends

state projectilehitscan
	// the sprite ID of the scanning projectile has been put in TEMPVAR5 before this state is called
	getactor[TEMPVAR5].x x
	getactor[TEMPVAR5].y y
	getactor[TEMPVAR5].z z
	getactor[TEMPVAR5].sectnum mysector
	getactor[TEMPVAR5].ang angvar
	getactor[TEMPVAR5].zvel zvel
	getactor[TEMPVAR5].xvel xvel
	shiftvarl zvel 14
	ifvare xvel 0 setvar xvel 1
	divvarvar zvel xvel
	cos mycos angvar
	sin mysin angvar
	hitscan x y z mysector mycos mysin zvel hitsector hitwall hitsprite hitx hity hitz clipmask
ends

state atmbroken_dealdamage
	ifvare mainmenu 0
	{
		state stopsearchsounds
		setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
		ifvare MISCARRAYID_AMOUNTTEMP 0
		{
			ifvarand CHEATBITFIELD? 32 nullop else
			{
				ifvarl INVULNTIME 1
				{
					sound SHORT_CIRCUIT state sparkstate
					randvar tempe 3
					addvar tempe 2
					setvarvar tempd SKILLLEVEL
					addvar tempd 1
					ifvarl tempd 1 setvar tempd 1
					mulvarvar tempe tempd
					setvarvar tempd SKILLLEVEL
					addvar tempd 1
					divvar tempd 2
					ifvarl tempd 1 setvar tempd 1
					mulvarvar tempe tempd
					ifrnd 85 mulvar tempe 3 else ifrnd 128 mulvar tempe 5 else mulvar tempe 7
			
					setvarvar TEMPDAMAGEVAR tempe
					state char_elecdamage_misc // Used by Player [ignores Drivable Tank checks]
					setvarvar tempe TEMPDAMAGEVAR
			
					//*********************
					//*Check Malakian Gems*
					//*********************
					setvarvar TEMP7 tempe
					state malakiangemcheck 
					setvarvar tempe TEMP7
			
					//****************
					//*Support System*
					//****************
					ifvarg tempe 0
					{
						setvar DAMAGEMODIFIER 1000
			
						//**Electric Support / Nethra**
						state support-electricresist
						state damagemod-tempvar          
					}
			
					//*********************************
					//*Support System [ESSence Support*
					//*********************************
					ifvarg tempe 0
					{
						setvar DAMAGEMODIFIER 1000
						//**Overall Support / ESSence**
						state support-overallresist
						state damagemod-tempvar          
					}
			
					//******************
					//*Equipment System*
					//******************
					ifvarg tempe 0
					{
						setvar DAMAGEMODIFIER 1000
						// Equipment Slot #1
						ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #2
						ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #3
						ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #4
						ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #5
						ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #6
						ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #7
						ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						// Equipment Slot #8
						ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
						ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
						state damagemod-tempvar          
					}
					// Nyx Gloves Deterrant
					ifvarg tempe 0
					{
						state nyxgloveschecker
						ifvarg DAMAGEMODIFIER 0 setvar tempe 0
					}
			
					ifvare DAMAGEMODIFIER 0 { ifvarand CHEATBITFIELD? 16 { ifvarg tempe 1 { divvar tempe 1000 ifvarl tempe 1 setvar tempe 1 state cheatersound } } }
			
					setvarvar TEMPDAMAGEVAR tempe
					state lisashield_misc
					setvarvar tempe TEMPDAMAGEVAR
			
					setvarvar tempb CURRENTHITPOINTS
					subvarvar tempb tempe
					ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
					else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
					ifvarl tempb 0 setvar tempb 0
					ifvarvarg tempb MAXHITPOINTSATOMIC setvarvar tempb MAXHITPOINTSATOMIC
					setactor[PLAYERID].htpicnum -1
					setvarvar CURRENTHITPOINTS tempb
					state checkbuddhamode
			
					ifvarn player[THISACTOR].over_shoulder_on 0
					{
						ifvarg CELLDAMAGETEMP 0
						{
							setvarvar SHOWDAMAGE CELLDAMAGETEMP
							setvar SHOWDAMAGETYPE 2
							setvarvar SHOWDAMAGEACTORID PLAYERID
							state showdamage
						}
					}
					ifvarg FULLSHIELDDAMAGE 0
					{
						setvar ATTACKINGACTORPICNUM 888
						getactor[THISACTOR].pal TEMP
						setvarvar ATTACKINGACTORPAL TEMP
						setvar ACTORCRITICAL? 0
						setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
						ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
					}
			
					ifvarn player[THISACTOR].over_shoulder_on 0
					{
						ifvarg tempe 0
						{
							setvarvar SHOWDAMAGE tempe
							setvar SHOWDAMAGETYPE 0
							setvarvar SHOWDAMAGEACTORID PLAYERID
							state showdamage
						}
						else ifvarl tempe 0
						{
							setvarvar TEMPHEALTH tempe
							mulvar TEMPHEALTH -1
							state showhealing_playerhp
						}
					}
			
					ifvarg tempe 0
					{
						setvarvar PAINSOUNDFACTOR tempe
						state checkpainfactor
			
						setvar ATTACKINGACTORPICNUM 888
						getactor[THISACTOR].pal TEMP
						setvarvar ATTACKINGACTORPAL TEMP
						setvar ACTORCRITICAL? 0
						setvarvar PLAYERDAMAGETEMP tempe
						setactor[THISACTOR].htpicnum -1
						setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
						setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
						ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
			
						state characterpainsounds
						setvarvar DAMAGEHUEFACTOR tempe
						state playerdamagehues-electrictype
					}
				} 
				else
				{
					sound INVULNITEM3
					palfrom 0 0 0 0
				}
			} 
		} 
	}
ends

state plug_dealdamage
	ifvare mainmenu 0
	{
		ifp pfacing
		{
			ifhitspace
			{
				ifcansee 
				{
					state stopsearchsounds
					setvar MISCARRAYID 26 getactorvar[MISCARRAYID].MISCARRAYID_AMOUNT MISCARRAYID_AMOUNTTEMP // DEATHSWITCH-DELAY
					ifvare MISCARRAYID_AMOUNTTEMP 0
					{
						ifvarand CHEATBITFIELD? 32 nullop else
						{
							ifvarl INVULNTIME 1
							{
								getactor[PLAYERID].z temp
								subvar temp 6144
								ifvarvarg temp KEYSCANNERZUP
								ifvarvarl temp KEYSCANNERZDOWN
								ifvare com_pause 0
								{ 
									sound SHORT_CIRCUIT state sparkstate
									randvar tempe 3
									addvar tempe 2
									setvarvar tempd SKILLLEVEL
									addvar tempd 1
									ifvarl tempd 1 setvar tempd 1
									mulvarvar tempe tempd
									setvarvar tempd SKILLLEVEL
									addvar tempd 1
									divvar tempd 2
									ifvarl tempd 1 setvar tempd 1
									mulvarvar tempe tempd
						
									setvarvar TEMPDAMAGEVAR tempe
									state char_elecdamage_misc // Used by Player [ignores Drivable Tank checks]
									setvarvar tempe TEMPDAMAGEVAR
					
									//*********************
									//*Check Malakian Gems*
									//*********************
									setvarvar TEMP7 tempe
									state malakiangemcheck 
									setvarvar tempe TEMP7
					
									//****************
									//*Support System*
									//****************
									ifvarg tempe 0
									{
										setvar DAMAGEMODIFIER 1000
					
										//**Electric Support / Nethra**
										state support-electricresist
										state damagemod-tempvar          
									}
					
									//*********************************
									//*Support System [ESSence Support*
									//*********************************
									ifvarg tempe 0
									{
										setvar DAMAGEMODIFIER 1000
										//**Overall Support / ESSence**
										state support-overallresist
										state damagemod-tempvar          
									}
					
									//******************
									//*Equipment System*
									//******************
									ifvarg tempe 0
									{
										setvar DAMAGEMODIFIER 1000
										// Equipment Slot #1
										ifvare PLAYEREQUIPSLOTITEM1 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #2
										ifvare PLAYEREQUIPSLOTITEM2 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #3
										ifvare PLAYEREQUIPSLOTITEM3 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #4
										ifvare PLAYEREQUIPSLOTITEM4 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #5
										ifvare PLAYEREQUIPSLOTITEM5 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #6
										ifvare PLAYEREQUIPSLOTITEM6 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #7
										ifvare PLAYEREQUIPSLOTITEM7 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										// Equipment Slot #8
										ifvare PLAYEREQUIPSLOTITEM8 3 addvar DAMAGEMODIFIER -238 // Plasma Ring
										ifvarl DAMAGEMODIFIER 0 setvar DAMAGEMODIFIER 0
										state damagemod-tempvar          
									}
									// Nyx Gloves Deterrant
									ifvarg tempe 0
									{
										state nyxgloveschecker
										ifvarg DAMAGEMODIFIER 0 setvar tempe 0
									}
					
									ifvare DAMAGEMODIFIER 0 { ifvarand CHEATBITFIELD? 16 { ifvarg tempe 1 { divvar tempe 1000 ifvarl tempe 1 setvar tempe 1 state cheatersound } } }
					
									setvarvar TEMPDAMAGEVAR tempe
									state lisashield_misc
									setvarvar tempe TEMPDAMAGEVAR
						
									setvarvar tempb CURRENTHITPOINTS
									subvarvar tempb tempe
									ifvarl tempe 0 setvar PLAYERHPDAMAGED? -1
									else ifvarg tempe 0 setvar PLAYERHPDAMAGED? 1
									ifvarl tempb 0 setvar tempb 0
									ifvarvarg tempb MAXHITPOINTSATOMIC setvarvar tempb MAXHITPOINTSATOMIC
									setactor[PLAYERID].htpicnum -1
									setvarvar CURRENTHITPOINTS tempb
									state checkbuddhamode
						
									ifvarn player[THISACTOR].over_shoulder_on 0
									{
										ifvarg CELLDAMAGETEMP 0
										{
											setvarvar SHOWDAMAGE CELLDAMAGETEMP
											setvar SHOWDAMAGETYPE 2
											setvarvar SHOWDAMAGEACTORID PLAYERID
											state showdamage
										}
									}
									ifvarg FULLSHIELDDAMAGE 0
									{
										setvar ATTACKINGACTORPICNUM 5175
										getactor[THISACTOR].pal TEMP
										setvarvar ATTACKINGACTORPAL TEMP
										setvar ACTORCRITICAL? 0
										setvar ATTACKERDISPLAYTIMER 0 setvar BIOSHIELDNULLDAMAGE 0
										ifvarg FULLSHIELDDAMAGE 0 setvar CELLDAMAGETIMER 0
									}
						
									ifvarn player[THISACTOR].over_shoulder_on 0
									{
										ifvarg tempe 0
										{
											setvarvar SHOWDAMAGE tempe
											setvar SHOWDAMAGETYPE 0
											setvarvar SHOWDAMAGEACTORID PLAYERID
											state showdamage
										}
										else ifvarl tempe 0
										{
											setvarvar TEMPHEALTH tempe
											mulvar TEMPHEALTH -1
											state showhealing_playerhp
										}
									}
					
									ifvarg tempe 0
									{
										setvarvar PAINSOUNDFACTOR tempe
										state checkpainfactor
					
										setvar ATTACKINGACTORPICNUM 5175
										getactor[THISACTOR].pal TEMP
										setvarvar ATTACKINGACTORPAL TEMP
										setvar ACTORCRITICAL? 0
										setvarvar PLAYERDAMAGETEMP tempe
										setactor[THISACTOR].htpicnum -1
										setvarvar TEMPHITCHARACTERVAR CHARACTERSELECTED?
										setvar ATTACKERDISPLAYTIMER 0 setvar NULLDAMAGE 0
										ifvarg tempe 0 setvar HEALTHDAMAGETIMER 0
					
										state characterpainsounds
										setvarvar DAMAGEHUEFACTOR tempe
										state playerdamagehues-electrictype
									}
						
									setvar com_pause 10 // This sets a delay between presses of space so that everything doesn't happen at once.
								}
							} 
							else
							{
								ifvare com_pause 0
								{ 
									sound INVULNITEM3
									palfrom 0 0 0 0
									setvar com_pause 10 // This sets a delay between presses of space so that everything doesn't happen at once.
								}
							}
						} 
					} 
				}
			}
		}
	}
ends

// Extraneous States
// End Extraneous States